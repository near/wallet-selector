"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[7174],{30891:(R,D,i)=>{i.d(D,{nY:()=>s});var u=i(49671),I=i(24688),B=i(99071),l=i(37069),U=i(86450),C=i(64599),v=i(36882),P=i(18445),A=i(29820),g=i(22917),m=i(21838),d=i(20597),k=i(10053);const h={getTokenList:()=>(0,u.Z)(function*(){const o=d.R.state.activeCaipNetwork;return(yield m.L.fetchSwapTokens({chainId:o?.caipNetworkId}))?.tokens?.map(r=>({...r,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0}))||[]})(),fetchGasPrice:()=>(0,u.Z)(function*(){const o=d.R.state.activeCaipNetwork;if(!o)return null;try{if("solana"===o.chainNamespace){const n=(yield k.ConnectionController?.estimateGas({chainNamespace:"solana"}))?.toString();return{standard:n,fast:n,instant:n}}return yield m.L.fetchGasPrice({chainId:o.caipNetworkId})}catch{return null}})(),fetchSwapAllowance:({tokenAddress:o,userAddress:n,sourceTokenAmount:t,sourceTokenDecimals:r})=>(0,u.Z)(function*(){const a=yield m.L.fetchSwapAllowance({tokenAddress:o,userAddress:n});if(a?.allowance&&t&&r){const c=k.ConnectionController.parseUnits(t,r)||0;return BigInt(a.allowance)>=c}return!1})(),getMyTokensWithBalance(o){var n=this;return(0,u.Z)(function*(){const t=g.AccountController.state.address,r=d.R.state.activeCaipNetwork;if(!t||!r)return[];const c=(yield m.L.getBalance(t,r.caipNetworkId,o)).balances.filter(T=>"0"!==T.quantity.decimals);return g.AccountController.setTokenBalance(c,d.R.state.activeChain),n.mapBalancesToSwapTokens(c)})()},mapBalancesToSwapTokens:o=>o?.map(n=>({...n,address:n?.address?n.address:d.R.getActiveNetworkTokenAddress(),decimals:parseInt(n.quantity.decimals,10),logoUri:n.iconUrl,eip2612:!1}))||[]},f={getGasPriceInEther:(o,n)=>Number(n*o)/1e18,getGasPriceInUSD(o,n,t){const r=f.getGasPriceInEther(n,t);return l.C.bigNumber(o).times(r).toNumber()},getPriceImpact({sourceTokenAmount:o,sourceTokenPriceInUSD:n,toTokenPriceInUSD:t,toTokenAmount:r}){const a=l.C.bigNumber(o).times(n),c=l.C.bigNumber(r).times(t);return a.minus(c).div(a).times(100).toNumber()},getMaxSlippage(o,n){const t=l.C.bigNumber(o).div(100);return l.C.multiply(n,t).toNumber()},getProviderFee:(o,n=.0085)=>l.C.bigNumber(o).times(n).toString(),isInsufficientNetworkTokenForGas(o,n){const t=n||"0";return!!l.C.bigNumber(o).eq(0)||l.C.bigNumber(l.C.bigNumber(t)).gt(o)},isInsufficientSourceTokenForSwap(o,n,t){const r=t?.find(c=>c.address===n)?.quantity?.numeric;return l.C.bigNumber(r||"0").lt(o)},getToTokenAmount({sourceToken:o,toToken:n,sourceTokenPrice:t,toTokenPrice:r,sourceTokenAmount:a}){if("0"===a||!o||!n)return"0";const c=o.decimals,T=t,p=n.decimals,y=r;if(y<=0)return"0";const F=l.C.bigNumber(a).times(.0085),G=l.C.bigNumber(a).minus(F).times(l.C.bigNumber(10).pow(c)),Z=l.C.bigNumber(T).div(y),j=c-p;return G.times(Z).div(l.C.bigNumber(10).pow(j)).div(l.C.bigNumber(10).pow(p)).toFixed(p).toString()}};var b=i(34198),E=i(13314),x=i(86424),L=i(79282),N=i(24380),S=i(76169);const O=15e4;const w={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:v.bq.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},e=(0,I.sj)(w),M={state:e,subscribe:o=>(0,I.Ld)(e,()=>o(e)),subscribeKey:(o,n)=>(0,B.VW)(e,o,n),getParams(){const o=d.R.state.activeCaipAddress,n=d.R.state.activeChain,t=P.j.getPlainAddress(o),r=d.R.getActiveNetworkTokenAddress(),a=x.ConnectorController.getConnectorId(n);if(!t)throw new Error("No address found to swap the tokens from.");const c=!e.toToken?.address||!e.toToken?.decimals,T=!e.sourceToken?.address||!e.sourceToken?.decimals||!l.C.bigNumber(e.sourceTokenAmount).gt(0),p=!e.sourceTokenAmount;return{networkAddress:r,fromAddress:t,fromCaipAddress:o,sourceTokenAddress:e.sourceToken?.address,toTokenAddress:e.toToken?.address,toTokenAmount:e.toTokenAmount,toTokenDecimals:e.toToken?.decimals,sourceTokenAmount:e.sourceTokenAmount,sourceTokenDecimals:e.sourceToken?.decimals,invalidToToken:c,invalidSourceToken:T,invalidSourceTokenAmount:p,availableToSwap:o&&!c&&!T&&!p,isAuthConnector:a===U.b.CONNECTOR_ID.AUTH}},setSourceToken(o){if(!o)return e.sourceToken=o,e.sourceTokenAmount="",void(e.sourceTokenPriceInUSD=0);e.sourceToken=o,s.setTokenPrice(o.address,"sourceToken")},setSourceTokenAmount(o){e.sourceTokenAmount=o},setToToken(o){if(!o)return e.toToken=o,e.toTokenAmount="",void(e.toTokenPriceInUSD=0);e.toToken=o,s.setTokenPrice(o.address,"toToken")},setToTokenAmount(o){e.toTokenAmount=o?l.C.formatNumberToLocalString(o,6):""},setTokenPrice:(o,n)=>(0,u.Z)(function*(){let t=e.tokensPriceMap[o]||0;t||(e.loadingPrices=!0,t=yield s.getAddressPrice(o)),"sourceToken"===n?e.sourceTokenPriceInUSD=t:"toToken"===n&&(e.toTokenPriceInUSD=t),e.loadingPrices&&(e.loadingPrices=!1),s.getParams().availableToSwap&&s.swapTokens()})(),switchTokens(){if(e.initializing||!e.initialized)return;const o=e.toToken?{...e.toToken}:void 0,n=e.sourceToken?{...e.sourceToken}:void 0,t=o&&""===e.toTokenAmount?"1":e.toTokenAmount;s.setSourceToken(o),s.setToToken(n),s.setSourceTokenAmount(t),s.setToTokenAmount(""),s.swapTokens()},resetState(){e.myTokensWithBalance=w.myTokensWithBalance,e.tokensPriceMap=w.tokensPriceMap,e.initialized=w.initialized,e.sourceToken=w.sourceToken,e.sourceTokenAmount=w.sourceTokenAmount,e.sourceTokenPriceInUSD=w.sourceTokenPriceInUSD,e.toToken=w.toToken,e.toTokenAmount=w.toTokenAmount,e.toTokenPriceInUSD=w.toTokenPriceInUSD,e.networkPrice=w.networkPrice,e.networkTokenSymbol=w.networkTokenSymbol,e.networkBalanceInUSD=w.networkBalanceInUSD,e.inputError=w.inputError,e.myTokensWithBalance=w.myTokensWithBalance},resetValues(){const{networkAddress:o}=s.getParams(),n=e.tokens?.find(t=>t.address===o);s.setSourceToken(n),s.setToToken(void 0)},getApprovalLoadingState:()=>e.loadingApprovalTransaction,clearError(){e.transactionError=void 0},initializeState:()=>(0,u.Z)(function*(){if(!e.initializing){if(e.initializing=!0,!e.initialized)try{yield s.fetchTokens(),e.initialized=!0}catch{e.initialized=!1,S.SnackController.showError("Failed to initialize swap"),N.RouterController.goBack()}e.initializing=!1}})(),fetchTokens:()=>(0,u.Z)(function*(){const{networkAddress:o}=s.getParams();yield s.getTokenList(),yield s.getNetworkTokenPrice(),yield s.getMyTokensWithBalance();const n=e.tokens?.find(t=>t.address===o);n&&(e.networkTokenSymbol=n.symbol,s.setSourceToken(n),s.setSourceTokenAmount("1"))})(),getTokenList:()=>(0,u.Z)(function*(){const o=yield h.getTokenList();e.tokens=o,e.popularTokens=o.sort((n,t)=>n.symbol<t.symbol?-1:n.symbol>t.symbol?1:0),e.suggestedTokens=o.filter(n=>!!v.bq.SWAP_SUGGESTED_TOKENS.includes(n.symbol),{})})(),getAddressPrice:o=>(0,u.Z)(function*(){const n=e.tokensPriceMap[o];if(n)return n;const r=(yield m.L.fetchTokenPrice({addresses:[o]}))?.fungibles||[],c=[...e.tokens||[],...e.myTokensWithBalance||[]]?.find(y=>y.address===o)?.symbol,T=r.find(y=>y.symbol.toLowerCase()===c?.toLowerCase())?.price||0,p=parseFloat(T.toString());return e.tokensPriceMap[o]=p,p})(),getNetworkTokenPrice:()=>(0,u.Z)(function*(){const{networkAddress:o}=s.getParams(),t=(yield m.L.fetchTokenPrice({addresses:[o]}).catch(()=>(S.SnackController.showError("Failed to fetch network token price"),{fungibles:[]}))).fungibles?.[0],r=t?.price.toString()||"0";e.tokensPriceMap[o]=parseFloat(r),e.networkTokenSymbol=t?.symbol||"",e.networkPrice=r})(),getMyTokensWithBalance:o=>(0,u.Z)(function*(){const n=yield A.y.getMyTokensWithBalance(o),t=A.y.mapBalancesToSwapTokens(n);t&&(yield s.getInitialGasPrice(),s.setBalances(t))})(),setBalances(o){const{networkAddress:n}=s.getParams(),t=d.R.state.activeCaipNetwork;if(!t)return;const r=o.find(a=>a.address===n);o.forEach(a=>{e.tokensPriceMap[a.address]=a.price||0}),e.myTokensWithBalance=o.filter(a=>a.address.startsWith(t.caipNetworkId)),e.networkBalanceInUSD=r?l.C.multiply(r.quantity.numeric,r.price).toString():"0"},getInitialGasPrice:()=>(0,u.Z)(function*(){const o=yield h.fetchGasPrice();if(!o)return{gasPrice:null,gasPriceInUSD:null};if("solana"===d.R.state?.activeCaipNetwork?.chainNamespace)return e.gasFee=o.standard??"0",e.gasPriceInUSD=l.C.multiply(o.standard,e.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(e.gasFee),gasPriceInUSD:Number(e.gasPriceInUSD)};{const n=o.standard??"0",t=BigInt(n),r=BigInt(O),a=f.getGasPriceInUSD(e.networkPrice,r,t);return e.gasFee=n,e.gasPriceInUSD=a,{gasPrice:t,gasPriceInUSD:a}}})(),swapTokens:()=>(0,u.Z)(function*(){const o=g.AccountController.state.address,n=e.sourceToken,t=e.toToken,r=l.C.bigNumber(e.sourceTokenAmount).gt(0);if(r||s.setToTokenAmount(""),!t||!n||e.loadingPrices||!r)return;e.loadingQuote=!0;const a=l.C.bigNumber(e.sourceTokenAmount).times(10**n.decimals).round(0);try{const c=yield m.L.fetchSwapQuote({userAddress:o,from:n.address,to:t.address,gasPrice:e.gasFee,amount:a.toString()});e.loadingQuote=!1;const T=c?.quotes?.[0]?.toAmount;if(!T)return void E.AlertController.open({shortMessage:"Incorrect amount",longMessage:"Please enter a valid amount"},"error");const p=l.C.bigNumber(T).div(10**t.decimals).toString();s.setToTokenAmount(p),s.hasInsufficientToken(e.sourceTokenAmount,n.address)?e.inputError="Insufficient balance":(e.inputError=void 0,s.setTransactionDetails())}catch{e.loadingQuote=!1,e.inputError="Insufficient balance"}})(),getTransaction:()=>(0,u.Z)(function*(){const{fromCaipAddress:o,availableToSwap:n}=s.getParams(),t=e.sourceToken,r=e.toToken;if(o&&n&&t&&r&&!e.loadingQuote)try{e.loadingBuildTransaction=!0;let c;return c=(yield h.fetchSwapAllowance({userAddress:o,tokenAddress:t.address,sourceTokenAmount:e.sourceTokenAmount,sourceTokenDecimals:t.decimals}))?yield s.createSwapTransaction():yield s.createAllowanceTransaction(),e.loadingBuildTransaction=!1,e.fetchError=!1,c}catch{return N.RouterController.goBack(),S.SnackController.showError("Failed to check allowance"),e.loadingBuildTransaction=!1,e.approvalTransaction=void 0,e.swapTransaction=void 0,void(e.fetchError=!0)}})(),createAllowanceTransaction:()=>(0,u.Z)(function*(){const{fromCaipAddress:o,sourceTokenAddress:n,toTokenAddress:t}=s.getParams();if(o&&t){if(!n)throw new Error("createAllowanceTransaction - No source token address found.");try{const r=yield m.L.generateApproveCalldata({from:n,to:t,userAddress:o}),a={data:r.tx.data,to:P.j.getPlainAddress(r.tx.from),gasPrice:BigInt(r.tx.eip155.gasPrice),value:BigInt(r.tx.value),toAmount:e.toTokenAmount};return e.swapTransaction=void 0,e.approvalTransaction={data:a.data,to:a.to,gasPrice:a.gasPrice,value:a.value,toAmount:a.toAmount},{data:a.data,to:a.to,gasPrice:a.gasPrice,value:a.value,toAmount:a.toAmount}}catch{return N.RouterController.goBack(),S.SnackController.showError("Failed to create approval transaction"),e.approvalTransaction=void 0,e.swapTransaction=void 0,void(e.fetchError=!0)}}})(),createSwapTransaction:()=>(0,u.Z)(function*(){const{networkAddress:o,fromCaipAddress:n,sourceTokenAmount:t}=s.getParams(),r=e.sourceToken,a=e.toToken;if(!(n&&t&&r&&a))return;const c=k.ConnectionController.parseUnits(t,r.decimals)?.toString();try{const T=yield m.L.generateSwapCalldata({userAddress:n,from:r.address,to:a.address,amount:c,disableEstimate:!0}),p=r.address===o,y=BigInt(T.tx.eip155.gas),F=BigInt(T.tx.eip155.gasPrice),W={data:T.tx.data,to:P.j.getPlainAddress(T.tx.to),gas:y,gasPrice:F,value:BigInt(p?c??"0":"0"),toAmount:e.toTokenAmount};return e.gasPriceInUSD=f.getGasPriceInUSD(e.networkPrice,y,F),e.approvalTransaction=void 0,e.swapTransaction=W,W}catch{return N.RouterController.goBack(),S.SnackController.showError("Failed to create transaction"),e.approvalTransaction=void 0,e.swapTransaction=void 0,void(e.fetchError=!0)}})(),sendTransactionForApproval:o=>(0,u.Z)(function*(){const{fromAddress:n,isAuthConnector:t}=s.getParams();e.loadingApprovalTransaction=!0;const r="Approve limit increase in your wallet";t?N.RouterController.pushTransactionStack({onSuccess(){S.SnackController.showLoading(r)}}):S.SnackController.showLoading(r);try{yield k.ConnectionController.sendTransaction({address:n,to:o.to,data:o.data,value:o.value,chainNamespace:"eip155"}),yield s.swapTokens(),yield s.getTransaction(),e.approvalTransaction=void 0,e.loadingApprovalTransaction=!1}catch(a){const c=a;e.transactionError=c?.shortMessage,e.loadingApprovalTransaction=!1,S.SnackController.showError(c?.shortMessage||"Transaction error"),L.X.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:c?.shortMessage||c?.message||"Unknown",network:d.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:s.state.sourceToken?.symbol||"",swapToToken:s.state.toToken?.symbol||"",swapFromAmount:s.state.sourceTokenAmount||"",swapToAmount:s.state.toTokenAmount||"",isSmartAccount:g.AccountController.state.preferredAccountTypes?.eip155===C.y_.ACCOUNT_TYPES.SMART_ACCOUNT}})}})(),sendTransactionForSwap:o=>(0,u.Z)(function*(){if(!o)return;const{fromAddress:n,toTokenAmount:t,isAuthConnector:r}=s.getParams();e.loadingTransaction=!0;const a=`Swapping ${e.sourceToken?.symbol} to ${l.C.formatNumberToLocalString(t,3)} ${e.toToken?.symbol}`,c=`Swapped ${e.sourceToken?.symbol} to ${l.C.formatNumberToLocalString(t,3)} ${e.toToken?.symbol}`;r?N.RouterController.pushTransactionStack({onSuccess(){N.RouterController.replace("Account"),S.SnackController.showLoading(a),M.resetState()}}):S.SnackController.showLoading("Confirm transaction in your wallet");try{const T=[e.sourceToken?.address,e.toToken?.address].join(","),p=yield k.ConnectionController.sendTransaction({address:n,to:o.to,data:o.data,value:o.value,chainNamespace:"eip155"});return e.loadingTransaction=!1,S.SnackController.showSuccess(c),L.X.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:d.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:s.state.sourceToken?.symbol||"",swapToToken:s.state.toToken?.symbol||"",swapFromAmount:s.state.sourceTokenAmount||"",swapToAmount:s.state.toTokenAmount||"",isSmartAccount:g.AccountController.state.preferredAccountTypes?.eip155===C.y_.ACCOUNT_TYPES.SMART_ACCOUNT}}),M.resetState(),r||N.RouterController.replace("Account"),M.getMyTokensWithBalance(T),p}catch(T){const p=T;return e.transactionError=p?.shortMessage,e.loadingTransaction=!1,S.SnackController.showError(p?.shortMessage||"Transaction error"),void L.X.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:p?.shortMessage||p?.message||"Unknown",network:d.R.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:s.state.sourceToken?.symbol||"",swapToToken:s.state.toToken?.symbol||"",swapFromAmount:s.state.sourceTokenAmount||"",swapToAmount:s.state.toTokenAmount||"",isSmartAccount:g.AccountController.state.preferredAccountTypes?.eip155===C.y_.ACCOUNT_TYPES.SMART_ACCOUNT}})}})(),hasInsufficientToken:(o,n)=>f.isInsufficientSourceTokenForSwap(o,n,e.myTokensWithBalance),setTransactionDetails(){const{toTokenAddress:o,toTokenDecimals:n}=s.getParams();!o||!n||(e.gasPriceInUSD=f.getGasPriceInUSD(e.networkPrice,BigInt(e.gasFee),BigInt(O)),e.priceImpact=f.getPriceImpact({sourceTokenAmount:e.sourceTokenAmount,sourceTokenPriceInUSD:e.sourceTokenPriceInUSD,toTokenPriceInUSD:e.toTokenPriceInUSD,toTokenAmount:e.toTokenAmount}),e.maxSlippage=f.getMaxSlippage(e.slippage,e.toTokenAmount),e.providerFee=f.getProviderFee(e.sourceTokenAmount))}},s=(0,b.P)(M)},51078:(R,D,i)=>{i(72686)},44448:(R,D,i)=>{i(87162)},66799:(R,D,i)=>{var u=i(59799),I=i(86523),U=(i(11252),i(10831),i(25518)),C=i(70075);i(87538);const P=u.iv`
  :host {
    display: block;
  }

  :host > button {
    gap: var(--wui-spacing-xxs);
    padding: var(--wui-spacing-xs);
    padding-right: var(--wui-spacing-1xs);
    height: 40px;
    border-radius: var(--wui-border-radius-l);
    background: var(--wui-color-gray-glass-002);
    border-width: 0px;
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-002);
  }

  :host > button wui-image {
    width: 24px;
    height: 24px;
    border-radius: var(--wui-border-radius-s);
    box-shadow: inset 0 0 0 1px var(--wui-color-gray-glass-010);
  }
`;var A=function(m,d,k,h){var E,f=arguments.length,b=f<3?d:null===h?h=Object.getOwnPropertyDescriptor(d,k):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)b=Reflect.decorate(m,d,k,h);else for(var x=m.length-1;x>=0;x--)(E=m[x])&&(b=(f<3?E(b):f>3?E(d,k,b):E(d,k))||b);return f>3&&b&&Object.defineProperty(d,k,b),b};let g=class extends u.oi{constructor(){super(...arguments),this.text=""}render(){return u.dy`
      <button>
        ${this.tokenTemplate()}
        <wui-text variant="paragraph-600" color="fg-100">${this.text}</wui-text>
      </button>
    `}tokenTemplate(){return this.imageSrc?u.dy`<wui-image src=${this.imageSrc}></wui-image>`:u.dy`
      <wui-icon-box
        size="sm"
        iconColor="fg-200"
        backgroundColor="fg-300"
        icon="networkPlaceholder"
      ></wui-icon-box>
    `}};g.styles=[U.ET,U.ZM,P],A([(0,I.Cb)()],g.prototype,"imageSrc",void 0),A([(0,I.Cb)()],g.prototype,"text",void 0),g=A([(0,C.M)("wui-token-button")],g)},11252:(R,D,i)=>{var u=i(59799),I=i(86523),B=i(25518),l=i(70075);const U=u.iv`
  :host {
    display: block;
    width: var(--local-width);
    height: var(--local-height);
  }

  img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center center;
    border-radius: inherit;
  }
`;var C=function(P,A,g,m){var h,d=arguments.length,k=d<3?A:null===m?m=Object.getOwnPropertyDescriptor(A,g):m;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)k=Reflect.decorate(P,A,g,m);else for(var f=P.length-1;f>=0;f--)(h=P[f])&&(k=(d<3?h(k):d>3?h(A,g,k):h(A,g))||k);return d>3&&k&&Object.defineProperty(A,g,k),k};let v=class extends u.oi{constructor(){super(...arguments),this.src="./path/to/image.jpg",this.alt="Image",this.size=void 0}render(){return this.style.cssText=`\n      --local-width: ${this.size?`var(--wui-icon-size-${this.size});`:"100%"};\n      --local-height: ${this.size?`var(--wui-icon-size-${this.size});`:"100%"};\n      `,u.dy`<img src=${this.src} alt=${this.alt} @error=${this.handleImageError} />`}handleImageError(){this.dispatchEvent(new CustomEvent("onLoadError",{bubbles:!0,composed:!0}))}};v.styles=[B.ET,B.Bp,U],C([(0,I.Cb)()],v.prototype,"src",void 0),C([(0,I.Cb)()],v.prototype,"alt",void 0),C([(0,I.Cb)()],v.prototype,"size",void 0),v=C([(0,l.M)("wui-image")],v)}}]);