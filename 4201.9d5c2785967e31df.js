"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[4201],{54201:(_E,xo,T)=>{T.r(xo),T.d(xo,{EthereumProvider:()=>sE,OPTIONAL_EVENTS:()=>pl,OPTIONAL_METHODS:()=>hl,REQUIRED_EVENTS:()=>ui,REQUIRED_METHODS:()=>ci,default:()=>hi});var pi={};T.r(pi),T.d(pi,{identity:()=>id});var fi={};T.r(fi),T.d(fi,{base2:()=>sd});var gi={};T.r(gi),T.d(gi,{base8:()=>od});var yi={};T.r(yi),T.d(yi,{base10:()=>ad});var mi={};T.r(mi),T.d(mi,{base16:()=>cd,base16upper:()=>ud});var _i={};T.r(_i),T.d(_i,{base32:()=>Zn,base32hex:()=>pd,base32hexpad:()=>gd,base32hexpadupper:()=>yd,base32hexupper:()=>fd,base32pad:()=>dd,base32padupper:()=>hd,base32upper:()=>ld,base32z:()=>md});var bi={};T.r(bi),T.d(bi,{base36:()=>_d,base36upper:()=>bd});var vi={};T.r(vi),T.d(vi,{base58btc:()=>_t,base58flickr:()=>vd});var wi={};T.r(wi),T.d(wi,{base64:()=>wd,base64pad:()=>Dd,base64url:()=>Ed,base64urlpad:()=>xd});var Di={};T.r(Di),T.d(Di,{base256emoji:()=>Od});var Ei={};T.r(Ei),T.d(Ei,{sha256:()=>Qd,sha512:()=>Yd});var xi={};T.r(xi),T.d(xi,{identity:()=>eh});var Ii={};T.r(Ii),T.d(Ii,{code:()=>nh,decode:()=>ih,encode:()=>rh,name:()=>th});var Ci={};T.r(Ci),T.d(Ci,{code:()=>ch,decode:()=>lh,encode:()=>uh,name:()=>ah});var Pi={};T.r(Pi),T.d(Pi,{identity:()=>Qy});var Si={};T.r(Si),T.d(Si,{base2:()=>Yy});var Oi={};T.r(Oi),T.d(Oi,{base8:()=>Xy});var Ai={};T.r(Ai),T.d(Ai,{base10:()=>em});var Ri={};T.r(Ri),T.d(Ri,{base16:()=>tm,base16upper:()=>nm});var Ni={};T.r(Ni),T.d(Ni,{base32:()=>or,base32hex:()=>om,base32hexpad:()=>cm,base32hexpadupper:()=>um,base32hexupper:()=>am,base32pad:()=>im,base32padupper:()=>sm,base32upper:()=>rm,base32z:()=>lm});var Ti={};T.r(Ti),T.d(Ti,{base36:()=>dm,base36upper:()=>hm});var Fi={};T.r(Fi),T.d(Fi,{base58btc:()=>It,base58flickr:()=>pm});var ji={};T.r(ji),T.d(ji,{base64:()=>fm,base64pad:()=>gm,base64url:()=>ym,base64urlpad:()=>mm});var $i={};T.r($i),T.d($i,{base256emoji:()=>Dm});var Ui={};T.r(Ui),T.d(Ui,{sha256:()=>Zm,sha512:()=>Vm});var Bi={};T.r(Bi),T.d(Bi,{identity:()=>Km});var qi={};T.r(qi),T.d(qi,{code:()=>Jm,decode:()=>Qm,encode:()=>Wm,name:()=>Gm});var Mi={};T.r(Mi),T.d(Mi,{code:()=>t_,decode:()=>r_,encode:()=>n_,name:()=>e_});var f=T(49671),gt=T(82016),ki=T.n(gt),bl=T(11653),$=T(35409),yt=T(20439),vl=T(66534);let _r={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:"viem@2.23.2"};class Ut extends Error{constructor(e,t={}){const i=t.cause instanceof Ut?t.cause.details:t.cause?.message?t.cause.message:t.details,s=t.cause instanceof Ut&&t.cause.docsPath||t.docsPath,o=_r.getDocsUrl?.({...t,docsPath:s});super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...i?[`Details: ${i}`]:[],..._r.version?[`Version: ${_r.version}`]:[]].join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version="2.23.2"}walk(e){return Co(this,e)}}function Co(r,e){return e?.(r)?r:r&&"object"==typeof r&&"cause"in r&&void 0!==r.cause?Co(r.cause,e):e?null:r}function kn(r,{strict:e=!0}={}){return!(!r||"string"!=typeof r)&&(e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x"))}class Po extends Ut{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function nn(r,{dir:e,size:t=32}={}){return"string"==typeof r?function wl(r,{dir:e,size:t=32}={}){if(null===t)return r;const i=r.replace("0x","");if(i.length>2*t)throw new Po({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i["right"===e?"padEnd":"padStart"](2*t,"0")}`}(r,{dir:e,size:t}):function Dl(r,{dir:e,size:t=32}={}){if(null===t)return r;if(r.length>t)throw new Po({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const o="right"===e;i[o?s:t-s-1]=r[o?s:r.length-s-1]}return i}(r,{dir:e,size:t})}class El extends Ut{constructor({max:e,min:t,signed:i,size:s,value:o}){super(`Number "${o}" is not in safe ${s?`${8*s}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class xl extends Ut{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function So(r){return kn(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}function St(r,{size:e}){if(So(r)>e)throw new xl({givenSize:So(r),maxSize:e})}function br(r,e={}){const{signed:t}=e;e.size&&St(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2;return i<=(1n<<8n*BigInt(s)-1n)-1n?i:i-BigInt(`0x${"f".padStart(2*s,"f")}`)-1n}function Oo(r,e={}){return Number(br(r,e))}const Pl=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Li(r,e={}){return"number"==typeof r||"bigint"==typeof r?Ro(r,e):"string"==typeof r?function Al(r,e={}){const t=Ol.encode(r);return Ao(t,e)}(r,e):"boolean"==typeof r?function Sl(r,e={}){const t=`0x${Number(r)}`;return"number"==typeof e.size?(St(t,{size:e.size}),nn(t,{size:e.size})):t}(r,e):Ao(r,e)}function Ao(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=Pl[r[s]];const i=`0x${t}`;return"number"==typeof e.size?(St(i,{size:e.size}),nn(i,{dir:"right",size:e.size})):i}function Ro(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let o;i?o=t?(1n<<8n*BigInt(i)-1n)-1n:2n**(8n*BigInt(i))-1n:"number"==typeof r&&(o=BigInt(Number.MAX_SAFE_INTEGER));const a="bigint"==typeof o&&t?-o-1n:0;if(o&&s>o||s<a){const u="bigint"==typeof r?"n":"";throw new El({max:o?`${o}${u}`:void 0,min:`${a}${u}`,signed:t,size:i,value:`${r}${u}`})}const c=`0x${(t&&s<0?(1n<<BigInt(8*i))+BigInt(s):s).toString(16)}`;return i?nn(c,{size:i}):c}const Ol=new TextEncoder;const Rl=new TextEncoder;function Nl(r,e={}){return"number"==typeof r||"bigint"==typeof r?function Fl(r,e){const t=Ro(r,e);return To(t)}(r,e):"boolean"==typeof r?function Tl(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),"number"==typeof e.size?(St(t,{size:e.size}),nn(t,{size:e.size})):t}(r,e):kn(r)?To(r,e):Fo(r,e)}const mt={zero:48,nine:57,A:65,F:70,a:97,f:102};function No(r){return r>=mt.zero&&r<=mt.nine?r-mt.zero:r>=mt.A&&r<=mt.F?r-(mt.A-10):r>=mt.a&&r<=mt.f?r-(mt.a-10):void 0}function To(r,e={}){let t=r;e.size&&(St(t,{size:e.size}),t=nn(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=No(i.charCodeAt(c++)),d=No(i.charCodeAt(c++));if(void 0===u||void 0===d)throw new Ut(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=16*u+d}return o}function Fo(r,e={}){const t=Rl.encode(r);return"number"==typeof e.size?(St(t,{size:e.size}),nn(t,{dir:"right",size:e.size})):t}var jl=T(65846);function jo(r,e){const t=e||"hex",i=(0,jl.fr)(kn(r,{strict:!1})?Nl(r):r);return"bytes"===t?i:Li(i)}class $l extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const zi=new $l(8192);function $o(r,e){if(zi.has(`${r}.${e}`))return zi.get(`${r}.${e}`);const t=e?`${e}${r.toLowerCase()}`:r.substring(2).toLowerCase(),i=jo(Fo(t),"bytes"),s=(e?t.substring(`${e}0x`.length):t).split("");for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&s[a]&&(s[a]=s[a].toUpperCase()),(15&i[a>>1])>=8&&s[a+1]&&(s[a+1]=s[a+1].toUpperCase());const o=`0x${s.join("")}`;return zi.set(`${r}.${e}`,o),o}function Zi(){return(Zi=(0,f.Z)(function*({hash:r,signature:e}){const t=kn(r)?r:Li(r),{secp256k1:i}=yield Promise.all([T.e(8592),T.e(8344)]).then(T.bind(T,78344));return`0x${(()=>{if("object"==typeof e&&"r"in e&&"s"in e){const{r:d,s:h,v:p,yParity:g}=e,y=Uo(Number(g??p));return new i.Signature(br(d),br(h)).addRecoveryBit(y)}const a=kn(e)?e:Li(e),u=Uo(Oo(`0x${a.slice(130)}`));return i.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(u)})().recoverPublicKey(t.substring(2)).toHex(!1)}`})).apply(this,arguments)}function Uo(r){if(0===r||1===r)return r;if(27===r)return 0;if(28===r)return 1;throw new Error("Invalid yParityOrV value")}function Vi(){return Vi=(0,f.Z)(function*({hash:r,signature:e}){return function Ul(r){return $o(`0x${jo(`0x${r.substring(4)}`).substring(26)}`)}(yield function Bl(r){return Zi.apply(this,arguments)}({hash:r,signature:e}))}),Vi.apply(this,arguments)}const kl=function Ml(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let d=0;d<e.length;d++)e[d]=255;for(let d=0;d<r.length;d++){const h=r.charAt(d),p=h.charCodeAt(0);if(255!==e[p])throw new TypeError(h+" is ambiguous");e[p]=d}const t=r.length,i=r.charAt(0),s=Math.log(t)/Math.log(256),o=Math.log(256)/Math.log(t);function c(d){if("string"!=typeof d)throw new TypeError("Expected String");if(0===d.length)return new Uint8Array;let h=0,p=0,g=0;for(;d[h]===i;)p++,h++;const b=(d.length-h)*s+1>>>0,y=new Uint8Array(b);for(;d[h];){let w=e[d.charCodeAt(h)];if(255===w)return;let E=0;for(let D=b-1;(0!==w||E<g)&&-1!==D;D--,E++)w+=t*y[D]>>>0,y[D]=w%256>>>0,w=w/256>>>0;if(0!==w)throw new Error("Non-zero carry");g=E,h++}let m=b-g;for(;m!==b&&0===y[m];)m++;const _=new Uint8Array(p+(b-m));let v=p;for(;m!==b;)_[v++]=y[m++];return _}return{encode:function a(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===d.length)return"";let h=0,p=0,g=0;const b=d.length;for(;g!==b&&0===d[g];)g++,h++;const y=(b-g)*o+1>>>0,m=new Uint8Array(y);for(;g!==b;){let w=d[g],E=0;for(let D=y-1;(0!==w||E<p)&&-1!==D;D--,E++)w+=256*m[D]>>>0,m[D]=w%t>>>0,w=w/t>>>0;if(0!==w)throw new Error("Non-zero carry");p=E,g++}let _=y-p;for(;_!==y&&0===m[_];)_++;let v=i.repeat(h);for(;_<y;++_)v+=r.charAt(m[_]);return v},decodeUnsafe:c,decode:function u(d){const h=c(d);if(h)return h;throw new Error("Non-base"+t+" character")}}};const zl=kl("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var Bt=T(21164);function Bo(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Ln(r,e){e||(e=r.reduce((s,o)=>s+o.length,0));const t=Bo(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}var Vl=function Zl(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=s}var c=r.length,u=r.charAt(0),d=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function g(y){if("string"!=typeof y)throw new TypeError("Expected String");if(0===y.length)return new Uint8Array;var m=0;if(" "!==y[m]){for(var _=0,v=0;y[m]===u;)_++,m++;for(var w=(y.length-m)*d+1>>>0,E=new Uint8Array(w);y[m];){var D=t[y.charCodeAt(m)];if(255===D)return;for(var P=0,C=w-1;(0!==D||P<v)&&-1!==C;C--,P++)D+=c*E[C]>>>0,E[C]=D%256>>>0,D=D/256>>>0;if(0!==D)throw new Error("Non-zero carry");v=P,m++}if(" "!==y[m]){for(var x=w-v;x!==w&&0===E[x];)x++;for(var I=new Uint8Array(_+(w-x)),S=_;x!==w;)I[S++]=E[x++];return I}}}return{encode:function p(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===y.length)return"";for(var m=0,_=0,v=0,w=y.length;v!==w&&0===y[v];)v++,m++;for(var E=(w-v)*h+1>>>0,D=new Uint8Array(E);v!==w;){for(var P=y[v],C=0,x=E-1;(0!==P||C<_)&&-1!==x;x--,C++)P+=256*D[x]>>>0,D[x]=P%c>>>0,P=P/c>>>0;if(0!==P)throw new Error("Non-zero carry");_=C,v++}for(var I=E-_;I!==E&&0===D[I];)I++;for(var S=u.repeat(m);I<E;++I)S+=r.charAt(D[I]);return S},decodeUnsafe:g,decode:function b(y){var m=g(y);if(m)return m;throw new Error(`Non-${e} character`)}}};const Kl=Vl,rn=(new Uint8Array(0),r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")});class Yl{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xl{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return qo(this,e)}}class ed{constructor(e){this.decoders=e}or(e){return qo(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const qo=(r,e)=>new ed({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class td{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Yl(e,t,i),this.decoder=new Xl(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const vr=({name:r,prefix:e,encode:t,decode:i})=>new td(r,e,t,i),zn=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Kl(t,e);return vr({prefix:r,name:e,encode:i,decode:o=>rn(s(o))})},we=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>vr({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let o="",a=0,c=0;for(let u=0;u<r.length;++u)for(c=c<<8|r[u],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),i)for(;o.length*t&7;)o+="=";return o})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let o=r.length;for(;"="===r[o-1];)--o;const a=new Uint8Array(o*t/8|0);let c=0,u=0,d=0;for(let h=0;h<o;++h){const p=s[r[h]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);u=u<<t|p,c+=t,c>=8&&(c-=8,a[d++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a})(s,i,t,r)}),id=vr({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)}),sd=we({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),od=we({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ad=zn({prefix:"9",name:"base10",alphabet:"0123456789"}),cd=we({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ud=we({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Zn=we({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ld=we({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dd=we({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),hd=we({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pd=we({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),fd=we({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gd=we({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yd=we({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),md=we({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),_d=zn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),bd=zn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),_t=zn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vd=zn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),wd=we({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Dd=we({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ed=we({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),xd=we({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Mo=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),Id=Mo.reduce((r,e,t)=>(r[t]=e,r),[]),Cd=Mo.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const Od=vr({prefix:"\u{1f680}",name:"base256emoji",encode:function Pd(r){return r.reduce((e,t)=>e+=Id[t],"")},decode:function Sd(r){const e=[];for(const t of r){const i=Cd[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var Ad=function Lo(r,e,t){e=e||[];for(var i=t=t||0;r>=Td;)e[t++]=255&r|ko,r/=128;for(;r&Nd;)e[t++]=255&r|ko,r>>>=7;return e[t]=0|r,Lo.bytes=t-i+1,e},ko=128,Nd=-128,Td=Math.pow(2,31);var Fd=function Hi(r,i){var a,t=0,s=0,o=i=i||0,c=r.length;do{if(o>=c)throw Hi.bytes=0,new RangeError("Could not decode varint");a=r[o++],t+=s<28?(a&zo)<<s:(a&zo)*Math.pow(2,s),s+=7}while(a>=jd);return Hi.bytes=o-i,t},jd=128,zo=127;var $d=Math.pow(2,7),Ud=Math.pow(2,14),Bd=Math.pow(2,21),qd=Math.pow(2,28),Md=Math.pow(2,35),kd=Math.pow(2,42),Ld=Math.pow(2,49),zd=Math.pow(2,56),Zd=Math.pow(2,63),Hd={encode:Ad,decode:Fd,encodingLength:function(r){return r<$d?1:r<Ud?2:r<Bd?3:r<qd?4:r<Md?5:r<kd?6:r<Ld?7:r<zd?8:r<Zd?9:10}};const wr=Hd,Dr=(r,e,t=0)=>(wr.encode(r,e,t),e),Er=r=>wr.encodingLength(r),xr=(r,e)=>{const t=e.byteLength,i=Er(r),s=i+Er(t),o=new Uint8Array(s+t);return Dr(r,o,0),Dr(t,o,i),o.set(e,s),new Gi(r,t,e,o)};class Gi{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Zo=({name:r,code:e,encode:t})=>new Wd(r,e,t);class Wd{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?xr(this.code,t):t.then(i=>xr(this.code,i))}throw Error("Unknown type, must be binary type")}}const Vo=r=>function(){var e=(0,f.Z)(function*(t){return new Uint8Array(yield crypto.subtle.digest(r,t))});return function(t){return e.apply(this,arguments)}}(),Qd=Zo({name:"sha2-256",code:18,encode:Vo("SHA-256")}),Yd=Zo({name:"sha2-512",code:19,encode:Vo("SHA-512")}),Ko=rn,eh={code:0,name:"identity",encode:Ko,digest:r=>xr(0,Ko(r))},th="raw",nh=85,rh=r=>rn(r),ih=r=>rn(r),sh=new TextEncoder,oh=new TextDecoder,ah="json",ch=512,uh=r=>sh.encode(JSON.stringify(r)),lh=r=>JSON.parse(oh.decode(r));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const Wo={...pi,...fi,...gi,...yi,...mi,..._i,...bi,...vi,...wi,...Di};function Qo(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Yo=Qo("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),Ji=Qo("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=Bo((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Xo={utf8:Yo,"utf-8":Yo,hex:Wo.base16,latin1:Ji,ascii:Ji,binary:Ji,...Wo};function Ge(r,e="utf8"){const t=Xo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):globalThis.Buffer.from(r,"utf8")}function Me(r,e="utf8"){const t=Xo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.encoder.encode(r).substring(1):globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8")}var _h=T(24443);const Pr=":";function qt(r){const[e,t]=r.split(Pr);return{namespace:e,reference:t}}function na(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function Wi(r,e){return r.includes(":")?[r]:e.chains||[]}var xh=Object.defineProperty,Ih=Object.defineProperties,Ch=Object.getOwnPropertyDescriptors,ra=Object.getOwnPropertySymbols,Ph=Object.prototype.hasOwnProperty,Sh=Object.prototype.propertyIsEnumerable,ia=(r,e,t)=>e in r?xh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,sa=(r,e)=>{for(var t in e||(e={}))Ph.call(e,t)&&ia(r,t,e[t]);if(ra)for(var t of ra(e))Sh.call(e,t)&&ia(r,t,e[t]);return r};const Ah="ReactNative",je={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Nh="js";function Sr(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ot(){return!(0,yt.getDocument)()&&!!(0,yt.getNavigator)()&&navigator.product===Ah}function sn(){return!Sr()&&!!(0,yt.getNavigator)()&&!!(0,yt.getDocument)()}function on(){return Ot()?je.reactNative:Sr()?je.node:sn()?je.browser:je.unknown}function aa(){var r;try{return Ot()&&typeof global<"u"&&typeof(null==global?void 0:global.Application)<"u"?null==(r=global.Application)?void 0:r.applicationId:void 0}catch{return}}function $h(r){var e,t;const i=ca();try{return null!=r&&r.url&&i.url&&new URL(r.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),r.url=i.url),null!=(e=r?.icons)&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>""!==s)),((r,e)=>Ih(r,Ch(e)))(sa(sa({},i),r),{url:r?.url||i.url,name:r?.name||i.name,description:r?.description||i.description,icons:null!=(t=r?.icons)&&t.length&&r.icons.length>0?r.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),r||i}}function ca(){return(0,vl.D)()||{name:"",description:"",url:"",icons:[""]}}function ua(r,e,t){const i=function Uh(){if(on()===je.reactNative&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=(0,bl.qY)();if(null===r)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return"browser"===r.type?[e,r.name,r.version].join("-"):[e,r.version].join("-")}(),s=function Bh(){var r;const e=on();return e===je.browser?[e,(null==(r=(0,yt.getLocation)())?void 0:r.host)||"unknown"].join(":"):e}();return[[r,e].join("-"),[Nh,t].join("-"),i,s].join("/")}function qh({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:o,useOnCloseEvent:a,bundleId:c,packageName:u}){const d=t.split("?"),p={auth:s,ua:ua(r,e,i),projectId:o,useOnCloseEvent:a||void 0,packageName:u||void 0,bundleId:c||void 0},g=function jh(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];void 0!==s&&t.set(i,s)}return t.toString()}(d[1]||"",p);return d[0]+"?"+g}function Mt(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Yi(r){return Object.fromEntries(r.entries())}function Xi(r){return new Map(Object.entries(r))}function Lt(r=$.FIVE_MINUTES,e){const t=(0,$.toMiliseconds)(r||$.FIVE_MINUTES);let i,s,o,a;return{resolve:c=>{o&&i&&(clearTimeout(o),i(c),a=Promise.resolve(c))},reject:c=>{o&&s&&(clearTimeout(o),s(c))},done:()=>new Promise((c,u)=>{if(a)return c(a);o=setTimeout(()=>{const d=new Error(e);a=Promise.reject(d),u(d)},t),i=c,s=u})}}function At(r,e,t){return new Promise(function(){var i=(0,f.Z)(function*(s,o){const a=setTimeout(()=>o(new Error(t)),e);try{s(yield r)}catch(c){o(c)}clearTimeout(a)});return function(s,o){return i.apply(this,arguments)}}())}function la(r,e){if("string"==typeof e&&e.startsWith(`${r}:`))return e;if("topic"===r.toLowerCase()){if("string"!=typeof e)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}if("id"===r.toLowerCase()){if("number"!=typeof e)throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function da(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if("topic"===e&&"string"==typeof t)i.topic=t;else{if("id"!==e||!Number.isInteger(Number(t)))throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);i.id=Number(t)}return i}function de(r,e){return(0,$.fromMiliseconds)((e||Date.now())+(0,$.toMiliseconds)(r))}function Rt(r){return Date.now()>=(0,$.toMiliseconds)(r)}function ee(r,e){return`${r}${e?`:${e}`:""}`}function $e(r=[],e=[]){return[...new Set([...r,...e])]}function es(){return(es=(0,f.Z)(function*({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s="string"==typeof t?JSON.parse(t):t,o=s?.href;if("string"!=typeof o)return;const a=function Hh(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){s=`${s}${r.includes("?")?"&startapp=":"?startapp="}${function Qh(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}(i,!0)}`}else s=`${s}/wc?${i}`;return s}(o,r,e),c=on();if(c===je.browser){if(null==(i=(0,yt.getDocument)())||!i.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function Kh(r){let e="_self";!function Wh(){try{return window.self!==window.top}catch{return!1}}()?(function Jh(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"):e="_top",window.open(r,e,"noreferrer noopener")}(a)}else c===je.reactNative&&typeof(null==global?void 0:global.Linking)<"u"&&(yield global.Linking.openURL(a))}catch(s){console.error(s)}})).apply(this,arguments)}function ts(){return(ts=(0,f.Z)(function*(r,e){let t="";try{if(sn()&&(t=localStorage.getItem(e),t))return t;t=yield r.getItem(e)}catch(i){console.error(i)}return t})).apply(this,arguments)}function pa(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function fa(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=16*Math.random()|0;return("x"===r?e:3&e|8).toString(16)})}function ns(){return typeof process<"u"&&"true"===process.env.IS_VITEST}function ga(r){return Buffer.from(r,"base64").toString("utf-8")}function Hn(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Kn(r,...e){if(!function Xh(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function rs(r){if("function"!=typeof r||"function"!=typeof r.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Hn(r.outputLen),Hn(r.blockLen)}function an(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ya(r,e){Kn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Or=BigInt(2**32-1),ma=BigInt(32);function ep(r,e=!1){return e?{h:Number(r&Or),l:Number(r>>ma&Or)}:{h:0|Number(r>>ma&Or),l:0|Number(r&Or)}}const cn="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function is(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ct(r,e){return r<<32-e|r>>>e}const _a=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function ap(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function ba(r){for(let e=0;e<r.length;e++)r[e]=ap(r[e])}function un(r){return"string"==typeof r&&(r=function cp(r){if("string"!=typeof r)throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array((new TextEncoder).encode(r))}(r)),Kn(r),r}class ss{clone(){return this._cloneInto()}}function va(r){const e=i=>r().update(un(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function ln(r=32){if(cn&&"function"==typeof cn.getRandomValues)return cn.getRandomValues(new Uint8Array(r));if(cn&&"function"==typeof cn.randomBytes)return cn.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const wa=[],Da=[],Ea=[],lp=BigInt(0),Gn=BigInt(1),dp=BigInt(2),hp=BigInt(7),pp=BigInt(256),fp=BigInt(113);for(let r=0,e=Gn,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],wa.push(2*(5*i+t)),Da.push((r+1)*(r+2)/2%64);let s=lp;for(let o=0;o<7;o++)e=(e<<Gn^(e>>hp)*fp)%pp,e&dp&&(s^=Gn<<(Gn<<BigInt(o))-Gn);Ea.push(s)}const[gp,yp]=function tp(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:o,l:a}=ep(r[s],e);[t[s],i[s]]=[o,a]}return[t,i]}(Ea,!0),xa=(r,e,t)=>t>32?((r,e,t)=>e<<t-32|r>>>64-t)(r,e,t):((r,e,t)=>r<<t|e>>>32-t)(r,e,t),Ia=(r,e,t)=>t>32?((r,e,t)=>r<<t-32|e>>>64-t)(r,e,t):((r,e,t)=>e<<t|r>>>32-t)(r,e,t);class os extends ss{constructor(e,t,i,s=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hn(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function op(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}(this.state)}keccak(){_a||ba(this.state32),function mp(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)t[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){const c=(a+8)%10,u=(a+2)%10,d=t[u],h=t[u+1],p=xa(d,h,1)^t[c],g=Ia(d,h,1)^t[c+1];for(let b=0;b<50;b+=10)r[a+b]^=p,r[a+b+1]^=g}let s=r[2],o=r[3];for(let a=0;a<24;a++){const c=Da[a],u=xa(s,o,c),d=Ia(s,o,c),h=wa[a];s=r[h],o=r[h+1],r[h]=u,r[h+1]=d}for(let a=0;a<50;a+=10){for(let c=0;c<10;c++)t[c]=r[a+c];for(let c=0;c<10;c++)r[a+c]^=~t[(c+2)%10]&t[(c+4)%10]}r[0]^=gp[i],r[1]^=yp[i]}t.fill(0)}(this.state32,this.rounds),_a||ba(this.state32),this.posOut=0,this.pos=0}update(e){an(this);const{blockLen:t,state:i}=this,s=(e=un(e)).length;for(let o=0;o<s;){const a=Math.min(t-this.pos,s-o);for(let c=0;c<a;c++)i[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){an(this,!1),Kn(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,o=e.length;s<o;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,o-s);e.set(t.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ya(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:o,enableXOF:a}=this;return e||(e=new os(t,i,s,a,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}}const bp=(r=1,e=136,t=32,va(()=>new os(e,r,t))),vp="https://rpc.walletconnect.org/v1";var r,e,t;function Ca(r){const e=`\x19Ethereum Signed Message:\n${r.length}`,t=(new TextEncoder).encode(e+r);return"0x"+Buffer.from(bp(t)).toString("hex")}function as(){return as=(0,f.Z)(function*(r,e,t,i,s,o){switch(t.t){case"eip191":return yield function Dp(r,e,t){return cs.apply(this,arguments)}(r,e,t.s);case"eip1271":return yield function Ep(r,e,t,i,s,o){return us.apply(this,arguments)}(r,e,t.s,i,s,o);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}),as.apply(this,arguments)}function cs(){return cs=(0,f.Z)(function*(r,e,t){return(yield function ql(r){return Vi.apply(this,arguments)}({hash:Ca(e),signature:t})).toLowerCase()===r.toLowerCase()}),cs.apply(this,arguments)}function us(){return us=(0,f.Z)(function*(r,e,t,i,s,o){const a=qt(i);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const c="0x1626ba7e",u="0000000000000000000000000000000000000000000000000000000000000040",d="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),g=c+Ca(e).substring(2)+u+d+h,b=yield fetch(`${o||vp}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:g},"latest"]})}),{result:y}=yield b.json();return!!y&&y.slice(0,c.length).toLowerCase()===c.toLowerCase()}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}),us.apply(this,arguments)}var Cp=Object.defineProperty,Pp=Object.defineProperties,Sp=Object.getOwnPropertyDescriptors,Pa=Object.getOwnPropertySymbols,Op=Object.prototype.hasOwnProperty,Ap=Object.prototype.propertyIsEnumerable,Sa=(r,e,t)=>e in r?Cp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ls=(r,e)=>{for(var t in e||(e={}))Op.call(e,t)&&Sa(r,t,e[t]);if(Pa)for(var t of Pa(e))Ap.call(e,t)&&Sa(r,t,e[t]);return r},Oa=(r,e)=>Pp(r,Sp(e));const ds=r=>r?.split(":"),hs=r=>{const e=r&&ds(r);if(e)return e[2]+":"+e[3]},Ar=r=>{const e=r&&ds(r);if(e)return e.pop()};function Aa(r){return ps.apply(this,arguments)}function ps(){return ps=(0,f.Z)(function*(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,o=Ra(s,s.iss),a=Ar(s.iss);return yield function wp(r,e,t,i,s,o){return as.apply(this,arguments)}(a,o,i,hs(s.iss),t)}),ps.apply(this,arguments)}const Ra=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=Ar(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const o=`URI: ${r.aud||r.uri}`,a=`Version: ${r.version}`,c=`Chain ID: ${(r=>{const e=r&&ds(r);if(e)return r.includes("did:pkh:")?e[3]:e[1]})(e)}`,u=`Nonce: ${r.nonce}`,d=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,p=r.nbf?`Not Before: ${r.nbf}`:void 0,g=r.requestId?`Request ID: ${r.requestId}`:void 0,b=r.resources?`Resources:${r.resources.map(m=>`\n- ${m}`).join("")}`:void 0,y=dn(r.resources);if(y){s=Fa(s,zt(y))}return[t,i,"",s,"",o,a,c,u,d,h,p,g,b].filter(m=>null!=m).join("\n")};function bt(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(null==e||!e.length)throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if("object"!=typeof i)throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const o=i[s];if(!Array.isArray(o))throw new Error(`Ability limits ${s} must be an array of objects, found: ${o}`);if(!o.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);o.forEach(a=>{if("object"!=typeof a)throw new Error(`Ability limits (${s}) must be an array of objects, found: ${a}`)})})})}function Na(r,e,t={}){e=e?.sort((s,o)=>s.localeCompare(o));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function fs(r){return bt(r),`urn:recap:${function $p(r){return Buffer.from(JSON.stringify(r)).toString("base64")}(r).replace(/=/g,"")}`}function zt(r){const e=function Up(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}(r.replace("urn:recap:",""));return bt(e),e}function Mp(r,e,t){const i=function Bp(r,e,t,i={}){return t?.sort((s,o)=>s.localeCompare(o)),{att:{[r]:Na(e,t,i)}}}(r,e,t);return fs(i)}function Ta(r){return r&&r.includes("urn:recap:")}function kp(r,e){const s=function Lp(r,e){bt(r),bt(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,o)=>s.localeCompare(o)),i={att:{}};return t.forEach(s=>{var o,a;Object.keys((null==(o=r.att)?void 0:o[s])||{}).concat(Object.keys((null==(a=e.att)?void 0:a[s])||{})).sort((c,u)=>c.localeCompare(u)).forEach(c=>{var u,d;i.att[s]=Oa(ls({},i.att[s]),{[c]:(null==(u=r.att[s])?void 0:u[c])||(null==(d=e.att[s])?void 0:d[c])})})}),i}(zt(r),zt(e));return fs(s)}function Fa(r="",e){bt(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(c=>{const u=Object.keys(e.att[c]).map(p=>({ability:p.split("/")[0],action:p.split("/")[1]}));u.sort((p,g)=>p.action.localeCompare(g.action));const d={};u.forEach(p=>{d[p.ability]||(d[p.ability]=[]),d[p.ability].push(p.action)});const h=Object.keys(d).map(p=>(s++,`(${s}) '${p}': '${d[p].join("', '")}' for '${c}'.`));i.push(h.join(", ").replace(".,","."))});return`${r?r+" ":""}${`${t}${i.join(" ")}`}`}function ja(r){var e;const t=zt(r);bt(t);const i=null==(e=t.att)?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function $a(r){const e=zt(r);bt(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var o;null!=(o=s?.[0])&&o.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function dn(r){if(!r)return;const e=r?.[r.length-1];return Ta(e)?e:void 0}function gs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Ua(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}function ke(r,...e){if(!Ua(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Ba(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function qa(r){if("boolean"!=typeof r)throw new Error(`boolean expected, not ${r}`)}const Nt=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4));if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function ys(r){if("string"==typeof r)r=function Hp(r){if("string"!=typeof r)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(r))}(r);else{if(!Ua(r))throw new Error("Uint8Array expected, got "+typeof r);r=ms(r)}return r}function Ma(r,e,t=!0){if(void 0===e)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!function Wp(r){return r.byteOffset%4==0}(e))throw new Error("invalid output, must be aligned");return e}function ka(r,e,t,i){if("function"==typeof r.setBigUint64)return r.setBigUint64(e,t,i);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),u=i?4:0,d=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+d,c,i)}function ms(r){return Uint8Array.from(r)}function hn(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const La=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),Qp=La("expand 16-byte k"),Yp=La("expand 32-byte k"),Xp=Nt(Qp),ef=Nt(Yp);function W(r,e){return r<<e|r>>>32-e}function _s(r){return r.byteOffset%4==0}const Rr=64,tf=16,za=2**32-1,Za=new Uint32Array;const De=(r,e)=>255&r[e++]|(255&r[e++])<<8;class sf{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ke(e=ys(e),32);const t=De(e,0),i=De(e,2),s=De(e,4),o=De(e,6),a=De(e,8),c=De(e,10),u=De(e,12),d=De(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|i<<3),this.r[2]=7939&(i>>>10|s<<6),this.r[3]=8191&(s>>>7|o<<9),this.r[4]=255&(o>>>4|a<<12),this.r[5]=a>>>1&8190,this.r[6]=8191&(a>>>14|c<<2),this.r[7]=8065&(c>>>11|u<<5),this.r[8]=8191&(u>>>8|d<<8),this.r[9]=d>>>5&127;for(let h=0;h<8;h++)this.pad[h]=De(e,16+2*h)}process(e,t,i=!1){const s=i?0:2048,{h:o,r:a}=this,c=a[0],u=a[1],d=a[2],h=a[3],p=a[4],g=a[5],b=a[6],y=a[7],m=a[8],_=a[9],v=De(e,t+0),w=De(e,t+2),E=De(e,t+4),D=De(e,t+6),P=De(e,t+8),C=De(e,t+10),x=De(e,t+12),I=De(e,t+14);let S=o[0]+(8191&v),L=o[1]+(8191&(v>>>13|w<<3)),F=o[2]+(8191&(w>>>10|E<<6)),M=o[3]+(8191&(E>>>7|D<<9)),V=o[4]+(8191&(D>>>4|P<<12)),A=o[5]+(P>>>1&8191),R=o[6]+(8191&(P>>>14|C<<2)),N=o[7]+(8191&(C>>>11|x<<5)),B=o[8]+(8191&(x>>>8|I<<8)),q=o[9]+(I>>>5|s),U=0,H=U+S*c+L*(5*_)+F*(5*m)+M*(5*y)+V*(5*b);U=H>>>13,H&=8191,H+=A*(5*g)+R*(5*p)+N*(5*h)+B*(5*d)+q*(5*u),U+=H>>>13,H&=8191;let Z=U+S*u+L*c+F*(5*_)+M*(5*m)+V*(5*y);U=Z>>>13,Z&=8191,Z+=A*(5*b)+R*(5*g)+N*(5*p)+B*(5*h)+q*(5*d),U+=Z>>>13,Z&=8191;let k=U+S*d+L*u+F*c+M*(5*_)+V*(5*m);U=k>>>13,k&=8191,k+=A*(5*y)+R*(5*b)+N*(5*g)+B*(5*p)+q*(5*h),U+=k>>>13,k&=8191;let X=U+S*h+L*d+F*u+M*c+V*(5*_);U=X>>>13,X&=8191,X+=A*(5*m)+R*(5*y)+N*(5*b)+B*(5*g)+q*(5*p),U+=X>>>13,X&=8191;let ae=U+S*p+L*h+F*d+M*u+V*c;U=ae>>>13,ae&=8191,ae+=A*(5*_)+R*(5*m)+N*(5*y)+B*(5*b)+q*(5*g),U+=ae>>>13,ae&=8191;let he=U+S*g+L*p+F*h+M*d+V*u;U=he>>>13,he&=8191,he+=A*c+R*(5*_)+N*(5*m)+B*(5*y)+q*(5*b),U+=he>>>13,he&=8191;let _e=U+S*b+L*g+F*p+M*h+V*d;U=_e>>>13,_e&=8191,_e+=A*u+R*c+N*(5*_)+B*(5*m)+q*(5*y),U+=_e>>>13,_e&=8191;let be=U+S*y+L*b+F*g+M*p+V*h;U=be>>>13,be&=8191,be+=A*d+R*u+N*c+B*(5*_)+q*(5*m),U+=be>>>13,be&=8191;let ve=U+S*m+L*y+F*b+M*g+V*p;U=ve>>>13,ve&=8191,ve+=A*h+R*d+N*u+B*c+q*(5*_),U+=ve>>>13,ve&=8191;let Ae=U+S*_+L*m+F*y+M*b+V*g;U=Ae>>>13,Ae&=8191,Ae+=A*p+R*h+N*d+B*u+q*c,U+=Ae>>>13,Ae&=8191,U=(U<<2)+U|0,U=U+H|0,H=8191&U,U>>>=13,Z+=U,o[0]=H,o[1]=Z,o[2]=k,o[3]=X,o[4]=ae,o[5]=he,o[6]=_e,o[7]=be,o[8]=ve,o[9]=Ae}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=s,s=e[c]>>>13,e[c]&=8191;e[0]+=5*s,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let c=1;c<10;c++)i[c]=e[c]+s,s=i[c]>>>13,i[c]&=8191;i[9]-=8192;let o=(1^s)-1;for(let c=0;c<10;c++)i[c]&=o;o=~o;for(let c=0;c<10;c++)e[c]=e[c]&o|i[c];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let a=e[0]+t[0];e[0]=65535&a;for(let c=1;c<8;c++)a=(e[c]+t[c]|0)+(a>>>16)|0,e[c]=65535&a;hn(i)}update(e){Ba(this);const{buffer:t,blockLen:i}=this,s=(e=ys(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)t.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0,!1),this.pos=0);else for(;i<=s-o;o+=i)this.process(e,o)}return this}destroy(){hn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ba(this),function Zp(r,e){ke(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let a=0;a<8;a++)e[o++]=i[a]>>>0,e[o++]=i[a]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}const af=function of(r){const e=(i,s)=>r(s).update(ys(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}(r=>new sf(r));const uf=function rf(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:o,rounds:a}=function Kp(r,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(r,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof r)throw new Error("core must be a function");return gs(s),gs(a),qa(o),qa(t),(c,u,d,h,p=0)=>{ke(c),ke(u),ke(d);const g=d.length;if(void 0===h&&(h=new Uint8Array(g)),ke(h),gs(p),p<0||p>=za)throw new Error("arx: counter overflow");if(h.length<g)throw new Error(`arx: output (${h.length}) is shorter than data (${g})`);const b=[];let m,_,y=c.length;if(32===y)b.push(m=ms(c)),_=ef;else{if(16!==y||!t)throw new Error(`arx: invalid 32-byte key, got length=${y}`);m=new Uint8Array(32),m.set(c),m.set(c,16),_=Xp,b.push(m)}_s(u)||b.push(u=ms(u));const v=Nt(m);if(i){if(24!==u.length)throw new Error("arx: extended nonce must be 24 bytes");i(_,v,Nt(u.subarray(0,16)),v),u=u.subarray(16)}const w=16-s;if(w!==u.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const D=new Uint8Array(12);D.set(u,o?0:12-u.length),u=D,b.push(u)}const E=Nt(u);return function nf(r,e,t,i,s,o,a,c){const u=s.length,d=new Uint8Array(Rr),h=Nt(d),p=_s(s)&&_s(o),g=p?Nt(s):Za,b=p?Nt(o):Za;for(let y=0;y<u;a++){if(r(e,t,i,h,a,c),a>=za)throw new Error("arx: counter overflow");const m=Math.min(Rr,u-y);if(p&&m===Rr){const _=y/4;if(y%4!=0)throw new Error("arx: invalid block position");for(let w,v=0;v<tf;v++)w=_+v,b[w]=g[w]^h[v];y+=Rr}else{for(let v,_=0;_<m;_++)v=y+_,o[v]=s[v]^d[_];y+=m}}}(r,_,v,E,d,h,p,a),hn(...b),h}}(function cf(r,e,t,i,s,o=20){let a=r[0],c=r[1],u=r[2],d=r[3],h=e[0],p=e[1],g=e[2],b=e[3],y=e[4],m=e[5],_=e[6],v=e[7],w=s,E=t[0],D=t[1],P=t[2],C=a,x=c,I=u,S=d,L=h,F=p,M=g,V=b,A=y,R=m,N=_,B=v,q=w,U=E,H=D,Z=P;for(let X=0;X<o;X+=2)C=C+L|0,q=W(q^C,16),A=A+q|0,L=W(L^A,12),C=C+L|0,q=W(q^C,8),A=A+q|0,L=W(L^A,7),x=x+F|0,U=W(U^x,16),R=R+U|0,F=W(F^R,12),x=x+F|0,U=W(U^x,8),R=R+U|0,F=W(F^R,7),I=I+M|0,H=W(H^I,16),N=N+H|0,M=W(M^N,12),I=I+M|0,H=W(H^I,8),N=N+H|0,M=W(M^N,7),S=S+V|0,Z=W(Z^S,16),B=B+Z|0,V=W(V^B,12),S=S+V|0,Z=W(Z^S,8),B=B+Z|0,V=W(V^B,7),C=C+F|0,Z=W(Z^C,16),N=N+Z|0,F=W(F^N,12),C=C+F|0,Z=W(Z^C,8),N=N+Z|0,F=W(F^N,7),x=x+M|0,q=W(q^x,16),B=B+q|0,M=W(M^B,12),x=x+M|0,q=W(q^x,8),B=B+q|0,M=W(M^B,7),I=I+V|0,U=W(U^I,16),A=A+U|0,V=W(V^A,12),I=I+V|0,U=W(U^I,8),A=A+U|0,V=W(V^A,7),S=S+L|0,H=W(H^S,16),R=R+H|0,L=W(L^R,12),S=S+L|0,H=W(H^S,8),R=R+H|0,L=W(L^R,7);let k=0;i[k++]=a+C|0,i[k++]=c+x|0,i[k++]=u+I|0,i[k++]=d+S|0,i[k++]=h+L|0,i[k++]=p+F|0,i[k++]=g+M|0,i[k++]=b+V|0,i[k++]=y+A|0,i[k++]=m+R|0,i[k++]=_+N|0,i[k++]=v+B|0,i[k++]=w+q|0,i[k++]=E+U|0,i[k++]=D+H|0,i[k++]=P+Z|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),lf=new Uint8Array(16),Va=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(lf.subarray(t))},df=new Uint8Array(32);function Ha(r,e,t,i,s){const o=r(e,t,df),a=af.create(o);s&&Va(a,s),Va(a,i);const c=new Uint8Array(16),u=(r=>new DataView(r.buffer,r.byteOffset,r.byteLength))(c);ka(u,0,BigInt(s?s.length:0),!0),ka(u,8,BigInt(i.length),!0),a.update(c);const d=a.digest();return hn(o,c),d}const Ka=((r,e)=>{function t(i,...s){if(ke(i),void 0!==r.nonceLength){const d=s[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?ke(d):ke(d,r.nonceLength)}const o=r.tagLength;o&&void 0!==s[1]&&ke(s[1]);const a=e(i,...s),c=(d,h)=>{if(void 0!==h){if(2!==d)throw new Error("cipher output not supported");ke(h)}};let u=!1;return{encrypt(d,h){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,ke(d),c(a.encrypt.length,h),a.encrypt(d,h)},decrypt(d,h){if(ke(d),o&&d.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return c(a.decrypt.length,h),a.decrypt(d,h)}}}return Object.assign(t,r),t})({blockSize:64,nonceLength:12,tagLength:16},(r=>(e,t,i)=>({encrypt(s,o){const a=s.length;(o=Ma(a+16,o,!1)).set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const u=Ha(r,e,t,c,i);return o.set(u,a),hn(u),o},decrypt(s,o){o=Ma(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),u=Ha(r,e,t,a,i);if(!function Gp(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return 0===t}(c,u))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),hn(u),o}}))(uf));class Ga extends ss{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,rs(e);const i=un(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(i.length>s?e.create().update(i).digest():i);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return an(this),this.iHash.update(e),this}digestInto(e){an(this),Kn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:o,blockLen:a,outputLen:c}=this;return e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Nr=(r,e,t)=>new Ga(r,e).update(t).digest();Nr.create=(r,e)=>new Ga(r,e);const bs=new Uint8Array([0]),Ja=new Uint8Array;const gf=(r,e,t,i,s)=>function ff(r,e,t,i=32){if(rs(r),Hn(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);void 0===t&&(t=Ja);const o=new Uint8Array(s*r.outputLen),a=Nr.create(r,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)bs[0]=d+1,c.update(0===d?Ja:u).update(t).update(bs).digestInto(u),o.set(u,r.outputLen*d),a._cloneInto(c);return a.destroy(),c.destroy(),u.fill(0),bs.fill(0),o.slice(0,i)}(r,function pf(r,e,t){return rs(r),void 0===t&&(t=new Uint8Array(r.outputLen)),Nr(r,un(t),un(e))}(r,e,t),i,s);function mf(r,e,t){return r&e^~r&t}function _f(r,e,t){return r&e^r&t^e&t}class bf extends ss{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=is(this.buffer)}update(e){an(this);const{view:t,buffer:i,blockLen:s}=this,o=(e=un(e)).length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c!==s)i.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(t,0),this.pos=0);else{const u=is(e);for(;s<=o-a;a+=s)this.process(u,a)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){an(this),ya(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let p=a;p<s;p++)t[p]=0;(function yf(r,e,t,i){if("function"==typeof r.setBigUint64)return r.setBigUint64(e,t,i);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),u=i?4:0,d=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+d,c,i)})(i,s-8,BigInt(8*this.length),o),this.process(i,0);const c=is(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=u/4,h=this.get();if(d>h.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<d;p++)c.setUint32(4*p,h[p],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:o,destroyed:a,pos:c}=this;return e.length=s,e.pos=c,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(i),e}}const vf=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Tt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ft=new Uint32Array(64);class wf extends bf{constructor(){super(64,32,8,!1),this.A=0|Tt[0],this.B=0|Tt[1],this.C=0|Tt[2],this.D=0|Tt[3],this.E=0|Tt[4],this.F=0|Tt[5],this.G=0|Tt[6],this.H=0|Tt[7]}get(){const{A:e,B:t,C:i,D:s,E:o,F:a,G:c,H:u}=this;return[e,t,i,s,o,a,c,u]}set(e,t,i,s,o,a,c,u){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|s,this.E=0|o,this.F=0|a,this.G=0|c,this.H=0|u}process(e,t){for(let p=0;p<16;p++,t+=4)Ft[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){const g=Ft[p-15],b=Ft[p-2],y=ct(g,7)^ct(g,18)^g>>>3,m=ct(b,17)^ct(b,19)^b>>>10;Ft[p]=m+Ft[p-7]+y+Ft[p-16]|0}let{A:i,B:s,C:o,D:a,E:c,F:u,G:d,H:h}=this;for(let p=0;p<64;p++){const b=h+(ct(c,6)^ct(c,11)^ct(c,25))+mf(c,u,d)+vf[p]+Ft[p]|0,y=(ct(i,2)^ct(i,13)^ct(i,22))+_f(i,s,o)|0;h=d,d=u,u=c,c=a+b|0,a=o,o=s,s=i,i=b+y|0}i=i+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,u=u+this.F|0,d=d+this.G|0,h=h+this.H|0,this.set(i,s,o,a,c,u,d,h)}roundClean(){Ft.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Jn=va(()=>new wf),Tr=BigInt(0),Fr=BigInt(1),Df=BigInt(2);function Zt(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}function Wn(r){if(!Zt(r))throw new Error("Uint8Array expected")}function pn(r,e){if("boolean"!=typeof e)throw new Error(r+" boolean expected, got "+e)}const Ef=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function fn(r){Wn(r);let e="";for(let t=0;t<r.length;t++)e+=Ef[r[t]];return e}function gn(r){const e=r.toString(16);return 1&e.length?"0"+e:e}function vs(r){if("string"!=typeof r)throw new Error("hex string expected, got "+typeof r);return""===r?Tr:BigInt("0x"+r)}const vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Wa(r){return r>=vt._0&&r<=vt._9?r-vt._0:r>=vt.A&&r<=vt.F?r-(vt.A-10):r>=vt.a&&r<=vt.f?r-(vt.a-10):void 0}function yn(r){if("string"!=typeof r)throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=Wa(r.charCodeAt(o)),c=Wa(r.charCodeAt(o+1));if(void 0===a||void 0===c){const u=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+o)}i[s]=16*a+c}return i}function Vt(r){return vs(fn(r))}function Qn(r){return Wn(r),vs(fn(Uint8Array.from(r).reverse()))}function mn(r,e){return yn(r.toString(16).padStart(2*e,"0"))}function jr(r,e){return mn(r,e).reverse()}function Le(r,e,t){let i;if("string"==typeof e)try{i=yn(e)}catch(o){throw new Error(r+" must be hex string or Uint8Array, cause: "+o)}else{if(!Zt(e))throw new Error(r+" must be hex string or Uint8Array");i=Uint8Array.from(e)}const s=i.length;if("number"==typeof t&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Yn(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Wn(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const o=r[i];t.set(o,s),s+=o.length}return t}const ws=r=>"bigint"==typeof r&&Tr<=r;function $r(r,e,t){return ws(r)&&ws(e)&&ws(t)&&e<=r&&r<t}function wt(r,e,t,i){if(!$r(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function Qa(r){let e;for(e=0;r>Tr;r>>=Fr,e+=1);return e}const Ds=r=>(Df<<BigInt(r-1))-Fr,Es=r=>new Uint8Array(r),Ya=r=>Uint8Array.from(r);function Xa(r,e,t){if("number"!=typeof r||r<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof t)throw new Error("hmacFn must be a function");let i=Es(r),s=Es(r),o=0;const a=()=>{i.fill(1),s.fill(0),o=0},c=(...h)=>t(s,i,...h),u=(h=Es())=>{s=c(Ya([0]),h),i=c(),0!==h.length&&(s=c(Ya([1]),h),i=c())},d=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){i=c();const g=i.slice();p.push(g),h+=i.length}return Yn(...p)};return(h,p)=>{let g;for(a(),u(h);!(g=p(d()));)u();return a(),g}}const Of={bigint:r=>"bigint"==typeof r,function:r=>"function"==typeof r,boolean:r=>"boolean"==typeof r,string:r=>"string"==typeof r,stringOrUint8Array:r=>"string"==typeof r||Zt(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>"function"==typeof r&&Number.isSafeInteger(r.outputLen)};function _n(r,e,t={}){const i=(s,o,a)=>{const c=Of[o];if("function"!=typeof c)throw new Error("invalid validator function");const u=r[s];if(!(a&&void 0===u||c(u,r)))throw new Error("param "+String(s)+" is invalid. Expected "+o+", got "+u)};for(const[s,o]of Object.entries(e))i(s,o,!1);for(const[s,o]of Object.entries(t))i(s,o,!0);return r}function xs(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(void 0!==s)return s;const o=r(t,...i);return e.set(t,o),o}}var Rf=Object.freeze({__proto__:null,isBytes:Zt,abytes:Wn,abool:pn,bytesToHex:fn,numberToHexUnpadded:gn,hexToNumber:vs,hexToBytes:yn,bytesToNumberBE:Vt,bytesToNumberLE:Qn,numberToBytesBE:mn,numberToBytesLE:jr,numberToVarBytesBE:function xf(r){return yn(gn(r))},ensureBytes:Le,concatBytes:Yn,equalBytes:function If(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return 0===t},utf8ToBytes:function Cf(r){if("string"!=typeof r)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(r))},inRange:$r,aInRange:wt,bitLen:Qa,bitGet:function Pf(r,e){return r>>BigInt(e)&Fr},bitSet:function Sf(r,e,t){return r|(t?Fr:Tr)<<BigInt(e)},bitMask:Ds,createHmacDrbg:Xa,validateObject:_n,notImplemented:()=>{throw new Error("not implemented")},memoized:xs});const pe=BigInt(0),ce=BigInt(1),Ht=BigInt(2),Nf=BigInt(3),Is=BigInt(4),ec=BigInt(5),tc=BigInt(8);function Ue(r,e){const t=r%e;return t>=pe?t:e+t}function nc(r,e,t){if(e<pe)throw new Error("invalid exponent, negatives unsupported");if(t<=pe)throw new Error("invalid modulus");if(t===ce)return pe;let i=ce;for(;e>pe;)e&ce&&(i=i*r%t),r=r*r%t,e>>=ce;return i}function et(r,e,t){let i=r;for(;e-- >pe;)i*=i,i%=t;return i}function Cs(r,e){if(r===pe)throw new Error("invert: expected non-zero number");if(e<=pe)throw new Error("invert: expected positive modulus, got "+e);let t=Ue(r,e),i=e,s=pe,o=ce;for(;t!==pe;){const c=i%t,u=s-o*(i/t);i=t,t=c,s=o,o=u}if(i!==ce)throw new Error("invert: does not exist");return Ue(s,e)}function Ff(r){if(r%Is===Nf){const e=(r+ce)/Is;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%tc===ec){const e=(r-ec)/tc;return function(t,i){const s=t.mul(i,Ht),o=t.pow(s,e),a=t.mul(i,o),c=t.mul(t.mul(a,Ht),o),u=t.mul(a,t.sub(c,t.ONE));if(!t.eql(t.sqr(u),i))throw new Error("Cannot find square root");return u}}return function Tf(r){const e=(r-ce)/Ht;let t,i,s;for(t=r-ce,i=0;t%Ht===pe;t/=Ht,i++);for(s=Ht;s<r&&nc(s,e,r)!==r-ce;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===i){const a=(r+ce)/Is;return function(c,u){const d=c.pow(u,a);if(!c.eql(c.sqr(d),u))throw new Error("Cannot find square root");return d}}const o=(t+ce)/Ht;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=i,d=a.pow(a.mul(a.ONE,s),t),h=a.pow(c,o),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let g=1;for(let y=a.sqr(p);g<u&&!a.eql(y,a.ONE);g++)y=a.sqr(y);const b=a.pow(d,ce<<BigInt(u-g-1));d=a.sqr(b),h=a.mul(h,b),p=a.mul(p,d),u=g}return h}}(r)}const jf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function rc(r,e){const t=void 0!==e?e:r.toString(2).length;return{nBitLength:t,nByteLength:Math.ceil(t/8)}}function ic(r,e,t=!1,i={}){if(r<=pe)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:o}=rc(r,e);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const c=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:o,MASK:Ds(s),ZERO:pe,ONE:ce,create:u=>Ue(u,r),isValid:u=>{if("bigint"!=typeof u)throw new Error("invalid field element: expected bigint, got "+typeof u);return pe<=u&&u<r},is0:u=>u===pe,isOdd:u=>(u&ce)===ce,neg:u=>Ue(-u,r),eql:(u,d)=>u===d,sqr:u=>Ue(u*u,r),add:(u,d)=>Ue(u+d,r),sub:(u,d)=>Ue(u-d,r),mul:(u,d)=>Ue(u*d,r),pow:(u,d)=>function Uf(r,e,t){if(t<pe)throw new Error("invalid exponent, negatives unsupported");if(t===pe)return r.ONE;if(t===ce)return e;let i=r.ONE,s=e;for(;t>pe;)t&ce&&(i=r.mul(i,s)),s=r.sqr(s),t>>=ce;return i}(c,u,d),div:(u,d)=>Ue(u*Cs(d,r),r),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>Cs(u,r),sqrt:i.sqrt||(u=>(a||(a=Ff(r)),a(c,u))),invertBatch:u=>function Bf(r,e){const t=new Array(e.length),i=e.reduce((o,a,c)=>r.is0(a)?o:(t[c]=o,r.mul(o,a)),r.ONE),s=r.inv(i);return e.reduceRight((o,a,c)=>r.is0(a)?o:(t[c]=r.mul(o,t[c]),r.mul(o,a)),s),t}(c,u),cmov:(u,d,h)=>h?d:u,toBytes:u=>t?jr(u,o):mn(u,o),fromBytes:u=>{if(u.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+u.length);return t?Qn(u):Vt(u)}});return Object.freeze(c)}function sc(r){if("bigint"!=typeof r)throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function oc(r){const e=sc(r);return e+Math.ceil(e/2)}const ac=BigInt(0),Ur=BigInt(1);function Ps(r,e){const t=e.negate();return r?t:e}function cc(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Ss(r,e){cc(r,e);return{windows:Math.ceil(e/r)+1,windowSize:2**(r-1)}}const Os=new WeakMap,uc=new WeakMap;function As(r){return uc.get(r)||1}function zf(r,e,t,i){if(function Mf(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}(t,r),function kf(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,o=Qa(BigInt(t.length)),a=o>12?o-3:o>4?o-2:o?2:1,c=(1<<a)-1,u=new Array(c+1).fill(s);let h=s;for(let p=Math.floor((e.BITS-1)/a)*a;p>=0;p-=a){u.fill(s);for(let b=0;b<i.length;b++){const y=i[b],m=Number(y>>BigInt(p)&BigInt(c));u[m]=u[m].add(t[b])}let g=s;for(let b=u.length-1,y=s;b>0;b--)y=y.add(u[b]),g=g.add(y);if(h=h.add(g),0!==p)for(let b=0;b<a;b++)h=h.double()}return h}function lc(r){return function $f(r){return _n(r,jf.reduce((i,s)=>(i[s]="function",i),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(r.Fp),_n(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rc(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const bn=BigInt(0),Rs=BigInt(1);const Ns=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Hf=BigInt(1),dc=BigInt(2),Kf=BigInt(3),Gf=BigInt(5);BigInt(8);const Ts=function Vf(r){const e=function Zf(r){return _n(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}(r),{P:t}=e,i=w=>Ue(w,t),s=e.montgomeryBits,o=Math.ceil(s/8),a=e.nByteLength,c=e.adjustScalarBytes||(w=>w),u=e.powPminus2||(w=>nc(w,t-BigInt(2),t));function d(w,E,D){const P=i(w*(E-D));return[E=i(E-P),D=i(D+P)]}const h=(e.a-BigInt(2))/BigInt(4);function g(w){return jr(i(w),o)}function m(w,E){const D=function b(w){const E=Le("u coordinate",w,o);return 32===a&&(E[31]&=127),Qn(E)}(E),P=function y(w){const E=Le("scalar",w),D=E.length;if(D!==o&&D!==a)throw new Error("invalid scalar, expected "+o+" or "+a+" bytes, got "+D);return Qn(c(E))}(w),C=function p(w,E){wt("u",w,bn,t),wt("scalar",E,bn,t);const D=E,P=w;let F,C=Rs,x=bn,I=w,S=Rs,L=bn;for(let V=BigInt(s-1);V>=bn;V--){const A=D>>V&Rs;L^=A,F=d(L,C,I),C=F[0],I=F[1],F=d(L,x,S),x=F[0],S=F[1],L=A;const R=C+x,N=i(R*R),B=C-x,q=i(B*B),U=N-q,H=I+S,k=i((I-S)*R),X=i(H*B),ae=k+X,he=k-X;I=i(ae*ae),S=i(P*i(he*he)),C=i(N*q),x=i(U*(N+i(h*U)))}F=d(L,C,I),C=F[0],I=F[1],F=d(L,x,S),x=F[0],S=F[1];const M=u(x);return i(C*M)}(D,P);if(C===bn)throw new Error("invalid private or public key received");return g(C)}const _=g(e.Gu);function v(w){return m(w,_)}return{scalarMult:m,scalarMultBase:v,getSharedSecret:(w,E)=>m(w,E),getPublicKey:w=>v(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:_}}({P:Ns,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=Ns,{pow_p_5_8:t,b2:i}=function Jf(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),o=Ns,a=r*r%o*r%o,c=et(a,dc,o)*a%o,u=et(c,Hf,o)*r%o,d=et(u,Gf,o)*u%o,h=et(d,e,o)*d%o,p=et(h,t,o)*h%o,g=et(p,i,o)*p%o,b=et(g,s,o)*g%o,y=et(b,s,o)*g%o,m=et(y,e,o)*d%o;return{pow_p_5_8:et(m,dc,o)*r%o,b2:a}}(r);return Ue(et(t,Kf,e)*i,e)},adjustScalarBytes:function Wf(r){return r[0]&=248,r[31]&=127,r[31]|=64,r},randomBytes:ln});function hc(r){void 0!==r.lowS&&pn("lowS",r.lowS),void 0!==r.prehash&&pn("prehash",r.prehash)}const{bytesToNumberBE:Yf,hexToBytes:Xf}=Rf;class eg extends Error{constructor(e=""){super(e)}}const Dt={Err:eg,_tlv:{encode:(r,e)=>{const{Err:t}=Dt;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(1&e.length)throw new t("tlv.encode: unpadded data");const i=e.length/2,s=gn(i);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const o=i>127?gn(s.length/2|128):"";return gn(r)+o+s+e},decode(r,e){const{Err:t}=Dt;let i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[i++];let a=0;if(!!(128&s)){const u=127&s;if(!u)throw new t("tlv.decode(long): indefinite length not supported");if(u>4)throw new t("tlv.decode(long): byte length is too big");const d=e.subarray(i,i+u);if(d.length!==u)throw new t("tlv.decode: length bytes not complete");if(0===d[0])throw new t("tlv.decode(long): zero leftmost byte");for(const h of d)a=a<<8|h;if(i+=u,a<128)throw new t("tlv.decode(long): not minimal encoding")}else a=s;const c=e.subarray(i,i+a);if(c.length!==a)throw new t("tlv.decode: wrong value length");return{v:c,l:e.subarray(i+a)}}},_int:{encode(r){const{Err:e}=Dt;if(r<Et)throw new e("integer: negative integers are not allowed");let t=gn(r);if(8&Number.parseInt(t[0],16)&&(t="00"+t),1&t.length)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Dt;if(128&r[0])throw new e("invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("invalid signature integer: unnecessary leading zero");return Yf(r)}},toSig(r){const{Err:e,_int:t,_tlv:i}=Dt,s="string"==typeof r?Xf(r):r;Wn(s);const{v:o,l:a}=i.decode(48,s);if(a.length)throw new e("invalid signature: left bytes after parsing");const{v:c,l:u}=i.decode(2,o),{v:d,l:h}=i.decode(2,u);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(c),s:t.decode(d)}},hexFromSig(r){const{_tlv:e,_int:t}=Dt,o=e.encode(2,t.encode(r.r))+e.encode(2,t.encode(r.s));return e.encode(48,o)}},Et=BigInt(0),fe=BigInt(1);BigInt(2);const pc=BigInt(3);function tg(r){const e=function Qf(r){const e=lc(r);_n(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:i,a:s}=e;if(t){if(!i.eql(s,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof t||"bigint"!=typeof t.beta||"function"!=typeof t.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(r),{Fp:t}=e,i=ic(e.n,e.nBitLength),s=e.toBytes||((m,_,v)=>{const w=_.toAffine();return Yn(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),o=e.fromBytes||(m=>{const _=m.subarray(1);return{x:t.fromBytes(_.subarray(0,t.BYTES)),y:t.fromBytes(_.subarray(t.BYTES,2*t.BYTES))}});function a(m){const{a:_,b:v}=e,w=t.sqr(m),E=t.mul(w,m);return t.add(t.add(E,t.mul(m,_)),v)}if(!t.eql(t.sqr(e.Gy),a(e.Gx)))throw new Error("bad generator point: equation left != right");function u(m){const{allowedPrivateKeyLengths:_,nByteLength:v,wrapPrivateKey:w,n:E}=e;if(_&&"bigint"!=typeof m){if(Zt(m)&&(m=fn(m)),"string"!=typeof m||!_.includes(m.length))throw new Error("invalid private key");m=m.padStart(2*v,"0")}let D;try{D="bigint"==typeof m?m:Vt(Le("private key",m,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof m)}return w&&(D=Ue(D,E)),wt("private key",D,fe,E),D}function d(m){if(!(m instanceof g))throw new Error("ProjectivePoint expected")}const h=xs((m,_)=>{const{px:v,py:w,pz:E}=m;if(t.eql(E,t.ONE))return{x:v,y:w};const D=m.is0();null==_&&(_=D?t.ONE:t.inv(E));const P=t.mul(v,_),C=t.mul(w,_),x=t.mul(E,_);if(D)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:P,y:C}}),p=xs(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:_,y:v}=m.toAffine();if(!t.isValid(_)||!t.isValid(v))throw new Error("bad point: x or y not FE");const w=t.sqr(v),E=a(_);if(!t.eql(w,E))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(_,v,w){if(this.px=_,this.py=v,this.pz=w,null==_||!t.isValid(_))throw new Error("x required");if(null==v||!t.isValid(v))throw new Error("y required");if(null==w||!t.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(_){const{x:v,y:w}=_||{};if(!_||!t.isValid(v)||!t.isValid(w))throw new Error("invalid affine point");if(_ instanceof g)throw new Error("projective point not allowed");const E=D=>t.eql(D,t.ZERO);return E(v)&&E(w)?g.ZERO:new g(v,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const v=t.invertBatch(_.map(w=>w.pz));return _.map((w,E)=>w.toAffine(v[E])).map(g.fromAffine)}static fromHex(_){const v=g.fromAffine(o(Le("pointHex",_)));return v.assertValidity(),v}static fromPrivateKey(_){return g.BASE.multiply(u(_))}static msm(_,v){return zf(g,i,_,v)}_setWindowSize(_){y.setWindowSize(this,_)}assertValidity(){p(this)}hasEvenY(){const{y:_}=this.toAffine();if(t.isOdd)return!t.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){d(_);const{px:v,py:w,pz:E}=this,{px:D,py:P,pz:C}=_,x=t.eql(t.mul(v,C),t.mul(D,E)),I=t.eql(t.mul(w,C),t.mul(P,E));return x&&I}negate(){return new g(this.px,t.neg(this.py),this.pz)}double(){const{a:_,b:v}=e,w=t.mul(v,pc),{px:E,py:D,pz:P}=this;let C=t.ZERO,x=t.ZERO,I=t.ZERO,S=t.mul(E,E),L=t.mul(D,D),F=t.mul(P,P),M=t.mul(E,D);return M=t.add(M,M),I=t.mul(E,P),I=t.add(I,I),C=t.mul(_,I),x=t.mul(w,F),x=t.add(C,x),C=t.sub(L,x),x=t.add(L,x),x=t.mul(C,x),C=t.mul(M,C),I=t.mul(w,I),F=t.mul(_,F),M=t.sub(S,F),M=t.mul(_,M),M=t.add(M,I),I=t.add(S,S),S=t.add(I,S),S=t.add(S,F),S=t.mul(S,M),x=t.add(x,S),F=t.mul(D,P),F=t.add(F,F),S=t.mul(F,M),C=t.sub(C,S),I=t.mul(F,L),I=t.add(I,I),I=t.add(I,I),new g(C,x,I)}add(_){d(_);const{px:v,py:w,pz:E}=this,{px:D,py:P,pz:C}=_;let x=t.ZERO,I=t.ZERO,S=t.ZERO;const L=e.a,F=t.mul(e.b,pc);let M=t.mul(v,D),V=t.mul(w,P),A=t.mul(E,C),R=t.add(v,w),N=t.add(D,P);R=t.mul(R,N),N=t.add(M,V),R=t.sub(R,N),N=t.add(v,E);let B=t.add(D,C);return N=t.mul(N,B),B=t.add(M,A),N=t.sub(N,B),B=t.add(w,E),x=t.add(P,C),B=t.mul(B,x),x=t.add(V,A),B=t.sub(B,x),S=t.mul(L,N),x=t.mul(F,A),S=t.add(x,S),x=t.sub(V,S),S=t.add(V,S),I=t.mul(x,S),V=t.add(M,M),V=t.add(V,M),A=t.mul(L,A),N=t.mul(F,N),V=t.add(V,A),A=t.sub(M,A),A=t.mul(L,A),N=t.add(N,A),M=t.mul(V,N),I=t.add(I,M),M=t.mul(B,N),x=t.mul(R,x),x=t.sub(x,M),M=t.mul(R,V),S=t.mul(B,S),S=t.add(S,M),new g(x,I,S)}subtract(_){return this.add(_.negate())}is0(){return this.equals(g.ZERO)}wNAF(_){return y.wNAFCached(this,_,g.normalizeZ)}multiplyUnsafe(_){const{endo:v,n:w}=e;wt("scalar",_,Et,w);const E=g.ZERO;if(_===Et)return E;if(this.is0()||_===fe)return this;if(!v||y.hasPrecomputes(this))return y.wNAFCachedUnsafe(this,_,g.normalizeZ);let{k1neg:D,k1:P,k2neg:C,k2:x}=v.splitScalar(_),I=E,S=E,L=this;for(;P>Et||x>Et;)P&fe&&(I=I.add(L)),x&fe&&(S=S.add(L)),L=L.double(),P>>=fe,x>>=fe;return D&&(I=I.negate()),C&&(S=S.negate()),S=new g(t.mul(S.px,v.beta),S.py,S.pz),I.add(S)}multiply(_){const{endo:v,n:w}=e;let E,D;if(wt("scalar",_,fe,w),v){const{k1neg:P,k1:C,k2neg:x,k2:I}=v.splitScalar(_);let{p:S,f:L}=this.wNAF(C),{p:F,f:M}=this.wNAF(I);S=y.constTimeNegate(P,S),F=y.constTimeNegate(x,F),F=new g(t.mul(F.px,v.beta),F.py,F.pz),E=S.add(F),D=L.add(M)}else{const{p:P,f:C}=this.wNAF(_);E=P,D=C}return g.normalizeZ([E,D])[0]}multiplyAndAddUnsafe(_,v,w){const E=g.BASE,D=(C,x)=>x!==Et&&x!==fe&&C.equals(E)?C.multiply(x):C.multiplyUnsafe(x),P=D(this,v).add(D(_,w));return P.is0()?void 0:P}toAffine(_){return h(this,_)}isTorsionFree(){const{h:_,isTorsionFree:v}=e;if(_===fe)return!0;if(v)return v(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:v}=e;return _===fe?this:v?v(g,this):this.multiplyUnsafe(e.h)}toRawBytes(_=!0){return pn("isCompressed",_),this.assertValidity(),s(g,this,_)}toHex(_=!0){return pn("isCompressed",_),fn(this.toRawBytes(_))}}g.BASE=new g(e.Gx,e.Gy,t.ONE),g.ZERO=new g(t.ZERO,t.ONE,t.ZERO);const b=e.nBitLength,y=function Lf(r,e){return{constTimeNegate:Ps,hasPrecomputes:t=>1!==As(t),unsafeLadder(t,i,s=r.ZERO){let o=t;for(;i>ac;)i&Ur&&(s=s.add(o)),o=o.double(),i>>=Ur;return s},precomputeWindow(t,i){const{windows:s,windowSize:o}=Ss(i,e),a=[];let c=t,u=c;for(let d=0;d<s;d++){u=c,a.push(u);for(let h=1;h<o;h++)u=u.add(c),a.push(u);c=u.double()}return a},wNAF(t,i,s){const{windows:o,windowSize:a}=Ss(t,e);let c=r.ZERO,u=r.BASE;const d=BigInt(2**t-1),h=2**t,p=BigInt(t);for(let g=0;g<o;g++){const b=g*a;let y=Number(s&d);s>>=p,y>a&&(y-=h,s+=Ur);const m=b,_=b+Math.abs(y)-1,v=g%2!=0,w=y<0;0===y?u=u.add(Ps(v,i[m])):c=c.add(Ps(w,i[_]))}return{p:c,f:u}},wNAFUnsafe(t,i,s,o=r.ZERO){const{windows:a,windowSize:c}=Ss(t,e),u=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let p=0;p<a;p++){const g=p*c;if(s===ac)break;let b=Number(s&u);if(s>>=h,b>c&&(b-=d,s+=Ur),0===b)continue;let y=i[g+Math.abs(b)-1];b<0&&(y=y.negate()),o=o.add(y)}return o},getPrecomputes(t,i,s){let o=Os.get(i);return o||(o=this.precomputeWindow(i,t),1!==t&&Os.set(i,s(o))),o},wNAFCached(t,i,s){const o=As(t);return this.wNAF(o,this.getPrecomputes(o,t,s),i)},wNAFCachedUnsafe(t,i,s,o){const a=As(t);return 1===a?this.unsafeLadder(t,i,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),i,o)},setWindowSize(t,i){cc(i,e),uc.set(t,i),Os.delete(t)}}}(g,e.endo?Math.ceil(b/2):b);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:u,weierstrassEquation:a,isWithinCurveOrder:function c(m){return $r(m,fe,e.n)}}}function rg(r){const e=function ng(r){const e=lc(r);return _n(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(r),{Fp:t,n:i}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(A){return Ue(A,i)}function c(A){return Cs(A,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:h,isWithinCurveOrder:p}=tg({...e,toBytes(A,R,N){const B=R.toAffine(),q=t.toBytes(B.x),U=Yn;return pn("isCompressed",N),N?U(Uint8Array.from([R.hasEvenY()?2:3]),q):U(Uint8Array.from([4]),q,t.toBytes(B.y))},fromBytes(A){const R=A.length,N=A[0],B=A.subarray(1);if(R!==s||2!==N&&3!==N){if(R===o&&4===N){return{x:t.fromBytes(B.subarray(0,t.BYTES)),y:t.fromBytes(B.subarray(t.BYTES,2*t.BYTES))}}throw new Error("invalid Point, expected length of "+s+", or uncompressed "+o+", got "+R)}{const q=Vt(B);if(!$r(q,fe,t.ORDER))throw new Error("Point is not on curve");const U=h(q);let H;try{H=t.sqrt(U)}catch(k){const X=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+X)}return 1==(1&N)!==((H&fe)===fe)&&(H=t.neg(H)),{x:q,y:H}}}}),g=A=>fn(mn(A,e.nByteLength));function b(A){return A>i>>fe}const m=(A,R,N)=>Vt(A.slice(R,N));class _{constructor(R,N,B){this.r=R,this.s=N,this.recovery=B,this.assertValidity()}static fromCompact(R){const N=e.nByteLength;return R=Le("compactSignature",R,2*N),new _(m(R,0,N),m(R,N,2*N))}static fromDER(R){const{r:N,s:B}=Dt.toSig(Le("DER",R));return new _(N,B)}assertValidity(){wt("r",this.r,fe,i),wt("s",this.s,fe,i)}addRecoveryBit(R){return new _(this.r,this.s,R)}recoverPublicKey(R){const{r:N,s:B,recovery:q}=this,U=C(Le("msgHash",R));if(null==q||![0,1,2,3].includes(q))throw new Error("recovery id invalid");const H=2===q||3===q?N+e.n:N;if(H>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const Z=1&q?"03":"02",k=u.fromHex(Z+g(H)),X=c(H),ae=a(-U*X),he=a(B*X),_e=u.BASE.multiplyAndAddUnsafe(k,ae,he);if(!_e)throw new Error("point at infinify");return _e.assertValidity(),_e}hasHighS(){return b(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return yn(this.toDERHex())}toDERHex(){return Dt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return yn(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const v={isValidPrivateKey(A){try{return d(A),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const A=oc(e.n);return function qf(r,e,t=!1){const i=r.length,s=sc(e),o=oc(e);if(i<16||i<o||i>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+i);const c=Ue(t?Qn(r):Vt(r),e-ce)+ce;return t?jr(c,s):mn(c,s)}(e.randomBytes(A),e.n)},precompute:(A=8,R=u.BASE)=>(R._setWindowSize(A),R.multiply(BigInt(3)),R)};function E(A){const R=Zt(A),N="string"==typeof A,B=(R||N)&&A.length;return R?B===s||B===o:N?B===2*s||B===2*o:A instanceof u}const P=e.bits2int||function(A){if(A.length>8192)throw new Error("input is too large");const R=Vt(A),N=8*A.length-e.nBitLength;return N>0?R>>BigInt(N):R},C=e.bits2int_modN||function(A){return a(P(A))},x=Ds(e.nBitLength);function I(A){return wt("num < 2^"+e.nBitLength,A,Et,x),mn(A,e.nByteLength)}function S(A,R,N=L){if(["recovered","canonical"].some(ve=>ve in N))throw new Error("sign() legacy options not supported");const{hash:B,randomBytes:q}=e;let{lowS:U,prehash:H,extraEntropy:Z}=N;null==U&&(U=!0),A=Le("msgHash",A),hc(N),H&&(A=Le("prehashed msgHash",B(A)));const k=C(A),X=d(R),ae=[I(X),I(k)];if(null!=Z&&!1!==Z){const ve=!0===Z?q(t.BYTES):Z;ae.push(Le("extraEntropy",ve))}const he=Yn(...ae),_e=k;return{seed:he,k2sig:function be(ve){const Ae=P(ve);if(!p(Ae))return;const Pt=c(Ae),ft=u.BASE.multiply(Ae).toAffine(),Ke=a(ft.x);if(Ke===Et)return;const at=a(Pt*a(_e+Ke*X));if(at===Et)return;let Mn=(ft.x===Ke?0:2)|Number(ft.y&fe),mr=at;return U&&b(at)&&(mr=function y(A){return b(A)?a(-A):A}(at),Mn^=1),new _(Ke,mr,Mn)}}}const L={lowS:e.lowS,prehash:!1},F={lowS:e.lowS,prehash:!1};return u.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function w(A,R=!0){return u.fromPrivateKey(A).toRawBytes(R)},getSharedSecret:function D(A,R,N=!0){if(E(A))throw new Error("first arg must be private key");if(!E(R))throw new Error("second arg must be public key");return u.fromHex(R).multiply(d(A)).toRawBytes(N)},sign:function M(A,R,N=L){const{seed:B,k2sig:q}=S(A,R,N),U=e;return Xa(U.hash.outputLen,U.nByteLength,U.hmac)(B,q)},verify:function V(A,R,N,B=F){const q=A;R=Le("msgHash",R),N=Le("publicKey",N);const{lowS:U,prehash:H,format:Z}=B;if(hc(B),"strict"in B)throw new Error("options.strict was renamed to lowS");if(void 0!==Z&&"compact"!==Z&&"der"!==Z)throw new Error("format must be compact or der");const k="string"==typeof q||Zt(q),X=!k&&!Z&&"object"==typeof q&&null!==q&&"bigint"==typeof q.r&&"bigint"==typeof q.s;if(!k&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ae,he;try{if(X&&(ae=new _(q.r,q.s)),k){try{"compact"!==Z&&(ae=_.fromDER(q))}catch(at){if(!(at instanceof Dt.Err))throw at}!ae&&"der"!==Z&&(ae=_.fromCompact(q))}he=u.fromHex(N)}catch{return!1}if(!ae||U&&ae.hasHighS())return!1;H&&(R=e.hash(R));const{r:_e,s:be}=ae,ve=C(R),Ae=c(be),Pt=a(ve*Ae),ft=a(_e*Ae),Ke=u.BASE.multiplyAndAddUnsafe(he,Pt,ft)?.toAffine();return!!Ke&&a(Ke.x)===_e},ProjectivePoint:u,Signature:_,utils:v}}function ig(r){return{hash:r,hmac:(e,...t)=>Nr(r,e,function up(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Kn(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const o=r[i];t.set(o,s),s+=o.length}return t}(...t)),randomBytes:ln}}BigInt(4);const fc=ic(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),cg=function sg(r,e){const t=i=>rg({...r,...ig(i)});return{...t(e),create:t}}({a:fc.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:fc,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Jn),gc="base10",Ne="base16",tt="base64pad",jt="base64url",Xn="utf8",yc=0,xt=1,er=2,ug=0,mc=1,tr=12,Fs=32;function js(){return Me(ln(Fs),Ne)}function Br(r){return Me(Jn(Ge(r,Ne)),Ne)}function ut(r){return Me(Jn(Ge(r,Xn)),Ne)}function _c(r){return Ge(`${r}`,gc)}function Kt(r){return Number(Me(r,gc))}function bc(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function vc(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function wc(r){if(Kt(r.type)===er)return Me(Ln([r.type,r.sealed]),tt);if(Kt(r.type)===xt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Me(Ln([r.type,r.senderPublicKey,r.iv,r.sealed]),tt)}return Me(Ln([r.type,r.iv,r.sealed]),tt)}function nr(r){const t=Ge((r.encoding||tt)===jt?vc(r.encoded):r.encoded,tt),i=t.slice(ug,mc),s=mc;if(Kt(i)===xt){const u=s+Fs,d=u+tr,h=t.slice(s,u),p=t.slice(u,d);return{type:i,sealed:t.slice(d),iv:p,senderPublicKey:h}}if(Kt(i)===er){return{type:i,sealed:t.slice(s),iv:ln(tr)}}const o=s+tr,a=t.slice(s,o);return{type:i,sealed:t.slice(o),iv:a}}function Dc(r){const e=r?.type||yc;if(e===xt){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function Ec(r){return r.type===xt&&"string"==typeof r.senderPublicKey&&"string"==typeof r.receiverPublicKey}function xc(r){return r.type===er}function _g(r,e){const[t,i,s]=r.split("."),o=Buffer.from(vc(s),"base64");if(64!==o.length)throw new Error("Invalid signature length");const a=o.slice(0,32),c=o.slice(32,64),d=Jn(`${t}.${i}`),h=function mg(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return Ln([new Uint8Array([4]),e,t])}(e);if(!cg.verify(Ln([a,c]),d,h))throw new Error("Invalid signature");return(0,Bt.xp)(r).payload}function qr(r){return r?.relay||{protocol:"irn"}}function rr(r){const e=_h.iO[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function vg(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const o=s.replace(i,""),a=r[s];t[o]=a}}),t}function Ic(r){if(!r.includes("wc:")){const d=ga(r);null!=d&&d.includes("wc:")&&(r=d)}const e=(r=(r=r.includes("wc://")?r.replace("wc://",""):r).includes("wc:")?r.replace("wc:",""):r).indexOf(":"),t=-1!==r.indexOf("?")?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),o=typeof t<"u"?r.substring(t):"",a=new URLSearchParams(o),c={};a.forEach((d,h)=>{c[h]=d});const u="string"==typeof c.methods?c.methods.split(","):void 0;return{protocol:i,topic:wg(s[0]),version:parseInt(s[1],10),symKey:c.symKey,relay:vg(c),methods:u,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function wg(r){return r.startsWith("//")?r.substring(2):r}function Cc(r){const e=new URLSearchParams,t=function Dg(r,e="-"){const i={};return Object.keys(r).forEach(s=>{const o=s,a="relay"+e+o;r[o]&&(i[a]=r[o])}),i}(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function Mr(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var Eg=Object.defineProperty,xg=Object.defineProperties,Ig=Object.getOwnPropertyDescriptors,Pc=Object.getOwnPropertySymbols,Cg=Object.prototype.hasOwnProperty,Pg=Object.prototype.propertyIsEnumerable,Sc=(r,e,t)=>e in r?Eg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sg=(r,e)=>{for(var t in e||(e={}))Cg.call(e,t)&&Sc(r,t,e[t]);if(Pc)for(var t of Pc(e))Pg.call(e,t)&&Sc(r,t,e[t]);return r},Og=(r,e)=>xg(r,Ig(e));function vn(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function kr(r){return r.includes(":")}function wn(r){return kr(r)?r.split(":")[0]:r}function Lr(r){var e,t,i;const s={};if(!$t(r))return s;for(const[o,a]of Object.entries(r)){const c=kr(o)?[o]:a.chains,u=a.methods||[],d=a.events||[],h=wn(o);s[h]=Og(Sg({},s[h]),{chains:$e(c,null==(e=s[h])?void 0:e.chains),methods:$e(u,null==(t=s[h])?void 0:t.methods),events:$e(d,null==(i=s[h])?void 0:i.events)})}return s}function Oc(r,e){const t=function Tg(r){const e={};return r?.forEach(t=>{var i;const[s,o]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),null==(i=e[s].chains)||i.push(`${s}:${o}`)}),e}(e=e.map(i=>i.replace("did:pkh:","")));for(const[i,s]of Object.entries(t))s.methods?s.methods=$e(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}const jg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},$g={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(r,e){const{message:t,code:i}=$g[r];return{message:e?`${t} ${e}`:t,code:i}}function te(r,e){const{message:t,code:i}=jg[r];return{message:e?`${t} ${e}`:t,code:i}}function nt(r,e){return!!Array.isArray(r)&&(!(typeof e<"u"&&r.length)||r.every(e))}function $t(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Ee(r){return typeof r>"u"}function ue(r,e){return!(!e||!Ee(r))||"string"==typeof r&&!!r.trim().length}function $s(r,e){return!(!e||!Ee(r))||"number"==typeof r&&!isNaN(r)}function zr(r){return!(!ue(r,!1)||!r.includes(":"))&&2===r.split(":").length}function Ac(r){let e=!0;return nt(r)?r.length&&(e=r.every(t=>ue(t,!1))):e=!1,e}function Zg(r,e,t){let i=null;return Object.entries(r).forEach(([s,o])=>{if(i)return;const a=function zg(r,e,t){let i=null;return nt(e)&&e.length?e.forEach(s=>{i||zr(s)||(i=te("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):zr(r)||(i=te("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}(s,Wi(s,o),`${e} ${t}`);a&&(i=a)}),i}function Vg(r,e){let t=null;return nt(r)?r.forEach(i=>{t||function Bg(r){if(ue(r,!1)&&r.includes(":")){const e=r.split(":");if(3===e.length){const t=e[0]+":"+e[1];return!!e[2]&&zr(t)}}return!1}(i)||(t=te("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Rc(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=function Kg(r,e){let t=null;return Ac(r?.methods)?Ac(r?.events)||(t=te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}(i,`${e}, namespace`);s&&(t=s)}),t}function Zr(r,e){let t=null;if(r&&$t(r)){const i=Rc(r,e);i&&(t=i);const s=function Hg(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Vg(i?.accounts,`${e} namespace`);s&&(t=s)}),t}(r,e);s&&(t=s)}else t=j("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Nc(r){return ue(r.protocol,!0)}function Be(r){return typeof r<"u"&&null!==typeof r}function Tc(r,e){return!(!zr(e)||!function Ag(r){const e=[];return Object.values(r).forEach(t=>{e.push(...vn(t.accounts))}),e}(r).includes(e))}function ty(r,e,t){return!!ue(t,!1)&&function Rg(r,e){const t=[];return Object.values(r).forEach(i=>{vn(i.accounts).includes(e)&&t.push(...i.methods)}),t}(r,e).includes(t)}function ny(r,e,t){return!!ue(t,!1)&&function Ng(r,e){const t=[];return Object.values(r).forEach(i=>{vn(i.accounts).includes(e)&&t.push(...i.events)}),t}(r,e).includes(t)}function Us(r,e,t){let i=null;const s=function ry(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:null==(i=r[t].chains)||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}(r),o=function iy(r){const e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:vn(r[t].accounts)?.forEach(s=>{e[s]={accounts:r[t].accounts.filter(o=>o.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}),e}(e),a=Object.keys(s),c=Object.keys(o),u=Fc(Object.keys(r)),d=Fc(Object.keys(e)),h=u.filter(p=>!d.includes(p));return h.length&&(i=j("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${h.toString()}\n      Received: ${Object.keys(e).toString()}`)),Mt(a,c)||(i=j("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.\n      Required: ${a.toString()}\n      Approved: ${c.toString()}`)),Object.keys(e).forEach(p=>{if(!p.includes(":")||i)return;const g=vn(e[p].accounts);g.includes(p)||(i=j("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${p}\n        Required: ${p}\n        Approved: ${g.toString()}`))}),a.forEach(p=>{i||(Mt(s[p].methods,o[p].methods)?Mt(s[p].events,o[p].events)||(i=j("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${p}`)):i=j("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${p}`))}),i}function Fc(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function jc(){const r=on();return new Promise(e=>{switch(r){case je.browser:e(function oy(){return sn()&&navigator?.onLine}());break;case je.reactNative:e(function ay(){return Bs.apply(this,arguments)}());break;case je.node:default:e(!0)}})}function Bs(){return(Bs=(0,f.Z)(function*(){return!(Ot()&&typeof global<"u"&&null!=global&&global.NetInfo)||(yield null==global?void 0:global.NetInfo.fetch())?.isConnected})).apply(this,arguments)}function uy(r){switch(on()){case je.browser:!function ly(r){!Ot()&&sn()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}(r);break;case je.reactNative:!function dy(r){Ot()&&typeof global<"u"&&null!=global&&global.NetInfo&&global?.NetInfo.addEventListener(e=>r(e?.isConnected))}(r);case je.node:}}const qs={};class ir{static get(e){return qs[e]}static set(e,t){qs[e]=t}static delete(e){delete qs[e]}}var Gt=T(63388),py=T(73407),K=T(87714),Dn=T(62108),fy=Object.defineProperty,$c=(r,e,t)=>((r,e,t)=>e in r?fy(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class yy extends Dn.q{constructor(e){super(),this.opts=e,$c(this,"protocol","wc"),$c(this,"version",2)}}var my=Object.defineProperty,by=(r,e,t)=>((r,e,t)=>e in r?my(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class vy extends Dn.q{constructor(e,t){super(),this.core=e,this.logger=t,by(this,"records",new Map)}}class wy{constructor(e,t){this.logger=e,this.core=t}}class Dy extends Dn.q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Ey extends Dn.q{constructor(e){super()}}class xy{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}}Object.defineProperty;class Sy extends Dn.q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Oy extends Dn.q{constructor(e,t){super(),this.core=e,this.logger=t}}class Ay{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}}class Ry{constructor(e,t){this.projectId=e,this.logger=t}}class Ny{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}}var Ty=Object.defineProperty,Uc=(r,e,t)=>((r,e,t)=>e in r?Ty(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class jy{constructor(e){this.opts=e,Uc(this,"protocol","wc"),Uc(this,"version",2)}}class $y{constructor(e){this.client=e}}var Ms=T(57630);var By=function Uy(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=s}var c=r.length,u=r.charAt(0),d=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function g(y){if("string"!=typeof y)throw new TypeError("Expected String");if(0===y.length)return new Uint8Array;var m=0;if(" "!==y[m]){for(var _=0,v=0;y[m]===u;)_++,m++;for(var w=(y.length-m)*d+1>>>0,E=new Uint8Array(w);y[m];){var D=t[y.charCodeAt(m)];if(255===D)return;for(var P=0,C=w-1;(0!==D||P<v)&&-1!==C;C--,P++)D+=c*E[C]>>>0,E[C]=D%256>>>0,D=D/256>>>0;if(0!==D)throw new Error("Non-zero carry");v=P,m++}if(" "!==y[m]){for(var x=w-v;x!==w&&0===E[x];)x++;for(var I=new Uint8Array(_+(w-x)),S=_;x!==w;)I[S++]=E[x++];return I}}}return{encode:function p(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===y.length)return"";for(var m=0,_=0,v=0,w=y.length;v!==w&&0===y[v];)v++,m++;for(var E=(w-v)*h+1>>>0,D=new Uint8Array(E);v!==w;){for(var P=y[v],C=0,x=E-1;(0!==P||C<_)&&-1!==x;x--,C++)P+=256*D[x]>>>0,D[x]=P%c>>>0,P=P/c>>>0;if(0!==P)throw new Error("Non-zero carry");_=C,v++}for(var I=E-_;I!==E&&0===D[I];)I++;for(var S=u.repeat(m);I<E;++I)S+=r.charAt(D[I]);return S},decodeUnsafe:g,decode:function b(y){var m=g(y);if(m)return m;throw new Error(`Non-${e} character`)}}};const My=By,En=(new Uint8Array(0),r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")});class Vy{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Hy{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Bc(this,e)}}class Ky{constructor(e){this.decoders=e}or(e){return Bc(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bc=(r,e)=>new Ky({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Gy{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Vy(e,t,i),this.decoder=new Hy(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vr=({name:r,prefix:e,encode:t,decode:i})=>new Gy(r,e,t,i),sr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=My(t,e);return Vr({prefix:r,name:e,encode:i,decode:o=>En(s(o))})},xe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Vr({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let o="",a=0,c=0;for(let u=0;u<r.length;++u)for(c=c<<8|r[u],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),i)for(;o.length*t&7;)o+="=";return o})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let o=r.length;for(;"="===r[o-1];)--o;const a=new Uint8Array(o*t/8|0);let c=0,u=0,d=0;for(let h=0;h<o;++h){const p=s[r[h]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);u=u<<t|p,c+=t,c>=8&&(c-=8,a[d++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a})(s,i,t,r)}),Qy=Vr({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)}),Yy=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Xy=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),em=sr({prefix:"9",name:"base10",alphabet:"0123456789"}),tm=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),nm=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),or=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rm=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),im=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sm=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),om=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),am=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cm=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),um=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lm=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),dm=sr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hm=sr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),It=sr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),pm=sr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),fm=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),gm=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ym=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),mm=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),qc=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),_m=qc.reduce((r,e,t)=>(r[t]=e,r),[]),bm=qc.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const Dm=Vr({prefix:"\u{1f680}",name:"base256emoji",encode:function vm(r){return r.reduce((e,t)=>e+=_m[t],"")},decode:function wm(r){const e=[];for(const t of r){const i=bm[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var Em=function kc(r,e,t){e=e||[];for(var i=t=t||0;r>=Cm;)e[t++]=255&r|Mc,r/=128;for(;r&Im;)e[t++]=255&r|Mc,r>>>=7;return e[t]=0|r,kc.bytes=t-i+1,e},Mc=128,Im=-128,Cm=Math.pow(2,31);var Pm=function ks(r,i){var a,t=0,s=0,o=i=i||0,c=r.length;do{if(o>=c)throw ks.bytes=0,new RangeError("Could not decode varint");a=r[o++],t+=s<28?(a&Lc)<<s:(a&Lc)*Math.pow(2,s),s+=7}while(a>=Sm);return ks.bytes=o-i,t},Sm=128,Lc=127;var Om=Math.pow(2,7),Am=Math.pow(2,14),Rm=Math.pow(2,21),Nm=Math.pow(2,28),Tm=Math.pow(2,35),Fm=Math.pow(2,42),jm=Math.pow(2,49),$m=Math.pow(2,56),Um=Math.pow(2,63),qm={encode:Em,decode:Pm,encodingLength:function(r){return r<Om?1:r<Am?2:r<Rm?3:r<Nm?4:r<Tm?5:r<Fm?6:r<jm?7:r<$m?8:r<Um?9:10}};const Hr=qm,Kr=(r,e,t=0)=>(Hr.encode(r,e,t),e),Gr=r=>Hr.encodingLength(r),Jr=(r,e)=>{const t=e.byteLength,i=Gr(r),s=i+Gr(t),o=new Uint8Array(s+t);return Kr(r,o,0),Kr(t,o,i),o.set(e,s),new zs(r,t,e,o)};class zs{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const zc=({name:r,code:e,encode:t})=>new zm(r,e,t);class zm{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Jr(this.code,t):t.then(i=>Jr(this.code,i))}throw Error("Unknown type, must be binary type")}}const Zc=r=>function(){var e=(0,f.Z)(function*(t){return new Uint8Array(yield crypto.subtle.digest(r,t))});return function(t){return e.apply(this,arguments)}}(),Zm=zc({name:"sha2-256",code:18,encode:Zc("SHA-256")}),Vm=zc({name:"sha2-512",code:19,encode:Zc("SHA-512")}),Hc=En,Km={code:0,name:"identity",encode:Hc,digest:r=>Jr(0,Hc(r))},Gm="raw",Jm=85,Wm=r=>En(r),Qm=r=>En(r),Ym=new TextEncoder,Xm=new TextDecoder,e_="json",t_=512,n_=r=>Ym.encode(JSON.stringify(r)),r_=r=>JSON.parse(Xm.decode(r));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const Jc={...Pi,...Si,...Oi,...Ai,...Ri,...Ni,...Ti,...Fi,...ji,...$i};function Wc(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Qc=Wc("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),Zs=Wc("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=function d_(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),h_={utf8:Qc,"utf-8":Qc,hex:Jc.base16,latin1:Zs,ascii:Zs,binary:Zs,...Jc};var Je=T(20259),z=T(26446),f_=T(66898);const Yr="core",lt=`wc@2:${Yr}:`,g__logger="error",y_={database:":memory:"},eu="client_ed25519_seed",__=$.ONE_DAY,tu=$.SIX_HOURS,ru="wss://relay.walletconnect.org",ge_message="relayer_message",ge_message_ack="relayer_message_ack",ge_connect="relayer_connect",ge_disconnect="relayer_disconnect",ge_error="relayer_error",ge_connection_stalled="relayer_connection_stalled",ge_publish="relayer_publish",We_payload="payload",We_connect="connect",We_disconnect="disconnect",We_error="error",Vs="2.21.1",oe={link_mode:"link_mode",relay:"relay"},Xr_inbound="inbound",Xr_outbound="outbound",iu="WALLETCONNECT_LINK_MODE_APPS",ze_created="subscription_created",ze_deleted="subscription_deleted",ze_sync="subscription_sync",ze_resubscribed="subscription_resubscribed",cr=($.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:$.ONE_DAY,prompt:!1,tag:0},res:{ttl:$.ONE_DAY,prompt:!1,tag:0}}}),Jt_create="pairing_create",Jt_expire="pairing_expire",Jt_delete="pairing_delete",Jt_ping="pairing_ping",rt_created="history_created",rt_updated="history_updated",rt_deleted="history_deleted",rt_sync="history_sync",Qe_created="expirer_created",Qe_deleted="expirer_deleted",Qe_expired="expirer_expired",Qe_sync="expirer_sync",su="https://verify.walletconnect.org",ur=su,M_=`${ur}/v3`,k_=["https://verify.walletconnect.com",su],dt_pairing_started="pairing_started",dt_pairing_uri_validation_success="pairing_uri_validation_success",dt_pairing_uri_not_expired="pairing_uri_not_expired",dt_store_new_pairing="store_new_pairing",dt_subscribing_pairing_topic="subscribing_pairing_topic",dt_subscribe_pairing_topic_success="subscribe_pairing_topic_success",dt_existing_pairing="existing_pairing",dt_pairing_not_expired="pairing_not_expired",dt_emit_inactive_pairing="emit_inactive_pairing",dt_emit_session_proposal="emit_session_proposal",Ct_no_internet_connection="no_internet_connection",Ct_malformed_pairing_uri="malformed_pairing_uri",Ct_active_pairing_already_exists="active_pairing_already_exists",Ct_subscribe_pairing_topic_failure="subscribe_pairing_topic_failure",Ct_pairing_expired="pairing_expired",Ct_proposal_listener_not_found="proposal_listener_not_found",it_session_approve_started="session_approve_started",it_session_namespaces_validation_success="session_namespaces_validation_success",it_subscribing_session_topic="subscribing_session_topic",it_subscribe_session_topic_success="subscribe_session_topic_success",it_publishing_session_approve="publishing_session_approve",it_session_approve_publish_success="session_approve_publish_success",it_store_session="store_session",it_publishing_session_settle="publishing_session_settle",it_session_settle_publish_success="session_settle_publish_success",Wt_no_internet_connection="no_internet_connection",Wt_proposal_expired="proposal_expired",Wt_subscribe_session_topic_failure="subscribe_session_topic_failure",Wt_session_approve_publish_failure="session_approve_publish_failure",Wt_session_settle_publish_failure="session_settle_publish_failure",Wt_session_approve_namespace_validation_failure="session_approve_namespace_validation_failure",Wt_proposal_not_found="proposal_not_found",Qt_authenticated_session_approve_started="authenticated_session_approve_started",Qt_create_authenticated_session_topic="create_authenticated_session_topic",Qt_cacaos_verified="cacaos_verified",Qt_store_authenticated_session="store_authenticated_session",Qt_subscribing_authenticated_session_topic="subscribing_authenticated_session_topic",Qt_subscribe_authenticated_session_topic_success="subscribe_authenticated_session_topic_success",Qt_publishing_authenticated_session_approve="publishing_authenticated_session_approve",lr_no_internet_connection="no_internet_connection",lr_invalid_cacao="invalid_cacao",lr_subscribe_authenticated_session_topic_failure="subscribe_authenticated_session_topic_failure",lr_authenticated_session_approve_publish_failure="authenticated_session_approve_publish_failure",lr_authenticated_session_pending_request_not_found="authenticated_session_pending_request_not_found";var J_=function G_(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=s}var c=r.length,u=r.charAt(0),d=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function g(y){if("string"!=typeof y)throw new TypeError("Expected String");if(0===y.length)return new Uint8Array;var m=0;if(" "!==y[m]){for(var _=0,v=0;y[m]===u;)_++,m++;for(var w=(y.length-m)*d+1>>>0,E=new Uint8Array(w);y[m];){var D=t[y.charCodeAt(m)];if(255===D)return;for(var P=0,C=w-1;(0!==D||P<v)&&-1!==C;C--,P++)D+=c*E[C]>>>0,E[C]=D%256>>>0,D=D/256>>>0;if(0!==D)throw new Error("Non-zero carry");v=P,m++}if(" "!==y[m]){for(var x=w-v;x!==w&&0===E[x];)x++;for(var I=new Uint8Array(_+(w-x)),S=_;x!==w;)I[S++]=E[x++];return I}}}return{encode:function p(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===y.length)return"";for(var m=0,_=0,v=0,w=y.length;v!==w&&0===y[v];)v++,m++;for(var E=(w-v)*h+1>>>0,D=new Uint8Array(E);v!==w;){for(var P=y[v],C=0,x=E-1;(0!==P||C<_)&&-1!==x;x--,C++)P+=256*D[x]>>>0,D[x]=P%c>>>0,P=P/c>>>0;if(0!==P)throw new Error("Non-zero carry");_=C,v++}for(var I=E-_;I!==E&&0===D[I];)I++;for(var S=u.repeat(m);I<E;++I)S+=r.charAt(D[I]);return S},decodeUnsafe:g,decode:function b(y){var m=g(y);if(m)return m;throw new Error(`Non-${e} character`)}}},W_=J_;const ou=r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class X_{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class eb{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return au(this,e)}}class tb{constructor(e){this.decoders=e}or(e){return au(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const au=(r,e)=>new tb({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class nb{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new X_(e,t,i),this.decoder=new eb(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ei=({name:r,prefix:e,encode:t,decode:i})=>new nb(r,e,t,i),dr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=W_(t,e);return ei({prefix:r,name:e,encode:i,decode:o=>ou(s(o))})},Ie=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ei({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let o="",a=0,c=0;for(let u=0;u<r.length;++u)for(c=c<<8|r[u],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),i)for(;o.length*t&7;)o+="=";return o})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let o=r.length;for(;"="===r[o-1];)--o;const a=new Uint8Array(o*t/8|0);let c=0,u=0,d=0;for(let h=0;h<o;++h){const p=s[r[h]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);u=u<<t|p,c+=t,c>=8&&(c-=8,a[d++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a})(s,i,t,r)}),sb=ei({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)});var ob=Object.freeze({__proto__:null,identity:sb});const ab=Ie({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var cb=Object.freeze({__proto__:null,base2:ab});const ub=Ie({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lb=Object.freeze({__proto__:null,base8:ub});const db=dr({prefix:"9",name:"base10",alphabet:"0123456789"});var hb=Object.freeze({__proto__:null,base10:db});const pb=Ie({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fb=Ie({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var gb=Object.freeze({__proto__:null,base16:pb,base16upper:fb});const yb=Ie({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mb=Ie({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_b=Ie({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bb=Ie({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vb=Ie({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wb=Ie({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Db=Ie({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Eb=Ie({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),xb=Ie({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ib=Object.freeze({__proto__:null,base32:yb,base32upper:mb,base32pad:_b,base32padupper:bb,base32hex:vb,base32hexupper:wb,base32hexpad:Db,base32hexpadupper:Eb,base32z:xb});const Cb=dr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Pb=dr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Sb=Object.freeze({__proto__:null,base36:Cb,base36upper:Pb});const Ob=dr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ab=dr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Rb=Object.freeze({__proto__:null,base58btc:Ob,base58flickr:Ab});const Nb=Ie({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Tb=Ie({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Fb=Ie({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),jb=Ie({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var $b=Object.freeze({__proto__:null,base64:Nb,base64pad:Tb,base64url:Fb,base64urlpad:jb});const cu=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),Ub=cu.reduce((r,e,t)=>(r[t]=e,r),[]),Bb=cu.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const kb=ei({prefix:"\u{1f680}",name:"base256emoji",encode:function qb(r){return r.reduce((e,t)=>e+=Ub[t],"")},decode:function Mb(r){const e=[];for(const t of r){const i=Bb[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var Lb=Object.freeze({__proto__:null,base256emoji:kb}),zb=function lu(r,e,t){e=e||[];for(var i=t=t||0;r>=Hb;)e[t++]=255&r|uu,r/=128;for(;r&Vb;)e[t++]=255&r|uu,r>>>=7;return e[t]=0|r,lu.bytes=t-i+1,e},uu=128,Vb=-128,Hb=Math.pow(2,31);var Kb=function Hs(r,i){var a,t=0,s=0,o=i=i||0,c=r.length;do{if(o>=c)throw Hs.bytes=0,new RangeError("Could not decode varint");a=r[o++],t+=s<28?(a&du)<<s:(a&du)*Math.pow(2,s),s+=7}while(a>=Gb);return Hs.bytes=o-i,t},Gb=128,du=127;var Jb=Math.pow(2,7),Wb=Math.pow(2,14),Qb=Math.pow(2,21),Yb=Math.pow(2,28),Xb=Math.pow(2,35),ev=Math.pow(2,42),tv=Math.pow(2,49),nv=Math.pow(2,56),rv=Math.pow(2,63),sv={encode:zb,decode:Kb,encodingLength:function(r){return r<Jb?1:r<Wb?2:r<Qb?3:r<Yb?4:r<Xb?5:r<ev?6:r<tv?7:r<nv?8:r<rv?9:10}},hu=sv;const pu=(r,e,t=0)=>(hu.encode(r,e,t),e),fu=r=>hu.encodingLength(r),Ks=(r,e)=>{const t=e.byteLength,i=fu(r),s=i+fu(t),o=new Uint8Array(s+t);return pu(r,o,0),pu(t,o,i),o.set(e,s),new ov(r,t,e,o)};class ov{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const gu=({name:r,code:e,encode:t})=>new av(r,e,t);class av{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ks(this.code,t):t.then(i=>Ks(this.code,i))}throw Error("Unknown type, must be binary type")}}const yu=r=>function(){var e=(0,f.Z)(function*(t){return new Uint8Array(yield crypto.subtle.digest(r,t))});return function(t){return e.apply(this,arguments)}}(),cv=gu({name:"sha2-256",code:18,encode:yu("SHA-256")}),uv=gu({name:"sha2-512",code:19,encode:yu("SHA-512")});Object.freeze({__proto__:null,sha256:cv,sha512:uv});const _u=ou;Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:_u,digest:r=>Ks(0,_u(r))}});new TextEncoder,new TextDecoder;const bu={...ob,...cb,...lb,...hb,...gb,...Ib,...Sb,...Rb,...$b,...Lb};function vu(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const wu=vu("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),Gs=vu("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=function pv(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),fv={utf8:wu,"utf-8":wu,hex:bu.base16,latin1:Gs,ascii:Gs,binary:Gs,...bu};var yv=Object.defineProperty,ht=(r,e,t)=>((r,e,t)=>e in r?yv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class _v{constructor(e,t){var i=this;this.core=e,this.logger=t,ht(this,"keychain",new Map),ht(this,"name","keychain"),ht(this,"version","0.3"),ht(this,"initialized",!1),ht(this,"storagePrefix",lt),ht(this,"init",(0,f.Z)(function*(){if(!i.initialized){const s=yield i.getKeyChain();typeof s<"u"&&(i.keychain=s),i.initialized=!0}})),ht(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),ht(this,"set",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),i.keychain.set(o,a),yield i.persist()});return function(o,a){return s.apply(this,arguments)}}()),ht(this,"get",s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:a}=j("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(a)}return o}),ht(this,"del",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),i.keychain.delete(o),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.core=e,this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}setKeyChain(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,Yi(e))})()}getKeyChain(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?Xi(t):void 0})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setKeyChain(e.keychain)})()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bv=Object.defineProperty,Pe=(r,e,t)=>((r,e,t)=>e in r?bv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class wv{constructor(e,t,i){var s=this;this.core=e,this.logger=t,Pe(this,"name","crypto"),Pe(this,"keychain"),Pe(this,"randomSessionIdentifier",js()),Pe(this,"initialized",!1),Pe(this,"init",(0,f.Z)(function*(){s.initialized||(yield s.keychain.init(),s.initialized=!0)})),Pe(this,"hasKeys",o=>(this.isInitialized(),this.keychain.has(o))),Pe(this,"getClientId",(0,f.Z)(function*(){s.isInitialized();const o=yield s.getClientSeed(),a=Bt.Au(o);return Bt.bG(a.publicKey)})),Pe(this,"generateKeyPair",()=>{this.isInitialized();const o=function lg(){const r=Ts.utils.randomPrivateKey(),e=Ts.getPublicKey(r);return{privateKey:Me(r,Ne),publicKey:Me(e,Ne)}}();return this.setPrivateKey(o.publicKey,o.privateKey)}),Pe(this,"signJWT",function(){var o=(0,f.Z)(function*(a){s.isInitialized();const c=yield s.getClientSeed(),u=Bt.Au(c),d=s.randomSessionIdentifier,h=__;return yield Bt.vf(d,a,h,u)});return function(a){return o.apply(this,arguments)}}()),Pe(this,"generateSharedKey",(o,a,c)=>{this.isInitialized();const d=function dg(r,e){const t=Ts.getSharedSecret(Ge(r,Ne),Ge(e,Ne));return Me(gf(Jn,t,void 0,void 0,Fs),Ne)}(this.getPrivateKey(o),a);return this.setSymKey(d,c)}),Pe(this,"setSymKey",function(){var o=(0,f.Z)(function*(a,c){s.isInitialized();const u=c||Br(a);return yield s.keychain.set(u,a),u});return function(a,c){return o.apply(this,arguments)}}()),Pe(this,"deleteKeyPair",function(){var o=(0,f.Z)(function*(a){s.isInitialized(),yield s.keychain.del(a)});return function(a){return o.apply(this,arguments)}}()),Pe(this,"deleteSymKey",function(){var o=(0,f.Z)(function*(a){s.isInitialized(),yield s.keychain.del(a)});return function(a){return o.apply(this,arguments)}}()),Pe(this,"encode",function(){var o=(0,f.Z)(function*(a,c,u){s.isInitialized();const d=Dc(u),h=(0,Ms.u)(c);if(xc(d))return function fg(r,e){const t=_c(er),i=ln(tr),o=wc({type:t,sealed:Ge(r,Xn),iv:i});return e===jt?bc(o):o}(h,u?.encoding);if(Ec(d)){const y=d.senderPublicKey,m=d.receiverPublicKey;a=yield s.generateSharedKey(y,m)}const p=s.getSymKey(a),{type:g,senderPublicKey:b}=d;return function hg(r){const e=_c(typeof r.type<"u"?r.type:yc);if(Kt(e)===xt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?Ge(r.senderPublicKey,Ne):void 0,i=typeof r.iv<"u"?Ge(r.iv,Ne):ln(tr),s=Ge(r.symKey,Ne),a=wc({type:e,sealed:Ka(s,i).encrypt(Ge(r.message,Xn)),iv:i,senderPublicKey:t});return r.encoding===jt?bc(a):a}({type:g,symKey:p,message:h,senderPublicKey:b,encoding:u?.encoding})});return function(a,c,u){return o.apply(this,arguments)}}()),Pe(this,"decode",function(){var o=(0,f.Z)(function*(a,c,u){s.isInitialized();const d=function yg(r,e){const t=nr({encoded:r,encoding:e?.encoding});return Dc({type:Kt(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Me(t.senderPublicKey,Ne):void 0,receiverPublicKey:e?.receiverPublicKey})}(c,u);if(xc(d)){const h=function gg(r,e){const{sealed:t}=nr({encoded:r,encoding:e});return Me(t,Xn)}(c,u?.encoding);return(0,Ms.D)(h)}if(Ec(d)){const h=d.receiverPublicKey,p=d.senderPublicKey;a=yield s.generateSharedKey(h,p)}try{const p=function pg(r){const e=Ge(r.symKey,Ne),{sealed:t,iv:i}=nr({encoded:r.encoded,encoding:r.encoding}),s=Ka(e,i).decrypt(t);if(null===s)throw new Error("Failed to decrypt");return Me(s,Xn)}({symKey:s.getSymKey(a),encoded:c,encoding:u?.encoding});return(0,Ms.D)(p)}catch(h){s.logger.error(`Failed to decode message from topic: '${a}', clientId: '${yield s.getClientId()}'`),s.logger.error(h)}});return function(a,c,u){return o.apply(this,arguments)}}()),Pe(this,"getPayloadType",(o,a=tt)=>Kt(nr({encoded:o,encoding:a}).type)),Pe(this,"getPayloadSenderPublicKey",(o,a=tt)=>{const c=nr({encoded:o,encoding:a});return c.senderPublicKey?function p_(r,e="utf8"){const t=h_[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.encoder.encode(r).substring(1):globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8")}(c.senderPublicKey,Ne):void 0}),this.core=e,this.logger=(0,K.Ep)(t,this.name),this.keychain=i||new _v(this.core,this.logger)}get context(){return(0,K.Fd)(this.logger)}setPrivateKey(e,t){var i=this;return(0,f.Z)(function*(){return yield i.keychain.set(e,t),e})()}getPrivateKey(e){return this.keychain.get(e)}getClientSeed(){var e=this;return(0,f.Z)(function*(){let t="";try{t=e.keychain.get(eu)}catch{t=js(),yield e.keychain.set(eu,t)}return function gv(r,e="utf8"){const t=fv[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):globalThis.Buffer.from(r,"utf8")}(t,"base16")})()}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Dv=Object.defineProperty,Ev=Object.defineProperties,xv=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,Iv=Object.prototype.hasOwnProperty,Cv=Object.prototype.propertyIsEnumerable,Js=(r,e,t)=>e in r?Dv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ze=(r,e,t)=>Js(r,"symbol"!=typeof e?e+"":e,t);class Ov extends wy{constructor(e,t){var i;super(e,t),i=this,this.logger=e,this.core=t,Ze(this,"messages",new Map),Ze(this,"messagesWithoutClientAck",new Map),Ze(this,"name","messages"),Ze(this,"version","0.3"),Ze(this,"initialized",!1),Ze(this,"storagePrefix",lt),Ze(this,"init",(0,f.Z)(function*(){if(!i.initialized){i.logger.trace("Initialized");try{const s=yield i.getRelayerMessages();typeof s<"u"&&(i.messages=s);const o=yield i.getRelayerMessagesWithoutClientAck();typeof o<"u"&&(i.messagesWithoutClientAck=o),i.logger.debug(`Successfully Restored records for ${i.name}`),i.logger.trace({type:"method",method:"restore",size:i.messages.size})}catch(s){i.logger.debug(`Failed to Restore records for ${i.name}`),i.logger.error(s)}finally{i.initialized=!0}}})),Ze(this,"set",function(){var s=(0,f.Z)(function*(o,a,c){i.isInitialized();const u=ut(a);let d=i.messages.get(o);if(typeof d>"u"&&(d={}),typeof d[u]<"u")return u;if(d[u]=a,i.messages.set(o,d),c===Xr_inbound){const h=i.messagesWithoutClientAck.get(o)||{};i.messagesWithoutClientAck.set(o,((r,e)=>Ev(r,xv(e)))(((r,e)=>{for(var t in e||(e={}))Iv.call(e,t)&&Js(r,t,e[t]);if(Du)for(var t of Du(e))Cv.call(e,t)&&Js(r,t,e[t]);return r})({},h),{[u]:a}))}return yield i.persist(),u});return function(o,a,c){return s.apply(this,arguments)}}()),Ze(this,"get",s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o}),Ze(this,"getWithoutAck",s=>{this.isInitialized();const o={};for(const a of s){const c=this.messagesWithoutClientAck.get(a)||{};o[a]=Object.values(c)}return o}),Ze(this,"has",(s,o)=>{this.isInitialized();return typeof this.get(s)[ut(o)]<"u"}),Ze(this,"ack",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized();const c=i.messagesWithoutClientAck.get(o);if(typeof c>"u")return;delete c[ut(a)],0===Object.keys(c).length?i.messagesWithoutClientAck.delete(o):i.messagesWithoutClientAck.set(o,c),yield i.persist()});return function(o,a){return s.apply(this,arguments)}}()),Ze(this,"del",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),i.messages.delete(o),i.messagesWithoutClientAck.delete(o),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.logger=(0,K.Ep)(e,this.name),this.core=t}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}setRelayerMessages(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,Yi(e))})()}setRelayerMessagesWithoutClientAck(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKeyWithoutClientAck,Yi(e))})()}getRelayerMessages(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?Xi(t):void 0})()}getRelayerMessagesWithoutClientAck(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKeyWithoutClientAck);return typeof t<"u"?Xi(t):void 0})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setRelayerMessages(e.messages),yield e.setRelayerMessagesWithoutClientAck(e.messagesWithoutClientAck)})()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Av=Object.defineProperty,Rv=Object.defineProperties,Nv=Object.getOwnPropertyDescriptors,Eu=Object.getOwnPropertySymbols,Tv=Object.prototype.hasOwnProperty,Fv=Object.prototype.propertyIsEnumerable,Ws=(r,e,t)=>e in r?Av(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ti=(r,e)=>{for(var t in e||(e={}))Tv.call(e,t)&&Ws(r,t,e[t]);if(Eu)for(var t of Eu(e))Fv.call(e,t)&&Ws(r,t,e[t]);return r},Qs=(r,e)=>Rv(r,Nv(e)),st=(r,e,t)=>Ws(r,"symbol"!=typeof e?e+"":e,t);class jv extends Dy{constructor(e,t){var i;super(e,t),i=this,this.relayer=e,this.logger=t,st(this,"events",new gt.EventEmitter),st(this,"name","publisher"),st(this,"queue",new Map),st(this,"publishTimeout",(0,$.toMiliseconds)($.ONE_MINUTE)),st(this,"initialPublishTimeout",(0,$.toMiliseconds)(15*$.ONE_SECOND)),st(this,"needsTransportRestart",!1),st(this,"publish",function(){var s=(0,f.Z)(function*(o,a,c){var u;i.logger.debug("Publishing Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:c}});const d=c?.ttl||tu,h=qr(c),p=c?.prompt||!1,g=c?.tag||0,b=c?.id||(0,z.getBigIntRpcId)().toString(),y={topic:o,message:a,opts:{ttl:d,relay:h,prompt:p,tag:g,id:b,attestation:c?.attestation,tvf:c?.tvf}},m=`Failed to publish payload, please try again. id:${b} tag:${g}`;try{const _=new Promise(function(){var v=(0,f.Z)(function*(w){const E=({id:P})=>{y.opts.id===P&&(i.removeRequestFromQueue(P),i.relayer.events.removeListener(ge_publish,E),w(y))};i.relayer.events.on(ge_publish,E);const D=At(new Promise((P,C)=>{i.rpcPublish({topic:o,message:a,ttl:d,prompt:p,tag:g,id:b,attestation:c?.attestation,tvf:c?.tvf}).then(P).catch(x=>{i.logger.warn(x,x?.message),C(x)})}),i.initialPublishTimeout,`Failed initial publish, retrying.... id:${b} tag:${g}`);try{yield D,i.events.removeListener(ge_publish,E)}catch(P){i.queue.set(b,Qs(ti({},y),{attempt:1})),i.logger.warn(P,P?.message)}});return function(w){return v.apply(this,arguments)}}());i.logger.trace({type:"method",method:"publish",params:{id:b,topic:o,message:a,opts:c}}),yield At(_,i.publishTimeout,m)}catch(_){if(i.logger.debug("Failed to Publish Payload"),i.logger.error(_),null!=(u=c?.internal)&&u.throwOnFailedPublish)throw _}finally{i.queue.delete(b)}});return function(o,a,c){return s.apply(this,arguments)}}()),st(this,"on",(s,o)=>{this.events.on(s,o)}),st(this,"once",(s,o)=>{this.events.once(s,o)}),st(this,"off",(s,o)=>{this.events.off(s,o)}),st(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.relayer=e,this.logger=(0,K.Ep)(t,this.name),this.registerEventListeners()}get context(){return(0,K.Fd)(this.logger)}rpcPublish(e){var t=this;return(0,f.Z)(function*(){var i,s,o,a;const{topic:c,message:u,ttl:d=tu,prompt:h,tag:p,id:g,attestation:b,tvf:y}=e,m={method:rr(qr().protocol).publish,params:ti({topic:c,message:u,ttl:d,prompt:h,tag:p,attestation:b},y),id:g};Ee(null==(i=m.params)?void 0:i.prompt)&&(null==(s=m.params)||delete s.prompt),Ee(null==(o=m.params)?void 0:o.tag)&&(null==(a=m.params)||delete a.tag),t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"message",direction:"outgoing",request:m});const _=yield t.relayer.request(m);return t.relayer.events.emit(ge_publish,e),t.logger.debug("Successfully Published Payload"),_})()}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){var e=this;this.queue.forEach(function(){var t=(0,f.Z)(function*(i,s){const o=i.attempt+1;e.queue.set(s,Qs(ti({},i),{attempt:o}));const{topic:a,message:c,opts:u,attestation:d}=i;e.logger.warn({},`Publisher: queue->publishing: ${i.opts.id}, tag: ${i.opts.tag}, attempt: ${o}`),yield e.rpcPublish(Qs(ti({},i),{topic:a,message:c,ttl:u.ttl,prompt:u.prompt,tag:u.tag,id:u.id,attestation:d,tvf:u.tvf})),e.logger.warn({},`Publisher: queue->published: ${i.opts.id}`)});return function(i,s){return t.apply(this,arguments)}}())}registerEventListeners(){this.relayer.core.heartbeat.on(Gt.Lx.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(ge_connection_stalled);this.checkQueue()}),this.relayer.on(ge_message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var $v=Object.defineProperty,xn=(r,e,t)=>((r,e,t)=>e in r?$v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Bv{constructor(){xn(this,"map",new Map),xn(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),xn(this,"get",e=>this.map.get(e)||[]),xn(this,"exists",(e,t)=>this.get(e).includes(t)),xn(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(o=>o!==t);s.length?this.map.set(e,s):this.map.delete(e)}),xn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var qv=Object.defineProperty,Mv=Object.defineProperties,kv=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,Lv=Object.prototype.hasOwnProperty,zv=Object.prototype.propertyIsEnumerable,Ys=(r,e,t)=>e in r?qv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hr=(r,e)=>{for(var t in e||(e={}))Lv.call(e,t)&&Ys(r,t,e[t]);if(xu)for(var t of xu(e))zv.call(e,t)&&Ys(r,t,e[t]);return r},Xs=(r,e)=>Mv(r,kv(e)),ne=(r,e,t)=>Ys(r,"symbol"!=typeof e?e+"":e,t);class Zv extends Sy{constructor(e,t){var i;super(e,t),i=this,this.relayer=e,this.logger=t,ne(this,"subscriptions",new Map),ne(this,"topicMap",new Bv),ne(this,"events",new gt.EventEmitter),ne(this,"name","subscription"),ne(this,"version","0.3"),ne(this,"pending",new Map),ne(this,"cached",[]),ne(this,"initialized",!1),ne(this,"storagePrefix",lt),ne(this,"subscribeTimeout",(0,$.toMiliseconds)($.ONE_MINUTE)),ne(this,"initialSubscribeTimeout",(0,$.toMiliseconds)(15*$.ONE_SECOND)),ne(this,"clientId"),ne(this,"batchSubscribeTopicsLimit",500),ne(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),i.registerEventListeners(),yield i.restore()),i.initialized=!0})),ne(this,"subscribe",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),i.logger.debug("Subscribing Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const c=qr(a),u={topic:o,relay:c,transportType:a?.transportType};i.pending.set(o,u);const d=yield i.rpcSubscribe(o,c,a);return"string"==typeof d&&(i.onSubscribe(d,u),i.logger.debug("Successfully Subscribed Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),d}catch(c){throw i.logger.debug("Failed to Subscribe Topic"),i.logger.error(c),c}});return function(o,a){return s.apply(this,arguments)}}()),ne(this,"unsubscribe",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),typeof a?.id<"u"?yield i.unsubscribeById(o,a.id,a):yield i.unsubscribeByTopic(o,a)});return function(o,a){return s.apply(this,arguments)}}()),ne(this,"isSubscribed",s=>new Promise(o=>{o(this.topicMap.topics.includes(s))})),ne(this,"isKnownTopic",s=>new Promise(o=>{o(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(a=>a.topic===s))})),ne(this,"on",(s,o)=>{this.events.on(s,o)}),ne(this,"once",(s,o)=>{this.events.once(s,o)}),ne(this,"off",(s,o)=>{this.events.off(s,o)}),ne(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),ne(this,"start",(0,f.Z)(function*(){yield i.onConnect()})),ne(this,"stop",(0,f.Z)(function*(){yield i.onDisconnect()})),ne(this,"restart",(0,f.Z)(function*(){yield i.restore(),yield i.onRestart()})),ne(this,"checkPending",(0,f.Z)(function*(){if(!(0!==i.pending.size||i.initialized&&i.relayer.connected))return;const s=[];i.pending.forEach(o=>{s.push(o)}),yield i.batchSubscribe(s)})),ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Gt.Lx.pulse,(0,f.Z)(function*(){yield i.checkPending()})),this.events.on(ze_created,function(){var s=(0,f.Z)(function*(o){const a=ze_created;i.logger.info(`Emitting ${a}`),i.logger.debug({type:"event",event:a,data:o}),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.events.on(ze_deleted,function(){var s=(0,f.Z)(function*(o){const a=ze_deleted;i.logger.info(`Emitting ${a}`),i.logger.debug({type:"event",event:a,data:o}),yield i.persist()});return function(o){return s.apply(this,arguments)}}())}),this.relayer=e,this.logger=(0,K.Ep)(t,this.name),this.clientId=""}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}unsubscribeByTopic(e,t){var i=this;return(0,f.Z)(function*(){const s=i.topicMap.get(e);yield Promise.all(s.map(function(){var o=(0,f.Z)(function*(a){return yield i.unsubscribeById(e,a,t)});return function(a){return o.apply(this,arguments)}}()))})()}unsubscribeById(e,t,i){var s=this;return(0,f.Z)(function*(){s.logger.debug("Unsubscribing Topic"),s.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const o=qr(i);yield s.restartToComplete({topic:e,id:t,relay:o}),yield s.rpcUnsubscribe(e,t,o);const a=te("USER_DISCONNECTED",`${s.name}, ${e}`);yield s.onUnsubscribe(e,t,a),s.logger.debug("Successfully Unsubscribed Topic"),s.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(o){throw s.logger.debug("Failed to Unsubscribe Topic"),s.logger.error(o),o}})()}rpcSubscribe(e,t,i){var s=this;return(0,f.Z)(function*(){var o;(!i||i?.transportType===oe.relay)&&(yield s.restartToComplete({topic:e,id:e,relay:t}));const a={method:rr(t.protocol).subscribe,params:{topic:e}};s.logger.debug("Outgoing Relay Payload"),s.logger.trace({type:"payload",direction:"outgoing",request:a});const c=null==(o=i?.internal)?void 0:o.throwOnFailedPublish;try{const u=yield s.getSubscriptionId(e);if(i?.transportType===oe.link_mode)return setTimeout(()=>{(s.relayer.connected||s.relayer.connecting)&&s.relayer.request(a).catch(p=>s.logger.warn(p))},(0,$.toMiliseconds)($.ONE_SECOND)),u;const d=new Promise(function(){var p=(0,f.Z)(function*(g){const b=y=>{y.topic===e&&(s.events.removeListener(ze_created,b),g(y.id))};s.events.on(ze_created,b);try{const y=yield At(new Promise((m,_)=>{s.relayer.request(a).catch(v=>{s.logger.warn(v,v?.message),_(v)}).then(m)}),s.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);s.events.removeListener(ze_created,b),g(y)}catch{}});return function(g){return p.apply(this,arguments)}}()),h=yield At(d,s.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return h?u:null}catch(u){if(s.logger.debug("Outgoing Relay Subscribe Payload stalled"),s.relayer.events.emit(ge_connection_stalled),c)throw u}return null})()}rpcBatchSubscribe(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;const s={method:rr(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(o=>o.topic)}};t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:s});try{yield yield At(new Promise(o=>{t.relayer.request(s).catch(a=>t.logger.warn(a)).then(o)}),t.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{t.relayer.events.emit(ge_connection_stalled)}})()}rpcBatchFetchMessages(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;const s={method:rr(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(a=>a.topic)}};let o;t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:s});try{o=yield yield At(new Promise((a,c)=>{t.relayer.request(s).catch(u=>{t.logger.warn(u),c(u)}).then(a)}),t.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{t.relayer.events.emit(ge_connection_stalled)}return o})()}rpcUnsubscribe(e,t,i){const s={method:rr(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Xs(hr({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,hr({},t)),this.pending.delete(t.topic)})}onUnsubscribe(e,t,i){var s=this;return(0,f.Z)(function*(){s.events.removeAllListeners(t),s.hasSubscription(t,e)&&s.deleteSubscription(t,i),yield s.relayer.messages.del(e)})()}setRelayerSubscriptions(e){var t=this;return(0,f.Z)(function*(){yield t.relayer.core.storage.setItem(t.storageKey,e)})()}getRelayerSubscriptions(){var e=this;return(0,f.Z)(function*(){return yield e.relayer.core.storage.getItem(e.storageKey)})()}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,hr({},t)),this.topicMap.set(t.topic,e),this.events.emit(ze_created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(ze_deleted,Xs(hr({},i),{reason:t}))}persist(){var e=this;return(0,f.Z)(function*(){yield e.setRelayerSubscriptions(e.values),e.events.emit(ze_sync)})()}onRestart(){var e=this;return(0,f.Z)(function*(){if(e.cached.length){const t=[...e.cached],i=Math.ceil(e.cached.length/e.batchSubscribeTopicsLimit);for(let s=0;s<i;s++){const o=t.splice(0,e.batchSubscribeTopicsLimit);yield e.batchSubscribe(o)}}e.events.emit(ze_resubscribed)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(e.subscriptions.size){const{message:i}=j("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),e.logger.error(`${e.name}: ${JSON.stringify(e.values)}`),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored subscriptions for ${e.name}`),e.logger.trace({type:"method",method:"restore",subscriptions:e.values})}catch(t){e.logger.debug(`Failed to Restore subscriptions for ${e.name}`),e.logger.error(t)}})()}batchSubscribe(e){var t=this;return(0,f.Z)(function*(){e.length&&(yield t.rpcBatchSubscribe(e),t.onBatchSubscribe(yield Promise.all(e.map(function(){var i=(0,f.Z)(function*(s){return Xs(hr({},s),{id:yield t.getSubscriptionId(s.topic)})});return function(s){return i.apply(this,arguments)}}()))))})()}batchFetchMessages(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;t.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const i=yield t.rpcBatchFetchMessages(e);i&&i.messages&&(yield function Yh(r){return new Promise(e=>setTimeout(e,r))}((0,$.toMiliseconds)($.ONE_SECOND)),yield t.relayer.handleBatchMessageEvents(i.messages))})()}onConnect(){var e=this;return(0,f.Z)(function*(){yield e.restart(),e.reset()})()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}restartToComplete(e){var t=this;return(0,f.Z)(function*(){!t.relayer.connected&&!t.relayer.connecting&&(t.cached.push(e),yield t.relayer.transportOpen())})()}getClientId(){var e=this;return(0,f.Z)(function*(){return e.clientId||(e.clientId=yield e.relayer.core.crypto.getClientId()),e.clientId})()}getSubscriptionId(e){var t=this;return(0,f.Z)(function*(){return ut(e+(yield t.getClientId()))})()}}var Vv=Object.defineProperty,Iu=Object.getOwnPropertySymbols,Hv=Object.prototype.hasOwnProperty,Kv=Object.prototype.propertyIsEnumerable,eo=(r,e,t)=>e in r?Vv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cu=(r,e)=>{for(var t in e||(e={}))Hv.call(e,t)&&eo(r,t,e[t]);if(Iu)for(var t of Iu(e))Kv.call(e,t)&&eo(r,t,e[t]);return r},Q=(r,e,t)=>eo(r,"symbol"!=typeof e?e+"":e,t);class Gv extends Ey{constructor(e){var t;super(e),t=this,Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new gt.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name","relayer"),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",(0,$.toMiliseconds)($.THIRTY_SECONDS+$.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",(0,$.toMiliseconds)(15*$.ONE_SECOND)),Q(this,"request",function(){var i=(0,f.Z)(function*(s){var o,a;t.logger.debug("Publishing Request Payload");const c=s.id||(0,z.getBigIntRpcId)().toString();yield t.toEstablishConnection();try{t.logger.trace({id:c,method:s.method,topic:null==(o=s.params)?void 0:o.topic},"relayer.request - publishing...");const u=`${c}:${(null==(a=s.params)?void 0:a.tag)||""}`;t.requestsInFlight.push(u);const d=yield t.provider.request(s);return t.requestsInFlight=t.requestsInFlight.filter(h=>h!==u),d}catch(u){throw t.logger.debug(`Failed to Publish Request: ${c}`),u}});return function(s){return i.apply(this,arguments)}}()),Q(this,"resetPingTimeout",()=>{Sr()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,s,o,a;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(a=null==(o=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)?void 0:o.terminate)||a.call(o)}catch(c){this.logger.warn(c,c?.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1f6dc}"),this.startPingTimeout(),this.events.emit(ge_connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1f6d1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(ge_error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(We_payload,this.onPayloadHandler),this.provider.on(We_connect,this.onConnectHandler),this.provider.on(We_disconnect,this.onDisconnectHandler),this.provider.on(We_error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,K.Ep)(e.logger,this.name):(0,K.gw)((0,K.jI)({level:e.logger||"error"})),this.messages=new Ov(this.logger,e.core),this.subscriber=new Zv(this,this.logger),this.publisher=new jv(this,this.logger),this.relayUrl=e?.relayUrl||ru,this.projectId=e.projectId,function Th(){return Ot()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"android"===(null==global?void 0:global.Platform.OS)}()?this.packageName=aa():function Fh(){return Ot()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"ios"===(null==global?void 0:global.Platform.OS)}()&&(this.bundleId=aa()),this.provider={}}init(){var e=this;return(0,f.Z)(function*(){if(e.logger.trace("Initialized"),e.registerEventListeners(),yield Promise.all([e.messages.init(),e.subscriber.init()]),e.initialized=!0,e.subscriber.hasAnyTopics)try{yield e.transportOpen()}catch(t){e.logger.warn(t,t?.message)}})()}get context(){return(0,K.Fd)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}publish(e,t,i){var s=this;return(0,f.Z)(function*(){s.isInitialized(),yield s.publisher.publish(e,t,i),yield s.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:oe.relay},Xr_outbound)})()}subscribe(e,t){var i=this;return(0,f.Z)(function*(){var s,o,a;i.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&(yield i.toEstablishConnection());const c=typeof(null==(s=t?.internal)?void 0:s.throwOnFailedPublish)>"u"||(null==(o=t?.internal)?void 0:o.throwOnFailedPublish);let d,u=(null==(a=i.subscriber.topicMap.get(e))?void 0:a[0])||"";const h=p=>{p.topic===e&&(i.subscriber.off(ze_created,h),d())};return yield Promise.all([new Promise(p=>{d=p,i.subscriber.on(ze_created,h)}),new Promise(function(){var p=(0,f.Z)(function*(g,b){u=(yield i.subscriber.subscribe(e,Cu({internal:{throwOnFailedPublish:c}},t)).catch(y=>{c&&b(y)}))||u,g()});return function(g,b){return p.apply(this,arguments)}}())]),u})()}unsubscribe(e,t){var i=this;return(0,f.Z)(function*(){i.isInitialized(),yield i.subscriber.unsubscribe(e,t)})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}transportDisconnect(){var e=this;return(0,f.Z)(function*(){e.provider.disconnect&&(e.hasExperiencedNetworkDisruption||e.connected)?yield At(e.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>e.onProviderDisconnect()):e.onProviderDisconnect()})()}transportClose(){var e=this;return(0,f.Z)(function*(){e.transportExplicitlyClosed=!0,yield e.transportDisconnect()})()}transportOpen(e){var t=this;return(0,f.Z)(function*(){if(t.subscriber.hasAnyTopics){if(t.connectPromise?(t.logger.debug({},"Waiting for existing connection attempt to resolve..."),yield t.connectPromise,t.logger.debug({},"Existing connection attempt resolved")):(t.connectPromise=new Promise(function(){var i=(0,f.Z)(function*(s,o){yield t.connect(e).then(s).catch(o).finally(()=>{t.connectPromise=void 0})});return function(s,o){return i.apply(this,arguments)}}()),yield t.connectPromise),!t.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${t.relayUrl}`)}else t.logger.warn("Starting WS connection skipped because the client has no topics to work with.")})()}restartTransport(e){var t=this;return(0,f.Z)(function*(){t.logger.debug({},"Restarting transport..."),!t.connectionAttemptInProgress&&(t.relayUrl=e||t.relayUrl,yield t.confirmOnlineStateOrThrow(),yield t.transportClose(),yield t.transportOpen())})()}confirmOnlineStateOrThrow(){return(0,f.Z)(function*(){if(!(yield jc()))throw new Error("No internet connection detected. Please restart your network and try again.")})()}handleBatchMessageEvents(e){var t=this;return(0,f.Z)(function*(){if(0===e?.length)return void t.logger.trace("Batch message events is empty. Ignoring...");const i=e.sort((s,o)=>s.publishedAt-o.publishedAt);t.logger.debug(`Batch of ${i.length} message events sorted`);for(const s of i)try{yield t.onMessageEvent(s)}catch(o){t.logger.warn(o,"Error while processing batch message event: "+o?.message)}t.logger.trace(`Batch of ${i.length} message events processed`)})()}onLinkMessageEvent(e,t){var i=this;return(0,f.Z)(function*(){const{topic:s}=e;if(!t.sessionExists){const a={topic:s,expiry:de($.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};yield i.core.pairing.pairings.set(s,a)}i.events.emit(ge_message,e),yield i.recordMessageEvent(e,Xr_inbound)})()}connect(e){var t=this;return(0,f.Z)(function*(){yield t.confirmOnlineStateOrThrow(),e&&e!==t.relayUrl&&(t.relayUrl=e,yield t.transportDisconnect()),t.connectionAttemptInProgress=!0,t.transportExplicitlyClosed=!1;let i=1;for(;i<6;){try{if(t.transportExplicitlyClosed)break;t.logger.debug({},`Connecting to ${t.relayUrl}, attempt: ${i}...`),yield t.createProvider(),yield new Promise(function(){var s=(0,f.Z)(function*(o,a){const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};t.provider.once(We_disconnect,c),yield At(new Promise((u,d)=>{t.provider.connect().then(u).catch(d)}),t.connectTimeout,`Socket stalled when trying to connect to ${t.relayUrl}`).catch(u=>{a(u)}).finally(()=>{t.provider.off(We_disconnect,c),clearTimeout(t.reconnectTimeout)}),yield new Promise(function(){var u=(0,f.Z)(function*(d,h){const p=()=>{h(new Error("Connection interrupted while trying to subscribe"))};t.provider.once(We_disconnect,p),yield t.subscriber.start().then(d).catch(h).finally(()=>{t.provider.off(We_disconnect,p)})});return function(d,h){return u.apply(this,arguments)}}()),t.hasExperiencedNetworkDisruption=!1,o()});return function(o,a){return s.apply(this,arguments)}}())}catch(s){yield t.subscriber.stop();const o=s;t.logger.warn({},o.message),t.hasExperiencedNetworkDisruption=!0}finally{t.connectionAttemptInProgress=!1}if(t.connected){t.logger.debug({},`Connected to ${t.relayUrl} successfully on attempt: ${i}`);break}yield new Promise(s=>setTimeout(s,(0,$.toMiliseconds)(1*i))),i++}})()}startPingTimeout(){var e,t,i,s,o;if(Sr())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(o=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||o.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}createProvider(){var e=this;return(0,f.Z)(function*(){e.provider.connection&&e.unregisterProviderListeners();const t=yield e.core.crypto.signJWT(e.relayUrl);e.provider=new Je.r(new f_.Z(qh({sdkVersion:Vs,protocol:e.protocol,version:e.version,relayUrl:e.relayUrl,projectId:e.projectId,auth:t,useOnCloseEvent:!0,bundleId:e.bundleId,packageName:e.packageName}))),e.registerProviderListeners()})()}recordMessageEvent(e,t){var i=this;return(0,f.Z)(function*(){const{topic:s,message:o}=e;yield i.messages.set(s,o,t)})()}shouldIgnoreMessageEvent(e){var t=this;return(0,f.Z)(function*(){const{topic:i,message:s}=e;if(!s||0===s.length)return t.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!(yield t.subscriber.isKnownTopic(i)))return t.logger.warn(`Ignoring message for unknown topic ${i}`),!0;const o=t.messages.has(i,s);return o&&t.logger.warn(`Ignoring duplicate message: ${s}`),o})()}onProviderPayload(e){var t=this;return(0,f.Z)(function*(){if(t.logger.debug("Incoming Relay Payload"),t.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,z.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;const i=e.params,{topic:s,message:o,publishedAt:a,attestation:c}=i.data,u={topic:s,message:o,publishedAt:a,transportType:oe.relay,attestation:c};t.logger.debug("Emitting Relayer Payload"),t.logger.trace(Cu({type:"event",event:i.id},u)),t.events.emit(i.id,u),yield t.acknowledgePayload(e),yield t.onMessageEvent(u)}else(0,z.isJsonRpcResponse)(e)&&t.events.emit(ge_message_ack,e)})()}onMessageEvent(e){var t=this;return(0,f.Z)(function*(){(yield t.shouldIgnoreMessageEvent(e))||(yield t.recordMessageEvent(e,Xr_inbound),t.events.emit(ge_message,e))})()}acknowledgePayload(e){var t=this;return(0,f.Z)(function*(){const i=(0,z.formatJsonRpcResult)(e.id,!0);yield t.provider.connection.send(i)})()}unregisterProviderListeners(){this.provider.off(We_payload,this.onPayloadHandler),this.provider.off(We_connect,this.onConnectHandler),this.provider.off(We_disconnect,this.onDisconnectHandler),this.provider.off(We_error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}registerEventListeners(){var e=this;return(0,f.Z)(function*(){let t=yield jc();uy(function(){var i=(0,f.Z)(function*(s){t!==s&&(t=s,s?yield e.transportOpen().catch(o=>e.logger.error(o,o?.message)):(e.hasExperiencedNetworkDisruption=!0,yield e.transportDisconnect(),e.transportExplicitlyClosed=!1))});return function(s){return i.apply(this,arguments)}}()),e.core.heartbeat.on(Gt.Lx.pulse,(0,f.Z)(function*(){if(!e.transportExplicitlyClosed&&!e.connected&&function hy(){var r;return!sn()||!(0,yt.getDocument)()||"visible"===(null==(r=(0,yt.getDocument)())?void 0:r.visibilityState)}())try{yield e.confirmOnlineStateOrThrow(),yield e.transportOpen()}catch(i){e.logger.warn(i,i?.message)}}))})()}onProviderDisconnect(){var e=this;return(0,f.Z)(function*(){clearTimeout(e.pingTimeout),e.events.emit(ge_disconnect),e.connectionAttemptInProgress=!1,!e.reconnectInProgress&&(e.reconnectInProgress=!0,yield e.subscriber.stop(),e.subscriber.hasAnyTopics&&(e.transportExplicitlyClosed||(e.reconnectTimeout=setTimeout((0,f.Z)(function*(){yield e.transportOpen().catch(t=>e.logger.error(t,t?.message)),e.reconnectTimeout=void 0,e.reconnectInProgress=!1}),(0,$.toMiliseconds)(.1)))))})()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}toEstablishConnection(){var e=this;return(0,f.Z)(function*(){if(yield e.confirmOnlineStateOrThrow(),!e.connected){if(e.connectPromise)return void(yield e.connectPromise);yield e.connect()}})()}}function Jv(){}function Pu(r){if(!r||"object"!=typeof r)return!1;const e=Object.getPrototypeOf(r);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(r)}function Su(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Ou(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const Wv="[object RegExp]",Qv="[object String]",Yv="[object Number]",Xv="[object Boolean]",Au="[object Arguments]",e0="[object Symbol]",t0="[object Date]",n0="[object Map]",r0="[object Set]",i0="[object Array]",s0="[object Function]",o0="[object ArrayBuffer]",to="[object Object]",a0="[object Error]",c0="[object DataView]",u0="[object Uint8Array]",l0="[object Uint8ClampedArray]",d0="[object Uint16Array]",h0="[object Uint32Array]",p0="[object BigUint64Array]",f0="[object Int8Array]",g0="[object Int16Array]",y0="[object Int32Array]",m0="[object BigInt64Array]",_0="[object Float32Array]",b0="[object Float64Array]";function pr(r,e,t,i,s,o,a){const c=a(r,e,t,i,s,o);if(void 0!==c)return c;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return r===e;case"number":return r===e||Object.is(r,e);case"object":return fr(r,e,o,a)}return fr(r,e,o,a)}function fr(r,e,t,i){if(Object.is(r,e))return!0;let s=Ou(r),o=Ou(e);if(s===Au&&(s=to),o===Au&&(o=to),s!==o)return!1;switch(s){case Qv:return r.toString()===e.toString();case Yv:return function v0(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}(r.valueOf(),e.valueOf());case Xv:case t0:case e0:return Object.is(r.valueOf(),e.valueOf());case Wv:return r.source===e.source&&r.flags===e.flags;case s0:return r===e}const a=(t=t??new Map).get(r),c=t.get(e);if(null!=a&&null!=c)return a===e;t.set(r,e),t.set(e,r);try{switch(s){case n0:if(r.size!==e.size)return!1;for(const[u,d]of r.entries())if(!e.has(u)||!pr(d,e.get(u),u,r,e,t,i))return!1;return!0;case r0:{if(r.size!==e.size)return!1;const u=Array.from(r.values()),d=Array.from(e.values());for(let h=0;h<u.length;h++){const p=u[h],g=d.findIndex(b=>pr(p,b,void 0,r,e,t,i));if(-1===g)return!1;d.splice(g,1)}return!0}case i0:case u0:case l0:case d0:case h0:case p0:case f0:case g0:case y0:case m0:case _0:case b0:if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let u=0;u<r.length;u++)if(!pr(r[u],e[u],u,r,e,t,i))return!1;return!0;case o0:return r.byteLength===e.byteLength&&fr(new Uint8Array(r),new Uint8Array(e),t,i);case c0:return r.byteLength===e.byteLength&&r.byteOffset===e.byteOffset&&fr(new Uint8Array(r),new Uint8Array(e),t,i);case a0:return r.name===e.name&&r.message===e.message;case to:{if(!(fr(r.constructor,e.constructor,t,i)||Pu(r)&&Pu(e)))return!1;const u=[...Object.keys(r),...Su(r)],d=[...Object.keys(e),...Su(e)];if(u.length!==d.length)return!1;for(let h=0;h<u.length;h++){const p=u[h],g=r[p];if(!Object.hasOwn(e,p))return!1;if(!pr(g,e[p],p,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function D0(r,e){return function w0(r,e,t){return pr(r,e,void 0,void 0,void 0,void 0,t)}(r,e,Jv)}var E0=Object.defineProperty,Ru=Object.getOwnPropertySymbols,x0=Object.prototype.hasOwnProperty,I0=Object.prototype.propertyIsEnumerable,no=(r,e,t)=>e in r?E0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nu=(r,e)=>{for(var t in e||(e={}))x0.call(e,t)&&no(r,t,e[t]);if(Ru)for(var t of Ru(e))I0.call(e,t)&&no(r,t,e[t]);return r},qe=(r,e,t)=>no(r,"symbol"!=typeof e?e+"":e,t);class Yt extends xy{constructor(e,t,i,s=lt,o=void 0){var a;super(e,t,i,s),a=this,this.core=e,this.logger=t,this.name=i,qe(this,"map",new Map),qe(this,"version","0.3"),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"getKey"),qe(this,"storagePrefix",lt),qe(this,"recentlyDeleted",[]),qe(this,"recentlyDeletedLimit",200),qe(this,"init",(0,f.Z)(function*(){a.initialized||(a.logger.trace("Initialized"),yield a.restore(),a.cached.forEach(c=>{a.getKey&&null!==c&&!Ee(c)?a.map.set(a.getKey(c),c):function Mg(r){var e;return null==(e=r?.proposer)?void 0:e.publicKey}(c)?a.map.set(c.id,c):function kg(r){return r?.topic}(c)&&a.map.set(c.topic,c)}),a.cached=[],a.initialized=!0)})),qe(this,"set",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.map.has(u)?yield a.update(u,d):(a.logger.debug("Setting value"),a.logger.trace({type:"method",method:"set",key:u,value:d}),a.map.set(u,d),yield a.persist())});return function(u,d){return c.apply(this,arguments)}}()),qe(this,"get",c=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:c}),this.getData(c))),qe(this,"getAll",c=>(this.isInitialized(),c?this.values.filter(u=>Object.keys(c).every(d=>D0(u[d],c[d]))):this.values)),qe(this,"update",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.logger.debug("Updating value"),a.logger.trace({type:"method",method:"update",key:u,update:d});const h=Nu(Nu({},a.getData(u)),d);a.map.set(u,h),yield a.persist()});return function(u,d){return c.apply(this,arguments)}}()),qe(this,"delete",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.map.has(u)&&(a.logger.debug("Deleting value"),a.logger.trace({type:"method",method:"delete",key:u,reason:d}),a.map.delete(u),a.addToRecentlyDeleted(u),yield a.persist())});return function(u,d){return c.apply(this,arguments)}}()),this.logger=(0,K.Ep)(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}setDataStore(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getDataStore(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}persist(){var e=this;return(0,f.Z)(function*(){yield e.setDataStore(e.values)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getDataStore();if(typeof t>"u"||!t.length)return;if(e.map.size){const{message:i}=j("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored value for ${e.name}`),e.logger.trace({type:"method",method:"restore",value:e.values})}catch(t){e.logger.debug(`Failed to Restore value for ${e.name}`),e.logger.error(t)}})()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var C0=Object.defineProperty,G=(r,e,t)=>((r,e,t)=>e in r?C0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class S0{constructor(e,t){var i=this;this.core=e,this.logger=t,G(this,"name","pairing"),G(this,"version","0.3"),G(this,"events",new(ki())),G(this,"pairings"),G(this,"initialized",!1),G(this,"storagePrefix",lt),G(this,"ignoredPayloadTypes",[xt]),G(this,"registeredMethods",[]),G(this,"init",(0,f.Z)(function*(){i.initialized||(yield i.pairings.init(),yield i.cleanup(),i.registerRelayerEvents(),i.registerExpirerEvents(),i.initialized=!0,i.logger.trace("Initialized"))})),G(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),G(this,"create",function(){var s=(0,f.Z)(function*(o){i.isInitialized();const a=js(),c=yield i.core.crypto.setSymKey(a),u=de($.FIVE_MINUTES),d={protocol:"irn"},h={topic:c,expiry:u,relay:d,active:!1,methods:o?.methods},p=Cc({protocol:i.core.protocol,version:i.core.version,topic:c,symKey:a,relay:d,expiryTimestamp:u,methods:o?.methods});return i.events.emit(Jt_create,h),i.core.expirer.set(c,u),yield i.pairings.set(c,h),yield i.core.relayer.subscribe(c,{transportType:o?.transportType}),{topic:c,uri:p}});return function(o){return s.apply(this,arguments)}}()),G(this,"pair",function(){var s=(0,f.Z)(function*(o){i.isInitialized();const a=i.core.eventClient.createEvent({properties:{topic:o?.uri,trace:[dt_pairing_started]}});i.isValidPair(o,a);const{topic:c,symKey:u,relay:d,expiryTimestamp:h,methods:p}=Ic(o.uri);let g;if(a.props.properties.topic=c,a.addTrace(dt_pairing_uri_validation_success),a.addTrace(dt_pairing_uri_not_expired),i.pairings.keys.includes(c)){if(g=i.pairings.get(c),a.addTrace(dt_existing_pairing),g.active)throw a.setError(Ct_active_pairing_already_exists),new Error(`Pairing already exists: ${c}. Please try again with a new connection URI.`);a.addTrace(dt_pairing_not_expired)}const b=h||de($.FIVE_MINUTES),y={topic:c,relay:d,expiry:b,active:!1,methods:p};i.core.expirer.set(c,b),yield i.pairings.set(c,y),a.addTrace(dt_store_new_pairing),o.activatePairing&&(yield i.activate({topic:c})),i.events.emit(Jt_create,y),a.addTrace(dt_emit_inactive_pairing),i.core.crypto.keychain.has(c)||(yield i.core.crypto.setSymKey(u,c)),a.addTrace(dt_subscribing_pairing_topic);try{yield i.core.relayer.confirmOnlineStateOrThrow()}catch{a.setError(Ct_no_internet_connection)}try{yield i.core.relayer.subscribe(c,{relay:d})}catch(m){throw a.setError(Ct_subscribe_pairing_topic_failure),m}return a.addTrace(dt_subscribe_pairing_topic_success),y});return function(o){return s.apply(this,arguments)}}()),G(this,"activate",function(){var s=(0,f.Z)(function*({topic:o}){i.isInitialized();const a=de($.FIVE_MINUTES);i.core.expirer.set(o,a),yield i.pairings.update(o,{active:!0,expiry:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"ping",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),yield i.isValidPing(o),i.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:a}=o;if(i.pairings.keys.includes(a)){const c=yield i.sendRequest(a,"wc_pairingPing",{}),{done:u,resolve:d,reject:h}=Lt();i.events.once(ee("pairing_ping",c),({error:p})=>{p?h(p):d()}),yield u()}});return function(o){return s.apply(this,arguments)}}()),G(this,"updateExpiry",function(){var s=(0,f.Z)(function*({topic:o,expiry:a}){i.isInitialized(),yield i.pairings.update(o,{expiry:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"updateMetadata",function(){var s=(0,f.Z)(function*({topic:o,metadata:a}){i.isInitialized(),yield i.pairings.update(o,{peerMetadata:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),G(this,"disconnect",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),yield i.isValidDisconnect(o);const{topic:a}=o;i.pairings.keys.includes(a)&&(yield i.sendRequest(a,"wc_pairingDelete",te("USER_DISCONNECTED")),yield i.deletePairing(a))});return function(o){return s.apply(this,arguments)}}()),G(this,"formatUriFromPairing",s=>{this.isInitialized();const{topic:o,relay:a,expiry:c,methods:u}=s,d=this.core.crypto.keychain.get(o);return Cc({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:d,relay:a,expiryTimestamp:c,methods:u})}),G(this,"sendRequest",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcRequest)(a,c),d=yield i.core.crypto.encode(o,u),h=cr[a].req;return i.core.history.set(o,u),i.core.relayer.publish(o,d,h),u.id});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"sendResult",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcResult)(o,c),d=yield i.core.crypto.encode(a,u),h=(yield i.core.history.get(a,o)).request.method,p=cr[h].res;yield i.core.relayer.publish(a,d,p),yield i.core.history.resolve(u)});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"sendError",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcError)(o,c),d=yield i.core.crypto.encode(a,u),h=(yield i.core.history.get(a,o)).request.method,p=cr[h]?cr[h].res:cr.unregistered_method.res;yield i.core.relayer.publish(a,d,p),yield i.core.history.resolve(u)});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"deletePairing",function(){var s=(0,f.Z)(function*(o,a){yield i.core.relayer.unsubscribe(o),yield Promise.all([i.pairings.delete(o,te("USER_DISCONNECTED")),i.core.crypto.deleteSymKey(o),a?Promise.resolve():i.core.expirer.del(o)])});return function(o,a){return s.apply(this,arguments)}}()),G(this,"cleanup",(0,f.Z)(function*(){const s=i.pairings.getAll().filter(o=>Rt(o.expiry));yield Promise.all(s.map(o=>i.deletePairing(o.topic)))})),G(this,"onRelayEventRequest",function(){var s=(0,f.Z)(function*(o){const{topic:a,payload:c}=o;switch(c.method){case"wc_pairingPing":return yield i.onPairingPingRequest(a,c);case"wc_pairingDelete":return yield i.onPairingDeleteRequest(a,c);default:return yield i.onUnknownRpcMethodRequest(a,c)}});return function(o){return s.apply(this,arguments)}}()),G(this,"onRelayEventResponse",function(){var s=(0,f.Z)(function*(o){const{topic:a,payload:c}=o,u=(yield i.core.history.get(a,c.id)).request.method;return"wc_pairingPing"===u?i.onPairingPingResponse(a,c):i.onUnknownRpcMethodResponse(u)});return function(o){return s.apply(this,arguments)}}()),G(this,"onPairingPingRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c}=a;try{i.isValidPing({topic:o}),yield i.sendResult(c,o,!0),i.events.emit(Jt_ping,{id:c,topic:o})}catch(u){yield i.sendError(c,o,u),i.logger.error(u)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onPairingPingResponse",(s,o)=>{const{id:a}=o;setTimeout(()=>{(0,z.isJsonRpcResult)(o)?this.events.emit(ee("pairing_ping",a),{}):(0,z.isJsonRpcError)(o)&&this.events.emit(ee("pairing_ping",a),{error:o.error})},500)}),G(this,"onPairingDeleteRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c}=a;try{i.isValidDisconnect({topic:o}),yield i.deletePairing(o),i.events.emit(Jt_delete,{id:c,topic:o})}catch(u){yield i.sendError(c,o,u),i.logger.error(u)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onUnknownRpcMethodRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c,method:u}=a;try{if(i.registeredMethods.includes(u))return;const d=te("WC_METHOD_UNSUPPORTED",u);yield i.sendError(c,o,d),i.logger.error(d)}catch(d){yield i.sendError(c,o,d),i.logger.error(d)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(te("WC_METHOD_UNSUPPORTED",s))}),G(this,"isValidPair",(s,o)=>{var a;if(!Be(s)){const{message:u}=j("MISSING_OR_INVALID",`pair() params: ${s}`);throw o.setError(Ct_malformed_pairing_uri),new Error(u)}if(!function qg(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ue(r,!1))return!!e(r)||e(ga(r))}catch{}return!1}(s.uri)){const{message:u}=j("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw o.setError(Ct_malformed_pairing_uri),new Error(u)}const c=Ic(s?.uri);if(null==(a=c?.relay)||!a.protocol){const{message:u}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw o.setError(Ct_malformed_pairing_uri),new Error(u)}if(null==c||!c.symKey){const{message:u}=j("MISSING_OR_INVALID","pair() uri#symKey");throw o.setError(Ct_malformed_pairing_uri),new Error(u)}if(null!=c&&c.expiryTimestamp&&(0,$.toMiliseconds)(c?.expiryTimestamp)<Date.now()){o.setError(Ct_pairing_expired);const{message:u}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(u)}}),G(this,"isValidPing",function(){var s=(0,f.Z)(function*(o){if(!Be(o)){const{message:c}=j("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(c)}const{topic:a}=o;yield i.isValidPairingTopic(a)});return function(o){return s.apply(this,arguments)}}()),G(this,"isValidDisconnect",function(){var s=(0,f.Z)(function*(o){if(!Be(o)){const{message:c}=j("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(c)}const{topic:a}=o;yield i.isValidPairingTopic(a)});return function(o){return s.apply(this,arguments)}}()),G(this,"isValidPairingTopic",function(){var s=(0,f.Z)(function*(o){if(!ue(o,!1)){const{message:a}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!i.pairings.keys.includes(o)){const{message:a}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if(Rt(i.pairings.get(o).expiry)){yield i.deletePairing(o);const{message:a}=j("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}});return function(o){return s.apply(this,arguments)}}()),this.core=e,this.logger=(0,K.Ep)(t,this.name),this.pairings=new Yt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,K.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){var e=this;this.core.relayer.on(ge_message,function(){var t=(0,f.Z)(function*(i){const{topic:s,message:o,transportType:a}=i;if(e.pairings.keys.includes(s)&&a!==oe.link_mode&&!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(o)))try{const c=yield e.core.crypto.decode(s,o);(0,z.isJsonRpcRequest)(c)?(e.core.history.set(s,c),yield e.onRelayEventRequest({topic:s,payload:c})):(0,z.isJsonRpcResponse)(c)&&(yield e.core.history.resolve(c),yield e.onRelayEventResponse({topic:s,payload:c}),e.core.history.delete(s,c.id)),yield e.core.relayer.messages.ack(s,o)}catch(c){e.logger.error(c)}});return function(i){return t.apply(this,arguments)}}())}registerExpirerEvents(){var e=this;this.core.expirer.on(Qe_expired,function(){var t=(0,f.Z)(function*(i){const{topic:s}=da(i.target);s&&e.pairings.keys.includes(s)&&(yield e.deletePairing(s,!0),e.events.emit(Jt_expire,{topic:s}))});return function(i){return t.apply(this,arguments)}}())}}var O0=Object.defineProperty,Se=(r,e,t)=>((r,e,t)=>e in r?O0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class R0 extends vy{constructor(e,t){var i;super(e,t),i=this,this.core=e,this.logger=t,Se(this,"records",new Map),Se(this,"events",new gt.EventEmitter),Se(this,"name","history"),Se(this,"version","0.3"),Se(this,"cached",[]),Se(this,"initialized",!1),Se(this,"storagePrefix",lt),Se(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),yield i.restore(),i.cached.forEach(s=>i.records.set(s.id,s)),i.cached=[],i.registerEventListeners(),i.initialized=!0)})),Se(this,"set",(s,o,a)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:a}),this.records.has(o.id))return;const c={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:a,expiry:de($.THIRTY_DAYS)};this.records.set(c.id,c),this.persist(),this.events.emit(rt_created,c)}),Se(this,"resolve",function(){var s=(0,f.Z)(function*(o){if(i.isInitialized(),i.logger.debug("Updating JSON-RPC response history record"),i.logger.trace({type:"method",method:"update",response:o}),!i.records.has(o.id))return;const a=yield i.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,z.isJsonRpcError)(o)?{error:o.error}:{result:o.result},i.records.set(a.id,a),i.persist(),i.events.emit(rt_updated,a))});return function(o){return s.apply(this,arguments)}}()),Se(this,"get",function(){var s=(0,f.Z)(function*(o,a){return i.isInitialized(),i.logger.debug("Getting record"),i.logger.trace({type:"method",method:"get",topic:o,id:a}),yield i.getRecord(a)});return function(o,a){return s.apply(this,arguments)}}()),Se(this,"delete",(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(a=>{if(a.topic===s){if(typeof o<"u"&&a.id!==o)return;this.records.delete(a.id),this.events.emit(rt_deleted,a)}}),this.persist()}),Se(this,"exists",function(){var s=(0,f.Z)(function*(o,a){return i.isInitialized(),!!i.records.has(a)&&(yield i.getRecord(a)).topic===o});return function(o,a){return s.apply(this,arguments)}}()),Se(this,"on",(s,o)=>{this.events.on(s,o)}),Se(this,"once",(s,o)=>{this.events.once(s,o)}),Se(this,"off",(s,o)=>{this.events.off(s,o)}),Se(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:(0,z.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}setJsonRpcRecords(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getJsonRpcRecords(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}persist(){var e=this;return(0,f.Z)(function*(){yield e.setJsonRpcRecords(e.values),e.events.emit(rt_sync)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(e.records.size){const{message:i}=j("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored records for ${e.name}`),e.logger.trace({type:"method",method:"restore",records:e.values})}catch(t){e.logger.debug(`Failed to Restore records for ${e.name}`),e.logger.error(t)}})()}registerEventListeners(){this.events.on(rt_created,e=>{const t=rt_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(rt_updated,e=>{const t=rt_updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(rt_deleted,e=>{const t=rt_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Gt.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,$.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(rt_deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var N0=Object.defineProperty,Oe=(r,e,t)=>((r,e,t)=>e in r?N0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class F0 extends Oy{constructor(e,t){var i;super(e,t),i=this,this.core=e,this.logger=t,Oe(this,"expirations",new Map),Oe(this,"events",new gt.EventEmitter),Oe(this,"name","expirer"),Oe(this,"version","0.3"),Oe(this,"cached",[]),Oe(this,"initialized",!1),Oe(this,"storagePrefix",lt),Oe(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),yield i.restore(),i.cached.forEach(s=>i.expirations.set(s.target,s)),i.cached=[],i.registerEventListeners(),i.initialized=!0)})),Oe(this,"has",s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}}),Oe(this,"set",(s,o)=>{this.isInitialized();const a=this.formatTarget(s),c={target:a,expiry:o};this.expirations.set(a,c),this.checkExpiry(a,c),this.events.emit(Qe_created,{target:a,expiration:c})}),Oe(this,"get",s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)}),Oe(this,"del",s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),a=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Qe_deleted,{target:o,expiration:a})}}),Oe(this,"on",(s,o)=>{this.events.on(s,o)}),Oe(this,"once",(s,o)=>{this.events.once(s,o)}),Oe(this,"off",(s,o)=>{this.events.off(s,o)}),Oe(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function zh(r){return la("topic",r)}(e);if("number"==typeof e)return function Zh(r){return la("id",r)}(e);const{message:t}=j("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}setExpirations(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getExpirations(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setExpirations(e.values),e.events.emit(Qe_sync)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getExpirations();if(typeof t>"u"||!t.length)return;if(e.expirations.size){const{message:i}=j("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored expirations for ${e.name}`),e.logger.trace({type:"method",method:"restore",expirations:e.values})}catch(t){e.logger.debug(`Failed to Restore expirations for ${e.name}`),e.logger.error(t)}})()}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;(0,$.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Qe_expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Gt.Lx.pulse,()=>this.checkExpirations()),this.events.on(Qe_created,e=>{const t=Qe_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Qe_expired,e=>{const t=Qe_expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Qe_deleted,e=>{const t=Qe_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}var j0=Object.defineProperty,le=(r,e,t)=>((r,e,t)=>e in r?j0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class U0 extends Ay{constructor(e,t,i){var s;super(e,t,i),s=this,this.core=e,this.logger=t,this.store=i,le(this,"name","verify-api"),le(this,"abortController"),le(this,"isDevEnv"),le(this,"verifyUrlV3",M_),le(this,"storagePrefix",lt),le(this,"version",2),le(this,"publicKey"),le(this,"fetchPromise"),le(this,"init",(0,f.Z)(function*(){var o;s.isDevEnv||(s.publicKey=yield s.store.getItem(s.storeKey),s.publicKey&&(0,$.toMiliseconds)(null==(o=s.publicKey)?void 0:o.expiresAt)<Date.now()&&(s.logger.debug("verify v2 public key expired"),yield s.removePublicKey()))})),le(this,"register",function(){var o=(0,f.Z)(function*(a){if(!sn()||s.isDevEnv)return;const c=window.location.origin,{id:u,decryptedId:d}=a,h=`${s.verifyUrlV3}/attestation?projectId=${s.core.projectId}&origin=${c}&id=${u}&decryptedId=${d}`;try{const p=(0,yt.getDocument)(),g=s.startAbortTimer(5*$.ONE_SECOND),b=yield new Promise((y,m)=>{const _=()=>{window.removeEventListener("message",w),p.body.removeChild(v),m("attestation aborted")};s.abortController.signal.addEventListener("abort",_);const v=p.createElement("iframe");v.src=h,v.style.display="none",v.addEventListener("error",_,{signal:s.abortController.signal});const w=E=>{if(E.data&&"string"==typeof E.data)try{const D=JSON.parse(E.data);if("verify_attestation"===D.type){if((0,Bt.xp)(D.attestation).payload.id!==u)return;clearInterval(g),p.body.removeChild(v),s.abortController.signal.removeEventListener("abort",_),window.removeEventListener("message",w),y(null===D.attestation?"":D.attestation)}}catch(D){s.logger.warn(D)}};p.body.appendChild(v),window.addEventListener("message",w,{signal:s.abortController.signal})});return s.logger.debug("jwt attestation",b),b}catch(p){s.logger.warn(p)}return""});return function(a){return o.apply(this,arguments)}}()),le(this,"resolve",function(){var o=(0,f.Z)(function*(a){if(s.isDevEnv)return"";const{attestationId:c,hash:u,encryptedId:d}=a;if(""===c)return void s.logger.debug("resolve: attestationId is empty, skipping");if(c){if((0,Bt.xp)(c).payload.id!==d)return;const p=yield s.isValidJwtAttestation(c);if(p)return p.isVerified?p:void s.logger.warn("resolve: jwt attestation: origin url not verified")}if(!u)return;const h=s.getVerifyUrl(a?.verifyUrl);return s.fetchAttestation(u,h)});return function(a){return o.apply(this,arguments)}}()),le(this,"fetchAttestation",function(){var o=(0,f.Z)(function*(a,c){s.logger.debug(`resolving attestation: ${a} from url: ${c}`);const u=s.startAbortTimer(5*$.ONE_SECOND),d=yield fetch(`${c}/attestation/${a}?v2Supported=true`,{signal:s.abortController.signal});return clearTimeout(u),200===d.status?yield d.json():void 0});return function(a,c){return o.apply(this,arguments)}}()),le(this,"getVerifyUrl",o=>{let a=o||ur;return k_.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ur}`),a=ur),a}),le(this,"fetchPublicKey",(0,f.Z)(function*(){try{s.logger.debug(`fetching public key from: ${s.verifyUrlV3}`);const o=s.startAbortTimer($.FIVE_SECONDS),a=yield fetch(`${s.verifyUrlV3}/public-key`,{signal:s.abortController.signal});return clearTimeout(o),yield a.json()}catch(o){s.logger.warn(o)}})),le(this,"persistPublicKey",function(){var o=(0,f.Z)(function*(a){s.logger.debug("persisting public key to local storage",a),yield s.store.setItem(s.storeKey,a),s.publicKey=a});return function(a){return o.apply(this,arguments)}}()),le(this,"removePublicKey",(0,f.Z)(function*(){s.logger.debug("removing verify v2 public key from storage"),yield s.store.removeItem(s.storeKey),s.publicKey=void 0})),le(this,"isValidJwtAttestation",function(){var o=(0,f.Z)(function*(a){const c=yield s.getPublicKey();try{if(c)return s.validateAttestation(a,c)}catch(d){s.logger.error(d),s.logger.warn("error validating attestation")}const u=yield s.fetchAndPersistPublicKey();try{if(u)return s.validateAttestation(a,u)}catch(d){s.logger.error(d),s.logger.warn("error validating attestation")}});return function(a){return o.apply(this,arguments)}}()),le(this,"getPublicKey",(0,f.Z)(function*(){return s.publicKey?s.publicKey:yield s.fetchAndPersistPublicKey()})),le(this,"fetchAndPersistPublicKey",(0,f.Z)(function*(){if(s.fetchPromise)return yield s.fetchPromise,s.publicKey;s.fetchPromise=new Promise(function(){var a=(0,f.Z)(function*(c){const u=yield s.fetchPublicKey();u&&(yield s.persistPublicKey(u),c(u))});return function(c){return a.apply(this,arguments)}}());const o=yield s.fetchPromise;return s.fetchPromise=void 0,o})),le(this,"validateAttestation",(o,a)=>{const c=_g(o,a.publicKey),u={hasExpired:(0,$.toMiliseconds)(c.exp)<Date.now(),payload:c};if(u.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:u.payload.origin,isScam:u.payload.isScam,isVerified:u.payload.isVerified}}),this.logger=(0,K.Ep)(t,this.name),this.abortController=new AbortController,this.isDevEnv=ns(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,K.Fd)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,$.toMiliseconds)(e))}}var B0=Object.defineProperty,Tu=(r,e,t)=>((r,e,t)=>e in r?B0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class M0 extends Ry{constructor(e,t){var i;super(e,t),i=this,this.projectId=e,this.logger=t,Tu(this,"context","echo"),Tu(this,"registerDeviceToken",function(){var s=(0,f.Z)(function*(o){const{clientId:a,token:c,notificationType:u,enableEncrypted:d=!1}=o,h=`https://echo.walletconnect.com/${i.projectId}/clients`;yield fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:u,token:c,always_raw:d})})});return function(o){return s.apply(this,arguments)}}()),this.logger=(0,K.Ep)(t,this.context)}}var k0=Object.defineProperty,Fu=Object.getOwnPropertySymbols,L0=Object.prototype.hasOwnProperty,z0=Object.prototype.propertyIsEnumerable,ro=(r,e,t)=>e in r?k0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gr=(r,e)=>{for(var t in e||(e={}))L0.call(e,t)&&ro(r,t,e[t]);if(Fu)for(var t of Fu(e))z0.call(e,t)&&ro(r,t,e[t]);return r},ye=(r,e,t)=>ro(r,"symbol"!=typeof e?e+"":e,t);class Z0 extends Ny{constructor(e,t,i=!0){var s;super(e,t,i),s=this,this.core=e,this.logger=t,ye(this,"context","event-client"),ye(this,"storagePrefix",lt),ye(this,"storageVersion",.1),ye(this,"events",new Map),ye(this,"shouldPersist",!1),ye(this,"init",(0,f.Z)(function*(){if(!ns())try{const o={eventId:fa(),timestamp:Date.now(),domain:s.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:yield s.core.crypto.getClientId(),user_agent:ua(s.core.relayer.protocol,s.core.relayer.version,Vs)}}};yield s.sendEvent([o])}catch(o){s.logger.warn(o)}})),ye(this,"createEvent",o=>{const{event:a="ERROR",type:c="",properties:{topic:u,trace:d}}=o,h=fa(),p=this.core.projectId||"",g=Date.now(),b=gr({eventId:h,timestamp:g,props:{event:a,type:c,properties:{topic:u,trace:d}},bundleId:p,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,b),this.shouldPersist=!0),b}),ye(this,"getEvent",o=>{const{eventId:a,topic:c}=o;if(a)return this.events.get(a);const u=Array.from(this.events.values()).find(d=>d.props.properties.topic===c);return u?gr(gr({},u),this.setMethods(u.eventId)):void 0}),ye(this,"deleteEvent",o=>{const{eventId:a}=o;this.events.delete(a),this.shouldPersist=!0}),ye(this,"setEventListeners",()=>{this.core.heartbeat.on(Gt.Lx.pulse,(0,f.Z)(function*(){s.shouldPersist&&(yield s.persist()),s.events.forEach(o=>{(0,$.fromMiliseconds)(Date.now())-(0,$.fromMiliseconds)(o.timestamp)>86400&&(s.events.delete(o.eventId),s.shouldPersist=!0)})}))}),ye(this,"setMethods",o=>({addTrace:a=>this.addTrace(o,a),setError:a=>this.setError(o,a)})),ye(this,"addTrace",(o,a)=>{const c=this.events.get(o);c&&(c.props.properties.trace.push(a),this.events.set(o,c),this.shouldPersist=!0)}),ye(this,"setError",(o,a)=>{const c=this.events.get(o);c&&(c.props.type=a,c.timestamp=Date.now(),this.events.set(o,c),this.shouldPersist=!0)}),ye(this,"persist",(0,f.Z)(function*(){yield s.core.storage.setItem(s.storageKey,Array.from(s.events.values())),s.shouldPersist=!1})),ye(this,"restore",(0,f.Z)(function*(){try{const o=(yield s.core.storage.getItem(s.storageKey))||[];if(!o.length)return;o.forEach(a=>{s.events.set(a.eventId,gr(gr({},a),s.setMethods(a.eventId)))})}catch(o){s.logger.warn(o)}})),ye(this,"submit",(0,f.Z)(function*(){if(!s.telemetryEnabled||0===s.events.size)return;const o=[];for(const[a,c]of s.events)c.props.type&&o.push(c);if(0!==o.length)try{if((yield s.sendEvent(o)).ok)for(const a of o)s.events.delete(a.eventId),s.shouldPersist=!0}catch(a){s.logger.warn(a)}})),ye(this,"sendEvent",function(){var o=(0,f.Z)(function*(a){const c=s.getAppDomain()?"":"&sp=desktop";return yield fetch(`https://pulse.walletconnect.org/batch?projectId=${s.core.projectId}&st=events_sdk&sv=js-${Vs}${c}`,{method:"POST",body:JSON.stringify(a)})});return function(a){return o.apply(this,arguments)}}()),ye(this,"getAppDomain",()=>ca().url),this.logger=(0,K.Ep)(t,this.context),this.telemetryEnabled=i,i?this.restore().then((0,f.Z)(function*(){yield s.submit(),s.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var V0=Object.defineProperty,ju=Object.getOwnPropertySymbols,H0=Object.prototype.hasOwnProperty,K0=Object.prototype.propertyIsEnumerable,io=(r,e,t)=>e in r?V0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$u=(r,e)=>{for(var t in e||(e={}))H0.call(e,t)&&io(r,t,e[t]);if(ju)for(var t of ju(e))K0.call(e,t)&&io(r,t,e[t]);return r},se=(r,e,t)=>io(r,"symbol"!=typeof e?e+"":e,t);class so extends yy{constructor(e){var t,i;super(e),t=this,se(this,"protocol","wc"),se(this,"version",2),se(this,"name",Yr),se(this,"relayUrl"),se(this,"projectId"),se(this,"customStoragePrefix"),se(this,"events",new gt.EventEmitter),se(this,"logger"),se(this,"heartbeat"),se(this,"relayer"),se(this,"crypto"),se(this,"storage"),se(this,"history"),se(this,"expirer"),se(this,"pairing"),se(this,"verify"),se(this,"echoClient"),se(this,"linkModeSupportedApps"),se(this,"eventClient"),se(this,"initialized",!1),se(this,"logChunkController"),se(this,"on",(u,d)=>this.events.on(u,d)),se(this,"once",(u,d)=>this.events.once(u,d)),se(this,"off",(u,d)=>this.events.off(u,d)),se(this,"removeListener",(u,d)=>this.events.removeListener(u,d)),se(this,"dispatchEnvelope",({topic:u,message:d,sessionExists:h})=>{if(!u||!d)return;const p={topic:u,message:d,publishedAt:Date.now(),transportType:oe.link_mode};this.relayer.onLinkMessageEvent(p,{sessionExists:h})});const s=this.getGlobalCore(e?.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(u){console.warn("Failed to copy global core",u)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ru,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const o=(0,K.jI)({level:"string"==typeof e?.logger&&e.logger?e.logger:g__logger,name:Yr}),{logger:a,chunkLoggerController:c}=(0,K.Rt)({opts:o,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=c,null!=(i=this.logChunkController)&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=(0,f.Z)(function*(){var u,d;null!=(u=t.logChunkController)&&u.downloadLogsBlobInBrowser&&(null==(d=t.logChunkController)||d.downloadLogsBlobInBrowser({clientId:yield t.crypto.getClientId()}))})),this.logger=(0,K.Ep)(a,this.name),this.heartbeat=new Gt.C$,this.crypto=new wv(this,this.logger,e?.keychain),this.history=new R0(this,this.logger),this.expirer=new F0(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new py.Z($u($u({},y_),e?.storageOptions)),this.relayer=new Gv({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new S0(this,this.logger),this.verify=new U0(this,this.logger,this.storage),this.echoClient=new M0(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Z0(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static init(e){return(0,f.Z)(function*(){const t=new so(e);yield t.initialize();const i=yield t.crypto.getClientId();return yield t.storage.setItem("WALLETCONNECT_CLIENT_ID",i),t})()}get context(){return(0,K.Fd)(this.logger)}start(){var e=this;return(0,f.Z)(function*(){e.initialized||(yield e.initialize())})()}getLogsBlob(){var e=this;return(0,f.Z)(function*(){var t;return null==(t=e.logChunkController)?void 0:t.logsToBlob({clientId:yield e.crypto.getClientId()})})()}addLinkModeSupportedApp(e){var t=this;return(0,f.Z)(function*(){t.linkModeSupportedApps.includes(e)||(t.linkModeSupportedApps.push(e),yield t.storage.setItem(iu,t.linkModeSupportedApps))})()}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized");try{yield e.crypto.init(),yield e.history.init(),yield e.expirer.init(),yield e.relayer.init(),yield e.heartbeat.init(),yield e.pairing.init(),e.linkModeSupportedApps=(yield e.storage.getItem(iu))||[],e.initialized=!0,e.logger.info("Core Initialization Success")}catch(t){throw e.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),e.logger.error(t.message),t}})()}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){return void console.warn("Failed to get global WalletConnect core",t)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}const G0=so,oo="wc@2:client:",ao_name="client",ao_logger="error",Mu="WALLETCONNECT_DEEPLINK_CHOICE",ku="Proposal expired",In=$.SEVEN_DAYS,me={wc_sessionPropose:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:$.ONE_DAY,prompt:!1,tag:1114},res:{ttl:$.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:$.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:$.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:$.FIVE_MINUTES,prompt:!1,tag:1119}}},co={min:$.FIVE_MINUTES,max:$.SEVEN_DAYS},pt_idle="IDLE",pt_active="ACTIVE",Lu={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},X0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],ni="wc@1.5:auth:",ri=`${ni}:PUB_KEY`;var sw=Object.defineProperty,ow=Object.defineProperties,aw=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,cw=Object.prototype.hasOwnProperty,uw=Object.prototype.propertyIsEnumerable,uo=(r,e,t)=>e in r?sw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,re=(r,e)=>{for(var t in e||(e={}))cw.call(e,t)&&uo(r,t,e[t]);if(zu)for(var t of zu(e))uw.call(e,t)&&uo(r,t,e[t]);return r},Fe=(r,e)=>ow(r,aw(e)),O=(r,e,t)=>uo(r,"symbol"!=typeof e?e+"":e,t);class lw extends $y{constructor(e){var t;super(e),t=this,O(this,"name","engine"),O(this,"events",new(ki())),O(this,"initialized",!1),O(this,"requestQueue",{state:pt_idle,queue:[]}),O(this,"sessionRequestQueue",{state:pt_idle,queue:[]}),O(this,"requestQueueDelay",$.ONE_SECOND),O(this,"expectedPairingMethodMap",new Map),O(this,"recentlyDeletedMap",new Map),O(this,"recentlyDeletedLimit",200),O(this,"relayMessageCache",[]),O(this,"pendingSessions",new Map),O(this,"init",(0,f.Z)(function*(){t.initialized||(yield t.cleanup(),t.registerRelayerEvents(),t.registerExpirerEvents(),t.registerPairingEvents(),yield t.registerLinkModeListeners(),t.client.core.pairing.register({methods:Object.keys(me)}),t.initialized=!0,setTimeout((0,f.Z)(function*(){yield t.processPendingMessageEvents(),t.sessionRequestQueue.queue=t.getPendingSessionRequests(),t.processSessionRequestQueue()}),(0,$.toMiliseconds)(t.requestQueueDelay)))})),O(this,"connect",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();const o=Fe(re({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});yield t.isValidConnect(o),o.optionalNamespaces=function Fg(r,e){var t,i,s,o,a,c;const u=Lr(r),d=Lr(e),h={},p=Object.keys(u).concat(Object.keys(d));for(const g of p)h[g]={chains:$e(null==(t=u[g])?void 0:t.chains,null==(i=d[g])?void 0:i.chains),methods:$e(null==(s=u[g])?void 0:s.methods,null==(o=d[g])?void 0:o.methods),events:$e(null==(a=u[g])?void 0:a.events,null==(c=d[g])?void 0:c.events)};return h}(o.requiredNamespaces,o.optionalNamespaces),o.requiredNamespaces={};const{pairingTopic:a,requiredNamespaces:c,optionalNamespaces:u,sessionProperties:d,scopedProperties:h,relays:p}=o;let b,g=a,y=!1;try{if(g){const I=t.client.core.pairing.pairings.get(g);t.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),y=I.active}}catch(I){throw t.client.logger.error(`connect() -> pairing.get(${g}) failed`),I}if(!g||!y){const{topic:I,uri:S}=yield t.client.core.pairing.create();g=I,b=S}if(!g){const{message:I}=j("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(I)}const m=yield t.client.core.crypto.generateKeyPair(),_=me.wc_sessionPropose.req.ttl||$.FIVE_MINUTES,v=de(_),w=Fe(re(re({requiredNamespaces:c,optionalNamespaces:u,relays:p??[{protocol:"irn"}],proposer:{publicKey:m,metadata:t.client.metadata},expiryTimestamp:v,pairingTopic:g},d&&{sessionProperties:d}),h&&{scopedProperties:h}),{id:(0,z.payloadId)()}),E=ee("session_connect",w.id),{reject:D,resolve:P,done:C}=Lt(_,ku),x=({id:I})=>{I===w.id&&(t.client.events.off("proposal_expire",x),t.pendingSessions.delete(w.id),t.events.emit(E,{error:{message:ku,code:0}}))};return t.client.events.on("proposal_expire",x),t.events.once(E,({error:I,session:S})=>{t.client.events.off("proposal_expire",x),I?D(I):S&&P(S)}),yield t.sendRequest({topic:g,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),yield t.setProposal(w.id,w),{uri:b,approval:C}});return function(s){return i.apply(this,arguments)}}()),O(this,"pair",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{return yield t.client.core.pairing.pair(s)}catch(o){throw t.client.logger.error("pair() failed"),o}});return function(s){return i.apply(this,arguments)}}()),O(this,"approve",function(){var i=(0,f.Z)(function*(s){var o,a,c;const u=t.client.core.eventClient.createEvent({properties:{topic:null==(o=s?.id)?void 0:o.toString(),trace:[it_session_approve_started]}});try{t.isInitialized(),yield t.confirmOnlineStateOrThrow()}catch(F){throw u.setError(Wt_no_internet_connection),F}try{yield t.isValidProposalId(s?.id)}catch(F){throw t.client.logger.error(`approve() -> proposal.get(${s?.id}) failed`),u.setError(Wt_proposal_not_found),F}try{yield t.isValidApprove(s)}catch(F){throw t.client.logger.error("approve() -> isValidApprove() failed"),u.setError(Wt_session_approve_namespace_validation_failure),F}const{id:d,relayProtocol:h,namespaces:p,sessionProperties:g,scopedProperties:b,sessionConfig:y}=s,m=t.client.proposal.get(d);t.client.core.eventClient.deleteEvent({eventId:u.eventId});const{pairingTopic:_,proposer:v,requiredNamespaces:w,optionalNamespaces:E}=m;let D=null==(a=t.client.core.eventClient)?void 0:a.getEvent({topic:_});D||(D=null==(c=t.client.core.eventClient)?void 0:c.createEvent({type:it_session_approve_started,properties:{topic:_,trace:[it_session_approve_started,it_session_namespaces_validation_success]}}));const P=yield t.client.core.crypto.generateKeyPair(),C=v.publicKey,x=yield t.client.core.crypto.generateSharedKey(P,C),I=re(re(re({relay:{protocol:h??"irn"},namespaces:p,controller:{publicKey:P,metadata:t.client.metadata},expiry:de(In)},g&&{sessionProperties:g}),b&&{scopedProperties:b}),y&&{sessionConfig:y}),S=oe.relay;D.addTrace(it_subscribing_session_topic);try{yield t.client.core.relayer.subscribe(x,{transportType:S})}catch(F){throw D.setError(Wt_subscribe_session_topic_failure),F}D.addTrace(it_subscribe_session_topic_success);const L=Fe(re({},I),{topic:x,requiredNamespaces:w,optionalNamespaces:E,pairingTopic:_,acknowledged:!1,self:I.controller,peer:{publicKey:v.publicKey,metadata:v.metadata},controller:P,transportType:oe.relay});yield t.client.session.set(x,L),D.addTrace(it_store_session);try{D.addTrace(it_publishing_session_settle),yield t.sendRequest({topic:x,method:"wc_sessionSettle",params:I,throwOnFailedPublish:!0}).catch(F=>{throw D?.setError(Wt_session_settle_publish_failure),F}),D.addTrace(it_session_settle_publish_success),D.addTrace(it_publishing_session_approve),yield t.sendResult({id:d,topic:_,result:{relay:{protocol:h??"irn"},responderPublicKey:P},throwOnFailedPublish:!0}).catch(F=>{throw D?.setError(Wt_session_approve_publish_failure),F}),D.addTrace(it_session_approve_publish_success)}catch(F){throw t.client.logger.error(F),t.client.session.delete(x,te("USER_DISCONNECTED")),yield t.client.core.relayer.unsubscribe(x),F}return t.client.core.eventClient.deleteEvent({eventId:D.eventId}),yield t.client.core.pairing.updateMetadata({topic:_,metadata:v.metadata}),yield t.client.proposal.delete(d,te("USER_DISCONNECTED")),yield t.client.core.pairing.activate({topic:_}),yield t.setExpiry(x,de(In)),{topic:x,acknowledged:()=>Promise.resolve(t.client.session.get(x))}});return function(s){return i.apply(this,arguments)}}()),O(this,"reject",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidReject(s)}catch(u){throw t.client.logger.error("reject() -> isValidReject() failed"),u}const{id:o,reason:a}=s;let c;try{c=t.client.proposal.get(o).pairingTopic}catch(u){throw t.client.logger.error(`reject() -> proposal.get(${o}) failed`),u}c&&(yield t.sendError({id:o,topic:c,error:a,rpcOpts:me.wc_sessionPropose.reject}),yield t.client.proposal.delete(o,te("USER_DISCONNECTED")))});return function(s){return i.apply(this,arguments)}}()),O(this,"update",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidUpdate(s)}catch(b){throw t.client.logger.error("update() -> isValidUpdate() failed"),b}const{topic:o,namespaces:a}=s,{done:c,resolve:u,reject:d}=Lt(),h=(0,z.payloadId)(),p=(0,z.getBigIntRpcId)().toString(),g=t.client.session.get(o).namespaces;return t.events.once(ee("session_update",h),({error:b})=>{b?d(b):u()}),yield t.client.session.update(o,{namespaces:a}),yield t.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:h,relayRpcId:p}).catch(b=>{t.client.logger.error(b),t.client.session.update(o,{namespaces:g}),d(b)}),{acknowledged:c}});return function(s){return i.apply(this,arguments)}}()),O(this,"extend",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidExtend(s)}catch(h){throw t.client.logger.error("extend() -> isValidExtend() failed"),h}const{topic:o}=s,a=(0,z.payloadId)(),{done:c,resolve:u,reject:d}=Lt();return t.events.once(ee("session_extend",a),({error:h})=>{h?d(h):u()}),yield t.setExpiry(o,de(In)),t.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(h=>{d(h)}),{acknowledged:c}});return function(s){return i.apply(this,arguments)}}()),O(this,"request",function(){var i=(0,f.Z)(function*(s){t.isInitialized();try{yield t.isValidRequest(s)}catch(E){throw t.client.logger.error("request() -> isValidRequest() failed"),E}const{chainId:o,request:a,topic:c,expiry:u=me.wc_sessionRequest.req.ttl}=s,d=t.client.session.get(c);d?.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const h=(0,z.payloadId)(),p=(0,z.getBigIntRpcId)().toString(),{done:g,resolve:b,reject:y}=Lt(u,"Request expired. Please try again.");t.events.once(ee("session_request",h),({error:E,result:D})=>{E?y(E):b(D)});const m="wc_sessionRequest",_=t.getAppLinkIfEnabled(d.peer.metadata,d.transportType);if(_)return yield t.sendRequest({clientRpcId:h,relayRpcId:p,topic:c,method:m,params:{request:Fe(re({},a),{expiryTimestamp:de(u)}),chainId:o},expiry:u,throwOnFailedPublish:!0,appLink:_}).catch(E=>y(E)),t.client.events.emit("session_request_sent",{topic:c,request:a,chainId:o,id:h}),yield g();const v={request:Fe(re({},a),{expiryTimestamp:de(u)}),chainId:o},w=t.shouldSetTVF(m,v);return yield Promise.all([new Promise(function(){var E=(0,f.Z)(function*(D){yield t.sendRequest(re({clientRpcId:h,relayRpcId:p,topic:c,method:m,params:v,expiry:u,throwOnFailedPublish:!0},w&&{tvf:t.getTVFParams(h,v)})).catch(P=>y(P)),t.client.events.emit("session_request_sent",{topic:c,request:a,chainId:o,id:h}),D()});return function(D){return E.apply(this,arguments)}}()),new Promise(function(){var E=(0,f.Z)(function*(D){var P;if(null==(P=d.sessionConfig)||!P.disableDeepLink){const C=yield function Gh(r,e){return ts.apply(this,arguments)}(t.client.core.storage,Mu);yield function Vh(r){return es.apply(this,arguments)}({id:h,topic:c,wcDeepLink:C})}D()});return function(D){return E.apply(this,arguments)}}()),g()]).then(E=>E[2])});return function(s){return i.apply(this,arguments)}}()),O(this,"respond",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.isValidRespond(s);const{topic:o,response:a}=s,{id:c}=a,u=t.client.session.get(o);u.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const d=t.getAppLinkIfEnabled(u.peer.metadata,u.transportType);(0,z.isJsonRpcResult)(a)?yield t.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:d}):(0,z.isJsonRpcError)(a)&&(yield t.sendError({id:c,topic:o,error:a.error,appLink:d})),t.cleanupAfterResponse(s)});return function(s){return i.apply(this,arguments)}}()),O(this,"ping",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidPing(s)}catch(a){throw t.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=s;if(t.client.session.keys.includes(o)){const a=(0,z.payloadId)(),c=(0,z.getBigIntRpcId)().toString(),{done:u,resolve:d,reject:h}=Lt();t.events.once(ee("session_ping",a),({error:p})=>{p?h(p):d()}),yield Promise.all([t.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),u()])}else t.client.core.pairing.pairings.keys.includes(o)&&(t.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),yield t.client.core.pairing.ping({topic:o}))});return function(s){return i.apply(this,arguments)}}()),O(this,"emit",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidEmit(s);const{topic:o,event:a,chainId:c}=s,u=(0,z.getBigIntRpcId)().toString(),d=(0,z.payloadId)();yield t.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:c},throwOnFailedPublish:!0,relayRpcId:u,clientRpcId:d})});return function(s){return i.apply(this,arguments)}}()),O(this,"disconnect",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidDisconnect(s);const{topic:o}=s;if(t.client.session.keys.includes(o))yield t.sendRequest({topic:o,method:"wc_sessionDelete",params:te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),yield t.deleteSession({topic:o,emitEvent:!1});else{if(!t.client.core.pairing.pairings.keys.includes(o)){const{message:a}=j("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}yield t.client.core.pairing.disconnect({topic:o})}});return function(s){return i.apply(this,arguments)}}()),O(this,"find",i=>(this.isInitialized(),this.client.session.getAll().filter(s=>function Ug(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let o=!0;return!!Mt(s,i)&&(i.forEach(a=>{const{accounts:c,methods:u,events:d}=r.namespaces[a],h=vn(c),p=t[a];Mt(Wi(a,p),h)&&Mt(p.methods,u)&&Mt(p.events,d)||(o=!1)}),o)}(s,i)))),O(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),O(this,"authenticate",function(){var i=(0,f.Z)(function*(s,o){var a;t.isInitialized(),t.isValidAuthenticate(s);const c=o&&t.client.core.linkModeSupportedApps.includes(o)&&(null==(a=t.client.metadata.redirect)?void 0:a.linkMode),u=c?oe.link_mode:oe.relay;u===oe.relay&&(yield t.confirmOnlineStateOrThrow());const{chains:d,statement:h="",uri:p,domain:g,nonce:b,type:y,exp:m,nbf:_,methods:v=[],expiry:w}=s,E=[...s.resources||[]],{topic:D,uri:P}=yield t.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:u});t.client.logger.info({message:"Generated new pairing",pairing:{topic:D,uri:P}});const C=yield t.client.core.crypto.generateKeyPair(),x=Br(C);if(yield Promise.all([t.client.auth.authKeys.set(ri,{responseTopic:x,publicKey:C}),t.client.auth.pairingTopics.set(x,{topic:x,pairingTopic:D})]),yield t.client.core.relayer.subscribe(x,{transportType:u}),t.client.logger.info(`sending request to new pairing topic: ${D}`),v.length>0){const{namespace:Z}=qt(d[0]);let k=Mp(Z,"request",v);dn(E)&&(k=kp(k,E.pop())),E.push(k)}const I=w&&w>me.wc_sessionAuthenticate.req.ttl?w:me.wc_sessionAuthenticate.req.ttl,S={authPayload:{type:y??"caip122",chains:d,statement:h,aud:p,domain:g,version:"1",nonce:b,iat:(new Date).toISOString(),exp:m,nbf:_,resources:E},requester:{publicKey:C,metadata:t.client.metadata},expiryTimestamp:de(I)},F={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:d,methods:[...new Set(["personal_sign",...v])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:D,proposer:{publicKey:C,metadata:t.client.metadata},expiryTimestamp:de(me.wc_sessionPropose.req.ttl),id:(0,z.payloadId)()},{done:M,resolve:V,reject:A}=Lt(I,"Request expired"),R=(0,z.payloadId)(),N=ee("session_connect",F.id),B=ee("session_request",R),q=function(){var Z=(0,f.Z)(function*({error:k,session:X}){t.events.off(B,U),k?A(k):X&&V({session:X})});return function(X){return Z.apply(this,arguments)}}(),U=function(){var Z=(0,f.Z)(function*(k){var X,ae,he;if(yield t.deletePendingAuthRequest(R,{message:"fulfilled",code:0}),k.error){const Ke=te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return k.error.code===Ke.code?void 0:(t.events.off(N,q),A(k.error.message))}yield t.deleteProposal(F.id),t.events.off(N,q);const{cacaos:_e,responder:be}=k.result,ve=[],Ae=[];for(const Ke of _e){(yield Aa({cacao:Ke,projectId:t.client.core.projectId}))||(t.client.logger.error(Ke,"Signature verification failed"),A(te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:at}=Ke,Mn=dn(at.resources),mr=[hs(at.iss)],yE=Ar(at.iss);if(Mn){const Eo=ja(Mn),mE=$a(Mn);ve.push(...Eo),mr.push(...mE)}for(const Eo of mr)Ae.push(`${Eo}:${yE}`)}const Pt=yield t.client.core.crypto.generateSharedKey(C,be.publicKey);let ft;ve.length>0&&(ft={topic:Pt,acknowledged:!0,self:{publicKey:C,metadata:t.client.metadata},peer:be,controller:be.publicKey,expiry:de(In),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:D,namespaces:Oc([...new Set(ve)],[...new Set(Ae)]),transportType:u},yield t.client.core.relayer.subscribe(Pt,{transportType:u}),yield t.client.session.set(Pt,ft),D&&(yield t.client.core.pairing.updateMetadata({topic:D,metadata:be.metadata})),ft=t.client.session.get(Pt)),null!=(X=t.client.metadata.redirect)&&X.linkMode&&null!=(ae=be.metadata.redirect)&&ae.linkMode&&null!=(he=be.metadata.redirect)&&he.universal&&o&&(t.client.core.addLinkModeSupportedApp(be.metadata.redirect.universal),t.client.session.update(Pt,{transportType:oe.link_mode})),V({auths:_e,session:ft})});return function(X){return Z.apply(this,arguments)}}();let H;t.events.once(N,q),t.events.once(B,U);try{if(c){const Z=(0,z.formatJsonRpcRequest)("wc_sessionAuthenticate",S,R);t.client.core.history.set(D,Z);const k=yield t.client.core.crypto.encode("",Z,{type:er,encoding:jt});H=Mr(o,D,k)}else yield Promise.all([t.sendRequest({topic:D,method:"wc_sessionAuthenticate",params:S,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:R}),t.sendRequest({topic:D,method:"wc_sessionPropose",params:F,expiry:me.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:F.id})])}catch(Z){throw t.events.off(N,q),t.events.off(B,U),Z}return yield t.setProposal(F.id,F),yield t.setAuthRequest(R,{request:Fe(re({},S),{verifyContext:{}}),pairingTopic:D,transportType:u}),{uri:H??P,response:M}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"approveSessionAuthenticate",function(){var i=(0,f.Z)(function*(s){const{id:o,auths:a}=s,c=t.client.core.eventClient.createEvent({properties:{topic:o.toString(),trace:[Qt_authenticated_session_approve_started]}});try{t.isInitialized()}catch(w){throw c.setError(lr_no_internet_connection),w}const u=t.getPendingAuthRequest(o);if(!u)throw c.setError(lr_authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${o}`);const d=u.transportType||oe.relay;d===oe.relay&&(yield t.confirmOnlineStateOrThrow());const h=u.requester.publicKey,p=yield t.client.core.crypto.generateKeyPair(),g=Br(h),b={type:xt,receiverPublicKey:h,senderPublicKey:p},y=[],m=[];for(const w of a){if(!(yield Aa({cacao:w,projectId:t.client.core.projectId}))){c.setError(lr_invalid_cacao);const x=te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw yield t.sendError({id:o,topic:g,error:x,encodeOpts:b}),new Error(x.message)}c.addTrace(Qt_cacaos_verified);const{p:E}=w,D=dn(E.resources),P=[hs(E.iss)],C=Ar(E.iss);if(D){const x=ja(D),I=$a(D);y.push(...x),P.push(...I)}for(const x of P)m.push(`${x}:${C}`)}const _=yield t.client.core.crypto.generateSharedKey(p,h);let v;if(c.addTrace(Qt_create_authenticated_session_topic),y?.length>0){v={topic:_,acknowledged:!0,self:{publicKey:p,metadata:t.client.metadata},peer:{publicKey:h,metadata:u.requester.metadata},controller:h,expiry:de(In),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:u.pairingTopic,namespaces:Oc([...new Set(y)],[...new Set(m)]),transportType:d},c.addTrace(Qt_subscribing_authenticated_session_topic);try{yield t.client.core.relayer.subscribe(_,{transportType:d})}catch(w){throw c.setError(lr_subscribe_authenticated_session_topic_failure),w}c.addTrace(Qt_subscribe_authenticated_session_topic_success),yield t.client.session.set(_,v),c.addTrace(Qt_store_authenticated_session),yield t.client.core.pairing.updateMetadata({topic:u.pairingTopic,metadata:u.requester.metadata})}c.addTrace(Qt_publishing_authenticated_session_approve);try{yield t.sendResult({topic:g,id:o,result:{cacaos:a,responder:{publicKey:p,metadata:t.client.metadata}},encodeOpts:b,throwOnFailedPublish:!0,appLink:t.getAppLinkIfEnabled(u.requester.metadata,d)})}catch(w){throw c.setError(lr_authenticated_session_approve_publish_failure),w}return yield t.client.auth.requests.delete(o,{message:"fulfilled",code:0}),yield t.client.core.pairing.activate({topic:u.pairingTopic}),t.client.core.eventClient.deleteEvent({eventId:c.eventId}),{session:v}});return function(s){return i.apply(this,arguments)}}()),O(this,"rejectSessionAuthenticate",function(){var i=(0,f.Z)(function*(s){t.isInitialized();const{id:o,reason:a}=s,c=t.getPendingAuthRequest(o);if(!c)throw new Error(`Could not find pending auth request with id ${o}`);c.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const u=c.requester.publicKey,d=yield t.client.core.crypto.generateKeyPair(),h=Br(u),p={type:xt,receiverPublicKey:u,senderPublicKey:d};yield t.sendError({id:o,topic:h,error:a,encodeOpts:p,rpcOpts:me.wc_sessionAuthenticate.reject,appLink:t.getAppLinkIfEnabled(c.requester.metadata,c.transportType)}),yield t.client.auth.requests.delete(o,{message:"rejected",code:0}),yield t.client.proposal.delete(o,te("USER_DISCONNECTED"))});return function(s){return i.apply(this,arguments)}}()),O(this,"formatAuthMessage",i=>{this.isInitialized();const{request:s,iss:o}=i;return Ra(s,o)}),O(this,"processRelayMessageCache",()=>{setTimeout((0,f.Z)(function*(){if(0!==t.relayMessageCache.length)for(;t.relayMessageCache.length>0;)try{const i=t.relayMessageCache.shift();i&&(yield t.onRelayMessage(i))}catch(i){t.client.logger.error(i)}}),50)}),O(this,"cleanupDuplicatePairings",function(){var i=(0,f.Z)(function*(s){if(s.pairingTopic)try{const o=t.client.core.pairing.pairings.get(s.pairingTopic),a=t.client.core.pairing.pairings.getAll().filter(c=>{var u,d;return(null==(u=c.peerMetadata)?void 0:u.url)&&(null==(d=c.peerMetadata)?void 0:d.url)===s.peer.metadata.url&&c.topic&&c.topic!==o.topic});if(0===a.length)return;t.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),yield Promise.all(a.map(c=>t.client.core.pairing.disconnect({topic:c.topic}))),t.client.logger.info("Duplicate pairings clean up finished")}catch(o){t.client.logger.error(o)}});return function(s){return i.apply(this,arguments)}}()),O(this,"deleteSession",function(){var i=(0,f.Z)(function*(s){var o;const{topic:a,expirerHasDeleted:c=!1,emitEvent:u=!0,id:d=0}=s,{self:h}=t.client.session.get(a);yield t.client.core.relayer.unsubscribe(a),yield t.client.session.delete(a,te("USER_DISCONNECTED")),t.addToRecentlyDeleted(a,"session"),t.client.core.crypto.keychain.has(h.publicKey)&&(yield t.client.core.crypto.deleteKeyPair(h.publicKey)),t.client.core.crypto.keychain.has(a)&&(yield t.client.core.crypto.deleteSymKey(a)),c||t.client.core.expirer.del(a),t.client.core.storage.removeItem(Mu).catch(p=>t.client.logger.warn(p)),t.getPendingSessionRequests().forEach(p=>{p.topic===a&&t.deletePendingSessionRequest(p.id,te("USER_DISCONNECTED"))}),a===(null==(o=t.sessionRequestQueue.queue[0])?void 0:o.topic)&&(t.sessionRequestQueue.state=pt_idle),u&&t.client.events.emit("session_delete",{id:d,topic:a})});return function(s){return i.apply(this,arguments)}}()),O(this,"deleteProposal",function(){var i=(0,f.Z)(function*(s,o){if(o)try{const a=t.client.proposal.get(s);t.client.core.eventClient.getEvent({topic:a.pairingTopic})?.setError(Wt_proposal_expired)}catch{}yield Promise.all([t.client.proposal.delete(s,te("USER_DISCONNECTED")),o?Promise.resolve():t.client.core.expirer.del(s)]),t.addToRecentlyDeleted(s,"proposal")});return function(s,o){return i.apply(this,arguments)}}()),O(this,"deletePendingSessionRequest",function(){var i=(0,f.Z)(function*(s,o,a=!1){yield Promise.all([t.client.pendingRequest.delete(s,o),a?Promise.resolve():t.client.core.expirer.del(s)]),t.addToRecentlyDeleted(s,"request"),t.sessionRequestQueue.queue=t.sessionRequestQueue.queue.filter(c=>c.id!==s),a&&(t.sessionRequestQueue.state=pt_idle,t.client.events.emit("session_request_expire",{id:s}))});return function(s,o){return i.apply(this,arguments)}}()),O(this,"deletePendingAuthRequest",function(){var i=(0,f.Z)(function*(s,o,a=!1){yield Promise.all([t.client.auth.requests.delete(s,o),a?Promise.resolve():t.client.core.expirer.del(s)])});return function(s,o){return i.apply(this,arguments)}}()),O(this,"setExpiry",function(){var i=(0,f.Z)(function*(s,o){t.client.session.keys.includes(s)&&(t.client.core.expirer.set(s,o),yield t.client.session.update(s,{expiry:o}))});return function(s,o){return i.apply(this,arguments)}}()),O(this,"setProposal",function(){var i=(0,f.Z)(function*(s,o){t.client.core.expirer.set(s,de(me.wc_sessionPropose.req.ttl)),yield t.client.proposal.set(s,o)});return function(s,o){return i.apply(this,arguments)}}()),O(this,"setAuthRequest",function(){var i=(0,f.Z)(function*(s,o){const{request:a,pairingTopic:c,transportType:u=oe.relay}=o;t.client.core.expirer.set(s,a.expiryTimestamp),yield t.client.auth.requests.set(s,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:s,pairingTopic:c,verifyContext:a.verifyContext,transportType:u})});return function(s,o){return i.apply(this,arguments)}}()),O(this,"setPendingSessionRequest",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,params:c,verifyContext:u}=s,d=c.request.expiryTimestamp||de(me.wc_sessionRequest.req.ttl);t.client.core.expirer.set(o,d),yield t.client.pendingRequest.set(o,{id:o,topic:a,params:c,verifyContext:u})});return function(s){return i.apply(this,arguments)}}()),O(this,"sendRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,method:a,params:c,expiry:u,relayRpcId:d,clientRpcId:h,throwOnFailedPublish:p,appLink:g,tvf:b}=s,y=(0,z.formatJsonRpcRequest)(a,c,h);let m;const _=!!g;try{const E=_?jt:tt;m=yield t.client.core.crypto.encode(o,y,{encoding:E})}catch(E){throw yield t.cleanup(),t.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),E}let v;if(X0.includes(a)){const E=ut(JSON.stringify(y)),D=ut(m);v=yield t.client.core.verify.register({id:D,decryptedId:E})}const w=me[a].req;if(w.attestation=v,u&&(w.ttl=u),d&&(w.id=d),t.client.core.history.set(o,y),_){const E=Mr(g,o,m);yield global.Linking.openURL(E,t.client.name)}else{const E=me[a].req;u&&(E.ttl=u),d&&(E.id=d),E.tvf=Fe(re({},b),{correlationId:y.id}),p?(E.internal=Fe(re({},E.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(o,m,E)):t.client.core.relayer.publish(o,m,E).catch(D=>t.client.logger.error(D))}return y.id});return function(s){return i.apply(this,arguments)}}()),O(this,"sendResult",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,result:c,throwOnFailedPublish:u,encodeOpts:d,appLink:h}=s,p=(0,z.formatJsonRpcResult)(o,c);let g;const b=h&&typeof(null==global?void 0:global.Linking)<"u";try{const _=b?jt:tt;g=yield t.client.core.crypto.encode(a,p,Fe(re({},d||{}),{encoding:_}))}catch(_){throw yield t.cleanup(),t.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),_}let y,m;try{y=yield t.client.core.history.get(a,o);const _=y.request;try{t.shouldSetTVF(_.method,_.params)&&(m=t.getTVFParams(o,_.params,c))}catch(v){t.client.logger.warn("sendResult() -> getTVFParams() failed",v)}}catch(_){throw t.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),_}if(b){const _=Mr(h,a,g);yield global.Linking.openURL(_,t.client.name)}else{const _=y.request.method,v=me[_].res;v.tvf=Fe(re({},m),{correlationId:o}),u?(v.internal=Fe(re({},v.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(a,g,v)):t.client.core.relayer.publish(a,g,v).catch(w=>t.client.logger.error(w))}yield t.client.core.history.resolve(p)});return function(s){return i.apply(this,arguments)}}()),O(this,"sendError",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,error:c,encodeOpts:u,rpcOpts:d,appLink:h}=s,p=(0,z.formatJsonRpcError)(o,c);let g;const b=h&&typeof(null==global?void 0:global.Linking)<"u";try{const m=b?jt:tt;g=yield t.client.core.crypto.encode(a,p,Fe(re({},u||{}),{encoding:m}))}catch(m){throw yield t.cleanup(),t.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),m}let y;try{y=yield t.client.core.history.get(a,o)}catch(m){throw t.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),m}if(b){const m=Mr(h,a,g);yield global.Linking.openURL(m,t.client.name)}else{const m=y.request.method,_=d||me[m].res;t.client.core.relayer.publish(a,g,_)}yield t.client.core.history.resolve(p)});return function(s){return i.apply(this,arguments)}}()),O(this,"cleanup",(0,f.Z)(function*(){const i=[],s=[];t.client.session.getAll().forEach(o=>{let a=!1;Rt(o.expiry)&&(a=!0),t.client.core.crypto.keychain.has(o.topic)||(a=!0),a&&i.push(o.topic)}),t.client.proposal.getAll().forEach(o=>{Rt(o.expiryTimestamp)&&s.push(o.id)}),yield Promise.all([...i.map(o=>t.deleteSession({topic:o})),...s.map(o=>t.deleteProposal(o))])})),O(this,"onProviderMessageEvent",function(){var i=(0,f.Z)(function*(s){!t.initialized||t.relayMessageCache.length>0?t.relayMessageCache.push(s):yield t.onRelayMessage(s)});return function(s){return i.apply(this,arguments)}}()),O(this,"onRelayEventRequest",function(){var i=(0,f.Z)(function*(s){t.requestQueue.queue.push(s),yield t.processRequestsQueue()});return function(s){return i.apply(this,arguments)}}()),O(this,"processRequestsQueue",(0,f.Z)(function*(){if(t.requestQueue.state!==pt_active){for(t.client.logger.info(`Request queue starting with ${t.requestQueue.queue.length} requests`);t.requestQueue.queue.length>0;){t.requestQueue.state=pt_active;const i=t.requestQueue.queue.shift();if(i)try{yield t.processRequest(i)}catch(s){t.client.logger.warn(s)}}t.requestQueue.state=pt_idle}else t.client.logger.info("Request queue already active, skipping...")})),O(this,"processRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,attestation:c,transportType:u,encryptedId:d}=s,h=a.method;if(!t.shouldIgnorePairingRequest({topic:o,requestMethod:h}))switch(h){case"wc_sessionPropose":return yield t.onSessionProposeRequest({topic:o,payload:a,attestation:c,encryptedId:d});case"wc_sessionSettle":return yield t.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return yield t.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return yield t.onSessionExtendRequest(o,a);case"wc_sessionPing":return yield t.onSessionPingRequest(o,a);case"wc_sessionDelete":return yield t.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return yield t.onSessionRequest({topic:o,payload:a,attestation:c,encryptedId:d,transportType:u});case"wc_sessionEvent":return yield t.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return yield t.onSessionAuthenticateRequest({topic:o,payload:a,attestation:c,encryptedId:d,transportType:u});default:return t.client.logger.info(`Unsupported request method ${h}`)}});return function(s){return i.apply(this,arguments)}}()),O(this,"onRelayEventResponse",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,transportType:c}=s,u=(yield t.client.core.history.get(o,a.id)).request.method;switch(u){case"wc_sessionPropose":return t.onSessionProposeResponse(o,a,c);case"wc_sessionSettle":return t.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return t.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return t.onSessionExtendResponse(o,a);case"wc_sessionPing":return t.onSessionPingResponse(o,a);case"wc_sessionRequest":return t.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return t.onSessionAuthenticateResponse(o,a);default:return t.client.logger.info(`Unsupported response method ${u}`)}});return function(s){return i.apply(this,arguments)}}()),O(this,"onRelayEventUnknownPayload",i=>{const{topic:s}=i,{message:o}=j("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)}),O(this,"shouldIgnorePairingRequest",i=>{const{topic:s,requestMethod:o}=i,a=this.expectedPairingMethodMap.get(s);return!(!a||a.includes(o))&&!!(a.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),O(this,"onSessionProposeRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,attestation:c,encryptedId:u}=s,{params:d,id:h}=a;try{const p=t.client.core.eventClient.getEvent({topic:o});0===t.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),p?.setError(Ct_proposal_listener_not_found)),t.isValidConnect(re({},a.params));const g=d.expiryTimestamp||de(me.wc_sessionPropose.req.ttl),b=re({id:h,pairingTopic:o,expiryTimestamp:g},d);yield t.setProposal(h,b);const y=yield t.getVerifyContext({attestationId:c,hash:ut(JSON.stringify(a)),encryptedId:u,metadata:b.proposer.metadata});p?.addTrace(dt_emit_session_proposal),t.client.events.emit("session_proposal",{id:h,params:b,verifyContext:y})}catch(p){yield t.sendError({id:h,topic:o,error:p,rpcOpts:me.wc_sessionPropose.autoReject}),t.client.logger.error(p)}});return function(s){return i.apply(this,arguments)}}()),O(this,"onSessionProposeResponse",function(){var i=(0,f.Z)(function*(s,o,a){const{id:c}=o;if((0,z.isJsonRpcResult)(o)){const{result:u}=o;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const d=t.client.proposal.get(c);t.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const h=d.proposer.publicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const p=u.responderPublicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:p});const g=yield t.client.core.crypto.generateSharedKey(h,p);t.pendingSessions.set(c,{sessionTopic:g,pairingTopic:s,proposalId:c,publicKey:h});const b=yield t.client.core.relayer.subscribe(g,{transportType:a});t.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:b}),yield t.client.core.pairing.activate({topic:s})}else if((0,z.isJsonRpcError)(o)){yield t.client.proposal.delete(c,te("USER_DISCONNECTED"));const u=ee("session_connect",c);if(0===t.events.listenerCount(u))throw new Error(`emitting ${u} without any listeners, 954`);t.events.emit(u,{error:o.error})}});return function(s,o,a){return i.apply(this,arguments)}}()),O(this,"onSessionSettleRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a,params:c}=o;try{t.isValidSessionSettleRequest(c);const{relay:u,controller:d,expiry:h,namespaces:p,sessionProperties:g,scopedProperties:b,sessionConfig:y}=o.params,m=[...t.pendingSessions.values()].find(w=>w.sessionTopic===s);if(!m)return t.client.logger.error(`Pending session not found for topic ${s}`);const _=t.client.proposal.get(m.proposalId),v=Fe(re(re(re({topic:s,relay:u,expiry:h,namespaces:p,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:_.requiredNamespaces,optionalNamespaces:_.optionalNamespaces,controller:d.publicKey,self:{publicKey:m.publicKey,metadata:t.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},g&&{sessionProperties:g}),b&&{scopedProperties:b}),y&&{sessionConfig:y}),{transportType:oe.relay});yield t.client.session.set(v.topic,v),yield t.setExpiry(v.topic,v.expiry),yield t.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:v.peer.metadata}),t.client.events.emit("session_connect",{session:v}),t.events.emit(ee("session_connect",m.proposalId),{session:v}),t.pendingSessions.delete(m.proposalId),t.deleteProposal(m.proposalId,!1),t.cleanupDuplicatePairings(v),yield t.sendResult({id:o.id,topic:s,result:!0,throwOnFailedPublish:!0})}catch(u){yield t.sendError({id:a,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionSettleResponse",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;(0,z.isJsonRpcResult)(o)?(yield t.client.session.update(s,{acknowledged:!0}),t.events.emit(ee("session_approve",a),{})):(0,z.isJsonRpcError)(o)&&(yield t.client.session.delete(s,te("USER_DISCONNECTED")),t.events.emit(ee("session_approve",a),{error:o.error}))});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionUpdateRequest",function(){var i=(0,f.Z)(function*(s,o){const{params:a,id:c}=o;try{const u=`${s}_session_update`,d=ir.get(u);if(d&&t.isRequestOutOfSync(d,c))return t.client.logger.warn(`Discarding out of sync request - ${c}`),void t.sendError({id:c,topic:s,error:te("INVALID_UPDATE_REQUEST")});t.isValidUpdate(re({topic:s},a));try{ir.set(u,c),yield t.client.session.update(s,{namespaces:a.namespaces}),yield t.sendResult({id:c,topic:s,result:!0,throwOnFailedPublish:!0})}catch(h){throw ir.delete(u),h}t.client.events.emit("session_update",{id:c,topic:s,params:a})}catch(u){yield t.sendError({id:c,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"isRequestOutOfSync",(i,s)=>s.toString().slice(0,-3)<i.toString().slice(0,-3)),O(this,"onSessionUpdateResponse",(i,s)=>{const{id:o}=s,a=ee("session_update",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_update",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_update",o),{error:s.error})}),O(this,"onSessionExtendRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidExtend({topic:s}),yield t.setExpiry(s,de(In)),yield t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.client.events.emit("session_extend",{id:a,topic:s})}catch(c){yield t.sendError({id:a,topic:s,error:c}),t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionExtendResponse",(i,s)=>{const{id:o}=s,a=ee("session_extend",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_extend",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_extend",o),{error:s.error})}),O(this,"onSessionPingRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidPing({topic:s}),yield t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.client.events.emit("session_ping",{id:a,topic:s})}catch(c){yield t.sendError({id:a,topic:s,error:c}),t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionPingResponse",(i,s)=>{const{id:o}=s,a=ee("session_ping",o);setTimeout(()=>{if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners 2176`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_ping",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_ping",o),{error:s.error})},500)}),O(this,"onSessionDeleteRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidDisconnect({topic:s,reason:o.params}),Promise.all([new Promise(c=>{t.client.core.relayer.once(ge_publish,(0,f.Z)(function*(){c(yield t.deleteSession({topic:s,id:a}))}))}),t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.cleanupPendingSentRequestsForTopic({topic:s,error:te("USER_DISCONNECTED")})]).catch(c=>t.client.logger.error(c))}catch(c){t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionRequest",function(){var i=(0,f.Z)(function*(s){var o,a,c;const{topic:u,payload:d,attestation:h,encryptedId:p,transportType:g}=s,{id:b,params:y}=d;try{yield t.isValidRequest(re({topic:u},y));const m=t.client.session.get(u),v={id:b,topic:u,params:y,verifyContext:yield t.getVerifyContext({attestationId:h,hash:ut(JSON.stringify((0,z.formatJsonRpcRequest)("wc_sessionRequest",y,b))),encryptedId:p,metadata:m.peer.metadata,transportType:g})};yield t.setPendingSessionRequest(v),g===oe.link_mode&&null!=(o=m.peer.metadata.redirect)&&o.universal&&t.client.core.addLinkModeSupportedApp(null==(a=m.peer.metadata.redirect)?void 0:a.universal),null!=(c=t.client.signConfig)&&c.disableRequestQueue?t.emitSessionRequest(v):(t.addSessionRequestToSessionRequestQueue(v),t.processSessionRequestQueue())}catch(m){yield t.sendError({id:b,topic:u,error:m}),t.client.logger.error(m)}});return function(s){return i.apply(this,arguments)}}()),O(this,"onSessionRequestResponse",(i,s)=>{const{id:o}=s,a=ee("session_request",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_request",o),{result:s.result}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_request",o),{error:s.error})}),O(this,"onSessionEventRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a,params:c}=o;try{const u=`${s}_session_event_${c.event.name}`,d=ir.get(u);if(d&&t.isRequestOutOfSync(d,a))return void t.client.logger.info(`Discarding out of sync request - ${a}`);t.isValidEmit(re({topic:s},c)),t.client.events.emit("session_event",{id:a,topic:s,params:c}),ir.set(u,a)}catch(u){yield t.sendError({id:a,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),O(this,"onSessionAuthenticateResponse",(i,s)=>{const{id:o}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:s}),(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_request",o),{result:s.result}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_request",o),{error:s.error})}),O(this,"onSessionAuthenticateRequest",function(){var i=(0,f.Z)(function*(s){var o;const{topic:a,payload:c,attestation:u,encryptedId:d,transportType:h}=s;try{const{requester:p,authPayload:g,expiryTimestamp:b}=c.params,y=yield t.getVerifyContext({attestationId:u,hash:ut(JSON.stringify(c)),encryptedId:d,metadata:p.metadata,transportType:h}),m={requester:p,pairingTopic:a,id:c.id,authPayload:g,verifyContext:y,expiryTimestamp:b};yield t.setAuthRequest(c.id,{request:m,pairingTopic:a,transportType:h}),h===oe.link_mode&&null!=(o=p.metadata.redirect)&&o.universal&&t.client.core.addLinkModeSupportedApp(p.metadata.redirect.universal),t.client.events.emit("session_authenticate",{topic:a,params:c.params,id:c.id,verifyContext:y})}catch(p){t.client.logger.error(p);const g=c.params.requester.publicKey,b=yield t.client.core.crypto.generateKeyPair(),y=t.getAppLinkIfEnabled(c.params.requester.metadata,h),m={type:xt,receiverPublicKey:g,senderPublicKey:b};yield t.sendError({id:c.id,topic:a,error:p,encodeOpts:m,rpcOpts:me.wc_sessionAuthenticate.autoReject,appLink:y})}});return function(s){return i.apply(this,arguments)}}()),O(this,"addSessionRequestToSessionRequestQueue",i=>{this.sessionRequestQueue.queue.push(i)}),O(this,"cleanupAfterResponse",i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=pt_idle,this.processSessionRequestQueue()},(0,$.toMiliseconds)(this.requestQueueDelay))}),O(this,"cleanupPendingSentRequestsForTopic",({topic:i,error:s})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(a=>a.topic===i&&"wc_sessionRequest"===a.request.method).forEach(a=>{const u=ee("session_request",a.request.id);if(0===this.events.listenerCount(u))throw new Error(`emitting ${u} without any listeners`);this.events.emit(ee("session_request",a.request.id),{error:s})})}),O(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===pt_active)return void this.client.logger.info("session request queue is already active.");const i=this.sessionRequestQueue.queue[0];if(i)try{this.sessionRequestQueue.state=pt_active,this.emitSessionRequest(i)}catch(s){this.client.logger.error(s)}else this.client.logger.info("session request queue is empty.")}),O(this,"emitSessionRequest",i=>{this.client.events.emit("session_request",i)}),O(this,"onPairingCreated",i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);s&&this.onSessionProposeRequest({topic:i.topic,payload:(0,z.formatJsonRpcRequest)("wc_sessionPropose",Fe(re({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id)})}),O(this,"isValidConnect",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:p}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(p)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:u,scopedProperties:d,relays:h}=s;if(Ee(o)||(yield t.isValidPairingTopic(o)),!function Jg(r,e){let t=!1;return e&&!r?t=!0:r&&nt(r)&&r.length&&r.forEach(i=>{t=Nc(i)}),t}(h,!0)){const{message:p}=j("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(p)}if(!Ee(a)&&0!==$t(a)){const p="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(t.client.logger.level)?console.warn(p):t.client.logger.warn(p),t.validateNamespaces(a,"requiredNamespaces")}if(!Ee(c)&&0!==$t(c)&&t.validateNamespaces(c,"optionalNamespaces"),Ee(u)||t.validateSessionProps(u,"sessionProperties"),!Ee(d)){t.validateSessionProps(d,"scopedProperties");const p=Object.keys(a||{}).concat(Object.keys(c||{}));if(!Object.keys(d).every(g=>p.includes(g)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(d)}, required/optional namespaces: ${JSON.stringify(p)}`)}});return function(s){return i.apply(this,arguments)}}()),O(this,"validateNamespaces",(i,s)=>{const o=function Gg(r,e,t){let i=null;if(r&&$t(r)){const s=Rc(r,e);s&&(i=s);const o=Zg(r,e,t);o&&(i=o)}else i=j("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}(i,"connect()",s);if(o)throw new Error(o.message)}),O(this,"isValidApprove",function(){var i=(0,f.Z)(function*(s){if(!Be(s))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:o,namespaces:a,relayProtocol:c,sessionProperties:u,scopedProperties:d}=s;t.checkRecentlyDeleted(o),yield t.isValidProposalId(o);const h=t.client.proposal.get(o),p=Zr(a,"approve()");if(p)throw new Error(p.message);const g=Us(h.requiredNamespaces,a,"approve()");if(g)throw new Error(g.message);if(!ue(c,!0)){const{message:b}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(b)}if(Ee(u)||t.validateSessionProps(u,"sessionProperties"),!Ee(d)){t.validateSessionProps(d,"scopedProperties");const b=new Set(Object.keys(a));if(!Object.keys(d).every(y=>b.has(y)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(d)}, approved namespaces: ${Array.from(b).join(", ")}`)}});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidReject",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:c}=j("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(c)}const{id:o,reason:a}=s;if(t.checkRecentlyDeleted(o),yield t.isValidProposalId(o),!function Qg(r){return!!(r&&"object"==typeof r&&r.code&&$s(r.code,!1)&&r.message&&ue(r.message,!1))}(a)){const{message:c}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(c)}});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidSessionSettleRequest",i=>{if(!Be(i)){const{message:h}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(h)}const{relay:s,controller:o,namespaces:a,expiry:c}=i;if(!Nc(s)){const{message:h}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const u=function Lg(r,e){let t=null;return ue(r?.publicKey,!1)||(t=j("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}(o,"onSessionSettleRequest()");if(u)throw new Error(u.message);const d=Zr(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);if(Rt(c)){const{message:h}=j("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),O(this,"isValidUpdate",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:h}=j("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(h)}const{topic:o,namespaces:a}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o);const c=t.client.session.get(o),u=Zr(a,"update()");if(u)throw new Error(u.message);const d=Us(c.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidExtend",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:a}=j("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(a)}const{topic:o}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o)});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidRequest",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:h}=j("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(h)}const{topic:o,request:a,chainId:c,expiry:u}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o);const{namespaces:d}=t.client.session.get(o);if(!Tc(d,c)){const{message:h}=j("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(h)}if(!function Yg(r){return!(Ee(r)||!ue(r.method,!1))}(a)){const{message:h}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(h)}if(!ty(d,c,a.method)){const{message:h}=j("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(h)}if(u&&!function sy(r,e){return $s(r,!1)&&r<=e.max&&r>=e.min}(u,co)){const{message:h}=j("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${co.min} and ${co.max}`);throw new Error(h)}});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidRespond",function(){var i=(0,f.Z)(function*(s){var o;if(!Be(s)){const{message:u}=j("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(u)}const{topic:a,response:c}=s;try{yield t.isValidSessionTopic(a)}catch(u){throw null!=(o=s?.response)&&o.id&&t.cleanupAfterResponse(s),u}if(!function Xg(r){return!(Ee(r)||Ee(r.result)&&Ee(r.error)||!$s(r.id,!1)||!ue(r.jsonrpc,!1))}(c)){const{message:u}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(u)}});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidPing",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:a}=j("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield t.isValidSessionOrPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidEmit",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:d}=j("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(d)}const{topic:o,event:a,chainId:c}=s;yield t.isValidSessionTopic(o);const{namespaces:u}=t.client.session.get(o);if(!Tc(u,c)){const{message:d}=j("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(d)}if(!function ey(r){return!(Ee(r)||!ue(r.name,!1))}(a)){const{message:d}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!ny(u,c,a.name)){const{message:d}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidDisconnect",function(){var i=(0,f.Z)(function*(s){if(!Be(s)){const{message:a}=j("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield t.isValidSessionOrPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),O(this,"isValidAuthenticate",i=>{const{chains:s,uri:o,domain:a,nonce:c}=i;if(!Array.isArray(s)||0===s.length)throw new Error("chains is required and must be a non-empty array");if(!ue(o,!1))throw new Error("uri is required parameter");if(!ue(a,!1))throw new Error("domain is required parameter");if(!ue(c,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(d=>qt(d).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:u}=qt(s[0]);if("eip155"!==u)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),O(this,"getVerifyContext",function(){var i=(0,f.Z)(function*(s){const{attestationId:o,hash:a,encryptedId:c,metadata:u,transportType:d}=s,h={verified:{verifyUrl:u.verifyUrl||ur,validation:"UNKNOWN",origin:u.url||""}};try{if(d===oe.link_mode){const g=t.getAppLinkIfEnabled(u,d);return h.verified.validation=g&&new URL(g).origin===new URL(u.url).origin?"VALID":"INVALID",h}const p=yield t.client.core.verify.resolve({attestationId:o,hash:a,encryptedId:c,verifyUrl:u.verifyUrl});p&&(h.verified.origin=p.origin,h.verified.isScam=p.isScam,h.verified.validation=p.origin===new URL(u.url).origin?"VALID":"INVALID")}catch(p){t.client.logger.warn(p)}return t.client.logger.debug(`Verify context: ${JSON.stringify(h)}`),h});return function(s){return i.apply(this,arguments)}}()),O(this,"validateSessionProps",(i,s)=>{Object.values(i).forEach((o,a)=>{if(null==o){const{message:c}=j("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${o} for key ${Object.keys(i)[a]}`);throw new Error(c)}})}),O(this,"getPendingAuthRequest",i=>{const s=this.client.auth.requests.get(i);return"object"==typeof s?s:void 0}),O(this,"addToRecentlyDeleted",(i,s)=>{if(this.recentlyDeletedMap.set(i,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let o=0;const a=this.recentlyDeletedLimit/2;for(const c of this.recentlyDeletedMap.keys()){if(o++>=a)break;this.recentlyDeletedMap.delete(c)}}}),O(this,"checkRecentlyDeleted",i=>{const s=this.recentlyDeletedMap.get(i);if(s){const{message:o}=j("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${i}`);throw new Error(o)}}),O(this,"isLinkModeEnabled",(i,s)=>{var o,a,c,u,d,h,p,g,b;return!(!i||s!==oe.link_mode)&&(!0===(null==(a=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:a.linkMode)&&void 0!==(null==(u=null==(c=this.client.metadata)?void 0:c.redirect)?void 0:u.universal)&&""!==(null==(h=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:h.universal)&&void 0!==(null==(p=i?.redirect)?void 0:p.universal)&&""!==(null==(g=i?.redirect)?void 0:g.universal)&&!0===(null==(b=i?.redirect)?void 0:b.linkMode)&&this.client.core.linkModeSupportedApps.includes(i.redirect.universal)&&typeof(null==global?void 0:global.Linking)<"u")}),O(this,"getAppLinkIfEnabled",(i,s)=>{var o;return this.isLinkModeEnabled(i,s)?null==(o=i?.redirect)?void 0:o.universal:void 0}),O(this,"handleLinkModeMessage",({url:i})=>{if(!i||!i.includes("wc_ev")||!i.includes("topic"))return;const s=pa(i,"topic")||"",o=decodeURIComponent(pa(i,"wc_ev")||""),a=this.client.session.keys.includes(s);a&&this.client.session.update(s,{transportType:oe.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:o,sessionExists:a})}),O(this,"registerLinkModeListeners",(0,f.Z)(function*(){var i;if(ns()||Ot()&&null!=(i=t.client.metadata.redirect)&&i.linkMode){const s=null==global?void 0:global.Linking;if(typeof s<"u"){s.addEventListener("url",t.handleLinkModeMessage,t.client.name);const o=yield s.getInitialURL();o&&setTimeout(()=>{t.handleLinkModeMessage({url:o})},50)}}})),O(this,"shouldSetTVF",(i,s)=>{if(!s||"wc_sessionRequest"!==i)return!1;const{request:o}=s;return Object.keys(Lu).includes(o.method)}),O(this,"getTVFParams",(i,s,o)=>{var a,c;try{const u=s.request.method,d=this.extractTxHashesFromResult(u,o);return Fe(re({correlationId:i,rpcMethods:[u],chainId:s.chainId},this.isValidContractData(s.request.params)&&{contractAddresses:[null==(c=null==(a=s.request.params)?void 0:a[0])?void 0:c.to]}),{txHashes:d})}catch(u){this.client.logger.warn("Error getting TVF params",u)}return{}}),O(this,"isValidContractData",i=>{var s;if(!i)return!1;try{const o=i?.data||(null==(s=i?.[0])?void 0:s.data);if(!o.startsWith("0x"))return!1;const a=o.slice(2);return!!/^[0-9a-fA-F]*$/.test(a)&&a.length%2==0}catch{}return!1}),O(this,"extractTxHashesFromResult",(i,s)=>{try{const o=Lu[i];if("string"==typeof s)return[s];const a=s[o.key];if(nt(a))return"solana_signAllTransactions"===i?a.map(c=>function Ip(r){const e=atob(r),t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);const i=t[0];if(0===i)throw new Error("No signatures found");const s=1+64*i;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const o=Buffer.from(r,"base64").slice(1,65);return zl.encode(o)}(c)):a;if("string"==typeof a)return[a]}catch(o){this.client.logger.warn("Error extracting tx hashes from result",o)}return[]})}processPendingMessageEvents(){var e=this;return(0,f.Z)(function*(){try{const t=e.client.session.keys,i=e.client.core.relayer.messages.getWithoutAck(t);for(const[s,o]of Object.entries(i))for(const a of o)try{yield e.onProviderMessageEvent({topic:s,message:a,publishedAt:Date.now()})}catch{e.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${a}`)}}catch(t){e.client.logger.warn("processPendingMessageEvents failed",t)}})()}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}confirmOnlineStateOrThrow(){var e=this;return(0,f.Z)(function*(){yield e.client.core.relayer.confirmOnlineStateOrThrow()})()}registerRelayerEvents(){this.client.core.relayer.on(ge_message,e=>{this.onProviderMessageEvent(e)})}onRelayMessage(e){var t=this;return(0,f.Z)(function*(){const{topic:i,message:s,attestation:o,transportType:a}=e,{publicKey:c}=t.client.auth.authKeys.keys.includes(ri)?t.client.auth.authKeys.get(ri):{responseTopic:void 0,publicKey:void 0};try{const u=yield t.client.core.crypto.decode(i,s,{receiverPublicKey:c,encoding:a===oe.link_mode?jt:tt});(0,z.isJsonRpcRequest)(u)?(t.client.core.history.set(i,u),yield t.onRelayEventRequest({topic:i,payload:u,attestation:o,transportType:a,encryptedId:ut(s)})):(0,z.isJsonRpcResponse)(u)?(yield t.client.core.history.resolve(u),yield t.onRelayEventResponse({topic:i,payload:u,transportType:a}),t.client.core.history.delete(i,u.id)):yield t.onRelayEventUnknownPayload({topic:i,payload:u,transportType:a}),yield t.client.core.relayer.messages.ack(i,s)}catch(u){t.client.logger.error(u)}})()}registerExpirerEvents(){var e=this;this.client.core.expirer.on(Qe_expired,function(){var t=(0,f.Z)(function*(i){const{topic:s,id:o}=da(i.target);return o&&e.client.pendingRequest.keys.includes(o)?yield e.deletePendingSessionRequest(o,j("EXPIRED"),!0):o&&e.client.auth.requests.keys.includes(o)?yield e.deletePendingAuthRequest(o,j("EXPIRED"),!0):void(s?e.client.session.keys.includes(s)&&(yield e.deleteSession({topic:s,expirerHasDeleted:!0}),e.client.events.emit("session_expire",{topic:s})):o&&(yield e.deleteProposal(o,!0),e.client.events.emit("proposal_expire",{id:o})))});return function(i){return t.apply(this,arguments)}}())}registerPairingEvents(){this.client.core.pairing.events.on(Jt_create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Jt_delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ue(e,!1)){const{message:t}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Rt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=j("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}isValidSessionTopic(e){var t=this;return(0,f.Z)(function*(){if(!ue(e,!1)){const{message:i}=j("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(t.checkRecentlyDeleted(e),!t.client.session.keys.includes(e)){const{message:i}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Rt(t.client.session.get(e).expiry)){yield t.deleteSession({topic:e});const{message:i}=j("EXPIRED",`session topic: ${e}`);throw new Error(i)}if(!t.client.core.crypto.keychain.has(e)){const{message:i}=j("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw yield t.deleteSession({topic:e}),new Error(i)}})()}isValidSessionOrPairingTopic(e){var t=this;return(0,f.Z)(function*(){if(t.checkRecentlyDeleted(e),t.client.session.keys.includes(e))yield t.isValidSessionTopic(e);else{if(!t.client.core.pairing.pairings.keys.includes(e)){if(ue(e,!1)){const{message:i}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}{const{message:i}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}t.isValidPairingTopic(e)}})()}isValidProposalId(e){var t=this;return(0,f.Z)(function*(){if(!function Wg(r){return"number"==typeof r}(e)){const{message:i}=j("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!t.client.proposal.keys.includes(e)){const{message:i}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Rt(t.client.proposal.get(e).expiryTimestamp)){yield t.deleteProposal(e);const{message:i}=j("EXPIRED",`proposal id: ${e}`);throw new Error(i)}})()}}class dw extends Yt{constructor(e,t){super(e,t,"proposal",oo),this.core=e,this.logger=t}}class hw extends Yt{constructor(e,t){super(e,t,"session",oo),this.core=e,this.logger=t}}class pw extends Yt{constructor(e,t){super(e,t,"request",oo,i=>i.id),this.core=e,this.logger=t}}class fw extends Yt{constructor(e,t){super(e,t,"authKeys",ni,()=>ri),this.core=e,this.logger=t}}class gw extends Yt{constructor(e,t){super(e,t,"pairingTopics",ni),this.core=e,this.logger=t}}class yw extends Yt{constructor(e,t){super(e,t,"requests",ni,i=>i.id),this.core=e,this.logger=t}}var mw=Object.defineProperty,lo=(r,e,t)=>((r,e,t)=>e in r?mw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class bw{constructor(e,t){this.core=e,this.logger=t,lo(this,"authKeys"),lo(this,"pairingTopics"),lo(this,"requests"),this.authKeys=new fw(this.core,this.logger),this.pairingTopics=new gw(this.core,this.logger),this.requests=new yw(this.core,this.logger)}init(){var e=this;return(0,f.Z)(function*(){yield e.authKeys.init(),yield e.pairingTopics.init(),yield e.requests.init()})()}}var vw=Object.defineProperty,J=(r,e,t)=>((r,e,t)=>e in r?vw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class ho extends jy{constructor(e){var t;super(e),t=this,J(this,"protocol","wc"),J(this,"version",2),J(this,"name",ao_name),J(this,"metadata"),J(this,"core"),J(this,"logger"),J(this,"events",new gt.EventEmitter),J(this,"engine"),J(this,"session"),J(this,"proposal"),J(this,"pendingRequest"),J(this,"auth"),J(this,"signConfig"),J(this,"on",(s,o)=>this.events.on(s,o)),J(this,"once",(s,o)=>this.events.once(s,o)),J(this,"off",(s,o)=>this.events.off(s,o)),J(this,"removeListener",(s,o)=>this.events.removeListener(s,o)),J(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),J(this,"connect",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.connect(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"pair",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.pair(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"approve",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.approve(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"reject",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.reject(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"update",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.update(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"extend",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.extend(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"request",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.request(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"respond",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.respond(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"ping",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.ping(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"emit",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.emit(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"disconnect",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.disconnect(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"find",s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}}),J(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),J(this,"authenticate",function(){var s=(0,f.Z)(function*(o,a){try{return yield t.engine.authenticate(o,a)}catch(c){throw t.logger.error(c.message),c}});return function(o,a){return s.apply(this,arguments)}}()),J(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(o){throw this.logger.error(o.message),o}}),J(this,"approveSessionAuthenticate",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.approveSessionAuthenticate(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),J(this,"rejectSessionAuthenticate",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.rejectSessionAuthenticate(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),this.name=e?.name||ao_name,this.metadata=$h(e?.metadata),this.signConfig=e?.signConfig;const i=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,K.gw)((0,K.jI)({level:e?.logger||ao_logger}));this.core=e?.core||new G0(e),this.logger=(0,K.Ep)(i,this.name),this.session=new hw(this.core,this.logger),this.proposal=new dw(this.core,this.logger),this.pendingRequest=new pw(this.core,this.logger),this.engine=new lw(this),this.auth=new bw(this.core,this.logger)}static init(e){return(0,f.Z)(function*(){const t=new ho(e);return yield t.initialize(),t})()}get context(){return(0,K.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized");try{yield e.core.start(),yield e.session.init(),yield e.proposal.init(),yield e.pendingRequest.init(),yield e.auth.init(),yield e.engine.init(),e.logger.info("SignClient Initialization Success"),setTimeout(()=>{e.engine.processRelayMessageCache()},(0,$.toMiliseconds)($.ONE_SECOND))}catch(t){throw e.logger.info("SignClient Initialization Failure"),e.logger.error(t.message),t}})()}}var ot=T(20901);const ii="wc@2:universal_provider:",Vu="https://rpc.walletconnect.org/v1/",Cn="generic",Iw=`${Vu}bundler`,Ye_DEFAULT_CHAIN_CHANGED="default_chain_changed";function Cw(){}function po(r){return null==r||"object"!=typeof r&&"function"!=typeof r}function fo(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Hu(r){return"object"==typeof r&&null!==r}function Ku(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Gu(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const Sw="[object RegExp]",Ju="[object String]",Wu="[object Number]",Qu="[object Boolean]",Yu="[object Arguments]",Ow="[object Symbol]",Aw="[object Date]",Rw="[object Map]",Nw="[object Set]",Tw="[object Array]",Fw="[object ArrayBuffer]",jw="[object Object]",$w="[object DataView]",Uw="[object Uint8Array]",Bw="[object Uint8ClampedArray]",qw="[object Uint16Array]",Mw="[object Uint32Array]",kw="[object Int8Array]",Lw="[object Int16Array]",zw="[object Int32Array]",Zw="[object Float32Array]",Vw="[object Float64Array]";function Pn(r,e,t,i=new Map,s=void 0){const o=s?.(r,e,t,i);if(null!=o)return o;if(po(r))return r;if(i.has(r))return i.get(r);if(Array.isArray(r)){const a=new Array(r.length);i.set(r,a);for(let c=0;c<r.length;c++)a[c]=Pn(r[c],c,t,i,s);return Object.hasOwn(r,"index")&&(a.index=r.index),Object.hasOwn(r,"input")&&(a.input=r.input),a}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const a=new RegExp(r.source,r.flags);return a.lastIndex=r.lastIndex,a}if(r instanceof Map){const a=new Map;i.set(r,a);for(const[c,u]of r)a.set(c,Pn(u,c,t,i,s));return a}if(r instanceof Set){const a=new Set;i.set(r,a);for(const c of r)a.add(Pn(c,void 0,t,i,s));return a}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(fo(r)){const a=new(Object.getPrototypeOf(r).constructor)(r.length);i.set(r,a);for(let c=0;c<r.length;c++)a[c]=Pn(r[c],c,t,i,s);return a}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const a=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return i.set(r,a),Xt(a,r,t,i,s),a}if(typeof File<"u"&&r instanceof File){const a=new File([r],r.name,{type:r.type});return i.set(r,a),Xt(a,r,t,i,s),a}if(r instanceof Blob){const a=new Blob([r],{type:r.type});return i.set(r,a),Xt(a,r,t,i,s),a}if(r instanceof Error){const a=new r.constructor;return i.set(r,a),a.message=r.message,a.name=r.name,a.stack=r.stack,a.cause=r.cause,Xt(a,r,t,i,s),a}if("object"==typeof r&&function Kw(r){switch(Gu(r)){case Yu:case Tw:case Fw:case $w:case Qu:case Aw:case Zw:case Vw:case kw:case Lw:case zw:case Rw:case Wu:case jw:case Sw:case Nw:case Ju:case Ow:case Uw:case Bw:case qw:case Mw:return!0;default:return!1}}(r)){const a=Object.create(Object.getPrototypeOf(r));return i.set(r,a),Xt(a,r,t,i,s),a}return r}function Xt(r,e,t=r,i,s){const o=[...Object.keys(e),...Ku(e)];for(let a=0;a<o.length;a++){const c=o[a],u=Object.getOwnPropertyDescriptor(r,c);(null==u||u.writable)&&(r[c]=Pn(e[c],c,t,i,s))}}function Gw(r,e){return function Hw(r,e){return Pn(r,void 0,r,new Map,e)}(r,(t,i,s,o)=>{const a=e?.(t,i,s,o);if(null!=a)return a;if("object"==typeof r)switch(Object.prototype.toString.call(r)){case Wu:case Ju:case Qu:{const c=new r.constructor(r?.valueOf());return Xt(c,r),c}case Yu:{const c={};return Xt(c,r),c.length=r.length,c[Symbol.iterator]=r[Symbol.iterator],c}default:return}})}function Xu(r){return Gw(r)}function el(r){return null!==r&&"object"==typeof r&&"[object Arguments]"===Gu(r)}function Jw(r){return fo(r)}function Ww(r){if("object"!=typeof r||null==r)return!1;if(null===Object.getPrototypeOf(r))return!0;if("[object Object]"!==Object.prototype.toString.call(r)){const t=r[Symbol.toStringTag];return!(null==t||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable)&&r.toString()===`[object ${t}]`}let e=r;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function go(r,e,t,i){if(po(r)&&(r=Object(r)),null==e||"object"!=typeof e)return r;if(i.has(e))return function Pw(r){if(po(r))return r;if(Array.isArray(r)||fo(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const i=new t(r);return i.lastIndex=r.lastIndex,i}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const i=new t(r.message);return i.stack=r.stack,i.name=r.name,i.cause=r.cause,i}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if("object"==typeof r){const i=Object.create(e);return Object.assign(i,r)}return r}(i.get(e));if(i.set(e,r),Array.isArray(e)){e=e.slice();for(let o=0;o<e.length;o++)e[o]=e[o]??void 0}const s=[...Object.keys(e),...Ku(e)];for(let o=0;o<s.length;o++){const a=s[o];let c=e[a],u=r[a];if(el(c)&&(c={...c}),el(u)&&(u={...u}),typeof Buffer<"u"&&Buffer.isBuffer(c)&&(c=Xu(c)),Array.isArray(c))if("object"==typeof u&&null!=u){const h=[],p=Reflect.ownKeys(u);for(let g=0;g<p.length;g++){const b=p[g];h[b]=u[b]}u=h}else u=[];const d=t(u,c,a,r,e,i);null!=d?r[a]=d:Array.isArray(c)||Hu(u)&&Hu(c)?r[a]=go(u,c,t,i):null==u&&Ww(c)?r[a]=go({},c,t,i):null==u&&Jw(c)?r[a]=Xu(c):(void 0===u||void 0!==c)&&(r[a]=c)}return r}function Yw(r,...e){return function Qw(r,...e){const t=e.slice(0,-1),i=e[e.length-1];let s=r;for(let o=0;o<t.length;o++)s=go(s,t[o],i,new Map);return s}(r,...e,Cw)}var Xw=Object.defineProperty,eD=Object.defineProperties,tD=Object.getOwnPropertyDescriptors,tl=Object.getOwnPropertySymbols,nD=Object.prototype.hasOwnProperty,rD=Object.prototype.propertyIsEnumerable,nl=(r,e,t)=>e in r?Xw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,si=(r,e)=>{for(var t in e||(e={}))nD.call(e,t)&&nl(r,t,e[t]);if(tl)for(var t of tl(e))rD.call(e,t)&&nl(r,t,e[t]);return r},iD=(r,e)=>eD(r,tD(e));function Ve(r,e,t){var i;const s=qt(r);return(null==(i=e.rpcMap)?void 0:i[s.reference])||`${Vu}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function en(r){return r.includes(":")?r.split(":")[1]:r}function rl(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function oi(r={},e={}){return Yw(il(r),il(e))}function il(r){var e,t,i,s,o;const a={};if(!$t(r))return a;for(const[c,u]of Object.entries(r)){const d=kr(c)?[c]:u.chains,h=u.methods||[],p=u.events||[],g=u.rpcMap||{},b=wn(c);a[b]=iD(si(si({},a[b]),u),{chains:$e(d,null==(e=a[b])?void 0:e.chains),methods:$e(h,null==(t=a[b])?void 0:t.methods),events:$e(p,null==(i=a[b])?void 0:i.events)}),($t(g)||$t((null==(s=a[b])?void 0:s.rpcMap)||{}))&&(a[b].rpcMap=si(si({},g),null==(o=a[b])?void 0:o.rpcMap))}return a}function sl(r){return r.includes(":")?r.split(":")[2]:r}function ol(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],o=i.events||[],a=i.accounts||[],c=kr(t)?[t]:i.chains?i.chains:rl(i.accounts);e[t]={chains:c,methods:s,events:o,accounts:a}}return e}function yo(r){return"number"==typeof r?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const al={},Y=r=>al[r],mo=(r,e)=>{al[r]=e};var oD=Object.defineProperty,Sn=(r,e,t)=>((r,e,t)=>e in r?oD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class cD{constructor(e){Sn(this,"name","polkadot"),Sn(this,"client"),Sn(this,"httpProviders"),Sn(this,"events"),Sn(this,"namespace"),Sn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=en(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var uD=Object.defineProperty,lD=Object.defineProperties,dD=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,hD=Object.prototype.hasOwnProperty,pD=Object.prototype.propertyIsEnumerable,_o=(r,e,t)=>e in r?uD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ul=(r,e)=>{for(var t in e||(e={}))hD.call(e,t)&&_o(r,t,e[t]);if(cl)for(var t of cl(e))pD.call(e,t)&&_o(r,t,e[t]);return r},ll=(r,e)=>lD(r,dD(e)),An=(r,e,t)=>_o(r,"symbol"!=typeof e?e+"":e,t);class fD{constructor(e){An(this,"name","eip155"),An(this,"client"),An(this,"chainId"),An(this,"namespace"),An(this,"httpProviders"),An(this,"events"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}request(e){var t=this;return(0,f.Z)(function*(){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return t.getAccounts();case"wallet_switchEthereumChain":return yield t.handleSwitchChain(e);case"eth_chainId":return parseInt(t.getDefaultChain());case"wallet_getCapabilities":return yield t.getCapabilities(e);case"wallet_getCallsStatus":return yield t.getCallStatus(e)}return t.namespace.methods.includes(e.request.method)?yield t.client.request(e):t.getHttpProvider().request(e.request)})()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Ve(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.k(i,Y("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(en(t));e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){var t=this;return(0,f.Z)(function*(){var i,s;let o=e.request.params?null==(i=e.request.params[0])?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const a=parseInt(o,16);if(t.isChainApproved(a))t.setDefaultChain(`${a}`);else{if(!t.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);yield t.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:o}]},chainId:null==(s=t.namespace.chains)?void 0:s[0]}),t.setDefaultChain(`${a}`)}return null})()}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}getCapabilities(e){var t=this;return(0,f.Z)(function*(){var i,s,o,a,c;const u=null==(s=null==(i=e.request)?void 0:i.params)?void 0:s[0],h=`${u}${((null==(a=null==(o=e.request)?void 0:o.params)?void 0:a[1])||[]).join(",")}`;if(!u)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const p=t.client.session.get(e.topic),g=(null==(c=p?.sessionProperties)?void 0:c.capabilities)||{};if(null!=g&&g[h])return g?.[h];const b=yield t.client.request(e);try{yield t.client.session.update(e.topic,{sessionProperties:ll(ul({},p.sessionProperties||{}),{capabilities:ll(ul({},g||{}),{[h]:b})})})}catch(y){console.warn("Failed to update session with capabilities",y)}return b})()}getCallStatus(e){var t=this;return(0,f.Z)(function*(){var i,s;const o=t.client.session.get(e.topic),a=null==(i=o.sessionProperties)?void 0:i.bundler_name;if(a){const u=t.getBundlerUrl(e.chainId,a);try{return yield t.getUserOperationReceipt(u,e)}catch(d){console.warn("Failed to fetch call status from bundler",d,u)}}const c=null==(s=o.sessionProperties)?void 0:s.bundler_url;if(c)try{return yield t.getUserOperationReceipt(c,e)}catch(u){console.warn("Failed to fetch call status from custom bundler",u,c)}if(t.namespace.methods.includes(e.request.method))return yield t.client.request(e);throw new Error("Fetching call status not approved by the wallet.")})()}getUserOperationReceipt(e,t){return(0,f.Z)(function*(){var i;const s=new URL(e),o=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,z.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!o.ok)throw new Error(`Failed to fetch user operation receipt - ${o.status}`);return yield o.json()})()}getBundlerUrl(e,t){return`${Iw}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var gD=Object.defineProperty,Rn=(r,e,t)=>((r,e,t)=>e in r?gD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class mD{constructor(e){Rn(this,"name","solana"),Rn(this,"client"),Rn(this,"httpProviders"),Rn(this,"events"),Rn(this,"namespace"),Rn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=en(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var _D=Object.defineProperty,Nn=(r,e,t)=>((r,e,t)=>e in r?_D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class vD{constructor(e){Nn(this,"name","cosmos"),Nn(this,"client"),Nn(this,"httpProviders"),Nn(this,"events"),Nn(this,"namespace"),Nn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=en(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var wD=Object.defineProperty,Tn=(r,e,t)=>((r,e,t)=>e in r?wD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class ED{constructor(e){Tn(this,"name","algorand"),Tn(this,"client"),Tn(this,"httpProviders"),Tn(this,"events"),Tn(this,"namespace"),Tn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Ve(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var xD=Object.defineProperty,Fn=(r,e,t)=>((r,e,t)=>e in r?xD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class CD{constructor(e){Fn(this,"name","cip34"),Fn(this,"client"),Fn(this,"httpProviders"),Fn(this,"events"),Fn(this,"namespace"),Fn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=en(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var PD=Object.defineProperty,jn=(r,e,t)=>((r,e,t)=>e in r?PD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class OD{constructor(e){jn(this,"name","elrond"),jn(this,"client"),jn(this,"httpProviders"),jn(this,"events"),jn(this,"namespace"),jn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=en(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var AD=Object.defineProperty,$n=(r,e,t)=>((r,e,t)=>e in r?AD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class ND{constructor(e){$n(this,"name","multiversx"),$n(this,"client"),$n(this,"httpProviders"),$n(this,"events"),$n(this,"namespace"),$n(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=en(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var TD=Object.defineProperty,Un=(r,e,t)=>((r,e,t)=>e in r?TD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class jD{constructor(e){Un(this,"name","near"),Un(this,"client"),Un(this,"httpProviders"),Un(this,"events"),Un(this,"namespace"),Un(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ve(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace);return typeof i>"u"?void 0:new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var $D=Object.defineProperty,Bn=(r,e,t)=>((r,e,t)=>e in r?$D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class BD{constructor(e){Bn(this,"name","tezos"),Bn(this,"client"),Bn(this,"httpProviders"),Bn(this,"events"),Bn(this,"namespace"),Bn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ve(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace);return typeof i>"u"?void 0:new Je.r(new ot.Z(i))}}var qD=Object.defineProperty,qn=(r,e,t)=>((r,e,t)=>e in r?qD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class kD{constructor(e){qn(this,"name",Cn),qn(this,"client"),qn(this,"httpProviders"),qn(this,"events"),qn(this,"namespace"),qn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Ye_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(s=>{const o=qt(s);i[`${o.namespace}:${o.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ve(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Je.r(new ot.Z(i,Y("disableProviderPing")))}}var LD=Object.defineProperty,zD=Object.defineProperties,ZD=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,VD=Object.prototype.hasOwnProperty,HD=Object.prototype.propertyIsEnumerable,bo=(r,e,t)=>e in r?LD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ai=(r,e)=>{for(var t in e||(e={}))VD.call(e,t)&&bo(r,t,e[t]);if(dl)for(var t of dl(e))HD.call(e,t)&&bo(r,t,e[t]);return r},vo=(r,e)=>zD(r,ZD(e)),Xe=(r,e,t)=>bo(r,"symbol"!=typeof e?e+"":e,t);class wo{constructor(e){Xe(this,"client"),Xe(this,"namespaces"),Xe(this,"optionalNamespaces"),Xe(this,"sessionProperties"),Xe(this,"scopedProperties"),Xe(this,"events",new(ki())),Xe(this,"rpcProviders",{}),Xe(this,"session"),Xe(this,"providerOpts"),Xe(this,"logger"),Xe(this,"uri"),Xe(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,K.gw)((0,K.jI)({level:e?.logger||"error"})),this.disableProviderPing=e?.disableProviderPing||!1}static init(e){return(0,f.Z)(function*(){const t=new wo(e);return yield t.initialize(),t})()}request(e,t,i){var s=this;return(0,f.Z)(function*(){const[o,a]=s.validateChain(t);if(!s.session)throw new Error("Please call connect() before request()");return yield s.getProvider(o).request({request:ai({},e),chainId:`${o}:${a}`,topic:s.session.topic,expiry:i})})()}sendAsync(e,t,i,s){const o=(new Date).getTime();this.request(e,i,s).then(a=>t(null,(0,z.formatJsonRpcResult)(o,a))).catch(a=>t(a,void 0))}enable(){var e=this;return(0,f.Z)(function*(){if(!e.client)throw new Error("Sign Client not initialized");return e.session||(yield e.connect({namespaces:e.namespaces,optionalNamespaces:e.optionalNamespaces,sessionProperties:e.sessionProperties,scopedProperties:e.scopedProperties})),yield e.requestAccounts()})()}disconnect(){var e=this;return(0,f.Z)(function*(){var t;if(!e.session)throw new Error("Please call connect() before enable()");yield e.client.disconnect({topic:null==(t=e.session)?void 0:t.topic,reason:te("USER_DISCONNECTED")}),yield e.cleanup()})()}connect(e){var t=this;return(0,f.Z)(function*(){if(!t.client)throw new Error("Sign Client not initialized");if(t.setNamespaces(e),yield t.cleanupPendingPairings(),!e.skipPairing)return yield t.pair(e.pairingTopic)})()}authenticate(e,t){var i=this;return(0,f.Z)(function*(){if(!i.client)throw new Error("Sign Client not initialized");i.setNamespaces(e),yield i.cleanupPendingPairings();const{uri:s,response:o}=yield i.client.authenticate(e,t);s&&(i.uri=s,i.events.emit("display_uri",s));const a=yield o();if(i.session=a.session,i.session){const c=ol(i.session.namespaces);i.namespaces=oi(i.namespaces,c),yield i.persist("namespaces",i.namespaces),i.onConnect()}return a})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}pair(e){var t=this;return(0,f.Z)(function*(){const{uri:i,approval:s}=yield t.client.connect({pairingTopic:e,requiredNamespaces:t.namespaces,optionalNamespaces:t.optionalNamespaces,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties});i&&(t.uri=i,t.events.emit("display_uri",i));const o=yield s();t.session=o;const a=ol(o.namespaces);return t.namespaces=oi(t.namespaces,a),yield t.persist("namespaces",t.namespaces),yield t.persist("optionalNamespaces",t.optionalNamespaces),t.onConnect(),t.session})()}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),o=this.getProvider(i);o.name===Cn?o.setDefaultChain(`${i}:${s}`,t):o.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}cleanupPendingPairings(e={}){var t=this;return(0,f.Z)(function*(){t.logger.info("Cleaning up inactive pairings...");const i=t.client.pairing.getAll();if(nt(i)){for(const s of i)e.deletePairings?t.client.core.expirer.set(s.topic,0):yield t.client.core.relayer.subscriber.unsubscribe(s.topic);t.logger.info(`Inactive pairings cleared: ${i.length}`)}})()}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}checkStorage(){var e=this;return(0,f.Z)(function*(){e.namespaces=(yield e.getFromStore("namespaces"))||{},e.optionalNamespaces=(yield e.getFromStore("optionalNamespaces"))||{},e.session&&e.createProviders()})()}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized"),yield e.createClient(),yield e.checkStorage(),e.registerEventListeners()})()}createClient(){var e=this;return(0,f.Z)(function*(){var t,i;if(e.client=e.providerOpts.client||(yield ho.init({core:e.providerOpts.core,logger:e.providerOpts.logger||"error",relayUrl:e.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:e.providerOpts.projectId,metadata:e.providerOpts.metadata,storageOptions:e.providerOpts.storageOptions,storage:e.providerOpts.storage,name:e.providerOpts.name,customStoragePrefix:e.providerOpts.customStoragePrefix,telemetryEnabled:e.providerOpts.telemetryEnabled})),e.providerOpts.session)try{e.session=e.client.session.get(e.providerOpts.session.topic)}catch(s){throw e.logger.error("Failed to get session",s),new Error(`The provided session: ${null==(i=null==(t=e.providerOpts)?void 0:t.session)?void 0:i.topic} doesn't exist in the Sign client`)}else{const s=e.client.session.getAll();e.session=s[0]}e.logger.trace("SignClient Initialized")})()}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>wn(t)))];mo("client",this.client),mo("events",this.events),mo("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=function sD(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const o=e.namespaces[s].accounts;i.push(...o)}),i}(t,this.session),s=rl(i),o=oi(this.namespaces,this.optionalNamespaces),a=vo(ai({},o[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new fD({namespace:a});break;case"algorand":this.rpcProviders[t]=new ED({namespace:a});break;case"solana":this.rpcProviders[t]=new mD({namespace:a});break;case"cosmos":this.rpcProviders[t]=new vD({namespace:a});break;case"polkadot":this.rpcProviders[t]=new cD({namespace:a});break;case"cip34":this.rpcProviders[t]=new CD({namespace:a});break;case"elrond":this.rpcProviders[t]=new OD({namespace:a});break;case"multiversx":this.rpcProviders[t]=new ND({namespace:a});break;case"near":this.rpcProviders[t]=new jD({namespace:a});break;case"tezos":this.rpcProviders[t]=new BD({namespace:a});break;default:this.rpcProviders[Cn]?this.rpcProviders[Cn].updateNamespace(a):this.rpcProviders[Cn]=new kD({namespace:a})}})}registerEventListeners(){var e=this;if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{var i;const{topic:s}=t;s===(null==(i=this.session)?void 0:i.topic)&&this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{var i;const{params:s,topic:o}=t;if(o!==(null==(i=this.session)?void 0:i.topic))return;const{event:a}=s;if("accountsChanged"===a.name){const c=a.data;c&&nt(c)&&this.events.emit("accountsChanged",c.map(sl))}else if("chainChanged"===a.name){const c=s.chainId,u=s.event.data,d=wn(c),h=yo(c)!==yo(u)?`${d}:${yo(u)}`:c;this.onChainChanged(h)}else this.events.emit(a.name,a.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:i})=>{var s,o;if(t!==(null==(s=this.session)?void 0:s.topic))return;const{namespaces:a}=i,c=null==(o=this.client)?void 0:o.session.get(t);this.session=vo(ai({},c),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:i})}),this.client.on("session_delete",function(){var t=(0,f.Z)(function*(i){var s;i.topic===(null==(s=e.session)?void 0:s.topic)&&(yield e.cleanup(),e.events.emit("session_delete",i),e.events.emit("disconnect",vo(ai({},te("USER_DISCONNECTED")),{data:i.topic})))});return function(i){return t.apply(this,arguments)}}()),this.on(Ye_DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Cn]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:o}=e;this.optionalNamespaces=oi(t,i),this.sessionProperties=s,this.scopedProperties=o}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>wn(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=wn(Object.keys(this.namespaces)[0]);return[s,this.rpcProviders[s].getDefaultChain()]}requestAccounts(){var e=this;return(0,f.Z)(function*(){const[t]=e.validateChain();return yield e.getProvider(t).requestAccounts()})()}onChainChanged(e,t=!1){var i=this;return(0,f.Z)(function*(){if(!i.namespaces)return;const[s,o]=i.validateChain(e);if(!o)return;i.updateNamespaceChain(s,o),i.events.emit("chainChanged",o);const a=i.getProvider(s).getDefaultChain();t||i.getProvider(s).setDefaultChain(o),i.emitAccountsChangedOnChainChange({namespace:s,previousChainId:a,newChainId:e}),yield i.persist("namespaces",i.namespaces)})()}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var s,o;try{if(t===i)return;const a=null==(o=null==(s=this.session)?void 0:s.namespaces[e])?void 0:o.accounts;if(!a)return;const c=a.filter(u=>u.includes(`${i}:`)).map(sl);if(!nt(c))return;this.events.emit("accountsChanged",c)}catch(a){this.logger.warn("Failed to emit accountsChanged on chain change",a)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}cleanup(){var e=this;return(0,f.Z)(function*(){e.namespaces=void 0,e.optionalNamespaces=void 0,e.sessionProperties=void 0,yield e.deleteFromStore("namespaces"),yield e.deleteFromStore("optionalNamespaces"),yield e.deleteFromStore("sessionProperties"),e.session=void 0,yield e.cleanupPendingPairings({deletePairings:!0}),yield e.cleanupStorage()})()}persist(e,t){var i=this;return(0,f.Z)(function*(){var s;const o=(null==(s=i.session)?void 0:s.topic)||"";yield i.client.core.storage.setItem(`${ii}/${e}${o}`,t)})()}getFromStore(e){var t=this;return(0,f.Z)(function*(){var i;const s=(null==(i=t.session)?void 0:i.topic)||"";return yield t.client.core.storage.getItem(`${ii}/${e}${s}`)})()}deleteFromStore(e){var t=this;return(0,f.Z)(function*(){var i;const s=(null==(i=t.session)?void 0:i.topic)||"";yield t.client.core.storage.removeItem(`${ii}/${e}${s}`)})()}cleanupStorage(){var e=this;return(0,f.Z)(function*(){var t;try{if((null==(t=e.client)?void 0:t.session.length)>0)return;const i=yield e.client.core.storage.getKeys();for(const s of i)s.startsWith(ii)&&(yield e.client.core.storage.removeItem(s))}catch(i){e.logger.warn("Failed to cleanup storage",i)}})()}}const KD=wo,ci=["eth_sendTransaction","personal_sign"],hl=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],ui=["chainChanged","accountsChanged"],pl=["chainChanged","accountsChanged","message","disconnect","connect"],YD=function(){var r=(0,f.Z)(function*(){const{createAppKit:e}=yield T.e(1171).then(T.bind(T,91171));return e});return function(){return r.apply(this,arguments)}}();var XD=Object.defineProperty,eE=Object.defineProperties,tE=Object.getOwnPropertyDescriptors,fl=Object.getOwnPropertySymbols,nE=Object.prototype.hasOwnProperty,rE=Object.prototype.propertyIsEnumerable,Do=(r,e,t)=>e in r?XD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tn=(r,e)=>{for(var t in e||(e={}))nE.call(e,t)&&Do(r,t,e[t]);if(fl)for(var t of fl(e))rE.call(e,t)&&Do(r,t,e[t]);return r},yr=(r,e)=>eE(r,tE(e)),He=(r,e,t)=>Do(r,"symbol"!=typeof e?e+"":e,t);function li(r){return Number(r[0].split(":")[1])}function di(r){return`0x${r.toString(16)}`}class hi{constructor(){He(this,"events",new gt.EventEmitter),He(this,"namespace","eip155"),He(this,"accounts",[]),He(this,"signer"),He(this,"chainId",1),He(this,"modal"),He(this,"rpc"),He(this,"STORAGE_KEY","wc@2:ethereum_provider:"),He(this,"on",(e,t)=>(this.events.on(e,t),this)),He(this,"once",(e,t)=>(this.events.once(e,t),this)),He(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),He(this,"off",(e,t)=>(this.events.off(e,t),this)),He(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static init(e){return(0,f.Z)(function*(){const t=new hi;return yield t.initialize(e),t})()}request(e,t){var i=this;return(0,f.Z)(function*(){return yield i.signer.request(e,i.formatChainId(i.chainId),t)})()}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}enable(){var e=this;return(0,f.Z)(function*(){return e.session||(yield e.connect()),yield e.request({method:"eth_requestAccounts"})})()}connect(e){var t=this;return(0,f.Z)(function*(){var i;if(!t.signer.client)throw new Error("Provider not initialized. Call init() first");t.loadConnectOpts(e);const{required:s,optional:o}=function iE(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:o,optionalEvents:a,rpcMap:c}=r;if(!nt(e))throw new Error("Invalid chains");const u={chains:e,methods:i||ci,events:o||ui,rpcMap:tn({},e.length?{[li(e)]:c[li(e)]}:{})},d=o?.filter(b=>!ui.includes(b)),h=i?.filter(b=>!ci.includes(b));if(!(t||a||s||null!=d&&d.length||null!=h&&h.length))return{required:e.length?u:void 0};const g={chains:[...new Set(d?.length&&h?.length||!t?u.chains.concat(t||[]):t)],methods:[...new Set(u.methods.concat(null!=s&&s.length?s:hl))],events:[...new Set(u.events.concat(null!=a&&a.length?a:pl))],rpcMap:c};return{required:e.length?u:void 0,optional:t.length?g:void 0}}(t.rpc);try{const a=yield new Promise(function(){var u=(0,f.Z)(function*(d,h){var p,g;t.rpc.showQrModal&&(null==(p=t.modal)||p.open(),null==(g=t.modal)||g.subscribeState(y=>{!y.open&&!t.signer.session&&(t.signer.abortPairingAttempt(),h(new Error("Connection request reset. Please try again.")))}));const b=null!=e&&e.scopedProperties?{[t.namespace]:e.scopedProperties}:void 0;yield t.signer.connect(yr(tn({namespaces:tn({},s&&{[t.namespace]:s})},o&&{optionalNamespaces:{[t.namespace]:o}}),{pairingTopic:e?.pairingTopic,scopedProperties:b})).then(y=>{d(y)}).catch(y=>{var m;null==(m=t.modal)||m.showErrorMessage("Unable to connect"),h(new Error(y.message))})});return function(d,h){return u.apply(this,arguments)}}());if(!a)return;const c=na(a.namespaces,[t.namespace]);t.setChainIds(t.rpc.chains.length?t.rpc.chains:c),t.setAccounts(c),t.events.emit("connect",{chainId:di(t.chainId)})}catch(a){throw t.signer.logger.error(a),a}finally{null==(i=t.modal)||i.close()}})()}authenticate(e,t){var i=this;return(0,f.Z)(function*(){var s;if(!i.signer.client)throw new Error("Provider not initialized. Call init() first");i.loadConnectOpts({chains:e?.chains});try{const o=yield new Promise(function(){var c=(0,f.Z)(function*(u,d){var h,p;i.rpc.showQrModal&&(null==(h=i.modal)||h.open(),null==(p=i.modal)||p.subscribeState(g=>{!g.open&&!i.signer.session&&(i.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),yield i.signer.authenticate(yr(tn({},e),{chains:i.rpc.chains}),t).then(g=>{u(g)}).catch(g=>{var b;null==(b=i.modal)||b.showErrorMessage("Unable to connect"),d(new Error(g.message))})});return function(u,d){return c.apply(this,arguments)}}()),a=o.session;if(a){const c=na(a.namespaces,[i.namespace]);i.setChainIds(i.rpc.chains.length?i.rpc.chains:c),i.setAccounts(c),i.events.emit("connect",{chainId:di(i.chainId)})}return o}catch(o){throw i.signer.logger.error(o),o}finally{null==(s=i.modal)||s.close()}})()}disconnect(){var e=this;return(0,f.Z)(function*(){e.session&&(yield e.signer.disconnect()),e.reset()})()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;"accountsChanged"===i.name?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===i.name?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",di(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",yr(tn({},te("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",di(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=null!=(t=e?.chains)?t:[],o=null!=(i=e?.optionalChains)?i:[],a=s.concat(o);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const c=s.length?e?.methods||ci:[],u=s.length?e?.events||ui:[],d=e?.optionalMethods||[],h=e?.optionalEvents||[],p=e?.rpcMap||this.buildRpcMap(a,e.projectId),g=e?.qrModalOptions||void 0;return{chains:s?.map(b=>this.formatChainId(b)),optionalChains:o.map(b=>this.formatChainId(b)),methods:c,events:u,optionalMethods:d,optionalEvents:h,rpcMap:p,showQrModal:!(null==e||!e.showQrModal),qrModalOptions:g,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}initialize(e){var t=this;return(0,f.Z)(function*(){if(t.rpc=t.getRpcConfig(e),t.chainId=t.rpc.chains.length?li(t.rpc.chains):li(t.rpc.optionalChains),t.signer=yield KD.init({projectId:t.rpc.projectId,metadata:t.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),t.registerEventListeners(),yield t.loadPersistedSession(),t.rpc.showQrModal){let i;try{const s=yield YD(),{convertWCMToAppKitOptions:o}=yield Promise.resolve().then(function(){return gE}),a=o(yr(tn({},t.rpc.qrModalOptions),{chains:[...new Set([...t.rpc.chains,...t.rpc.optionalChains])],metadata:t.rpc.metadata,projectId:t.rpc.projectId}));if(!a.networks.length)throw new Error("No networks found for WalletConnect\xb7");i=s(yr(tn({},a),{universalProvider:t.signer,manualWCControl:!0}))}catch(s){throw console.warn(s),new Error("To use QR modal, please install @reown/appkit package")}if(i)try{t.modal=i}catch(s){throw t.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}})()}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&nt(t)&&(this.rpc.chains=t.map(o=>this.formatChainId(o)),t.forEach(o=>{this.rpc.rpcMap[o]=s?.[o]||this.getRpcUrl(o)})),i&&nt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(o=>this.formatChainId(o)),i.forEach(o=>{this.rpc.rpcMap[o]=s?.[o]||this.getRpcUrl(o)}))}getRpcUrl(e,t){var i;return(null==(i=this.rpc.rpcMap)?void 0:i[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}loadPersistedSession(){var e=this;return(0,f.Z)(function*(){if(e.session)try{const t=yield e.signer.client.core.storage.getItem(`${e.STORAGE_KEY}/chainId`),i=e.session.namespaces[`${e.namespace}:${t}`]?e.session.namespaces[`${e.namespace}:${t}`]:e.session.namespaces[e.namespace];e.setChainIds(t?[e.formatChainId(t)]:i?.accounts),e.setAccounts(i?.accounts)}catch(t){e.signer.logger.error("Failed to load persisted session, clearing state..."),e.signer.logger.error(t),yield e.disconnect().catch(i=>e.signer.logger.warn(i))}})()}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const sE=hi;var oE=Object.defineProperty,aE=Object.defineProperties,cE=Object.getOwnPropertyDescriptors,gl=Object.getOwnPropertySymbols,uE=Object.prototype.hasOwnProperty,lE=Object.prototype.propertyIsEnumerable,yl=(r,e,t)=>e in r?oE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ml=(r,e)=>{for(var t in e||(e={}))uE.call(e,t)&&yl(r,t,e[t]);if(gl)for(var t of gl(e))lE.call(e,t)&&yl(r,t,e[t]);return r},dE=(r,e)=>aE(r,cE(e));function hE(r){if(r)return{"--w3m-font-family":r["--wcm-font-family"],"--w3m-accent":r["--wcm-accent-color"],"--w3m-color-mix":r["--wcm-background-color"],"--w3m-z-index":r["--wcm-z-index"]?Number(r["--wcm-z-index"]):void 0,"--w3m-qr-color":r["--wcm-accent-color"],"--w3m-font-size-master":r["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":r["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const pE=r=>{const[e,t]=r.split(":");return _l({id:t,caipNetworkId:r,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function _l(r){return ml({formatters:void 0,fees:void 0,serializers:void 0},r)}var gE=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function fE(r){var e,t,i,s,o,a,c;const u=null==(e=r.chains)?void 0:e.map(pE).filter(Boolean);if(0===u.length)throw new Error("At least one chain must be specified");const d=u.find(p=>{var g;return p.id===(null==(g=r.defaultChain)?void 0:g.id)}),h={projectId:r.projectId,networks:u,themeMode:r.themeMode,themeVariables:hE(r.themeVariables),chainImages:r.chainImages,connectorImages:r.walletImages,defaultNetwork:d,metadata:dE(ml({},r.metadata),{name:(null==(t=r.metadata)?void 0:t.name)||"WalletConnect",description:(null==(i=r.metadata)?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:(null==(s=r.metadata)?void 0:s.url)||"https://walletconnect.org",icons:(null==(o=r.metadata)?void 0:o.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:"NONE"===r.explorerRecommendedWalletIds?[]:Array.isArray(r.explorerRecommendedWalletIds)?r.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===r.explorerExcludedWalletIds?[]:Array.isArray(r.explorerExcludedWalletIds)?r.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(a=r.mobileWallets)&&a.length||null!=(c=r.desktopWallets)&&c.length){const p=[...(r.mobileWallets||[]).map(y=>({id:y.id,name:y.name,links:y.links})),...(r.desktopWallets||[]).map(y=>({id:y.id,name:y.name,links:{native:y.links.native,universal:y.links.universal}}))],g=[...h.featuredWalletIds||[],...h.excludeWalletIds||[]],b=p.filter(y=>!g.includes(y.id));b.length&&(h.customWallets=b)}return h},defineChain:_l})}}]);