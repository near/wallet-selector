"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[8944],{88944:(W0,Vs,B)=>{B.r(Vs),B.d(Vs,{EthereumProvider:()=>F0,OPTIONAL_EVENTS:()=>wu,OPTIONAL_METHODS:()=>bu,REQUIRED_EVENTS:()=>Wr,REQUIRED_METHODS:()=>Gr,default:()=>Yr});var Xr={};B.r(Xr),B.d(Xr,{identity:()=>hl});var ei={};B.r(ei),B.d(ei,{base2:()=>pl});var ti={};B.r(ti),B.d(ti,{base8:()=>fl});var ni={};B.r(ni),B.d(ni,{base10:()=>gl});var ri={};B.r(ri),B.d(ri,{base16:()=>yl,base16upper:()=>ml});var ii={};B.r(ii),B.d(ii,{base32:()=>Bn,base32hex:()=>wl,base32hexpad:()=>El,base32hexpadupper:()=>Dl,base32hexupper:()=>xl,base32pad:()=>vl,base32padupper:()=>bl,base32upper:()=>_l,base32z:()=>Il});var si={};B.r(si),B.d(si,{base36:()=>Pl,base36upper:()=>Sl});var oi={};B.r(oi),B.d(oi,{base58btc:()=>yt,base58flickr:()=>Cl});var ai={};B.r(ai),B.d(ai,{base64:()=>Ol,base64pad:()=>Al,base64url:()=>Rl,base64urlpad:()=>Nl});var ci={};B.r(ci),B.d(ci,{base256emoji:()=>ql});var ui={};B.r(ui),B.d(ui,{sha256:()=>sd,sha512:()=>od});var li={};B.r(li),B.d(li,{identity:()=>cd});var di={};B.r(di),B.d(di,{code:()=>ld,decode:()=>hd,encode:()=>dd,name:()=>ud});var hi={};B.r(hi),B.d(hi,{code:()=>yd,decode:()=>_d,encode:()=>md,name:()=>gd});var f=B(49671),pt=B(82016),pi=B.n(pt),Su=B(11653),j=B(35409),ft=B(20439),Cu=B(66534);let dr={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:"viem@2.23.2"};class $t extends Error{constructor(e,t={}){const i=t.cause instanceof $t?t.cause.details:t.cause?.message?t.cause.message:t.details,s=t.cause instanceof $t&&t.cause.docsPath||t.docsPath,o=dr.getDocsUrl?.({...t,docsPath:s});super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...i?[`Details: ${i}`]:[],...dr.version?[`Version: ${dr.version}`]:[]].join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version="2.23.2"}walk(e){return Ks(this,e)}}function Ks(r,e){return e?.(r)?r:r&&"object"==typeof r&&"cause"in r&&void 0!==r.cause?Ks(r.cause,e):e?null:r}function qn(r,{strict:e=!0}={}){return!(!r||"string"!=typeof r)&&(e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x"))}class Gs extends $t{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Xt(r,{dir:e,size:t=32}={}){return"string"==typeof r?function Ou(r,{dir:e,size:t=32}={}){if(null===t)return r;const i=r.replace("0x","");if(i.length>2*t)throw new Gs({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i["right"===e?"padEnd":"padStart"](2*t,"0")}`}(r,{dir:e,size:t}):function Au(r,{dir:e,size:t=32}={}){if(null===t)return r;if(r.length>t)throw new Gs({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const o="right"===e;i[o?s:t-s-1]=r[o?s:r.length-s-1]}return i}(r,{dir:e,size:t})}class Ru extends $t{constructor({max:e,min:t,signed:i,size:s,value:o}){super(`Number "${o}" is not in safe ${s?`${8*s}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class Nu extends $t{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Ws(r){return qn(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}function It(r,{size:e}){if(Ws(r)>e)throw new Nu({givenSize:Ws(r),maxSize:e})}function hr(r,e={}){const{signed:t}=e;e.size&&It(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2;return i<=(1n<<8n*BigInt(s)-1n)-1n?i:i-BigInt(`0x${"f".padStart(2*s,"f")}`)-1n}function Js(r,e={}){return Number(hr(r,e))}const ju=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function fi(r,e={}){return"number"==typeof r||"bigint"==typeof r?Ys(r,e):"string"==typeof r?function Uu(r,e={}){const t=qu.encode(r);return Qs(t,e)}(r,e):"boolean"==typeof r?function Fu(r,e={}){const t=`0x${Number(r)}`;return"number"==typeof e.size?(It(t,{size:e.size}),Xt(t,{size:e.size})):t}(r,e):Qs(r,e)}function Qs(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=ju[r[s]];const i=`0x${t}`;return"number"==typeof e.size?(It(i,{size:e.size}),Xt(i,{dir:"right",size:e.size})):i}function Ys(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let o;i?o=t?(1n<<8n*BigInt(i)-1n)-1n:2n**(8n*BigInt(i))-1n:"number"==typeof r&&(o=BigInt(Number.MAX_SAFE_INTEGER));const a="bigint"==typeof o&&t?-o-1n:0;if(o&&s>o||s<a){const u="bigint"==typeof r?"n":"";throw new Ru({max:o?`${o}${u}`:void 0,min:`${a}${u}`,signed:t,size:i,value:`${r}${u}`})}const c=`0x${(t&&s<0?(1n<<BigInt(8*i))+BigInt(s):s).toString(16)}`;return i?Xt(c,{size:i}):c}const qu=new TextEncoder;const ku=new TextEncoder;function Bu(r,e={}){return"number"==typeof r||"bigint"==typeof r?function Lu(r,e){const t=Ys(r,e);return eo(t)}(r,e):"boolean"==typeof r?function Mu(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),"number"==typeof e.size?(It(t,{size:e.size}),Xt(t,{size:e.size})):t}(r,e):qn(r)?eo(r,e):to(r,e)}const gt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Xs(r){return r>=gt.zero&&r<=gt.nine?r-gt.zero:r>=gt.A&&r<=gt.F?r-(gt.A-10):r>=gt.a&&r<=gt.f?r-(gt.a-10):void 0}function eo(r,e={}){let t=r;e.size&&(It(t,{size:e.size}),t=Xt(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=Xs(i.charCodeAt(c++)),d=Xs(i.charCodeAt(c++));if(void 0===u||void 0===d)throw new $t(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=16*u+d}return o}function to(r,e={}){const t=ku.encode(r);return"number"==typeof e.size?(It(t,{size:e.size}),Xt(t,{dir:"right",size:e.size})):t}var zu=B(65591);function no(r,e){const t=e||"hex",i=(0,zu.fr)(qn(r,{strict:!1})?Bu(r):r);return"bytes"===t?i:fi(i)}class Zu extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const gi=new Zu(8192);function ro(r,e){if(gi.has(`${r}.${e}`))return gi.get(`${r}.${e}`);const t=e?`${e}${r.toLowerCase()}`:r.substring(2).toLowerCase(),i=no(to(t),"bytes"),s=(e?t.substring(`${e}0x`.length):t).split("");for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&s[a]&&(s[a]=s[a].toUpperCase()),(15&i[a>>1])>=8&&s[a+1]&&(s[a+1]=s[a+1].toUpperCase());const o=`0x${s.join("")}`;return gi.set(`${r}.${e}`,o),o}function yi(){return(yi=(0,f.Z)(function*({hash:r,signature:e}){const t=qn(r)?r:fi(r),{secp256k1:i}=yield B.e(8195).then(B.bind(B,88195));return`0x${(()=>{if("object"==typeof e&&"r"in e&&"s"in e){const{r:d,s:h,v:p,yParity:g}=e,y=io(Number(g??p));return new i.Signature(hr(d),hr(h)).addRecoveryBit(y)}const a=qn(e)?e:fi(e),u=io(Js(`0x${a.slice(130)}`));return i.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(u)})().recoverPublicKey(t.substring(2)).toHex(!1)}`})).apply(this,arguments)}function io(r){if(0===r||1===r)return r;if(27===r)return 0;if(28===r)return 1;throw new Error("Invalid yParityOrV value")}function mi(){return mi=(0,f.Z)(function*({hash:r,signature:e}){return function Vu(r){return ro(`0x${no(`0x${r.substring(4)}`).substring(26)}`)}(yield function Hu(r){return yi.apply(this,arguments)}({hash:r,signature:e}))}),mi.apply(this,arguments)}const Wu=function Gu(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let d=0;d<e.length;d++)e[d]=255;for(let d=0;d<r.length;d++){const h=r.charAt(d),p=h.charCodeAt(0);if(255!==e[p])throw new TypeError(h+" is ambiguous");e[p]=d}const t=r.length,i=r.charAt(0),s=Math.log(t)/Math.log(256),o=Math.log(256)/Math.log(t);function c(d){if("string"!=typeof d)throw new TypeError("Expected String");if(0===d.length)return new Uint8Array;let h=0,p=0,g=0;for(;d[h]===i;)p++,h++;const m=(d.length-h)*s+1>>>0,y=new Uint8Array(m);for(;d[h];){let w=e[d.charCodeAt(h)];if(255===w)return;let E=0;for(let x=m-1;(0!==w||E<g)&&-1!==x;x--,E++)w+=t*y[x]>>>0,y[x]=w%256>>>0,w=w/256>>>0;if(0!==w)throw new Error("Non-zero carry");g=E,h++}let v=m-g;for(;v!==m&&0===y[v];)v++;const _=new Uint8Array(p+(m-v));let b=p;for(;v!==m;)_[b++]=y[v++];return _}return{encode:function a(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===d.length)return"";let h=0,p=0,g=0;const m=d.length;for(;g!==m&&0===d[g];)g++,h++;const y=(m-g)*o+1>>>0,v=new Uint8Array(y);for(;g!==m;){let w=d[g],E=0;for(let x=y-1;(0!==w||E<p)&&-1!==x;x--,E++)w+=256*v[x]>>>0,v[x]=w%t>>>0,w=w/t>>>0;if(0!==w)throw new Error("Non-zero carry");p=E,g++}let _=y-p;for(;_!==y&&0===v[_];)_++;let b=i.repeat(h);for(;_<y;++_)b+=r.charAt(v[_]);return b},decodeUnsafe:c,decode:function u(d){const h=c(d);if(h)return h;throw new Error("Non-base"+t+" character")}}};const Qu=Wu("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var jt=B(21164);function so(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Un(r,e){e||(e=r.reduce((s,o)=>s+o.length,0));const t=so(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}var Xu=function Yu(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=s}var c=r.length,u=r.charAt(0),d=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function g(y){if("string"!=typeof y)throw new TypeError("Expected String");if(0===y.length)return new Uint8Array;var v=0;if(" "!==y[v]){for(var _=0,b=0;y[v]===u;)_++,v++;for(var w=(y.length-v)*d+1>>>0,E=new Uint8Array(w);y[v];){var x=t[y.charCodeAt(v)];if(255===x)return;for(var C=0,P=w-1;(0!==x||C<b)&&-1!==P;P--,C++)x+=c*E[P]>>>0,E[P]=x%256>>>0,x=x/256>>>0;if(0!==x)throw new Error("Non-zero carry");b=C,v++}if(" "!==y[v]){for(var D=w-b;D!==w&&0===E[D];)D++;for(var I=new Uint8Array(_+(w-D)),A=_;D!==w;)I[A++]=E[D++];return I}}}return{encode:function p(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===y.length)return"";for(var v=0,_=0,b=0,w=y.length;b!==w&&0===y[b];)b++,v++;for(var E=(w-b)*h+1>>>0,x=new Uint8Array(E);b!==w;){for(var C=y[b],P=0,D=E-1;(0!==C||P<_)&&-1!==D;D--,P++)C+=256*x[D]>>>0,x[D]=C%c>>>0,C=C/c>>>0;if(0!==C)throw new Error("Non-zero carry");_=P,b++}for(var I=E-_;I!==E&&0===x[I];)I++;for(var A=u.repeat(v);I<E;++I)A+=r.charAt(x[I]);return A},decodeUnsafe:g,decode:function m(y){var v=g(y);if(v)return v;throw new Error(`Non-${e} character`)}}};const tl=Xu,en=(new Uint8Array(0),r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")});class ol{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class al{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return oo(this,e)}}class cl{constructor(e){this.decoders=e}or(e){return oo(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const oo=(r,e)=>new cl({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class ul{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new ol(e,t,i),this.decoder=new al(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const pr=({name:r,prefix:e,encode:t,decode:i})=>new ul(r,e,t,i),kn=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=tl(t,e);return pr({prefix:r,name:e,encode:i,decode:o=>en(s(o))})},we=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>pr({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let o="",a=0,c=0;for(let u=0;u<r.length;++u)for(c=c<<8|r[u],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),i)for(;o.length*t&7;)o+="=";return o})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let o=r.length;for(;"="===r[o-1];)--o;const a=new Uint8Array(o*t/8|0);let c=0,u=0,d=0;for(let h=0;h<o;++h){const p=s[r[h]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);u=u<<t|p,c+=t,c>=8&&(c-=8,a[d++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a})(s,i,t,r)}),hl=pr({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)}),pl=we({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),fl=we({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),gl=kn({prefix:"9",name:"base10",alphabet:"0123456789"}),yl=we({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ml=we({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Bn=we({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_l=we({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),vl=we({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bl=we({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),wl=we({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xl=we({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),El=we({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Dl=we({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Il=we({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Pl=kn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Sl=kn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),yt=kn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Cl=kn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ol=we({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Al=we({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rl=we({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Nl=we({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ao=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),Tl=ao.reduce((r,e,t)=>(r[t]=e,r),[]),$l=ao.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const ql=pr({prefix:"\u{1f680}",name:"base256emoji",encode:function jl(r){return r.reduce((e,t)=>e+=Tl[t],"")},decode:function Fl(r){const e=[];for(const t of r){const i=$l[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var Ul=function uo(r,e,t){e=e||[];for(var i=t=t||0;r>=Ml;)e[t++]=255&r|co,r/=128;for(;r&Bl;)e[t++]=255&r|co,r>>>=7;return e[t]=0|r,uo.bytes=t-i+1,e},co=128,Bl=-128,Ml=Math.pow(2,31);var Ll=function _i(r,i){var a,t=0,s=0,o=i=i||0,c=r.length;do{if(o>=c)throw _i.bytes=0,new RangeError("Could not decode varint");a=r[o++],t+=s<28?(a&lo)<<s:(a&lo)*Math.pow(2,s),s+=7}while(a>=zl);return _i.bytes=o-i,t},zl=128,lo=127;var Zl=Math.pow(2,7),Vl=Math.pow(2,14),Hl=Math.pow(2,21),Kl=Math.pow(2,28),Gl=Math.pow(2,35),Wl=Math.pow(2,42),Jl=Math.pow(2,49),Ql=Math.pow(2,56),Yl=Math.pow(2,63),ed={encode:Ul,decode:Ll,encodingLength:function(r){return r<Zl?1:r<Vl?2:r<Hl?3:r<Kl?4:r<Gl?5:r<Wl?6:r<Jl?7:r<Ql?8:r<Yl?9:10}};const fr=ed,gr=(r,e,t=0)=>(fr.encode(r,e,t),e),yr=r=>fr.encodingLength(r),mr=(r,e)=>{const t=e.byteLength,i=yr(r),s=i+yr(t),o=new Uint8Array(s+t);return gr(r,o,0),gr(t,o,i),o.set(e,s),new bi(r,t,e,o)};class bi{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const ho=({name:r,code:e,encode:t})=>new id(r,e,t);class id{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?mr(this.code,t):t.then(i=>mr(this.code,i))}throw Error("Unknown type, must be binary type")}}const po=r=>function(){var e=(0,f.Z)(function*(t){return new Uint8Array(yield crypto.subtle.digest(r,t))});return function(t){return e.apply(this,arguments)}}(),sd=ho({name:"sha2-256",code:18,encode:po("SHA-256")}),od=ho({name:"sha2-512",code:19,encode:po("SHA-512")}),go=en,cd={code:0,name:"identity",encode:go,digest:r=>mr(0,go(r))},ud="raw",ld=85,dd=r=>en(r),hd=r=>en(r),pd=new TextEncoder,fd=new TextDecoder,gd="json",yd=512,md=r=>pd.encode(JSON.stringify(r)),_d=r=>JSON.parse(fd.decode(r));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const _o={...Xr,...ei,...ti,...ni,...ri,...ii,...si,...oi,...ai,...ci};function vo(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const bo=vo("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),wi=vo("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=so((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),wo={utf8:bo,"utf-8":bo,hex:_o.base16,latin1:wi,ascii:wi,binary:wi,..._o};function He(r,e="utf8"){const t=wo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):globalThis.Buffer.from(r,"utf8")}function Te(r,e="utf8"){const t=wo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.encoder.encode(r).substring(1):globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8")}var Pd=B(24443);const br=":";function Ft(r){const[e,t]=r.split(br);return{namespace:e,reference:t}}function Do(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function xi(r,e){return r.includes(":")?[r]:e.chains||[]}var Nd=Object.defineProperty,Td=Object.defineProperties,$d=Object.getOwnPropertyDescriptors,Io=Object.getOwnPropertySymbols,jd=Object.prototype.hasOwnProperty,Fd=Object.prototype.propertyIsEnumerable,Po=(r,e,t)=>e in r?Nd(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,So=(r,e)=>{for(var t in e||(e={}))jd.call(e,t)&&Po(r,t,e[t]);if(Io)for(var t of Io(e))Fd.call(e,t)&&Po(r,t,e[t]);return r};const Ud="ReactNative",$e={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Bd="js";function wr(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Pt(){return!(0,ft.getDocument)()&&!!(0,ft.getNavigator)()&&navigator.product===Ud}function tn(){return!wr()&&!!(0,ft.getNavigator)()&&!!(0,ft.getDocument)()}function nn(){return Pt()?$e.reactNative:wr()?$e.node:tn()?$e.browser:$e.unknown}function Oo(){var r;try{return Pt()&&typeof global<"u"&&typeof(null==global?void 0:global.Application)<"u"?null==(r=global.Application)?void 0:r.applicationId:void 0}catch{return}}function Zd(r){var e,t;const i=Ao();try{return null!=r&&r.url&&i.url&&new URL(r.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),r.url=i.url),null!=(e=r?.icons)&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>""!==s)),((r,e)=>Td(r,$d(e)))(So(So({},i),r),{url:r?.url||i.url,name:r?.name||i.name,description:r?.description||i.description,icons:null!=(t=r?.icons)&&t.length&&r.icons.length>0?r.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),r||i}}function Ao(){return(0,Cu.D)()||{name:"",description:"",url:"",icons:[""]}}function Ro(r,e,t){const i=function Vd(){if(nn()===$e.reactNative&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"){const{OS:t,Version:i}=global.Platform;return[t,i].join("-")}const r=(0,Su.qY)();if(null===r)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return"browser"===r.type?[e,r.name,r.version].join("-"):[e,r.version].join("-")}(),s=function Hd(){var r;const e=nn();return e===$e.browser?[e,(null==(r=(0,ft.getLocation)())?void 0:r.host)||"unknown"].join(":"):e}();return[[r,e].join("-"),[Bd,t].join("-"),i,s].join("/")}function Kd({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:o,useOnCloseEvent:a,bundleId:c,packageName:u}){const d=t.split("?"),p={auth:s,ua:Ro(r,e,i),projectId:o,useOnCloseEvent:a||void 0,packageName:u||void 0,bundleId:c||void 0},g=function zd(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];void 0!==s&&t.set(i,s)}return t.toString()}(d[1]||"",p);return d[0]+"?"+g}function qt(r,e){return r.filter(t=>e.includes(t)).length===r.length}function Di(r){return Object.fromEntries(r.entries())}function Ii(r){return new Map(Object.entries(r))}function Ut(r=j.FIVE_MINUTES,e){const t=(0,j.toMiliseconds)(r||j.FIVE_MINUTES);let i,s,o,a;return{resolve:c=>{o&&i&&(clearTimeout(o),i(c),a=Promise.resolve(c))},reject:c=>{o&&s&&(clearTimeout(o),s(c))},done:()=>new Promise((c,u)=>{if(a)return c(a);o=setTimeout(()=>{const d=new Error(e);a=Promise.reject(d),u(d)},t),i=c,s=u})}}function St(r,e,t){return new Promise(function(){var i=(0,f.Z)(function*(s,o){const a=setTimeout(()=>o(new Error(t)),e);try{s(yield r)}catch(c){o(c)}clearTimeout(a)});return function(s,o){return i.apply(this,arguments)}}())}function No(r,e){if("string"==typeof e&&e.startsWith(`${r}:`))return e;if("topic"===r.toLowerCase()){if("string"!=typeof e)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}if("id"===r.toLowerCase()){if("number"!=typeof e)throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function To(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if("topic"===e&&"string"==typeof t)i.topic=t;else{if("id"!==e||!Number.isInteger(Number(t)))throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);i.id=Number(t)}return i}function de(r,e){return(0,j.fromMiliseconds)((e||Date.now())+(0,j.toMiliseconds)(r))}function Ct(r){return Date.now()>=(0,j.toMiliseconds)(r)}function ee(r,e){return`${r}${e?`:${e}`:""}`}function je(r=[],e=[]){return[...new Set([...r,...e])]}function Pi(){return(Pi=(0,f.Z)(function*({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s="string"==typeof t?JSON.parse(t):t,o=s?.href;if("string"!=typeof o)return;const a=function eh(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){s=`${s}${r.includes("?")?"&startapp=":"?startapp="}${function sh(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}(i,!0)}`}else s=`${s}/wc?${i}`;return s}(o,r,e),c=nn();if(c===$e.browser){if(null==(i=(0,ft.getDocument)())||!i.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function th(r){let e="_self";!function ih(){try{return window.self!==window.top}catch{return!1}}()?(function rh(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"):e="_top",window.open(r,e,"noreferrer noopener")}(a)}else c===$e.reactNative&&typeof(null==global?void 0:global.Linking)<"u"&&(yield global.Linking.openURL(a))}catch(s){console.error(s)}})).apply(this,arguments)}function Si(){return(Si=(0,f.Z)(function*(r,e){let t="";try{if(tn()&&(t=localStorage.getItem(e),t))return t;t=yield r.getItem(e)}catch(i){console.error(i)}return t})).apply(this,arguments)}function jo(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function Fo(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=16*Math.random()|0;return("x"===r?e:3&e|8).toString(16)})}function Ci(){return typeof process<"u"&&"true"===process.env.IS_VITEST}function qo(r){return Buffer.from(r,"base64").toString("utf-8")}function Ln(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function zn(r,...e){if(!function ah(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Oi(r){if("function"!=typeof r||"function"!=typeof r.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Ln(r.outputLen),Ln(r.blockLen)}function rn(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Uo(r,e){zn(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const xr=BigInt(2**32-1),ko=BigInt(32);function ch(r,e=!1){return e?{h:Number(r&xr),l:Number(r>>ko&xr)}:{h:0|Number(r>>ko&xr),l:0|Number(r&xr)}}const sn="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Ai(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function ot(r,e){return r<<32-e|r>>>e}const Bo=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function gh(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function Mo(r){for(let e=0;e<r.length;e++)r[e]=gh(r[e])}function on(r){return"string"==typeof r&&(r=function yh(r){if("string"!=typeof r)throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array((new TextEncoder).encode(r))}(r)),zn(r),r}class Ri{clone(){return this._cloneInto()}}function Lo(r){const e=i=>r().update(on(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function an(r=32){if(sn&&"function"==typeof sn.getRandomValues)return sn.getRandomValues(new Uint8Array(r));if(sn&&"function"==typeof sn.randomBytes)return sn.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const zo=[],Zo=[],Vo=[],_h=BigInt(0),Zn=BigInt(1),vh=BigInt(2),bh=BigInt(7),wh=BigInt(256),xh=BigInt(113);for(let r=0,e=Zn,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],zo.push(2*(5*i+t)),Zo.push((r+1)*(r+2)/2%64);let s=_h;for(let o=0;o<7;o++)e=(e<<Zn^(e>>bh)*xh)%wh,e&vh&&(s^=Zn<<(Zn<<BigInt(o))-Zn);Vo.push(s)}const[Eh,Dh]=function uh(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:o,l:a}=ch(r[s],e);[t[s],i[s]]=[o,a]}return[t,i]}(Vo,!0),Ho=(r,e,t)=>t>32?((r,e,t)=>e<<t-32|r>>>64-t)(r,e,t):((r,e,t)=>r<<t|e>>>32-t)(r,e,t),Ko=(r,e,t)=>t>32?((r,e,t)=>r<<t-32|e>>>64-t)(r,e,t):((r,e,t)=>e<<t|r>>>32-t)(r,e,t);class Ni extends Ri{constructor(e,t,i,s=!1,o=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ln(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function fh(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}(this.state)}keccak(){Bo||Mo(this.state32),function Ih(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let a=0;a<10;a++)t[a]=r[a]^r[a+10]^r[a+20]^r[a+30]^r[a+40];for(let a=0;a<10;a+=2){const c=(a+8)%10,u=(a+2)%10,d=t[u],h=t[u+1],p=Ho(d,h,1)^t[c],g=Ko(d,h,1)^t[c+1];for(let m=0;m<50;m+=10)r[a+m]^=p,r[a+m+1]^=g}let s=r[2],o=r[3];for(let a=0;a<24;a++){const c=Zo[a],u=Ho(s,o,c),d=Ko(s,o,c),h=zo[a];s=r[h],o=r[h+1],r[h]=u,r[h+1]=d}for(let a=0;a<50;a+=10){for(let c=0;c<10;c++)t[c]=r[a+c];for(let c=0;c<10;c++)r[a+c]^=~t[(c+2)%10]&t[(c+4)%10]}r[0]^=Eh[i],r[1]^=Dh[i]}t.fill(0)}(this.state32,this.rounds),Bo||Mo(this.state32),this.posOut=0,this.pos=0}update(e){rn(this);const{blockLen:t,state:i}=this,s=(e=on(e)).length;for(let o=0;o<s;){const a=Math.min(t-this.pos,s-o);for(let c=0;c<a;c++)i[this.pos++]^=e[o++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){rn(this,!1),zn(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,o=e.length;s<o;){this.posOut>=i&&this.keccak();const a=Math.min(i-this.posOut,o-s);e.set(t.subarray(this.posOut,this.posOut+a),s),this.posOut+=a,s+=a}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ln(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Uo(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:o,enableXOF:a}=this;return e||(e=new Ni(t,i,s,a,o)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=o,e.suffix=i,e.outputLen=s,e.enableXOF=a,e.destroyed=this.destroyed,e}}const Sh=(r=1,e=136,t=32,Lo(()=>new Ni(e,r,t))),Ch="https://rpc.walletconnect.org/v1";var r,e,t;function Go(r){const e=`\x19Ethereum Signed Message:\n${r.length}`,t=(new TextEncoder).encode(e+r);return"0x"+Buffer.from(Sh(t)).toString("hex")}function Ti(){return Ti=(0,f.Z)(function*(r,e,t,i,s,o){switch(t.t){case"eip191":return yield function Ah(r,e,t){return $i.apply(this,arguments)}(r,e,t.s);case"eip1271":return yield function Rh(r,e,t,i,s,o){return ji.apply(this,arguments)}(r,e,t.s,i,s,o);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}),Ti.apply(this,arguments)}function $i(){return $i=(0,f.Z)(function*(r,e,t){return(yield function Ku(r){return mi.apply(this,arguments)}({hash:Go(e),signature:t})).toLowerCase()===r.toLowerCase()}),$i.apply(this,arguments)}function ji(){return ji=(0,f.Z)(function*(r,e,t,i,s,o){const a=Ft(i);if(!a.namespace||!a.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const c="0x1626ba7e",u="0000000000000000000000000000000000000000000000000000000000000040",d="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),g=c+Go(e).substring(2)+u+d+h,m=yield fetch(`${o||Ch}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:g},"latest"]})}),{result:y}=yield m.json();return!!y&&y.slice(0,c.length).toLowerCase()===c.toLowerCase()}catch(c){return console.error("isValidEip1271Signature: ",c),!1}}),ji.apply(this,arguments)}var $h=Object.defineProperty,jh=Object.defineProperties,Fh=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,qh=Object.prototype.hasOwnProperty,Uh=Object.prototype.propertyIsEnumerable,Jo=(r,e,t)=>e in r?$h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Fi=(r,e)=>{for(var t in e||(e={}))qh.call(e,t)&&Jo(r,t,e[t]);if(Wo)for(var t of Wo(e))Uh.call(e,t)&&Jo(r,t,e[t]);return r},Qo=(r,e)=>jh(r,Fh(e));const qi=r=>r?.split(":"),Ui=r=>{const e=r&&qi(r);if(e)return e[2]+":"+e[3]},Er=r=>{const e=r&&qi(r);if(e)return e.pop()};function Yo(r){return ki.apply(this,arguments)}function ki(){return ki=(0,f.Z)(function*(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,o=Xo(s,s.iss),a=Er(s.iss);return yield function Oh(r,e,t,i,s,o){return Ti.apply(this,arguments)}(a,o,i,Ui(s.iss),t)}),ki.apply(this,arguments)}const Xo=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=Er(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const o=`URI: ${r.aud||r.uri}`,a=`Version: ${r.version}`,c=`Chain ID: ${(r=>{const e=r&&qi(r);if(e)return r.includes("did:pkh:")?e[3]:e[1]})(e)}`,u=`Nonce: ${r.nonce}`,d=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,p=r.nbf?`Not Before: ${r.nbf}`:void 0,g=r.requestId?`Request ID: ${r.requestId}`:void 0,m=r.resources?`Resources:${r.resources.map(v=>`\n- ${v}`).join("")}`:void 0,y=cn(r.resources);if(y){s=na(s,Bt(y))}return[t,i,"",s,"",o,a,c,u,d,h,p,g,m].filter(v=>null!=v).join("\n")};function mt(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(null==e||!e.length)throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if("object"!=typeof i)throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const o=i[s];if(!Array.isArray(o))throw new Error(`Ability limits ${s} must be an array of objects, found: ${o}`);if(!o.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);o.forEach(a=>{if("object"!=typeof a)throw new Error(`Ability limits (${s}) must be an array of objects, found: ${a}`)})})})}function ea(r,e,t={}){e=e?.sort((s,o)=>s.localeCompare(o));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function Bi(r){return mt(r),`urn:recap:${function Zh(r){return Buffer.from(JSON.stringify(r)).toString("base64")}(r).replace(/=/g,"")}`}function Bt(r){const e=function Vh(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}(r.replace("urn:recap:",""));return mt(e),e}function Gh(r,e,t){const i=function Hh(r,e,t,i={}){return t?.sort((s,o)=>s.localeCompare(o)),{att:{[r]:ea(e,t,i)}}}(r,e,t);return Bi(i)}function ta(r){return r&&r.includes("urn:recap:")}function Wh(r,e){const s=function Jh(r,e){mt(r),mt(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,o)=>s.localeCompare(o)),i={att:{}};return t.forEach(s=>{var o,a;Object.keys((null==(o=r.att)?void 0:o[s])||{}).concat(Object.keys((null==(a=e.att)?void 0:a[s])||{})).sort((c,u)=>c.localeCompare(u)).forEach(c=>{var u,d;i.att[s]=Qo(Fi({},i.att[s]),{[c]:(null==(u=r.att[s])?void 0:u[c])||(null==(d=e.att[s])?void 0:d[c])})})}),i}(Bt(r),Bt(e));return Bi(s)}function na(r="",e){mt(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(c=>{const u=Object.keys(e.att[c]).map(p=>({ability:p.split("/")[0],action:p.split("/")[1]}));u.sort((p,g)=>p.action.localeCompare(g.action));const d={};u.forEach(p=>{d[p.ability]||(d[p.ability]=[]),d[p.ability].push(p.action)});const h=Object.keys(d).map(p=>(s++,`(${s}) '${p}': '${d[p].join("', '")}' for '${c}'.`));i.push(h.join(", ").replace(".,","."))});return`${r?r+" ":""}${`${t}${i.join(" ")}`}`}function ra(r){var e;const t=Bt(r);mt(t);const i=null==(e=t.att)?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function ia(r){const e=Bt(r);mt(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var o;null!=(o=s?.[0])&&o.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function cn(r){if(!r)return;const e=r?.[r.length-1];return ta(e)?e:void 0}function Mi(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function sa(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}function ke(r,...e){if(!sa(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function oa(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function aa(r){if("boolean"!=typeof r)throw new Error(`boolean expected, not ${r}`)}const Ot=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4));if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function Li(r){if("string"==typeof r)r=function ep(r){if("string"!=typeof r)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(r))}(r);else{if(!sa(r))throw new Error("Uint8Array expected, got "+typeof r);r=zi(r)}return r}function ca(r,e,t=!0){if(void 0===e)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!function ip(r){return r.byteOffset%4==0}(e))throw new Error("invalid output, must be aligned");return e}function ua(r,e,t,i){if("function"==typeof r.setBigUint64)return r.setBigUint64(e,t,i);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),u=i?4:0,d=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+d,c,i)}function zi(r){return Uint8Array.from(r)}function un(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const la=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),sp=la("expand 16-byte k"),op=la("expand 32-byte k"),ap=Ot(sp),cp=Ot(op);function J(r,e){return r<<e|r>>>32-e}function Zi(r){return r.byteOffset%4==0}const Dr=64,up=16,da=2**32-1,ha=new Uint32Array;const xe=(r,e)=>255&r[e++]|(255&r[e++])<<8;class hp{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ke(e=Li(e),32);const t=xe(e,0),i=xe(e,2),s=xe(e,4),o=xe(e,6),a=xe(e,8),c=xe(e,10),u=xe(e,12),d=xe(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|i<<3),this.r[2]=7939&(i>>>10|s<<6),this.r[3]=8191&(s>>>7|o<<9),this.r[4]=255&(o>>>4|a<<12),this.r[5]=a>>>1&8190,this.r[6]=8191&(a>>>14|c<<2),this.r[7]=8065&(c>>>11|u<<5),this.r[8]=8191&(u>>>8|d<<8),this.r[9]=d>>>5&127;for(let h=0;h<8;h++)this.pad[h]=xe(e,16+2*h)}process(e,t,i=!1){const s=i?0:2048,{h:o,r:a}=this,c=a[0],u=a[1],d=a[2],h=a[3],p=a[4],g=a[5],m=a[6],y=a[7],v=a[8],_=a[9],b=xe(e,t+0),w=xe(e,t+2),E=xe(e,t+4),x=xe(e,t+6),C=xe(e,t+8),P=xe(e,t+10),D=xe(e,t+12),I=xe(e,t+14);let A=o[0]+(8191&b),L=o[1]+(8191&(b>>>13|w<<3)),T=o[2]+(8191&(w>>>10|E<<6)),k=o[3]+(8191&(E>>>7|x<<9)),V=o[4]+(8191&(x>>>4|C<<12)),O=o[5]+(C>>>1&8191),R=o[6]+(8191&(C>>>14|P<<2)),N=o[7]+(8191&(P>>>11|D<<5)),q=o[8]+(8191&(D>>>8|I<<8)),U=o[9]+(I>>>5|s),F=0,H=F+A*c+L*(5*_)+T*(5*v)+k*(5*y)+V*(5*m);F=H>>>13,H&=8191,H+=O*(5*g)+R*(5*p)+N*(5*h)+q*(5*d)+U*(5*u),F+=H>>>13,H&=8191;let Z=F+A*u+L*c+T*(5*_)+k*(5*v)+V*(5*y);F=Z>>>13,Z&=8191,Z+=O*(5*m)+R*(5*g)+N*(5*p)+q*(5*h)+U*(5*d),F+=Z>>>13,Z&=8191;let M=F+A*d+L*u+T*c+k*(5*_)+V*(5*v);F=M>>>13,M&=8191,M+=O*(5*y)+R*(5*m)+N*(5*g)+q*(5*p)+U*(5*h),F+=M>>>13,M&=8191;let X=F+A*h+L*d+T*u+k*c+V*(5*_);F=X>>>13,X&=8191,X+=O*(5*v)+R*(5*y)+N*(5*m)+q*(5*g)+U*(5*p),F+=X>>>13,X&=8191;let ae=F+A*p+L*h+T*d+k*u+V*c;F=ae>>>13,ae&=8191,ae+=O*(5*_)+R*(5*v)+N*(5*y)+q*(5*m)+U*(5*g),F+=ae>>>13,ae&=8191;let he=F+A*g+L*p+T*h+k*d+V*u;F=he>>>13,he&=8191,he+=O*c+R*(5*_)+N*(5*v)+q*(5*y)+U*(5*m),F+=he>>>13,he&=8191;let _e=F+A*m+L*g+T*p+k*h+V*d;F=_e>>>13,_e&=8191,_e+=O*u+R*c+N*(5*_)+q*(5*v)+U*(5*y),F+=_e>>>13,_e&=8191;let ve=F+A*y+L*m+T*g+k*p+V*h;F=ve>>>13,ve&=8191,ve+=O*d+R*u+N*c+q*(5*_)+U*(5*v),F+=ve>>>13,ve&=8191;let be=F+A*v+L*y+T*m+k*g+V*p;F=be>>>13,be&=8191,be+=O*h+R*d+N*u+q*c+U*(5*_),F+=be>>>13,be&=8191;let Oe=F+A*_+L*v+T*y+k*m+V*g;F=Oe>>>13,Oe&=8191,Oe+=O*p+R*h+N*d+q*u+U*c,F+=Oe>>>13,Oe&=8191,F=(F<<2)+F|0,F=F+H|0,H=8191&F,F>>>=13,Z+=F,o[0]=H,o[1]=Z,o[2]=M,o[3]=X,o[4]=ae,o[5]=he,o[6]=_e,o[7]=ve,o[8]=be,o[9]=Oe}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let c=2;c<10;c++)e[c]+=s,s=e[c]>>>13,e[c]&=8191;e[0]+=5*s,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let c=1;c<10;c++)i[c]=e[c]+s,s=i[c]>>>13,i[c]&=8191;i[9]-=8192;let o=(1^s)-1;for(let c=0;c<10;c++)i[c]&=o;o=~o;for(let c=0;c<10;c++)e[c]=e[c]&o|i[c];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let a=e[0]+t[0];e[0]=65535&a;for(let c=1;c<8;c++)a=(e[c]+t[c]|0)+(a>>>16)|0,e[c]=65535&a;un(i)}update(e){oa(this);const{buffer:t,blockLen:i}=this,s=(e=Li(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)t.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0,!1),this.pos=0);else for(;i<=s-o;o+=i)this.process(e,o)}return this}destroy(){un(this.h,this.r,this.buffer,this.pad)}digestInto(e){oa(this),function Yh(r,e){ke(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let o=0;for(let a=0;a<8;a++)e[o++]=i[a]>>>0,e[o++]=i[a]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}const fp=function pp(r){const e=(i,s)=>r(s).update(Li(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}(r=>new hp(r));const yp=function dp(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:o,rounds:a}=function tp(r,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(r,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof r)throw new Error("core must be a function");return Mi(s),Mi(a),aa(o),aa(t),(c,u,d,h,p=0)=>{ke(c),ke(u),ke(d);const g=d.length;if(void 0===h&&(h=new Uint8Array(g)),ke(h),Mi(p),p<0||p>=da)throw new Error("arx: counter overflow");if(h.length<g)throw new Error(`arx: output (${h.length}) is shorter than data (${g})`);const m=[];let v,_,y=c.length;if(32===y)m.push(v=zi(c)),_=cp;else{if(16!==y||!t)throw new Error(`arx: invalid 32-byte key, got length=${y}`);v=new Uint8Array(32),v.set(c),v.set(c,16),_=ap,m.push(v)}Zi(u)||m.push(u=zi(u));const b=Ot(v);if(i){if(24!==u.length)throw new Error("arx: extended nonce must be 24 bytes");i(_,b,Ot(u.subarray(0,16)),b),u=u.subarray(16)}const w=16-s;if(w!==u.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const x=new Uint8Array(12);x.set(u,o?0:12-u.length),u=x,m.push(u)}const E=Ot(u);return function lp(r,e,t,i,s,o,a,c){const u=s.length,d=new Uint8Array(Dr),h=Ot(d),p=Zi(s)&&Zi(o),g=p?Ot(s):ha,m=p?Ot(o):ha;for(let y=0;y<u;a++){if(r(e,t,i,h,a,c),a>=da)throw new Error("arx: counter overflow");const v=Math.min(Dr,u-y);if(p&&v===Dr){const _=y/4;if(y%4!=0)throw new Error("arx: invalid block position");for(let w,b=0;b<up;b++)w=_+b,m[w]=g[w]^h[b];y+=Dr}else{for(let b,_=0;_<v;_++)b=y+_,o[b]=s[b]^d[_];y+=v}}}(r,_,b,E,d,h,p,a),un(...m),h}}(function gp(r,e,t,i,s,o=20){let a=r[0],c=r[1],u=r[2],d=r[3],h=e[0],p=e[1],g=e[2],m=e[3],y=e[4],v=e[5],_=e[6],b=e[7],w=s,E=t[0],x=t[1],C=t[2],P=a,D=c,I=u,A=d,L=h,T=p,k=g,V=m,O=y,R=v,N=_,q=b,U=w,F=E,H=x,Z=C;for(let X=0;X<o;X+=2)P=P+L|0,U=J(U^P,16),O=O+U|0,L=J(L^O,12),P=P+L|0,U=J(U^P,8),O=O+U|0,L=J(L^O,7),D=D+T|0,F=J(F^D,16),R=R+F|0,T=J(T^R,12),D=D+T|0,F=J(F^D,8),R=R+F|0,T=J(T^R,7),I=I+k|0,H=J(H^I,16),N=N+H|0,k=J(k^N,12),I=I+k|0,H=J(H^I,8),N=N+H|0,k=J(k^N,7),A=A+V|0,Z=J(Z^A,16),q=q+Z|0,V=J(V^q,12),A=A+V|0,Z=J(Z^A,8),q=q+Z|0,V=J(V^q,7),P=P+T|0,Z=J(Z^P,16),N=N+Z|0,T=J(T^N,12),P=P+T|0,Z=J(Z^P,8),N=N+Z|0,T=J(T^N,7),D=D+k|0,U=J(U^D,16),q=q+U|0,k=J(k^q,12),D=D+k|0,U=J(U^D,8),q=q+U|0,k=J(k^q,7),I=I+V|0,F=J(F^I,16),O=O+F|0,V=J(V^O,12),I=I+V|0,F=J(F^I,8),O=O+F|0,V=J(V^O,7),A=A+L|0,H=J(H^A,16),R=R+H|0,L=J(L^R,12),A=A+L|0,H=J(H^A,8),R=R+H|0,L=J(L^R,7);let M=0;i[M++]=a+P|0,i[M++]=c+D|0,i[M++]=u+I|0,i[M++]=d+A|0,i[M++]=h+L|0,i[M++]=p+T|0,i[M++]=g+k|0,i[M++]=m+V|0,i[M++]=y+O|0,i[M++]=v+R|0,i[M++]=_+N|0,i[M++]=b+q|0,i[M++]=w+U|0,i[M++]=E+F|0,i[M++]=x+H|0,i[M++]=C+Z|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),mp=new Uint8Array(16),pa=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(mp.subarray(t))},_p=new Uint8Array(32);function fa(r,e,t,i,s){const o=r(e,t,_p),a=fp.create(o);s&&pa(a,s),pa(a,i);const c=new Uint8Array(16),u=(r=>new DataView(r.buffer,r.byteOffset,r.byteLength))(c);ua(u,0,BigInt(s?s.length:0),!0),ua(u,8,BigInt(i.length),!0),a.update(c);const d=a.digest();return un(o,c),d}const ga=((r,e)=>{function t(i,...s){if(ke(i),void 0!==r.nonceLength){const d=s[0];if(!d)throw new Error("nonce / iv required");r.varSizeNonce?ke(d):ke(d,r.nonceLength)}const o=r.tagLength;o&&void 0!==s[1]&&ke(s[1]);const a=e(i,...s),c=(d,h)=>{if(void 0!==h){if(2!==d)throw new Error("cipher output not supported");ke(h)}};let u=!1;return{encrypt(d,h){if(u)throw new Error("cannot encrypt() twice with same key + nonce");return u=!0,ke(d),c(a.encrypt.length,h),a.encrypt(d,h)},decrypt(d,h){if(ke(d),o&&d.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return c(a.decrypt.length,h),a.decrypt(d,h)}}}return Object.assign(t,r),t})({blockSize:64,nonceLength:12,tagLength:16},(r=>(e,t,i)=>({encrypt(s,o){const a=s.length;(o=ca(a+16,o,!1)).set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const u=fa(r,e,t,c,i);return o.set(u,a),un(u),o},decrypt(s,o){o=ca(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),u=fa(r,e,t,a,i);if(!function np(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return 0===t}(c,u))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),un(u),o}}))(yp));class ya extends Ri{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Oi(e);const i=on(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(i.length>s?e.create().update(i).digest():i);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return rn(this),this.iHash.update(e),this}digestInto(e){rn(this),zn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:o,blockLen:a,outputLen:c}=this;return e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ir=(r,e,t)=>new ya(r,e).update(t).digest();Ir.create=(r,e)=>new ya(r,e);const Vi=new Uint8Array([0]),ma=new Uint8Array;const xp=(r,e,t,i,s)=>function wp(r,e,t,i=32){if(Oi(r),Ln(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);void 0===t&&(t=ma);const o=new Uint8Array(s*r.outputLen),a=Ir.create(r,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let d=0;d<s;d++)Vi[0]=d+1,c.update(0===d?ma:u).update(t).update(Vi).digestInto(u),o.set(u,r.outputLen*d),a._cloneInto(c);return a.destroy(),c.destroy(),u.fill(0),Vi.fill(0),o.slice(0,i)}(r,function bp(r,e,t){return Oi(r),void 0===t&&(t=new Uint8Array(r.outputLen)),Ir(r,on(t),on(e))}(r,e,t),i,s);function Dp(r,e,t){return r&e^~r&t}function Ip(r,e,t){return r&e^r&t^e&t}class Pp extends Ri{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ai(this.buffer)}update(e){rn(this);const{view:t,buffer:i,blockLen:s}=this,o=(e=on(e)).length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c!==s)i.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(t,0),this.pos=0);else{const u=Ai(e);for(;s<=o-a;a+=s)this.process(u,a)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){rn(this),Uo(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(i,0),a=0);for(let p=a;p<s;p++)t[p]=0;(function Ep(r,e,t,i){if("function"==typeof r.setBigUint64)return r.setBigUint64(e,t,i);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),u=i?4:0,d=i?0:4;r.setUint32(e+u,a,i),r.setUint32(e+d,c,i)})(i,s-8,BigInt(8*this.length),o),this.process(i,0);const c=Ai(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=u/4,h=this.get();if(d>h.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<d;p++)c.setUint32(4*p,h[p],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:o,destroyed:a,pos:c}=this;return e.length=s,e.pos=c,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(i),e}}const Sp=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),At=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Rt=new Uint32Array(64);class Cp extends Pp{constructor(){super(64,32,8,!1),this.A=0|At[0],this.B=0|At[1],this.C=0|At[2],this.D=0|At[3],this.E=0|At[4],this.F=0|At[5],this.G=0|At[6],this.H=0|At[7]}get(){const{A:e,B:t,C:i,D:s,E:o,F:a,G:c,H:u}=this;return[e,t,i,s,o,a,c,u]}set(e,t,i,s,o,a,c,u){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|s,this.E=0|o,this.F=0|a,this.G=0|c,this.H=0|u}process(e,t){for(let p=0;p<16;p++,t+=4)Rt[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){const g=Rt[p-15],m=Rt[p-2],y=ot(g,7)^ot(g,18)^g>>>3,v=ot(m,17)^ot(m,19)^m>>>10;Rt[p]=v+Rt[p-7]+y+Rt[p-16]|0}let{A:i,B:s,C:o,D:a,E:c,F:u,G:d,H:h}=this;for(let p=0;p<64;p++){const m=h+(ot(c,6)^ot(c,11)^ot(c,25))+Dp(c,u,d)+Sp[p]+Rt[p]|0,y=(ot(i,2)^ot(i,13)^ot(i,22))+Ip(i,s,o)|0;h=d,d=u,u=c,c=a+m|0,a=o,o=s,s=i,i=m+y|0}i=i+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,u=u+this.F|0,d=d+this.G|0,h=h+this.H|0,this.set(i,s,o,a,c,u,d,h)}roundClean(){Rt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Vn=Lo(()=>new Cp),Pr=BigInt(0),Sr=BigInt(1),Op=BigInt(2);function Mt(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name}function Hn(r){if(!Mt(r))throw new Error("Uint8Array expected")}function ln(r,e){if("boolean"!=typeof e)throw new Error(r+" boolean expected, got "+e)}const Ap=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function dn(r){Hn(r);let e="";for(let t=0;t<r.length;t++)e+=Ap[r[t]];return e}function hn(r){const e=r.toString(16);return 1&e.length?"0"+e:e}function Hi(r){if("string"!=typeof r)throw new Error("hex string expected, got "+typeof r);return""===r?Pr:BigInt("0x"+r)}const _t={_0:48,_9:57,A:65,F:70,a:97,f:102};function _a(r){return r>=_t._0&&r<=_t._9?r-_t._0:r>=_t.A&&r<=_t.F?r-(_t.A-10):r>=_t.a&&r<=_t.f?r-(_t.a-10):void 0}function pn(r){if("string"!=typeof r)throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=_a(r.charCodeAt(o)),c=_a(r.charCodeAt(o+1));if(void 0===a||void 0===c){const u=r[o]+r[o+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+o)}i[s]=16*a+c}return i}function Lt(r){return Hi(dn(r))}function Kn(r){return Hn(r),Hi(dn(Uint8Array.from(r).reverse()))}function fn(r,e){return pn(r.toString(16).padStart(2*e,"0"))}function Cr(r,e){return fn(r,e).reverse()}function Be(r,e,t){let i;if("string"==typeof e)try{i=pn(e)}catch(o){throw new Error(r+" must be hex string or Uint8Array, cause: "+o)}else{if(!Mt(e))throw new Error(r+" must be hex string or Uint8Array");i=Uint8Array.from(e)}const s=i.length;if("number"==typeof t&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Gn(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Hn(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const o=r[i];t.set(o,s),s+=o.length}return t}const Ki=r=>"bigint"==typeof r&&Pr<=r;function Or(r,e,t){return Ki(r)&&Ki(e)&&Ki(t)&&e<=r&&r<t}function vt(r,e,t,i){if(!Or(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function va(r){let e;for(e=0;r>Pr;r>>=Sr,e+=1);return e}const Gi=r=>(Op<<BigInt(r-1))-Sr,Wi=r=>new Uint8Array(r),ba=r=>Uint8Array.from(r);function wa(r,e,t){if("number"!=typeof r||r<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof t)throw new Error("hmacFn must be a function");let i=Wi(r),s=Wi(r),o=0;const a=()=>{i.fill(1),s.fill(0),o=0},c=(...h)=>t(s,i,...h),u=(h=Wi())=>{s=c(ba([0]),h),i=c(),0!==h.length&&(s=c(ba([1]),h),i=c())},d=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){i=c();const g=i.slice();p.push(g),h+=i.length}return Gn(...p)};return(h,p)=>{let g;for(a(),u(h);!(g=p(d()));)u();return a(),g}}const Fp={bigint:r=>"bigint"==typeof r,function:r=>"function"==typeof r,boolean:r=>"boolean"==typeof r,string:r=>"string"==typeof r,stringOrUint8Array:r=>"string"==typeof r||Mt(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>"function"==typeof r&&Number.isSafeInteger(r.outputLen)};function gn(r,e,t={}){const i=(s,o,a)=>{const c=Fp[o];if("function"!=typeof c)throw new Error("invalid validator function");const u=r[s];if(!(a&&void 0===u||c(u,r)))throw new Error("param "+String(s)+" is invalid. Expected "+o+", got "+u)};for(const[s,o]of Object.entries(e))i(s,o,!1);for(const[s,o]of Object.entries(t))i(s,o,!0);return r}function Ji(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(void 0!==s)return s;const o=r(t,...i);return e.set(t,o),o}}var Up=Object.freeze({__proto__:null,isBytes:Mt,abytes:Hn,abool:ln,bytesToHex:dn,numberToHexUnpadded:hn,hexToNumber:Hi,hexToBytes:pn,bytesToNumberBE:Lt,bytesToNumberLE:Kn,numberToBytesBE:fn,numberToBytesLE:Cr,numberToVarBytesBE:function Rp(r){return pn(hn(r))},ensureBytes:Be,concatBytes:Gn,equalBytes:function Np(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return 0===t},utf8ToBytes:function Tp(r){if("string"!=typeof r)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(r))},inRange:Or,aInRange:vt,bitLen:va,bitGet:function $p(r,e){return r>>BigInt(e)&Sr},bitSet:function jp(r,e,t){return r|(t?Sr:Pr)<<BigInt(e)},bitMask:Gi,createHmacDrbg:wa,validateObject:gn,notImplemented:()=>{throw new Error("not implemented")},memoized:Ji});const pe=BigInt(0),ce=BigInt(1),zt=BigInt(2),kp=BigInt(3),Qi=BigInt(4),xa=BigInt(5),Ea=BigInt(8);function Fe(r,e){const t=r%e;return t>=pe?t:e+t}function Da(r,e,t){if(e<pe)throw new Error("invalid exponent, negatives unsupported");if(t<=pe)throw new Error("invalid modulus");if(t===ce)return pe;let i=ce;for(;e>pe;)e&ce&&(i=i*r%t),r=r*r%t,e>>=ce;return i}function Ye(r,e,t){let i=r;for(;e-- >pe;)i*=i,i%=t;return i}function Yi(r,e){if(r===pe)throw new Error("invert: expected non-zero number");if(e<=pe)throw new Error("invert: expected positive modulus, got "+e);let t=Fe(r,e),i=e,s=pe,o=ce;for(;t!==pe;){const c=i%t,u=s-o*(i/t);i=t,t=c,s=o,o=u}if(i!==ce)throw new Error("invert: does not exist");return Fe(s,e)}function Mp(r){if(r%Qi===kp){const e=(r+ce)/Qi;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Ea===xa){const e=(r-xa)/Ea;return function(t,i){const s=t.mul(i,zt),o=t.pow(s,e),a=t.mul(i,o),c=t.mul(t.mul(a,zt),o),u=t.mul(a,t.sub(c,t.ONE));if(!t.eql(t.sqr(u),i))throw new Error("Cannot find square root");return u}}return function Bp(r){const e=(r-ce)/zt;let t,i,s;for(t=r-ce,i=0;t%zt===pe;t/=zt,i++);for(s=zt;s<r&&Da(s,e,r)!==r-ce;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===i){const a=(r+ce)/Qi;return function(c,u){const d=c.pow(u,a);if(!c.eql(c.sqr(d),u))throw new Error("Cannot find square root");return d}}const o=(t+ce)/zt;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=i,d=a.pow(a.mul(a.ONE,s),t),h=a.pow(c,o),p=a.pow(c,t);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let g=1;for(let y=a.sqr(p);g<u&&!a.eql(y,a.ONE);g++)y=a.sqr(y);const m=a.pow(d,ce<<BigInt(u-g-1));d=a.sqr(m),h=a.mul(h,m),p=a.mul(p,d),u=g}return h}}(r)}const Lp=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ia(r,e){const t=void 0!==e?e:r.toString(2).length;return{nBitLength:t,nByteLength:Math.ceil(t/8)}}function Pa(r,e,t=!1,i={}){if(r<=pe)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:o}=Ia(r,e);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const c=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:o,MASK:Gi(s),ZERO:pe,ONE:ce,create:u=>Fe(u,r),isValid:u=>{if("bigint"!=typeof u)throw new Error("invalid field element: expected bigint, got "+typeof u);return pe<=u&&u<r},is0:u=>u===pe,isOdd:u=>(u&ce)===ce,neg:u=>Fe(-u,r),eql:(u,d)=>u===d,sqr:u=>Fe(u*u,r),add:(u,d)=>Fe(u+d,r),sub:(u,d)=>Fe(u-d,r),mul:(u,d)=>Fe(u*d,r),pow:(u,d)=>function Zp(r,e,t){if(t<pe)throw new Error("invalid exponent, negatives unsupported");if(t===pe)return r.ONE;if(t===ce)return e;let i=r.ONE,s=e;for(;t>pe;)t&ce&&(i=r.mul(i,s)),s=r.sqr(s),t>>=ce;return i}(c,u,d),div:(u,d)=>Fe(u*Yi(d,r),r),sqrN:u=>u*u,addN:(u,d)=>u+d,subN:(u,d)=>u-d,mulN:(u,d)=>u*d,inv:u=>Yi(u,r),sqrt:i.sqrt||(u=>(a||(a=Mp(r)),a(c,u))),invertBatch:u=>function Vp(r,e){const t=new Array(e.length),i=e.reduce((o,a,c)=>r.is0(a)?o:(t[c]=o,r.mul(o,a)),r.ONE),s=r.inv(i);return e.reduceRight((o,a,c)=>r.is0(a)?o:(t[c]=r.mul(o,t[c]),r.mul(o,a)),s),t}(c,u),cmov:(u,d,h)=>h?d:u,toBytes:u=>t?Cr(u,o):fn(u,o),fromBytes:u=>{if(u.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+u.length);return t?Kn(u):Lt(u)}});return Object.freeze(c)}function Sa(r){if("bigint"!=typeof r)throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function Ca(r){const e=Sa(r);return e+Math.ceil(e/2)}const Oa=BigInt(0),Ar=BigInt(1);function Xi(r,e){const t=e.negate();return r?t:e}function Aa(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function es(r,e){Aa(r,e);return{windows:Math.ceil(e/r)+1,windowSize:2**(r-1)}}const ts=new WeakMap,Ra=new WeakMap;function ns(r){return Ra.get(r)||1}function Jp(r,e,t,i){if(function Kp(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}(t,r),function Gp(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,o=va(BigInt(t.length)),a=o>12?o-3:o>4?o-2:o?2:1,c=(1<<a)-1,u=new Array(c+1).fill(s);let h=s;for(let p=Math.floor((e.BITS-1)/a)*a;p>=0;p-=a){u.fill(s);for(let m=0;m<i.length;m++){const y=i[m],v=Number(y>>BigInt(p)&BigInt(c));u[v]=u[v].add(t[m])}let g=s;for(let m=u.length-1,y=s;m>0;m--)y=y.add(u[m]),g=g.add(y);if(h=h.add(g),0!==p)for(let m=0;m<a;m++)h=h.double()}return h}function Na(r){return function zp(r){return gn(r,Lp.reduce((i,s)=>(i[s]="function",i),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(r.Fp),gn(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ia(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const yn=BigInt(0),rs=BigInt(1);const is=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Xp=BigInt(1),Ta=BigInt(2),ef=BigInt(3),tf=BigInt(5);BigInt(8);const ss=function Yp(r){const e=function Qp(r){return gn(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}(r),{P:t}=e,i=w=>Fe(w,t),s=e.montgomeryBits,o=Math.ceil(s/8),a=e.nByteLength,c=e.adjustScalarBytes||(w=>w),u=e.powPminus2||(w=>Da(w,t-BigInt(2),t));function d(w,E,x){const C=i(w*(E-x));return[E=i(E-C),x=i(x+C)]}const h=(e.a-BigInt(2))/BigInt(4);function g(w){return Cr(i(w),o)}function v(w,E){const x=function m(w){const E=Be("u coordinate",w,o);return 32===a&&(E[31]&=127),Kn(E)}(E),C=function y(w){const E=Be("scalar",w),x=E.length;if(x!==o&&x!==a)throw new Error("invalid scalar, expected "+o+" or "+a+" bytes, got "+x);return Kn(c(E))}(w),P=function p(w,E){vt("u",w,yn,t),vt("scalar",E,yn,t);const x=E,C=w;let T,P=rs,D=yn,I=w,A=rs,L=yn;for(let V=BigInt(s-1);V>=yn;V--){const O=x>>V&rs;L^=O,T=d(L,P,I),P=T[0],I=T[1],T=d(L,D,A),D=T[0],A=T[1],L=O;const R=P+D,N=i(R*R),q=P-D,U=i(q*q),F=N-U,H=I+A,M=i((I-A)*R),X=i(H*q),ae=M+X,he=M-X;I=i(ae*ae),A=i(C*i(he*he)),P=i(N*U),D=i(F*(N+i(h*F)))}T=d(L,P,I),P=T[0],I=T[1],T=d(L,D,A),D=T[0],A=T[1];const k=u(D);return i(P*k)}(x,C);if(P===yn)throw new Error("invalid private or public key received");return g(P)}const _=g(e.Gu);function b(w){return v(w,_)}return{scalarMult:v,scalarMultBase:b,getSharedSecret:(w,E)=>v(w,E),getPublicKey:w=>b(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:_}}({P:is,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=is,{pow_p_5_8:t,b2:i}=function nf(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),o=is,a=r*r%o*r%o,c=Ye(a,Ta,o)*a%o,u=Ye(c,Xp,o)*r%o,d=Ye(u,tf,o)*u%o,h=Ye(d,e,o)*d%o,p=Ye(h,t,o)*h%o,g=Ye(p,i,o)*p%o,m=Ye(g,s,o)*g%o,y=Ye(m,s,o)*g%o,v=Ye(y,e,o)*d%o;return{pow_p_5_8:Ye(v,Ta,o)*r%o,b2:a}}(r);return Fe(Ye(t,ef,e)*i,e)},adjustScalarBytes:function rf(r){return r[0]&=248,r[31]&=127,r[31]|=64,r},randomBytes:an});function $a(r){void 0!==r.lowS&&ln("lowS",r.lowS),void 0!==r.prehash&&ln("prehash",r.prehash)}const{bytesToNumberBE:of,hexToBytes:af}=Up;class cf extends Error{constructor(e=""){super(e)}}const bt={Err:cf,_tlv:{encode:(r,e)=>{const{Err:t}=bt;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(1&e.length)throw new t("tlv.encode: unpadded data");const i=e.length/2,s=hn(i);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const o=i>127?hn(s.length/2|128):"";return hn(r)+o+s+e},decode(r,e){const{Err:t}=bt;let i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[i++];let a=0;if(!!(128&s)){const u=127&s;if(!u)throw new t("tlv.decode(long): indefinite length not supported");if(u>4)throw new t("tlv.decode(long): byte length is too big");const d=e.subarray(i,i+u);if(d.length!==u)throw new t("tlv.decode: length bytes not complete");if(0===d[0])throw new t("tlv.decode(long): zero leftmost byte");for(const h of d)a=a<<8|h;if(i+=u,a<128)throw new t("tlv.decode(long): not minimal encoding")}else a=s;const c=e.subarray(i,i+a);if(c.length!==a)throw new t("tlv.decode: wrong value length");return{v:c,l:e.subarray(i+a)}}},_int:{encode(r){const{Err:e}=bt;if(r<wt)throw new e("integer: negative integers are not allowed");let t=hn(r);if(8&Number.parseInt(t[0],16)&&(t="00"+t),1&t.length)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=bt;if(128&r[0])throw new e("invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("invalid signature integer: unnecessary leading zero");return of(r)}},toSig(r){const{Err:e,_int:t,_tlv:i}=bt,s="string"==typeof r?af(r):r;Hn(s);const{v:o,l:a}=i.decode(48,s);if(a.length)throw new e("invalid signature: left bytes after parsing");const{v:c,l:u}=i.decode(2,o),{v:d,l:h}=i.decode(2,u);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(c),s:t.decode(d)}},hexFromSig(r){const{_tlv:e,_int:t}=bt,o=e.encode(2,t.encode(r.r))+e.encode(2,t.encode(r.s));return e.encode(48,o)}},wt=BigInt(0),fe=BigInt(1);BigInt(2);const ja=BigInt(3);function uf(r){const e=function sf(r){const e=Na(r);gn(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:i,a:s}=e;if(t){if(!i.eql(s,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof t||"bigint"!=typeof t.beta||"function"!=typeof t.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(r),{Fp:t}=e,i=Pa(e.n,e.nBitLength),s=e.toBytes||((v,_,b)=>{const w=_.toAffine();return Gn(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),o=e.fromBytes||(v=>{const _=v.subarray(1);return{x:t.fromBytes(_.subarray(0,t.BYTES)),y:t.fromBytes(_.subarray(t.BYTES,2*t.BYTES))}});function a(v){const{a:_,b}=e,w=t.sqr(v),E=t.mul(w,v);return t.add(t.add(E,t.mul(v,_)),b)}if(!t.eql(t.sqr(e.Gy),a(e.Gx)))throw new Error("bad generator point: equation left != right");function u(v){const{allowedPrivateKeyLengths:_,nByteLength:b,wrapPrivateKey:w,n:E}=e;if(_&&"bigint"!=typeof v){if(Mt(v)&&(v=dn(v)),"string"!=typeof v||!_.includes(v.length))throw new Error("invalid private key");v=v.padStart(2*b,"0")}let x;try{x="bigint"==typeof v?v:Lt(Be("private key",v,b))}catch{throw new Error("invalid private key, expected hex or "+b+" bytes, got "+typeof v)}return w&&(x=Fe(x,E)),vt("private key",x,fe,E),x}function d(v){if(!(v instanceof g))throw new Error("ProjectivePoint expected")}const h=Ji((v,_)=>{const{px:b,py:w,pz:E}=v;if(t.eql(E,t.ONE))return{x:b,y:w};const x=v.is0();null==_&&(_=x?t.ONE:t.inv(E));const C=t.mul(b,_),P=t.mul(w,_),D=t.mul(E,_);if(x)return{x:t.ZERO,y:t.ZERO};if(!t.eql(D,t.ONE))throw new Error("invZ was invalid");return{x:C,y:P}}),p=Ji(v=>{if(v.is0()){if(e.allowInfinityPoint&&!t.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:_,y:b}=v.toAffine();if(!t.isValid(_)||!t.isValid(b))throw new Error("bad point: x or y not FE");const w=t.sqr(b),E=a(_);if(!t.eql(w,E))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(_,b,w){if(this.px=_,this.py=b,this.pz=w,null==_||!t.isValid(_))throw new Error("x required");if(null==b||!t.isValid(b))throw new Error("y required");if(null==w||!t.isValid(w))throw new Error("z required");Object.freeze(this)}static fromAffine(_){const{x:b,y:w}=_||{};if(!_||!t.isValid(b)||!t.isValid(w))throw new Error("invalid affine point");if(_ instanceof g)throw new Error("projective point not allowed");const E=x=>t.eql(x,t.ZERO);return E(b)&&E(w)?g.ZERO:new g(b,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const b=t.invertBatch(_.map(w=>w.pz));return _.map((w,E)=>w.toAffine(b[E])).map(g.fromAffine)}static fromHex(_){const b=g.fromAffine(o(Be("pointHex",_)));return b.assertValidity(),b}static fromPrivateKey(_){return g.BASE.multiply(u(_))}static msm(_,b){return Jp(g,i,_,b)}_setWindowSize(_){y.setWindowSize(this,_)}assertValidity(){p(this)}hasEvenY(){const{y:_}=this.toAffine();if(t.isOdd)return!t.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){d(_);const{px:b,py:w,pz:E}=this,{px:x,py:C,pz:P}=_,D=t.eql(t.mul(b,P),t.mul(x,E)),I=t.eql(t.mul(w,P),t.mul(C,E));return D&&I}negate(){return new g(this.px,t.neg(this.py),this.pz)}double(){const{a:_,b}=e,w=t.mul(b,ja),{px:E,py:x,pz:C}=this;let P=t.ZERO,D=t.ZERO,I=t.ZERO,A=t.mul(E,E),L=t.mul(x,x),T=t.mul(C,C),k=t.mul(E,x);return k=t.add(k,k),I=t.mul(E,C),I=t.add(I,I),P=t.mul(_,I),D=t.mul(w,T),D=t.add(P,D),P=t.sub(L,D),D=t.add(L,D),D=t.mul(P,D),P=t.mul(k,P),I=t.mul(w,I),T=t.mul(_,T),k=t.sub(A,T),k=t.mul(_,k),k=t.add(k,I),I=t.add(A,A),A=t.add(I,A),A=t.add(A,T),A=t.mul(A,k),D=t.add(D,A),T=t.mul(x,C),T=t.add(T,T),A=t.mul(T,k),P=t.sub(P,A),I=t.mul(T,L),I=t.add(I,I),I=t.add(I,I),new g(P,D,I)}add(_){d(_);const{px:b,py:w,pz:E}=this,{px:x,py:C,pz:P}=_;let D=t.ZERO,I=t.ZERO,A=t.ZERO;const L=e.a,T=t.mul(e.b,ja);let k=t.mul(b,x),V=t.mul(w,C),O=t.mul(E,P),R=t.add(b,w),N=t.add(x,C);R=t.mul(R,N),N=t.add(k,V),R=t.sub(R,N),N=t.add(b,E);let q=t.add(x,P);return N=t.mul(N,q),q=t.add(k,O),N=t.sub(N,q),q=t.add(w,E),D=t.add(C,P),q=t.mul(q,D),D=t.add(V,O),q=t.sub(q,D),A=t.mul(L,N),D=t.mul(T,O),A=t.add(D,A),D=t.sub(V,A),A=t.add(V,A),I=t.mul(D,A),V=t.add(k,k),V=t.add(V,k),O=t.mul(L,O),N=t.mul(T,N),V=t.add(V,O),O=t.sub(k,O),O=t.mul(L,O),N=t.add(N,O),k=t.mul(V,N),I=t.add(I,k),k=t.mul(q,N),D=t.mul(R,D),D=t.sub(D,k),k=t.mul(R,V),A=t.mul(q,A),A=t.add(A,k),new g(D,I,A)}subtract(_){return this.add(_.negate())}is0(){return this.equals(g.ZERO)}wNAF(_){return y.wNAFCached(this,_,g.normalizeZ)}multiplyUnsafe(_){const{endo:b,n:w}=e;vt("scalar",_,wt,w);const E=g.ZERO;if(_===wt)return E;if(this.is0()||_===fe)return this;if(!b||y.hasPrecomputes(this))return y.wNAFCachedUnsafe(this,_,g.normalizeZ);let{k1neg:x,k1:C,k2neg:P,k2:D}=b.splitScalar(_),I=E,A=E,L=this;for(;C>wt||D>wt;)C&fe&&(I=I.add(L)),D&fe&&(A=A.add(L)),L=L.double(),C>>=fe,D>>=fe;return x&&(I=I.negate()),P&&(A=A.negate()),A=new g(t.mul(A.px,b.beta),A.py,A.pz),I.add(A)}multiply(_){const{endo:b,n:w}=e;let E,x;if(vt("scalar",_,fe,w),b){const{k1neg:C,k1:P,k2neg:D,k2:I}=b.splitScalar(_);let{p:A,f:L}=this.wNAF(P),{p:T,f:k}=this.wNAF(I);A=y.constTimeNegate(C,A),T=y.constTimeNegate(D,T),T=new g(t.mul(T.px,b.beta),T.py,T.pz),E=A.add(T),x=L.add(k)}else{const{p:C,f:P}=this.wNAF(_);E=C,x=P}return g.normalizeZ([E,x])[0]}multiplyAndAddUnsafe(_,b,w){const E=g.BASE,x=(P,D)=>D!==wt&&D!==fe&&P.equals(E)?P.multiply(D):P.multiplyUnsafe(D),C=x(this,b).add(x(_,w));return C.is0()?void 0:C}toAffine(_){return h(this,_)}isTorsionFree(){const{h:_,isTorsionFree:b}=e;if(_===fe)return!0;if(b)return b(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:b}=e;return _===fe?this:b?b(g,this):this.multiplyUnsafe(e.h)}toRawBytes(_=!0){return ln("isCompressed",_),this.assertValidity(),s(g,this,_)}toHex(_=!0){return ln("isCompressed",_),dn(this.toRawBytes(_))}}g.BASE=new g(e.Gx,e.Gy,t.ONE),g.ZERO=new g(t.ZERO,t.ONE,t.ZERO);const m=e.nBitLength,y=function Wp(r,e){return{constTimeNegate:Xi,hasPrecomputes:t=>1!==ns(t),unsafeLadder(t,i,s=r.ZERO){let o=t;for(;i>Oa;)i&Ar&&(s=s.add(o)),o=o.double(),i>>=Ar;return s},precomputeWindow(t,i){const{windows:s,windowSize:o}=es(i,e),a=[];let c=t,u=c;for(let d=0;d<s;d++){u=c,a.push(u);for(let h=1;h<o;h++)u=u.add(c),a.push(u);c=u.double()}return a},wNAF(t,i,s){const{windows:o,windowSize:a}=es(t,e);let c=r.ZERO,u=r.BASE;const d=BigInt(2**t-1),h=2**t,p=BigInt(t);for(let g=0;g<o;g++){const m=g*a;let y=Number(s&d);s>>=p,y>a&&(y-=h,s+=Ar);const v=m,_=m+Math.abs(y)-1,b=g%2!=0,w=y<0;0===y?u=u.add(Xi(b,i[v])):c=c.add(Xi(w,i[_]))}return{p:c,f:u}},wNAFUnsafe(t,i,s,o=r.ZERO){const{windows:a,windowSize:c}=es(t,e),u=BigInt(2**t-1),d=2**t,h=BigInt(t);for(let p=0;p<a;p++){const g=p*c;if(s===Oa)break;let m=Number(s&u);if(s>>=h,m>c&&(m-=d,s+=Ar),0===m)continue;let y=i[g+Math.abs(m)-1];m<0&&(y=y.negate()),o=o.add(y)}return o},getPrecomputes(t,i,s){let o=ts.get(i);return o||(o=this.precomputeWindow(i,t),1!==t&&ts.set(i,s(o))),o},wNAFCached(t,i,s){const o=ns(t);return this.wNAF(o,this.getPrecomputes(o,t,s),i)},wNAFCachedUnsafe(t,i,s,o){const a=ns(t);return 1===a?this.unsafeLadder(t,i,o):this.wNAFUnsafe(a,this.getPrecomputes(a,t,s),i,o)},setWindowSize(t,i){Aa(i,e),Ra.set(t,i),ts.delete(t)}}}(g,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:u,weierstrassEquation:a,isWithinCurveOrder:function c(v){return Or(v,fe,e.n)}}}function df(r){const e=function lf(r){const e=Na(r);return gn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(r),{Fp:t,n:i}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(O){return Fe(O,i)}function c(O){return Yi(O,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:h,isWithinCurveOrder:p}=uf({...e,toBytes(O,R,N){const q=R.toAffine(),U=t.toBytes(q.x),F=Gn;return ln("isCompressed",N),N?F(Uint8Array.from([R.hasEvenY()?2:3]),U):F(Uint8Array.from([4]),U,t.toBytes(q.y))},fromBytes(O){const R=O.length,N=O[0],q=O.subarray(1);if(R!==s||2!==N&&3!==N){if(R===o&&4===N){return{x:t.fromBytes(q.subarray(0,t.BYTES)),y:t.fromBytes(q.subarray(t.BYTES,2*t.BYTES))}}throw new Error("invalid Point, expected length of "+s+", or uncompressed "+o+", got "+R)}{const U=Lt(q);if(!Or(U,fe,t.ORDER))throw new Error("Point is not on curve");const F=h(U);let H;try{H=t.sqrt(F)}catch(M){const X=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+X)}return 1==(1&N)!==((H&fe)===fe)&&(H=t.neg(H)),{x:U,y:H}}}}),g=O=>dn(fn(O,e.nByteLength));function m(O){return O>i>>fe}const v=(O,R,N)=>Lt(O.slice(R,N));class _{constructor(R,N,q){this.r=R,this.s=N,this.recovery=q,this.assertValidity()}static fromCompact(R){const N=e.nByteLength;return R=Be("compactSignature",R,2*N),new _(v(R,0,N),v(R,N,2*N))}static fromDER(R){const{r:N,s:q}=bt.toSig(Be("DER",R));return new _(N,q)}assertValidity(){vt("r",this.r,fe,i),vt("s",this.s,fe,i)}addRecoveryBit(R){return new _(this.r,this.s,R)}recoverPublicKey(R){const{r:N,s:q,recovery:U}=this,F=P(Be("msgHash",R));if(null==U||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const H=2===U||3===U?N+e.n:N;if(H>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const Z=1&U?"03":"02",M=u.fromHex(Z+g(H)),X=c(H),ae=a(-F*X),he=a(q*X),_e=u.BASE.multiplyAndAddUnsafe(M,ae,he);if(!_e)throw new Error("point at infinify");return _e.assertValidity(),_e}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return pn(this.toDERHex())}toDERHex(){return bt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return pn(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const b={isValidPrivateKey(O){try{return d(O),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const O=Ca(e.n);return function Hp(r,e,t=!1){const i=r.length,s=Sa(e),o=Ca(e);if(i<16||i<o||i>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+i);const c=Fe(t?Kn(r):Lt(r),e-ce)+ce;return t?Cr(c,s):fn(c,s)}(e.randomBytes(O),e.n)},precompute:(O=8,R=u.BASE)=>(R._setWindowSize(O),R.multiply(BigInt(3)),R)};function E(O){const R=Mt(O),N="string"==typeof O,q=(R||N)&&O.length;return R?q===s||q===o:N?q===2*s||q===2*o:O instanceof u}const C=e.bits2int||function(O){if(O.length>8192)throw new Error("input is too large");const R=Lt(O),N=8*O.length-e.nBitLength;return N>0?R>>BigInt(N):R},P=e.bits2int_modN||function(O){return a(C(O))},D=Gi(e.nBitLength);function I(O){return vt("num < 2^"+e.nBitLength,O,wt,D),fn(O,e.nByteLength)}function A(O,R,N=L){if(["recovered","canonical"].some(be=>be in N))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:U}=e;let{lowS:F,prehash:H,extraEntropy:Z}=N;null==F&&(F=!0),O=Be("msgHash",O),$a(N),H&&(O=Be("prehashed msgHash",q(O)));const M=P(O),X=d(R),ae=[I(X),I(M)];if(null!=Z&&!1!==Z){const be=!0===Z?U(t.BYTES):Z;ae.push(Be("extraEntropy",be))}const he=Gn(...ae),_e=M;return{seed:he,k2sig:function ve(be){const Oe=C(be);if(!p(Oe))return;const Dt=c(Oe),ht=u.BASE.multiply(Oe).toAffine(),Ve=a(ht.x);if(Ve===wt)return;const st=a(Dt*a(_e+Ve*X));if(st===wt)return;let Fn=(ht.x===Ve?0:2)|Number(ht.y&fe),lr=st;return F&&m(st)&&(lr=function y(O){return m(O)?a(-O):O}(st),Fn^=1),new _(Ve,lr,Fn)}}}const L={lowS:e.lowS,prehash:!1},T={lowS:e.lowS,prehash:!1};return u.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function w(O,R=!0){return u.fromPrivateKey(O).toRawBytes(R)},getSharedSecret:function x(O,R,N=!0){if(E(O))throw new Error("first arg must be private key");if(!E(R))throw new Error("second arg must be public key");return u.fromHex(R).multiply(d(O)).toRawBytes(N)},sign:function k(O,R,N=L){const{seed:q,k2sig:U}=A(O,R,N),F=e;return wa(F.hash.outputLen,F.nByteLength,F.hmac)(q,U)},verify:function V(O,R,N,q=T){const U=O;R=Be("msgHash",R),N=Be("publicKey",N);const{lowS:F,prehash:H,format:Z}=q;if($a(q),"strict"in q)throw new Error("options.strict was renamed to lowS");if(void 0!==Z&&"compact"!==Z&&"der"!==Z)throw new Error("format must be compact or der");const M="string"==typeof U||Mt(U),X=!M&&!Z&&"object"==typeof U&&null!==U&&"bigint"==typeof U.r&&"bigint"==typeof U.s;if(!M&&!X)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ae,he;try{if(X&&(ae=new _(U.r,U.s)),M){try{"compact"!==Z&&(ae=_.fromDER(U))}catch(st){if(!(st instanceof bt.Err))throw st}!ae&&"der"!==Z&&(ae=_.fromCompact(U))}he=u.fromHex(N)}catch{return!1}if(!ae||F&&ae.hasHighS())return!1;H&&(R=e.hash(R));const{r:_e,s:ve}=ae,be=P(R),Oe=c(ve),Dt=a(be*Oe),ht=a(_e*Oe),Ve=u.BASE.multiplyAndAddUnsafe(he,Dt,ht)?.toAffine();return!!Ve&&a(Ve.x)===_e},ProjectivePoint:u,Signature:_,utils:b}}function hf(r){return{hash:r,hmac:(e,...t)=>Ir(r,e,function mh(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];zn(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const o=r[i];t.set(o,s),s+=o.length}return t}(...t)),randomBytes:an}}BigInt(4);const Fa=Pa(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),yf=function pf(r,e){const t=i=>df({...r,...hf(i)});return{...t(e),create:t}}({a:Fa.create(BigInt("-3")),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Fp:Fa,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Vn),qa="base10",Re="base16",Xe="base64pad",Nt="base64url",Wn="utf8",Ua=0,xt=1,Jn=2,mf=0,ka=1,Qn=12,os=32;function as(){return Te(an(os),Re)}function Rr(r){return Te(Vn(He(r,Re)),Re)}function at(r){return Te(Vn(He(r,Wn)),Re)}function Ba(r){return He(`${r}`,qa)}function Zt(r){return Number(Te(r,qa))}function Ma(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function La(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function za(r){if(Zt(r.type)===Jn)return Te(Un([r.type,r.sealed]),Xe);if(Zt(r.type)===xt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Te(Un([r.type,r.senderPublicKey,r.iv,r.sealed]),Xe)}return Te(Un([r.type,r.iv,r.sealed]),Xe)}function Yn(r){const t=He((r.encoding||Xe)===Nt?La(r.encoded):r.encoded,Xe),i=t.slice(mf,ka),s=ka;if(Zt(i)===xt){const u=s+os,d=u+Qn,h=t.slice(s,u),p=t.slice(u,d);return{type:i,sealed:t.slice(d),iv:p,senderPublicKey:h}}if(Zt(i)===Jn){return{type:i,sealed:t.slice(s),iv:an(Qn)}}const o=s+Qn,a=t.slice(s,o);return{type:i,sealed:t.slice(o),iv:a}}function Za(r){const e=r?.type||Ua;if(e===xt){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function Va(r){return r.type===xt&&"string"==typeof r.senderPublicKey&&"string"==typeof r.receiverPublicKey}function Ha(r){return r.type===Jn}function Pf(r,e){const[t,i,s]=r.split("."),o=Buffer.from(La(s),"base64");if(64!==o.length)throw new Error("Invalid signature length");const a=o.slice(0,32),c=o.slice(32,64),d=Vn(`${t}.${i}`),h=function If(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return Un([new Uint8Array([4]),e,t])}(e);if(!yf.verify(Un([a,c]),d,h))throw new Error("Invalid signature");return(0,jt.xp)(r).payload}function Nr(r){return r?.relay||{protocol:"irn"}}function Xn(r){const e=Pd.iO[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function Cf(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const o=s.replace(i,""),a=r[s];t[o]=a}}),t}function Ka(r){if(!r.includes("wc:")){const d=qo(r);null!=d&&d.includes("wc:")&&(r=d)}const e=(r=(r=r.includes("wc://")?r.replace("wc://",""):r).includes("wc:")?r.replace("wc:",""):r).indexOf(":"),t=-1!==r.indexOf("?")?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),o=typeof t<"u"?r.substring(t):"",a=new URLSearchParams(o),c={};a.forEach((d,h)=>{c[h]=d});const u="string"==typeof c.methods?c.methods.split(","):void 0;return{protocol:i,topic:Of(s[0]),version:parseInt(s[1],10),symKey:c.symKey,relay:Cf(c),methods:u,expiryTimestamp:c.expiryTimestamp?parseInt(c.expiryTimestamp,10):void 0}}function Of(r){return r.startsWith("//")?r.substring(2):r}function Ga(r){const e=new URLSearchParams,t=function Af(r,e="-"){const i={};return Object.keys(r).forEach(s=>{const o=s,a="relay"+e+o;r[o]&&(i[a]=r[o])}),i}(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function Tr(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var Rf=Object.defineProperty,Nf=Object.defineProperties,Tf=Object.getOwnPropertyDescriptors,Wa=Object.getOwnPropertySymbols,$f=Object.prototype.hasOwnProperty,jf=Object.prototype.propertyIsEnumerable,Ja=(r,e,t)=>e in r?Rf(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ff=(r,e)=>{for(var t in e||(e={}))$f.call(e,t)&&Ja(r,t,e[t]);if(Wa)for(var t of Wa(e))jf.call(e,t)&&Ja(r,t,e[t]);return r},qf=(r,e)=>Nf(r,Tf(e));function mn(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function $r(r){return r.includes(":")}function _n(r){return $r(r)?r.split(":")[0]:r}function jr(r){var e,t,i;const s={};if(!Tt(r))return s;for(const[o,a]of Object.entries(r)){const c=$r(o)?[o]:a.chains,u=a.methods||[],d=a.events||[],h=_n(o);s[h]=qf(Ff({},s[h]),{chains:je(c,null==(e=s[h])?void 0:e.chains),methods:je(u,null==(t=s[h])?void 0:t.methods),events:je(d,null==(i=s[h])?void 0:i.events)})}return s}function Qa(r,e){const t=function Mf(r){const e={};return r?.forEach(t=>{var i;const[s,o]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),null==(i=e[s].chains)||i.push(`${s}:${o}`)}),e}(e=e.map(i=>i.replace("did:pkh:","")));for(const[i,s]of Object.entries(t))s.methods?s.methods=je(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}const zf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Zf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function $(r,e){const{message:t,code:i}=Zf[r];return{message:e?`${t} ${e}`:t,code:i}}function te(r,e){const{message:t,code:i}=zf[r];return{message:e?`${t} ${e}`:t,code:i}}function et(r,e){return!!Array.isArray(r)&&(!(typeof e<"u"&&r.length)||r.every(e))}function Tt(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Ee(r){return typeof r>"u"}function ue(r,e){return!(!e||!Ee(r))||"string"==typeof r&&!!r.trim().length}function cs(r,e){return!(!e||!Ee(r))||"number"==typeof r&&!isNaN(r)}function Fr(r){return!(!ue(r,!1)||!r.includes(":"))&&2===r.split(":").length}function Ya(r){let e=!0;return et(r)?r.length&&(e=r.every(t=>ue(t,!1))):e=!1,e}function Yf(r,e,t){let i=null;return Object.entries(r).forEach(([s,o])=>{if(i)return;const a=function Qf(r,e,t){let i=null;return et(e)&&e.length?e.forEach(s=>{i||Fr(s)||(i=te("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Fr(r)||(i=te("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}(s,xi(s,o),`${e} ${t}`);a&&(i=a)}),i}function Xf(r,e){let t=null;return et(r)?r.forEach(i=>{t||function Hf(r){if(ue(r,!1)&&r.includes(":")){const e=r.split(":");if(3===e.length){const t=e[0]+":"+e[1];return!!e[2]&&Fr(t)}}return!1}(i)||(t=te("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Xa(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=function tg(r,e){let t=null;return Ya(r?.methods)?Ya(r?.events)||(t=te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}(i,`${e}, namespace`);s&&(t=s)}),t}function qr(r,e){let t=null;if(r&&Tt(r)){const i=Xa(r,e);i&&(t=i);const s=function eg(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Xf(i?.accounts,`${e} namespace`);s&&(t=s)}),t}(r,e);s&&(t=s)}else t=$("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function ec(r){return ue(r.protocol,!0)}function qe(r){return typeof r<"u"&&null!==typeof r}function tc(r,e){return!(!Fr(e)||!function Uf(r){const e=[];return Object.values(r).forEach(t=>{e.push(...mn(t.accounts))}),e}(r).includes(e))}function ug(r,e,t){return!!ue(t,!1)&&function kf(r,e){const t=[];return Object.values(r).forEach(i=>{mn(i.accounts).includes(e)&&t.push(...i.methods)}),t}(r,e).includes(t)}function lg(r,e,t){return!!ue(t,!1)&&function Bf(r,e){const t=[];return Object.values(r).forEach(i=>{mn(i.accounts).includes(e)&&t.push(...i.events)}),t}(r,e).includes(t)}function us(r,e,t){let i=null;const s=function dg(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:null==(i=r[t].chains)||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}(r),o=function hg(r){const e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:mn(r[t].accounts)?.forEach(s=>{e[s]={accounts:r[t].accounts.filter(o=>o.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}),e}(e),a=Object.keys(s),c=Object.keys(o),u=nc(Object.keys(r)),d=nc(Object.keys(e)),h=u.filter(p=>!d.includes(p));return h.length&&(i=$("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${h.toString()}\n      Received: ${Object.keys(e).toString()}`)),qt(a,c)||(i=$("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.\n      Required: ${a.toString()}\n      Approved: ${c.toString()}`)),Object.keys(e).forEach(p=>{if(!p.includes(":")||i)return;const g=mn(e[p].accounts);g.includes(p)||(i=$("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${p}\n        Required: ${p}\n        Approved: ${g.toString()}`))}),a.forEach(p=>{i||(qt(s[p].methods,o[p].methods)?qt(s[p].events,o[p].events)||(i=$("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${p}`)):i=$("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${p}`))}),i}function nc(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function rc(){const r=nn();return new Promise(e=>{switch(r){case $e.browser:e(function fg(){return tn()&&navigator?.onLine}());break;case $e.reactNative:e(function gg(){return ls.apply(this,arguments)}());break;case $e.node:default:e(!0)}})}function ls(){return(ls=(0,f.Z)(function*(){return!(Pt()&&typeof global<"u"&&null!=global&&global.NetInfo)||(yield null==global?void 0:global.NetInfo.fetch())?.isConnected})).apply(this,arguments)}function mg(r){switch(nn()){case $e.browser:!function _g(r){!Pt()&&tn()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}(r);break;case $e.reactNative:!function vg(r){Pt()&&typeof global<"u"&&null!=global&&global.NetInfo&&global?.NetInfo.addEventListener(e=>r(e?.isConnected))}(r);case $e.node:}}const ds={};class er{static get(e){return ds[e]}static set(e,t){ds[e]=t}static delete(e){delete ds[e]}}var Vt=B(63388),wg=B(73407),K=B(87714),vn=B(62108),xg=Object.defineProperty,ic=(r,e,t)=>((r,e,t)=>e in r?xg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Dg extends vn.q{constructor(e){super(),this.opts=e,ic(this,"protocol","wc"),ic(this,"version",2)}}var Ig=Object.defineProperty,Sg=(r,e,t)=>((r,e,t)=>e in r?Ig(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Cg extends vn.q{constructor(e,t){super(),this.core=e,this.logger=t,Sg(this,"records",new Map)}}class Og{constructor(e,t){this.logger=e,this.core=t}}class Ag extends vn.q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Rg extends vn.q{constructor(e){super()}}class Ng{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}}Object.defineProperty;class Fg extends vn.q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class qg extends vn.q{constructor(e,t){super(),this.core=e,this.logger=t}}class Ug{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}}class kg{constructor(e,t){this.projectId=e,this.logger=t}}class Bg{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}}var Mg=Object.defineProperty,sc=(r,e,t)=>((r,e,t)=>e in r?Mg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class zg{constructor(e){this.opts=e,sc(this,"protocol","wc"),sc(this,"version",2)}}class Zg{constructor(e){this.client=e}}var hs=B(57630),Ke=B(20259),z=B(26446),Vg=B(66898);const Ur="core",ct=`wc@2:${Ur}:`,Hg_logger="error",Kg={database:":memory:"},cc="client_ed25519_seed",Wg=j.ONE_DAY,uc=j.SIX_HOURS,dc="wss://relay.walletconnect.org",ge_message="relayer_message",ge_message_ack="relayer_message_ack",ge_connect="relayer_connect",ge_disconnect="relayer_disconnect",ge_error="relayer_error",ge_connection_stalled="relayer_connection_stalled",ge_publish="relayer_publish",Ge_payload="payload",Ge_connect="connect",Ge_disconnect="disconnect",Ge_error="error",ps="2.21.1",oe={link_mode:"link_mode",relay:"relay"},kr_inbound="inbound",kr_outbound="outbound",hc="WALLETCONNECT_LINK_MODE_APPS",Me_created="subscription_created",Me_deleted="subscription_deleted",Me_sync="subscription_sync",Me_resubscribed="subscription_resubscribed",tr=(j.FIVE_SECONDS,{wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}}),Ht_create="pairing_create",Ht_expire="pairing_expire",Ht_delete="pairing_delete",Ht_ping="pairing_ping",tt_created="history_created",tt_updated="history_updated",tt_deleted="history_deleted",tt_sync="history_sync",We_created="expirer_created",We_deleted="expirer_deleted",We_expired="expirer_expired",We_sync="expirer_sync",pc="https://verify.walletconnect.org",nr=pc,my=`${nr}/v3`,_y=["https://verify.walletconnect.com",pc],ut_pairing_started="pairing_started",ut_pairing_uri_validation_success="pairing_uri_validation_success",ut_pairing_uri_not_expired="pairing_uri_not_expired",ut_store_new_pairing="store_new_pairing",ut_subscribing_pairing_topic="subscribing_pairing_topic",ut_subscribe_pairing_topic_success="subscribe_pairing_topic_success",ut_existing_pairing="existing_pairing",ut_pairing_not_expired="pairing_not_expired",ut_emit_inactive_pairing="emit_inactive_pairing",ut_emit_session_proposal="emit_session_proposal",Et_no_internet_connection="no_internet_connection",Et_malformed_pairing_uri="malformed_pairing_uri",Et_active_pairing_already_exists="active_pairing_already_exists",Et_subscribe_pairing_topic_failure="subscribe_pairing_topic_failure",Et_pairing_expired="pairing_expired",Et_proposal_listener_not_found="proposal_listener_not_found",nt_session_approve_started="session_approve_started",nt_session_namespaces_validation_success="session_namespaces_validation_success",nt_subscribing_session_topic="subscribing_session_topic",nt_subscribe_session_topic_success="subscribe_session_topic_success",nt_publishing_session_approve="publishing_session_approve",nt_session_approve_publish_success="session_approve_publish_success",nt_store_session="store_session",nt_publishing_session_settle="publishing_session_settle",nt_session_settle_publish_success="session_settle_publish_success",Kt_no_internet_connection="no_internet_connection",Kt_proposal_expired="proposal_expired",Kt_subscribe_session_topic_failure="subscribe_session_topic_failure",Kt_session_approve_publish_failure="session_approve_publish_failure",Kt_session_settle_publish_failure="session_settle_publish_failure",Kt_session_approve_namespace_validation_failure="session_approve_namespace_validation_failure",Kt_proposal_not_found="proposal_not_found",Gt_authenticated_session_approve_started="authenticated_session_approve_started",Gt_create_authenticated_session_topic="create_authenticated_session_topic",Gt_cacaos_verified="cacaos_verified",Gt_store_authenticated_session="store_authenticated_session",Gt_subscribing_authenticated_session_topic="subscribing_authenticated_session_topic",Gt_subscribe_authenticated_session_topic_success="subscribe_authenticated_session_topic_success",Gt_publishing_authenticated_session_approve="publishing_authenticated_session_approve",rr_no_internet_connection="no_internet_connection",rr_invalid_cacao="invalid_cacao",rr_subscribe_authenticated_session_topic_failure="subscribe_authenticated_session_topic_failure",rr_authenticated_session_approve_publish_failure="authenticated_session_approve_publish_failure",rr_authenticated_session_pending_request_not_found="authenticated_session_pending_request_not_found";var Py=function Iy(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),a=o.charCodeAt(0);if(255!==t[a])throw new TypeError(o+" is ambiguous");t[a]=s}var c=r.length,u=r.charAt(0),d=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function g(y){if("string"!=typeof y)throw new TypeError("Expected String");if(0===y.length)return new Uint8Array;var v=0;if(" "!==y[v]){for(var _=0,b=0;y[v]===u;)_++,v++;for(var w=(y.length-v)*d+1>>>0,E=new Uint8Array(w);y[v];){var x=t[y.charCodeAt(v)];if(255===x)return;for(var C=0,P=w-1;(0!==x||C<b)&&-1!==P;P--,C++)x+=c*E[P]>>>0,E[P]=x%256>>>0,x=x/256>>>0;if(0!==x)throw new Error("Non-zero carry");b=C,v++}if(" "!==y[v]){for(var D=w-b;D!==w&&0===E[D];)D++;for(var I=new Uint8Array(_+(w-D)),A=_;D!==w;)I[A++]=E[D++];return I}}}return{encode:function p(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===y.length)return"";for(var v=0,_=0,b=0,w=y.length;b!==w&&0===y[b];)b++,v++;for(var E=(w-b)*h+1>>>0,x=new Uint8Array(E);b!==w;){for(var C=y[b],P=0,D=E-1;(0!==C||P<_)&&-1!==D;D--,P++)C+=256*x[D]>>>0,x[D]=C%c>>>0,C=C/c>>>0;if(0!==C)throw new Error("Non-zero carry");_=P,b++}for(var I=E-_;I!==E&&0===x[I];)I++;for(var A=u.repeat(v);I<E;++I)A+=r.charAt(x[I]);return A},decodeUnsafe:g,decode:function m(y){var v=g(y);if(v)return v;throw new Error(`Non-${e} character`)}}},Sy=Py;const fc=r=>{if(r instanceof Uint8Array&&"Uint8Array"===r.constructor.name)return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};class Ay{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ry{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return gc(this,e)}}class Ny{constructor(e){this.decoders=e}or(e){return gc(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const gc=(r,e)=>new Ny({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Ty{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Ay(e,t,i),this.decoder=new Ry(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Br=({name:r,prefix:e,encode:t,decode:i})=>new Ty(r,e,t,i),ir=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Sy(t,e);return Br({prefix:r,name:e,encode:i,decode:o=>fc(s(o))})},De=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Br({prefix:e,name:r,encode:s=>((r,e,t)=>{const i="="===e[e.length-1],s=(1<<t)-1;let o="",a=0,c=0;for(let u=0;u<r.length;++u)for(c=c<<8|r[u],a+=8;a>t;)a-=t,o+=e[s&c>>a];if(a&&(o+=e[s&c<<t-a]),i)for(;o.length*t&7;)o+="=";return o})(s,i,t),decode:s=>((r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let o=r.length;for(;"="===r[o-1];)--o;const a=new Uint8Array(o*t/8|0);let c=0,u=0,d=0;for(let h=0;h<o;++h){const p=s[r[h]];if(void 0===p)throw new SyntaxError(`Non-${i} character`);u=u<<t|p,c+=t,c>=8&&(c-=8,a[d++]=255&u>>c)}if(c>=t||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a})(s,i,t,r)}),Fy=Br({prefix:"\0",name:"identity",encode:r=>(r=>(new TextDecoder).decode(r))(r),decode:r=>(r=>(new TextEncoder).encode(r))(r)});var qy=Object.freeze({__proto__:null,identity:Fy});const Uy=De({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ky=Object.freeze({__proto__:null,base2:Uy});const By=De({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var My=Object.freeze({__proto__:null,base8:By});const Ly=ir({prefix:"9",name:"base10",alphabet:"0123456789"});var zy=Object.freeze({__proto__:null,base10:Ly});const Zy=De({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Vy=De({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Hy=Object.freeze({__proto__:null,base16:Zy,base16upper:Vy});const Ky=De({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Gy=De({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Wy=De({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Jy=De({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Qy=De({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Yy=De({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Xy=De({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),em=De({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tm=De({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var nm=Object.freeze({__proto__:null,base32:Ky,base32upper:Gy,base32pad:Wy,base32padupper:Jy,base32hex:Qy,base32hexupper:Yy,base32hexpad:Xy,base32hexpadupper:em,base32z:tm});const rm=ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),im=ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sm=Object.freeze({__proto__:null,base36:rm,base36upper:im});const om=ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),am=ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cm=Object.freeze({__proto__:null,base58btc:om,base58flickr:am});const um=De({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lm=De({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),dm=De({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hm=De({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var pm=Object.freeze({__proto__:null,base64:um,base64pad:lm,base64url:dm,base64urlpad:hm});const yc=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),fm=yc.reduce((r,e,t)=>(r[t]=e,r),[]),gm=yc.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);const _m=Br({prefix:"\u{1f680}",name:"base256emoji",encode:function ym(r){return r.reduce((e,t)=>e+=fm[t],"")},decode:function mm(r){const e=[];for(const t of r){const i=gm[t.codePointAt(0)];if(void 0===i)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}});var vm=Object.freeze({__proto__:null,base256emoji:_m}),bm=function _c(r,e,t){e=e||[];for(var i=t=t||0;r>=Em;)e[t++]=255&r|mc,r/=128;for(;r&xm;)e[t++]=255&r|mc,r>>>=7;return e[t]=0|r,_c.bytes=t-i+1,e},mc=128,xm=-128,Em=Math.pow(2,31);var Dm=function fs(r,i){var a,t=0,s=0,o=i=i||0,c=r.length;do{if(o>=c)throw fs.bytes=0,new RangeError("Could not decode varint");a=r[o++],t+=s<28?(a&vc)<<s:(a&vc)*Math.pow(2,s),s+=7}while(a>=Im);return fs.bytes=o-i,t},Im=128,vc=127;var Pm=Math.pow(2,7),Sm=Math.pow(2,14),Cm=Math.pow(2,21),Om=Math.pow(2,28),Am=Math.pow(2,35),Rm=Math.pow(2,42),Nm=Math.pow(2,49),Tm=Math.pow(2,56),$m=Math.pow(2,63),Fm={encode:bm,decode:Dm,encodingLength:function(r){return r<Pm?1:r<Sm?2:r<Cm?3:r<Om?4:r<Am?5:r<Rm?6:r<Nm?7:r<Tm?8:r<$m?9:10}},bc=Fm;const wc=(r,e,t=0)=>(bc.encode(r,e,t),e),xc=r=>bc.encodingLength(r),gs=(r,e)=>{const t=e.byteLength,i=xc(r),s=i+xc(t),o=new Uint8Array(s+t);return wc(r,o,0),wc(t,o,i),o.set(e,s),new qm(r,t,e,o)};class qm{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Ec=({name:r,code:e,encode:t})=>new Um(r,e,t);class Um{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?gs(this.code,t):t.then(i=>gs(this.code,i))}throw Error("Unknown type, must be binary type")}}const Dc=r=>function(){var e=(0,f.Z)(function*(t){return new Uint8Array(yield crypto.subtle.digest(r,t))});return function(t){return e.apply(this,arguments)}}(),km=Ec({name:"sha2-256",code:18,encode:Dc("SHA-256")}),Bm=Ec({name:"sha2-512",code:19,encode:Dc("SHA-512")});Object.freeze({__proto__:null,sha256:km,sha512:Bm});const Pc=fc;Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:Pc,digest:r=>gs(0,Pc(r))}});new TextEncoder,new TextDecoder;const Sc={...qy,...ky,...My,...zy,...Hy,...nm,...sm,...cm,...pm,...vm};function Cc(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Oc=Cc("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>(new TextEncoder).encode(r.substring(1))),ys=Cc("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{const e=function Zm(r=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}((r=r.substring(1)).length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Vm={utf8:Oc,"utf-8":Oc,hex:Sc.base16,latin1:ys,ascii:ys,binary:ys,...Sc};var Km=Object.defineProperty,lt=(r,e,t)=>((r,e,t)=>e in r?Km(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Wm{constructor(e,t){var i=this;this.core=e,this.logger=t,lt(this,"keychain",new Map),lt(this,"name","keychain"),lt(this,"version","0.3"),lt(this,"initialized",!1),lt(this,"storagePrefix",ct),lt(this,"init",(0,f.Z)(function*(){if(!i.initialized){const s=yield i.getKeyChain();typeof s<"u"&&(i.keychain=s),i.initialized=!0}})),lt(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),lt(this,"set",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),i.keychain.set(o,a),yield i.persist()});return function(o,a){return s.apply(this,arguments)}}()),lt(this,"get",s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:a}=$("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(a)}return o}),lt(this,"del",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),i.keychain.delete(o),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.core=e,this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}setKeyChain(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,Di(e))})()}getKeyChain(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?Ii(t):void 0})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setKeyChain(e.keychain)})()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Jm=Object.defineProperty,Ie=(r,e,t)=>((r,e,t)=>e in r?Jm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Ym{constructor(e,t,i){var s=this;this.core=e,this.logger=t,Ie(this,"name","crypto"),Ie(this,"keychain"),Ie(this,"randomSessionIdentifier",as()),Ie(this,"initialized",!1),Ie(this,"init",(0,f.Z)(function*(){s.initialized||(yield s.keychain.init(),s.initialized=!0)})),Ie(this,"hasKeys",o=>(this.isInitialized(),this.keychain.has(o))),Ie(this,"getClientId",(0,f.Z)(function*(){s.isInitialized();const o=yield s.getClientSeed(),a=jt.Au(o);return jt.bG(a.publicKey)})),Ie(this,"generateKeyPair",()=>{this.isInitialized();const o=function _f(){const r=ss.utils.randomPrivateKey(),e=ss.getPublicKey(r);return{privateKey:Te(r,Re),publicKey:Te(e,Re)}}();return this.setPrivateKey(o.publicKey,o.privateKey)}),Ie(this,"signJWT",function(){var o=(0,f.Z)(function*(a){s.isInitialized();const c=yield s.getClientSeed(),u=jt.Au(c),d=s.randomSessionIdentifier,h=Wg;return yield jt.vf(d,a,h,u)});return function(a){return o.apply(this,arguments)}}()),Ie(this,"generateSharedKey",(o,a,c)=>{this.isInitialized();const d=function vf(r,e){const t=ss.getSharedSecret(He(r,Re),He(e,Re));return Te(xp(Vn,t,void 0,void 0,os),Re)}(this.getPrivateKey(o),a);return this.setSymKey(d,c)}),Ie(this,"setSymKey",function(){var o=(0,f.Z)(function*(a,c){s.isInitialized();const u=c||Rr(a);return yield s.keychain.set(u,a),u});return function(a,c){return o.apply(this,arguments)}}()),Ie(this,"deleteKeyPair",function(){var o=(0,f.Z)(function*(a){s.isInitialized(),yield s.keychain.del(a)});return function(a){return o.apply(this,arguments)}}()),Ie(this,"deleteSymKey",function(){var o=(0,f.Z)(function*(a){s.isInitialized(),yield s.keychain.del(a)});return function(a){return o.apply(this,arguments)}}()),Ie(this,"encode",function(){var o=(0,f.Z)(function*(a,c,u){s.isInitialized();const d=Za(u),h=(0,hs.u)(c);if(Ha(d))return function xf(r,e){const t=Ba(Jn),i=an(Qn),o=za({type:t,sealed:He(r,Wn),iv:i});return e===Nt?Ma(o):o}(h,u?.encoding);if(Va(d)){const y=d.senderPublicKey,v=d.receiverPublicKey;a=yield s.generateSharedKey(y,v)}const p=s.getSymKey(a),{type:g,senderPublicKey:m}=d;return function bf(r){const e=Ba(typeof r.type<"u"?r.type:Ua);if(Zt(e)===xt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?He(r.senderPublicKey,Re):void 0,i=typeof r.iv<"u"?He(r.iv,Re):an(Qn),s=He(r.symKey,Re),a=za({type:e,sealed:ga(s,i).encrypt(He(r.message,Wn)),iv:i,senderPublicKey:t});return r.encoding===Nt?Ma(a):a}({type:g,symKey:p,message:h,senderPublicKey:m,encoding:u?.encoding})});return function(a,c,u){return o.apply(this,arguments)}}()),Ie(this,"decode",function(){var o=(0,f.Z)(function*(a,c,u){s.isInitialized();const d=function Df(r,e){const t=Yn({encoded:r,encoding:e?.encoding});return Za({type:Zt(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Te(t.senderPublicKey,Re):void 0,receiverPublicKey:e?.receiverPublicKey})}(c,u);if(Ha(d)){const h=function Ef(r,e){const{sealed:t}=Yn({encoded:r,encoding:e});return Te(t,Wn)}(c,u?.encoding);return(0,hs.D)(h)}if(Va(d)){const h=d.receiverPublicKey,p=d.senderPublicKey;a=yield s.generateSharedKey(h,p)}try{const p=function wf(r){const e=He(r.symKey,Re),{sealed:t,iv:i}=Yn({encoded:r.encoded,encoding:r.encoding}),s=ga(e,i).decrypt(t);if(null===s)throw new Error("Failed to decrypt");return Te(s,Wn)}({symKey:s.getSymKey(a),encoded:c,encoding:u?.encoding});return(0,hs.D)(p)}catch(h){s.logger.error(`Failed to decode message from topic: '${a}', clientId: '${yield s.getClientId()}'`),s.logger.error(h)}});return function(a,c,u){return o.apply(this,arguments)}}()),Ie(this,"getPayloadType",(o,a=Xe)=>Zt(Yn({encoded:o,encoding:a}).type)),Ie(this,"getPayloadSenderPublicKey",(o,a=Xe)=>{const c=Yn({encoded:o,encoding:a});return c.senderPublicKey?Te(c.senderPublicKey,Re):void 0}),this.core=e,this.logger=(0,K.Ep)(t,this.name),this.keychain=i||new Wm(this.core,this.logger)}get context(){return(0,K.Fd)(this.logger)}setPrivateKey(e,t){var i=this;return(0,f.Z)(function*(){return yield i.keychain.set(e,t),e})()}getPrivateKey(e){return this.keychain.get(e)}getClientSeed(){var e=this;return(0,f.Z)(function*(){let t="";try{t=e.keychain.get(cc)}catch{t=as(),yield e.keychain.set(cc,t)}return function Hm(r,e="utf8"){const t=Vm[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${r}`):globalThis.Buffer.from(r,"utf8")}(t,"base16")})()}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Xm=Object.defineProperty,e_=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,Ac=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,ms=(r,e,t)=>e in r?Xm(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Le=(r,e,t)=>ms(r,"symbol"!=typeof e?e+"":e,t);class o_ extends Og{constructor(e,t){var i;super(e,t),i=this,this.logger=e,this.core=t,Le(this,"messages",new Map),Le(this,"messagesWithoutClientAck",new Map),Le(this,"name","messages"),Le(this,"version","0.3"),Le(this,"initialized",!1),Le(this,"storagePrefix",ct),Le(this,"init",(0,f.Z)(function*(){if(!i.initialized){i.logger.trace("Initialized");try{const s=yield i.getRelayerMessages();typeof s<"u"&&(i.messages=s);const o=yield i.getRelayerMessagesWithoutClientAck();typeof o<"u"&&(i.messagesWithoutClientAck=o),i.logger.debug(`Successfully Restored records for ${i.name}`),i.logger.trace({type:"method",method:"restore",size:i.messages.size})}catch(s){i.logger.debug(`Failed to Restore records for ${i.name}`),i.logger.error(s)}finally{i.initialized=!0}}})),Le(this,"set",function(){var s=(0,f.Z)(function*(o,a,c){i.isInitialized();const u=at(a);let d=i.messages.get(o);if(typeof d>"u"&&(d={}),typeof d[u]<"u")return u;if(d[u]=a,i.messages.set(o,d),c===kr_inbound){const h=i.messagesWithoutClientAck.get(o)||{};i.messagesWithoutClientAck.set(o,((r,e)=>e_(r,t_(e)))(((r,e)=>{for(var t in e||(e={}))n_.call(e,t)&&ms(r,t,e[t]);if(Ac)for(var t of Ac(e))r_.call(e,t)&&ms(r,t,e[t]);return r})({},h),{[u]:a}))}return yield i.persist(),u});return function(o,a,c){return s.apply(this,arguments)}}()),Le(this,"get",s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o}),Le(this,"getWithoutAck",s=>{this.isInitialized();const o={};for(const a of s){const c=this.messagesWithoutClientAck.get(a)||{};o[a]=Object.values(c)}return o}),Le(this,"has",(s,o)=>{this.isInitialized();return typeof this.get(s)[at(o)]<"u"}),Le(this,"ack",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized();const c=i.messagesWithoutClientAck.get(o);if(typeof c>"u")return;delete c[at(a)],0===Object.keys(c).length?i.messagesWithoutClientAck.delete(o):i.messagesWithoutClientAck.set(o,c),yield i.persist()});return function(o,a){return s.apply(this,arguments)}}()),Le(this,"del",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),i.messages.delete(o),i.messagesWithoutClientAck.delete(o),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.logger=(0,K.Ep)(e,this.name),this.core=t}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}setRelayerMessages(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,Di(e))})()}setRelayerMessagesWithoutClientAck(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKeyWithoutClientAck,Di(e))})()}getRelayerMessages(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?Ii(t):void 0})()}getRelayerMessagesWithoutClientAck(){var e=this;return(0,f.Z)(function*(){const t=yield e.core.storage.getItem(e.storageKeyWithoutClientAck);return typeof t<"u"?Ii(t):void 0})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setRelayerMessages(e.messages),yield e.setRelayerMessagesWithoutClientAck(e.messagesWithoutClientAck)})()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var a_=Object.defineProperty,c_=Object.defineProperties,u_=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,l_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,_s=(r,e,t)=>e in r?a_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Mr=(r,e)=>{for(var t in e||(e={}))l_.call(e,t)&&_s(r,t,e[t]);if(Rc)for(var t of Rc(e))d_.call(e,t)&&_s(r,t,e[t]);return r},vs=(r,e)=>c_(r,u_(e)),rt=(r,e,t)=>_s(r,"symbol"!=typeof e?e+"":e,t);class h_ extends Ag{constructor(e,t){var i;super(e,t),i=this,this.relayer=e,this.logger=t,rt(this,"events",new pt.EventEmitter),rt(this,"name","publisher"),rt(this,"queue",new Map),rt(this,"publishTimeout",(0,j.toMiliseconds)(j.ONE_MINUTE)),rt(this,"initialPublishTimeout",(0,j.toMiliseconds)(15*j.ONE_SECOND)),rt(this,"needsTransportRestart",!1),rt(this,"publish",function(){var s=(0,f.Z)(function*(o,a,c){var u;i.logger.debug("Publishing Payload"),i.logger.trace({type:"method",method:"publish",params:{topic:o,message:a,opts:c}});const d=c?.ttl||uc,h=Nr(c),p=c?.prompt||!1,g=c?.tag||0,m=c?.id||(0,z.getBigIntRpcId)().toString(),y={topic:o,message:a,opts:{ttl:d,relay:h,prompt:p,tag:g,id:m,attestation:c?.attestation,tvf:c?.tvf}},v=`Failed to publish payload, please try again. id:${m} tag:${g}`;try{const _=new Promise(function(){var b=(0,f.Z)(function*(w){const E=({id:C})=>{y.opts.id===C&&(i.removeRequestFromQueue(C),i.relayer.events.removeListener(ge_publish,E),w(y))};i.relayer.events.on(ge_publish,E);const x=St(new Promise((C,P)=>{i.rpcPublish({topic:o,message:a,ttl:d,prompt:p,tag:g,id:m,attestation:c?.attestation,tvf:c?.tvf}).then(C).catch(D=>{i.logger.warn(D,D?.message),P(D)})}),i.initialPublishTimeout,`Failed initial publish, retrying.... id:${m} tag:${g}`);try{yield x,i.events.removeListener(ge_publish,E)}catch(C){i.queue.set(m,vs(Mr({},y),{attempt:1})),i.logger.warn(C,C?.message)}});return function(w){return b.apply(this,arguments)}}());i.logger.trace({type:"method",method:"publish",params:{id:m,topic:o,message:a,opts:c}}),yield St(_,i.publishTimeout,v)}catch(_){if(i.logger.debug("Failed to Publish Payload"),i.logger.error(_),null!=(u=c?.internal)&&u.throwOnFailedPublish)throw _}finally{i.queue.delete(m)}});return function(o,a,c){return s.apply(this,arguments)}}()),rt(this,"on",(s,o)=>{this.events.on(s,o)}),rt(this,"once",(s,o)=>{this.events.once(s,o)}),rt(this,"off",(s,o)=>{this.events.off(s,o)}),rt(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.relayer=e,this.logger=(0,K.Ep)(t,this.name),this.registerEventListeners()}get context(){return(0,K.Fd)(this.logger)}rpcPublish(e){var t=this;return(0,f.Z)(function*(){var i,s,o,a;const{topic:c,message:u,ttl:d=uc,prompt:h,tag:p,id:g,attestation:m,tvf:y}=e,v={method:Xn(Nr().protocol).publish,params:Mr({topic:c,message:u,ttl:d,prompt:h,tag:p,attestation:m},y),id:g};Ee(null==(i=v.params)?void 0:i.prompt)&&(null==(s=v.params)||delete s.prompt),Ee(null==(o=v.params)?void 0:o.tag)&&(null==(a=v.params)||delete a.tag),t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"message",direction:"outgoing",request:v});const _=yield t.relayer.request(v);return t.relayer.events.emit(ge_publish,e),t.logger.debug("Successfully Published Payload"),_})()}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){var e=this;this.queue.forEach(function(){var t=(0,f.Z)(function*(i,s){const o=i.attempt+1;e.queue.set(s,vs(Mr({},i),{attempt:o}));const{topic:a,message:c,opts:u,attestation:d}=i;e.logger.warn({},`Publisher: queue->publishing: ${i.opts.id}, tag: ${i.opts.tag}, attempt: ${o}`),yield e.rpcPublish(vs(Mr({},i),{topic:a,message:c,ttl:u.ttl,prompt:u.prompt,tag:u.tag,id:u.id,attestation:d,tvf:u.tvf})),e.logger.warn({},`Publisher: queue->published: ${i.opts.id}`)});return function(i,s){return t.apply(this,arguments)}}())}registerEventListeners(){this.relayer.core.heartbeat.on(Vt.Lx.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(ge_connection_stalled);this.checkQueue()}),this.relayer.on(ge_message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var p_=Object.defineProperty,bn=(r,e,t)=>((r,e,t)=>e in r?p_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class g_{constructor(){bn(this,"map",new Map),bn(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),bn(this,"get",e=>this.map.get(e)||[]),bn(this,"exists",(e,t)=>this.get(e).includes(t)),bn(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(o=>o!==t);s.length?this.map.set(e,s):this.map.delete(e)}),bn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var y_=Object.defineProperty,m_=Object.defineProperties,__=Object.getOwnPropertyDescriptors,Nc=Object.getOwnPropertySymbols,v_=Object.prototype.hasOwnProperty,b_=Object.prototype.propertyIsEnumerable,bs=(r,e,t)=>e in r?y_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,sr=(r,e)=>{for(var t in e||(e={}))v_.call(e,t)&&bs(r,t,e[t]);if(Nc)for(var t of Nc(e))b_.call(e,t)&&bs(r,t,e[t]);return r},ws=(r,e)=>m_(r,__(e)),ne=(r,e,t)=>bs(r,"symbol"!=typeof e?e+"":e,t);class w_ extends Fg{constructor(e,t){var i;super(e,t),i=this,this.relayer=e,this.logger=t,ne(this,"subscriptions",new Map),ne(this,"topicMap",new g_),ne(this,"events",new pt.EventEmitter),ne(this,"name","subscription"),ne(this,"version","0.3"),ne(this,"pending",new Map),ne(this,"cached",[]),ne(this,"initialized",!1),ne(this,"storagePrefix",ct),ne(this,"subscribeTimeout",(0,j.toMiliseconds)(j.ONE_MINUTE)),ne(this,"initialSubscribeTimeout",(0,j.toMiliseconds)(15*j.ONE_SECOND)),ne(this,"clientId"),ne(this,"batchSubscribeTopicsLimit",500),ne(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),i.registerEventListeners(),yield i.restore()),i.initialized=!0})),ne(this,"subscribe",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),i.logger.debug("Subscribing Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}});try{const c=Nr(a),u={topic:o,relay:c,transportType:a?.transportType};i.pending.set(o,u);const d=yield i.rpcSubscribe(o,c,a);return"string"==typeof d&&(i.onSubscribe(d,u),i.logger.debug("Successfully Subscribed Topic"),i.logger.trace({type:"method",method:"subscribe",params:{topic:o,opts:a}})),d}catch(c){throw i.logger.debug("Failed to Subscribe Topic"),i.logger.error(c),c}});return function(o,a){return s.apply(this,arguments)}}()),ne(this,"unsubscribe",function(){var s=(0,f.Z)(function*(o,a){i.isInitialized(),typeof a?.id<"u"?yield i.unsubscribeById(o,a.id,a):yield i.unsubscribeByTopic(o,a)});return function(o,a){return s.apply(this,arguments)}}()),ne(this,"isSubscribed",s=>new Promise(o=>{o(this.topicMap.topics.includes(s))})),ne(this,"isKnownTopic",s=>new Promise(o=>{o(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(a=>a.topic===s))})),ne(this,"on",(s,o)=>{this.events.on(s,o)}),ne(this,"once",(s,o)=>{this.events.once(s,o)}),ne(this,"off",(s,o)=>{this.events.off(s,o)}),ne(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),ne(this,"start",(0,f.Z)(function*(){yield i.onConnect()})),ne(this,"stop",(0,f.Z)(function*(){yield i.onDisconnect()})),ne(this,"restart",(0,f.Z)(function*(){yield i.restore(),yield i.onRestart()})),ne(this,"checkPending",(0,f.Z)(function*(){if(!(0!==i.pending.size||i.initialized&&i.relayer.connected))return;const s=[];i.pending.forEach(o=>{s.push(o)}),yield i.batchSubscribe(s)})),ne(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Vt.Lx.pulse,(0,f.Z)(function*(){yield i.checkPending()})),this.events.on(Me_created,function(){var s=(0,f.Z)(function*(o){const a=Me_created;i.logger.info(`Emitting ${a}`),i.logger.debug({type:"event",event:a,data:o}),yield i.persist()});return function(o){return s.apply(this,arguments)}}()),this.events.on(Me_deleted,function(){var s=(0,f.Z)(function*(o){const a=Me_deleted;i.logger.info(`Emitting ${a}`),i.logger.debug({type:"event",event:a,data:o}),yield i.persist()});return function(o){return s.apply(this,arguments)}}())}),this.relayer=e,this.logger=(0,K.Ep)(t,this.name),this.clientId=""}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}unsubscribeByTopic(e,t){var i=this;return(0,f.Z)(function*(){const s=i.topicMap.get(e);yield Promise.all(s.map(function(){var o=(0,f.Z)(function*(a){return yield i.unsubscribeById(e,a,t)});return function(a){return o.apply(this,arguments)}}()))})()}unsubscribeById(e,t,i){var s=this;return(0,f.Z)(function*(){s.logger.debug("Unsubscribing Topic"),s.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const o=Nr(i);yield s.restartToComplete({topic:e,id:t,relay:o}),yield s.rpcUnsubscribe(e,t,o);const a=te("USER_DISCONNECTED",`${s.name}, ${e}`);yield s.onUnsubscribe(e,t,a),s.logger.debug("Successfully Unsubscribed Topic"),s.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(o){throw s.logger.debug("Failed to Unsubscribe Topic"),s.logger.error(o),o}})()}rpcSubscribe(e,t,i){var s=this;return(0,f.Z)(function*(){var o;(!i||i?.transportType===oe.relay)&&(yield s.restartToComplete({topic:e,id:e,relay:t}));const a={method:Xn(t.protocol).subscribe,params:{topic:e}};s.logger.debug("Outgoing Relay Payload"),s.logger.trace({type:"payload",direction:"outgoing",request:a});const c=null==(o=i?.internal)?void 0:o.throwOnFailedPublish;try{const u=yield s.getSubscriptionId(e);if(i?.transportType===oe.link_mode)return setTimeout(()=>{(s.relayer.connected||s.relayer.connecting)&&s.relayer.request(a).catch(p=>s.logger.warn(p))},(0,j.toMiliseconds)(j.ONE_SECOND)),u;const d=new Promise(function(){var p=(0,f.Z)(function*(g){const m=y=>{y.topic===e&&(s.events.removeListener(Me_created,m),g(y.id))};s.events.on(Me_created,m);try{const y=yield St(new Promise((v,_)=>{s.relayer.request(a).catch(b=>{s.logger.warn(b,b?.message),_(b)}).then(v)}),s.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);s.events.removeListener(Me_created,m),g(y)}catch{}});return function(g){return p.apply(this,arguments)}}()),h=yield St(d,s.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!h&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return h?u:null}catch(u){if(s.logger.debug("Outgoing Relay Subscribe Payload stalled"),s.relayer.events.emit(ge_connection_stalled),c)throw u}return null})()}rpcBatchSubscribe(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;const s={method:Xn(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(o=>o.topic)}};t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:s});try{yield yield St(new Promise(o=>{t.relayer.request(s).catch(a=>t.logger.warn(a)).then(o)}),t.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{t.relayer.events.emit(ge_connection_stalled)}})()}rpcBatchFetchMessages(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;const s={method:Xn(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(a=>a.topic)}};let o;t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:s});try{o=yield yield St(new Promise((a,c)=>{t.relayer.request(s).catch(u=>{t.logger.warn(u),c(u)}).then(a)}),t.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{t.relayer.events.emit(ge_connection_stalled)}return o})()}rpcUnsubscribe(e,t,i){const s={method:Xn(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,ws(sr({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,sr({},t)),this.pending.delete(t.topic)})}onUnsubscribe(e,t,i){var s=this;return(0,f.Z)(function*(){s.events.removeAllListeners(t),s.hasSubscription(t,e)&&s.deleteSubscription(t,i),yield s.relayer.messages.del(e)})()}setRelayerSubscriptions(e){var t=this;return(0,f.Z)(function*(){yield t.relayer.core.storage.setItem(t.storageKey,e)})()}getRelayerSubscriptions(){var e=this;return(0,f.Z)(function*(){return yield e.relayer.core.storage.getItem(e.storageKey)})()}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,sr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Me_created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Me_deleted,ws(sr({},i),{reason:t}))}persist(){var e=this;return(0,f.Z)(function*(){yield e.setRelayerSubscriptions(e.values),e.events.emit(Me_sync)})()}onRestart(){var e=this;return(0,f.Z)(function*(){if(e.cached.length){const t=[...e.cached],i=Math.ceil(e.cached.length/e.batchSubscribeTopicsLimit);for(let s=0;s<i;s++){const o=t.splice(0,e.batchSubscribeTopicsLimit);yield e.batchSubscribe(o)}}e.events.emit(Me_resubscribed)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(e.subscriptions.size){const{message:i}=$("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),e.logger.error(`${e.name}: ${JSON.stringify(e.values)}`),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored subscriptions for ${e.name}`),e.logger.trace({type:"method",method:"restore",subscriptions:e.values})}catch(t){e.logger.debug(`Failed to Restore subscriptions for ${e.name}`),e.logger.error(t)}})()}batchSubscribe(e){var t=this;return(0,f.Z)(function*(){e.length&&(yield t.rpcBatchSubscribe(e),t.onBatchSubscribe(yield Promise.all(e.map(function(){var i=(0,f.Z)(function*(s){return ws(sr({},s),{id:yield t.getSubscriptionId(s.topic)})});return function(s){return i.apply(this,arguments)}}()))))})()}batchFetchMessages(e){var t=this;return(0,f.Z)(function*(){if(!e.length)return;t.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const i=yield t.rpcBatchFetchMessages(e);i&&i.messages&&(yield function oh(r){return new Promise(e=>setTimeout(e,r))}((0,j.toMiliseconds)(j.ONE_SECOND)),yield t.relayer.handleBatchMessageEvents(i.messages))})()}onConnect(){var e=this;return(0,f.Z)(function*(){yield e.restart(),e.reset()})()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}restartToComplete(e){var t=this;return(0,f.Z)(function*(){!t.relayer.connected&&!t.relayer.connecting&&(t.cached.push(e),yield t.relayer.transportOpen())})()}getClientId(){var e=this;return(0,f.Z)(function*(){return e.clientId||(e.clientId=yield e.relayer.core.crypto.getClientId()),e.clientId})()}getSubscriptionId(e){var t=this;return(0,f.Z)(function*(){return at(e+(yield t.getClientId()))})()}}var x_=Object.defineProperty,Tc=Object.getOwnPropertySymbols,E_=Object.prototype.hasOwnProperty,D_=Object.prototype.propertyIsEnumerable,xs=(r,e,t)=>e in r?x_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$c=(r,e)=>{for(var t in e||(e={}))E_.call(e,t)&&xs(r,t,e[t]);if(Tc)for(var t of Tc(e))D_.call(e,t)&&xs(r,t,e[t]);return r},Q=(r,e,t)=>xs(r,"symbol"!=typeof e?e+"":e,t);class I_ extends Rg{constructor(e){var t;super(e),t=this,Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new pt.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name","relayer"),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",(0,j.toMiliseconds)(j.THIRTY_SECONDS+j.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",(0,j.toMiliseconds)(15*j.ONE_SECOND)),Q(this,"request",function(){var i=(0,f.Z)(function*(s){var o,a;t.logger.debug("Publishing Request Payload");const c=s.id||(0,z.getBigIntRpcId)().toString();yield t.toEstablishConnection();try{t.logger.trace({id:c,method:s.method,topic:null==(o=s.params)?void 0:o.topic},"relayer.request - publishing...");const u=`${c}:${(null==(a=s.params)?void 0:a.tag)||""}`;t.requestsInFlight.push(u);const d=yield t.provider.request(s);return t.requestsInFlight=t.requestsInFlight.filter(h=>h!==u),d}catch(u){throw t.logger.debug(`Failed to Publish Request: ${c}`),u}});return function(s){return i.apply(this,arguments)}}()),Q(this,"resetPingTimeout",()=>{wr()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,s,o,a;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(a=null==(o=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)?void 0:o.terminate)||a.call(o)}catch(c){this.logger.warn(c,c?.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1f6dc}"),this.startPingTimeout(),this.events.emit(ge_connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1f6d1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(ge_error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(Ge_payload,this.onPayloadHandler),this.provider.on(Ge_connect,this.onConnectHandler),this.provider.on(Ge_disconnect,this.onDisconnectHandler),this.provider.on(Ge_error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,K.Ep)(e.logger,this.name):(0,K.gw)((0,K.jI)({level:e.logger||"error"})),this.messages=new o_(this.logger,e.core),this.subscriber=new w_(this,this.logger),this.publisher=new h_(this,this.logger),this.relayUrl=e?.relayUrl||dc,this.projectId=e.projectId,function Md(){return Pt()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"android"===(null==global?void 0:global.Platform.OS)}()?this.packageName=Oo():function Ld(){return Pt()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"ios"===(null==global?void 0:global.Platform.OS)}()&&(this.bundleId=Oo()),this.provider={}}init(){var e=this;return(0,f.Z)(function*(){if(e.logger.trace("Initialized"),e.registerEventListeners(),yield Promise.all([e.messages.init(),e.subscriber.init()]),e.initialized=!0,e.subscriber.hasAnyTopics)try{yield e.transportOpen()}catch(t){e.logger.warn(t,t?.message)}})()}get context(){return(0,K.Fd)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}publish(e,t,i){var s=this;return(0,f.Z)(function*(){s.isInitialized(),yield s.publisher.publish(e,t,i),yield s.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:oe.relay},kr_outbound)})()}subscribe(e,t){var i=this;return(0,f.Z)(function*(){var s,o,a;i.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&(yield i.toEstablishConnection());const c=typeof(null==(s=t?.internal)?void 0:s.throwOnFailedPublish)>"u"||(null==(o=t?.internal)?void 0:o.throwOnFailedPublish);let d,u=(null==(a=i.subscriber.topicMap.get(e))?void 0:a[0])||"";const h=p=>{p.topic===e&&(i.subscriber.off(Me_created,h),d())};return yield Promise.all([new Promise(p=>{d=p,i.subscriber.on(Me_created,h)}),new Promise(function(){var p=(0,f.Z)(function*(g,m){u=(yield i.subscriber.subscribe(e,$c({internal:{throwOnFailedPublish:c}},t)).catch(y=>{c&&m(y)}))||u,g()});return function(g,m){return p.apply(this,arguments)}}())]),u})()}unsubscribe(e,t){var i=this;return(0,f.Z)(function*(){i.isInitialized(),yield i.subscriber.unsubscribe(e,t)})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}transportDisconnect(){var e=this;return(0,f.Z)(function*(){e.provider.disconnect&&(e.hasExperiencedNetworkDisruption||e.connected)?yield St(e.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>e.onProviderDisconnect()):e.onProviderDisconnect()})()}transportClose(){var e=this;return(0,f.Z)(function*(){e.transportExplicitlyClosed=!0,yield e.transportDisconnect()})()}transportOpen(e){var t=this;return(0,f.Z)(function*(){if(t.subscriber.hasAnyTopics){if(t.connectPromise?(t.logger.debug({},"Waiting for existing connection attempt to resolve..."),yield t.connectPromise,t.logger.debug({},"Existing connection attempt resolved")):(t.connectPromise=new Promise(function(){var i=(0,f.Z)(function*(s,o){yield t.connect(e).then(s).catch(o).finally(()=>{t.connectPromise=void 0})});return function(s,o){return i.apply(this,arguments)}}()),yield t.connectPromise),!t.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${t.relayUrl}`)}else t.logger.warn("Starting WS connection skipped because the client has no topics to work with.")})()}restartTransport(e){var t=this;return(0,f.Z)(function*(){t.logger.debug({},"Restarting transport..."),!t.connectionAttemptInProgress&&(t.relayUrl=e||t.relayUrl,yield t.confirmOnlineStateOrThrow(),yield t.transportClose(),yield t.transportOpen())})()}confirmOnlineStateOrThrow(){return(0,f.Z)(function*(){if(!(yield rc()))throw new Error("No internet connection detected. Please restart your network and try again.")})()}handleBatchMessageEvents(e){var t=this;return(0,f.Z)(function*(){if(0===e?.length)return void t.logger.trace("Batch message events is empty. Ignoring...");const i=e.sort((s,o)=>s.publishedAt-o.publishedAt);t.logger.debug(`Batch of ${i.length} message events sorted`);for(const s of i)try{yield t.onMessageEvent(s)}catch(o){t.logger.warn(o,"Error while processing batch message event: "+o?.message)}t.logger.trace(`Batch of ${i.length} message events processed`)})()}onLinkMessageEvent(e,t){var i=this;return(0,f.Z)(function*(){const{topic:s}=e;if(!t.sessionExists){const a={topic:s,expiry:de(j.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};yield i.core.pairing.pairings.set(s,a)}i.events.emit(ge_message,e),yield i.recordMessageEvent(e,kr_inbound)})()}connect(e){var t=this;return(0,f.Z)(function*(){yield t.confirmOnlineStateOrThrow(),e&&e!==t.relayUrl&&(t.relayUrl=e,yield t.transportDisconnect()),t.connectionAttemptInProgress=!0,t.transportExplicitlyClosed=!1;let i=1;for(;i<6;){try{if(t.transportExplicitlyClosed)break;t.logger.debug({},`Connecting to ${t.relayUrl}, attempt: ${i}...`),yield t.createProvider(),yield new Promise(function(){var s=(0,f.Z)(function*(o,a){const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};t.provider.once(Ge_disconnect,c),yield St(new Promise((u,d)=>{t.provider.connect().then(u).catch(d)}),t.connectTimeout,`Socket stalled when trying to connect to ${t.relayUrl}`).catch(u=>{a(u)}).finally(()=>{t.provider.off(Ge_disconnect,c),clearTimeout(t.reconnectTimeout)}),yield new Promise(function(){var u=(0,f.Z)(function*(d,h){const p=()=>{h(new Error("Connection interrupted while trying to subscribe"))};t.provider.once(Ge_disconnect,p),yield t.subscriber.start().then(d).catch(h).finally(()=>{t.provider.off(Ge_disconnect,p)})});return function(d,h){return u.apply(this,arguments)}}()),t.hasExperiencedNetworkDisruption=!1,o()});return function(o,a){return s.apply(this,arguments)}}())}catch(s){yield t.subscriber.stop();const o=s;t.logger.warn({},o.message),t.hasExperiencedNetworkDisruption=!0}finally{t.connectionAttemptInProgress=!1}if(t.connected){t.logger.debug({},`Connected to ${t.relayUrl} successfully on attempt: ${i}`);break}yield new Promise(s=>setTimeout(s,(0,j.toMiliseconds)(1*i))),i++}})()}startPingTimeout(){var e,t,i,s,o;if(wr())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(o=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||o.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}createProvider(){var e=this;return(0,f.Z)(function*(){e.provider.connection&&e.unregisterProviderListeners();const t=yield e.core.crypto.signJWT(e.relayUrl);e.provider=new Ke.r(new Vg.Z(Kd({sdkVersion:ps,protocol:e.protocol,version:e.version,relayUrl:e.relayUrl,projectId:e.projectId,auth:t,useOnCloseEvent:!0,bundleId:e.bundleId,packageName:e.packageName}))),e.registerProviderListeners()})()}recordMessageEvent(e,t){var i=this;return(0,f.Z)(function*(){const{topic:s,message:o}=e;yield i.messages.set(s,o,t)})()}shouldIgnoreMessageEvent(e){var t=this;return(0,f.Z)(function*(){const{topic:i,message:s}=e;if(!s||0===s.length)return t.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!(yield t.subscriber.isKnownTopic(i)))return t.logger.warn(`Ignoring message for unknown topic ${i}`),!0;const o=t.messages.has(i,s);return o&&t.logger.warn(`Ignoring duplicate message: ${s}`),o})()}onProviderPayload(e){var t=this;return(0,f.Z)(function*(){if(t.logger.debug("Incoming Relay Payload"),t.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,z.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;const i=e.params,{topic:s,message:o,publishedAt:a,attestation:c}=i.data,u={topic:s,message:o,publishedAt:a,transportType:oe.relay,attestation:c};t.logger.debug("Emitting Relayer Payload"),t.logger.trace($c({type:"event",event:i.id},u)),t.events.emit(i.id,u),yield t.acknowledgePayload(e),yield t.onMessageEvent(u)}else(0,z.isJsonRpcResponse)(e)&&t.events.emit(ge_message_ack,e)})()}onMessageEvent(e){var t=this;return(0,f.Z)(function*(){(yield t.shouldIgnoreMessageEvent(e))||(yield t.recordMessageEvent(e,kr_inbound),t.events.emit(ge_message,e))})()}acknowledgePayload(e){var t=this;return(0,f.Z)(function*(){const i=(0,z.formatJsonRpcResult)(e.id,!0);yield t.provider.connection.send(i)})()}unregisterProviderListeners(){this.provider.off(Ge_payload,this.onPayloadHandler),this.provider.off(Ge_connect,this.onConnectHandler),this.provider.off(Ge_disconnect,this.onDisconnectHandler),this.provider.off(Ge_error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}registerEventListeners(){var e=this;return(0,f.Z)(function*(){let t=yield rc();mg(function(){var i=(0,f.Z)(function*(s){t!==s&&(t=s,s?yield e.transportOpen().catch(o=>e.logger.error(o,o?.message)):(e.hasExperiencedNetworkDisruption=!0,yield e.transportDisconnect(),e.transportExplicitlyClosed=!1))});return function(s){return i.apply(this,arguments)}}()),e.core.heartbeat.on(Vt.Lx.pulse,(0,f.Z)(function*(){if(!e.transportExplicitlyClosed&&!e.connected&&function bg(){var r;return!tn()||!(0,ft.getDocument)()||"visible"===(null==(r=(0,ft.getDocument)())?void 0:r.visibilityState)}())try{yield e.confirmOnlineStateOrThrow(),yield e.transportOpen()}catch(i){e.logger.warn(i,i?.message)}}))})()}onProviderDisconnect(){var e=this;return(0,f.Z)(function*(){clearTimeout(e.pingTimeout),e.events.emit(ge_disconnect),e.connectionAttemptInProgress=!1,!e.reconnectInProgress&&(e.reconnectInProgress=!0,yield e.subscriber.stop(),e.subscriber.hasAnyTopics&&(e.transportExplicitlyClosed||(e.reconnectTimeout=setTimeout((0,f.Z)(function*(){yield e.transportOpen().catch(t=>e.logger.error(t,t?.message)),e.reconnectTimeout=void 0,e.reconnectInProgress=!1}),(0,j.toMiliseconds)(.1)))))})()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}toEstablishConnection(){var e=this;return(0,f.Z)(function*(){if(yield e.confirmOnlineStateOrThrow(),!e.connected){if(e.connectPromise)return void(yield e.connectPromise);yield e.connect()}})()}}function P_(){}function jc(r){if(!r||"object"!=typeof r)return!1;const e=Object.getPrototypeOf(r);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(r)}function Fc(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function qc(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const S_="[object RegExp]",C_="[object String]",O_="[object Number]",A_="[object Boolean]",Uc="[object Arguments]",R_="[object Symbol]",N_="[object Date]",T_="[object Map]",$_="[object Set]",j_="[object Array]",F_="[object Function]",q_="[object ArrayBuffer]",Es="[object Object]",U_="[object Error]",k_="[object DataView]",B_="[object Uint8Array]",M_="[object Uint8ClampedArray]",L_="[object Uint16Array]",z_="[object Uint32Array]",Z_="[object BigUint64Array]",V_="[object Int8Array]",H_="[object Int16Array]",K_="[object Int32Array]",G_="[object BigInt64Array]",W_="[object Float32Array]",J_="[object Float64Array]";function or(r,e,t,i,s,o,a){const c=a(r,e,t,i,s,o);if(void 0!==c)return c;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return r===e;case"number":return r===e||Object.is(r,e);case"object":return ar(r,e,o,a)}return ar(r,e,o,a)}function ar(r,e,t,i){if(Object.is(r,e))return!0;let s=qc(r),o=qc(e);if(s===Uc&&(s=Es),o===Uc&&(o=Es),s!==o)return!1;switch(s){case C_:return r.toString()===e.toString();case O_:return function Q_(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}(r.valueOf(),e.valueOf());case A_:case N_:case R_:return Object.is(r.valueOf(),e.valueOf());case S_:return r.source===e.source&&r.flags===e.flags;case F_:return r===e}const a=(t=t??new Map).get(r),c=t.get(e);if(null!=a&&null!=c)return a===e;t.set(r,e),t.set(e,r);try{switch(s){case T_:if(r.size!==e.size)return!1;for(const[u,d]of r.entries())if(!e.has(u)||!or(d,e.get(u),u,r,e,t,i))return!1;return!0;case $_:{if(r.size!==e.size)return!1;const u=Array.from(r.values()),d=Array.from(e.values());for(let h=0;h<u.length;h++){const p=u[h],g=d.findIndex(m=>or(p,m,void 0,r,e,t,i));if(-1===g)return!1;d.splice(g,1)}return!0}case j_:case B_:case M_:case L_:case z_:case Z_:case V_:case H_:case K_:case G_:case W_:case J_:if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let u=0;u<r.length;u++)if(!or(r[u],e[u],u,r,e,t,i))return!1;return!0;case q_:return r.byteLength===e.byteLength&&ar(new Uint8Array(r),new Uint8Array(e),t,i);case k_:return r.byteLength===e.byteLength&&r.byteOffset===e.byteOffset&&ar(new Uint8Array(r),new Uint8Array(e),t,i);case U_:return r.name===e.name&&r.message===e.message;case Es:{if(!(ar(r.constructor,e.constructor,t,i)||jc(r)&&jc(e)))return!1;const u=[...Object.keys(r),...Fc(r)],d=[...Object.keys(e),...Fc(e)];if(u.length!==d.length)return!1;for(let h=0;h<u.length;h++){const p=u[h],g=r[p];if(!Object.hasOwn(e,p))return!1;if(!or(g,e[p],p,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function X_(r,e){return function Y_(r,e,t){return or(r,e,void 0,void 0,void 0,void 0,t)}(r,e,P_)}var ev=Object.defineProperty,kc=Object.getOwnPropertySymbols,tv=Object.prototype.hasOwnProperty,nv=Object.prototype.propertyIsEnumerable,Ds=(r,e,t)=>e in r?ev(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Bc=(r,e)=>{for(var t in e||(e={}))tv.call(e,t)&&Ds(r,t,e[t]);if(kc)for(var t of kc(e))nv.call(e,t)&&Ds(r,t,e[t]);return r},Ue=(r,e,t)=>Ds(r,"symbol"!=typeof e?e+"":e,t);class Wt extends Ng{constructor(e,t,i,s=ct,o=void 0){var a;super(e,t,i,s),a=this,this.core=e,this.logger=t,this.name=i,Ue(this,"map",new Map),Ue(this,"version","0.3"),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"getKey"),Ue(this,"storagePrefix",ct),Ue(this,"recentlyDeleted",[]),Ue(this,"recentlyDeletedLimit",200),Ue(this,"init",(0,f.Z)(function*(){a.initialized||(a.logger.trace("Initialized"),yield a.restore(),a.cached.forEach(c=>{a.getKey&&null!==c&&!Ee(c)?a.map.set(a.getKey(c),c):function Gf(r){var e;return null==(e=r?.proposer)?void 0:e.publicKey}(c)?a.map.set(c.id,c):function Wf(r){return r?.topic}(c)&&a.map.set(c.topic,c)}),a.cached=[],a.initialized=!0)})),Ue(this,"set",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.map.has(u)?yield a.update(u,d):(a.logger.debug("Setting value"),a.logger.trace({type:"method",method:"set",key:u,value:d}),a.map.set(u,d),yield a.persist())});return function(u,d){return c.apply(this,arguments)}}()),Ue(this,"get",c=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:c}),this.getData(c))),Ue(this,"getAll",c=>(this.isInitialized(),c?this.values.filter(u=>Object.keys(c).every(d=>X_(u[d],c[d]))):this.values)),Ue(this,"update",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.logger.debug("Updating value"),a.logger.trace({type:"method",method:"update",key:u,update:d});const h=Bc(Bc({},a.getData(u)),d);a.map.set(u,h),yield a.persist()});return function(u,d){return c.apply(this,arguments)}}()),Ue(this,"delete",function(){var c=(0,f.Z)(function*(u,d){a.isInitialized(),a.map.has(u)&&(a.logger.debug("Deleting value"),a.logger.trace({type:"method",method:"delete",key:u,reason:d}),a.map.delete(u),a.addToRecentlyDeleted(u),yield a.persist())});return function(u,d){return c.apply(this,arguments)}}()),this.logger=(0,K.Ep)(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}setDataStore(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getDataStore(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=$("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}persist(){var e=this;return(0,f.Z)(function*(){yield e.setDataStore(e.values)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getDataStore();if(typeof t>"u"||!t.length)return;if(e.map.size){const{message:i}=$("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored value for ${e.name}`),e.logger.trace({type:"method",method:"restore",value:e.values})}catch(t){e.logger.debug(`Failed to Restore value for ${e.name}`),e.logger.error(t)}})()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var rv=Object.defineProperty,G=(r,e,t)=>((r,e,t)=>e in r?rv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class sv{constructor(e,t){var i=this;this.core=e,this.logger=t,G(this,"name","pairing"),G(this,"version","0.3"),G(this,"events",new(pi())),G(this,"pairings"),G(this,"initialized",!1),G(this,"storagePrefix",ct),G(this,"ignoredPayloadTypes",[xt]),G(this,"registeredMethods",[]),G(this,"init",(0,f.Z)(function*(){i.initialized||(yield i.pairings.init(),yield i.cleanup(),i.registerRelayerEvents(),i.registerExpirerEvents(),i.initialized=!0,i.logger.trace("Initialized"))})),G(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),G(this,"create",function(){var s=(0,f.Z)(function*(o){i.isInitialized();const a=as(),c=yield i.core.crypto.setSymKey(a),u=de(j.FIVE_MINUTES),d={protocol:"irn"},h={topic:c,expiry:u,relay:d,active:!1,methods:o?.methods},p=Ga({protocol:i.core.protocol,version:i.core.version,topic:c,symKey:a,relay:d,expiryTimestamp:u,methods:o?.methods});return i.events.emit(Ht_create,h),i.core.expirer.set(c,u),yield i.pairings.set(c,h),yield i.core.relayer.subscribe(c,{transportType:o?.transportType}),{topic:c,uri:p}});return function(o){return s.apply(this,arguments)}}()),G(this,"pair",function(){var s=(0,f.Z)(function*(o){i.isInitialized();const a=i.core.eventClient.createEvent({properties:{topic:o?.uri,trace:[ut_pairing_started]}});i.isValidPair(o,a);const{topic:c,symKey:u,relay:d,expiryTimestamp:h,methods:p}=Ka(o.uri);let g;if(a.props.properties.topic=c,a.addTrace(ut_pairing_uri_validation_success),a.addTrace(ut_pairing_uri_not_expired),i.pairings.keys.includes(c)){if(g=i.pairings.get(c),a.addTrace(ut_existing_pairing),g.active)throw a.setError(Et_active_pairing_already_exists),new Error(`Pairing already exists: ${c}. Please try again with a new connection URI.`);a.addTrace(ut_pairing_not_expired)}const m=h||de(j.FIVE_MINUTES),y={topic:c,relay:d,expiry:m,active:!1,methods:p};i.core.expirer.set(c,m),yield i.pairings.set(c,y),a.addTrace(ut_store_new_pairing),o.activatePairing&&(yield i.activate({topic:c})),i.events.emit(Ht_create,y),a.addTrace(ut_emit_inactive_pairing),i.core.crypto.keychain.has(c)||(yield i.core.crypto.setSymKey(u,c)),a.addTrace(ut_subscribing_pairing_topic);try{yield i.core.relayer.confirmOnlineStateOrThrow()}catch{a.setError(Et_no_internet_connection)}try{yield i.core.relayer.subscribe(c,{relay:d})}catch(v){throw a.setError(Et_subscribe_pairing_topic_failure),v}return a.addTrace(ut_subscribe_pairing_topic_success),y});return function(o){return s.apply(this,arguments)}}()),G(this,"activate",function(){var s=(0,f.Z)(function*({topic:o}){i.isInitialized();const a=de(j.FIVE_MINUTES);i.core.expirer.set(o,a),yield i.pairings.update(o,{active:!0,expiry:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"ping",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),yield i.isValidPing(o),i.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:a}=o;if(i.pairings.keys.includes(a)){const c=yield i.sendRequest(a,"wc_pairingPing",{}),{done:u,resolve:d,reject:h}=Ut();i.events.once(ee("pairing_ping",c),({error:p})=>{p?h(p):d()}),yield u()}});return function(o){return s.apply(this,arguments)}}()),G(this,"updateExpiry",function(){var s=(0,f.Z)(function*({topic:o,expiry:a}){i.isInitialized(),yield i.pairings.update(o,{expiry:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"updateMetadata",function(){var s=(0,f.Z)(function*({topic:o,metadata:a}){i.isInitialized(),yield i.pairings.update(o,{peerMetadata:a})});return function(o){return s.apply(this,arguments)}}()),G(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),G(this,"disconnect",function(){var s=(0,f.Z)(function*(o){i.isInitialized(),yield i.isValidDisconnect(o);const{topic:a}=o;i.pairings.keys.includes(a)&&(yield i.sendRequest(a,"wc_pairingDelete",te("USER_DISCONNECTED")),yield i.deletePairing(a))});return function(o){return s.apply(this,arguments)}}()),G(this,"formatUriFromPairing",s=>{this.isInitialized();const{topic:o,relay:a,expiry:c,methods:u}=s,d=this.core.crypto.keychain.get(o);return Ga({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:d,relay:a,expiryTimestamp:c,methods:u})}),G(this,"sendRequest",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcRequest)(a,c),d=yield i.core.crypto.encode(o,u),h=tr[a].req;return i.core.history.set(o,u),i.core.relayer.publish(o,d,h),u.id});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"sendResult",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcResult)(o,c),d=yield i.core.crypto.encode(a,u),h=(yield i.core.history.get(a,o)).request.method,p=tr[h].res;yield i.core.relayer.publish(a,d,p),yield i.core.history.resolve(u)});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"sendError",function(){var s=(0,f.Z)(function*(o,a,c){const u=(0,z.formatJsonRpcError)(o,c),d=yield i.core.crypto.encode(a,u),h=(yield i.core.history.get(a,o)).request.method,p=tr[h]?tr[h].res:tr.unregistered_method.res;yield i.core.relayer.publish(a,d,p),yield i.core.history.resolve(u)});return function(o,a,c){return s.apply(this,arguments)}}()),G(this,"deletePairing",function(){var s=(0,f.Z)(function*(o,a){yield i.core.relayer.unsubscribe(o),yield Promise.all([i.pairings.delete(o,te("USER_DISCONNECTED")),i.core.crypto.deleteSymKey(o),a?Promise.resolve():i.core.expirer.del(o)])});return function(o,a){return s.apply(this,arguments)}}()),G(this,"cleanup",(0,f.Z)(function*(){const s=i.pairings.getAll().filter(o=>Ct(o.expiry));yield Promise.all(s.map(o=>i.deletePairing(o.topic)))})),G(this,"onRelayEventRequest",function(){var s=(0,f.Z)(function*(o){const{topic:a,payload:c}=o;switch(c.method){case"wc_pairingPing":return yield i.onPairingPingRequest(a,c);case"wc_pairingDelete":return yield i.onPairingDeleteRequest(a,c);default:return yield i.onUnknownRpcMethodRequest(a,c)}});return function(o){return s.apply(this,arguments)}}()),G(this,"onRelayEventResponse",function(){var s=(0,f.Z)(function*(o){const{topic:a,payload:c}=o,u=(yield i.core.history.get(a,c.id)).request.method;return"wc_pairingPing"===u?i.onPairingPingResponse(a,c):i.onUnknownRpcMethodResponse(u)});return function(o){return s.apply(this,arguments)}}()),G(this,"onPairingPingRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c}=a;try{i.isValidPing({topic:o}),yield i.sendResult(c,o,!0),i.events.emit(Ht_ping,{id:c,topic:o})}catch(u){yield i.sendError(c,o,u),i.logger.error(u)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onPairingPingResponse",(s,o)=>{const{id:a}=o;setTimeout(()=>{(0,z.isJsonRpcResult)(o)?this.events.emit(ee("pairing_ping",a),{}):(0,z.isJsonRpcError)(o)&&this.events.emit(ee("pairing_ping",a),{error:o.error})},500)}),G(this,"onPairingDeleteRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c}=a;try{i.isValidDisconnect({topic:o}),yield i.deletePairing(o),i.events.emit(Ht_delete,{id:c,topic:o})}catch(u){yield i.sendError(c,o,u),i.logger.error(u)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onUnknownRpcMethodRequest",function(){var s=(0,f.Z)(function*(o,a){const{id:c,method:u}=a;try{if(i.registeredMethods.includes(u))return;const d=te("WC_METHOD_UNSUPPORTED",u);yield i.sendError(c,o,d),i.logger.error(d)}catch(d){yield i.sendError(c,o,d),i.logger.error(d)}});return function(o,a){return s.apply(this,arguments)}}()),G(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(te("WC_METHOD_UNSUPPORTED",s))}),G(this,"isValidPair",(s,o)=>{var a;if(!qe(s)){const{message:u}=$("MISSING_OR_INVALID",`pair() params: ${s}`);throw o.setError(Et_malformed_pairing_uri),new Error(u)}if(!function Kf(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ue(r,!1))return!!e(r)||e(qo(r))}catch{}return!1}(s.uri)){const{message:u}=$("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw o.setError(Et_malformed_pairing_uri),new Error(u)}const c=Ka(s?.uri);if(null==(a=c?.relay)||!a.protocol){const{message:u}=$("MISSING_OR_INVALID","pair() uri#relay-protocol");throw o.setError(Et_malformed_pairing_uri),new Error(u)}if(null==c||!c.symKey){const{message:u}=$("MISSING_OR_INVALID","pair() uri#symKey");throw o.setError(Et_malformed_pairing_uri),new Error(u)}if(null!=c&&c.expiryTimestamp&&(0,j.toMiliseconds)(c?.expiryTimestamp)<Date.now()){o.setError(Et_pairing_expired);const{message:u}=$("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(u)}}),G(this,"isValidPing",function(){var s=(0,f.Z)(function*(o){if(!qe(o)){const{message:c}=$("MISSING_OR_INVALID",`ping() params: ${o}`);throw new Error(c)}const{topic:a}=o;yield i.isValidPairingTopic(a)});return function(o){return s.apply(this,arguments)}}()),G(this,"isValidDisconnect",function(){var s=(0,f.Z)(function*(o){if(!qe(o)){const{message:c}=$("MISSING_OR_INVALID",`disconnect() params: ${o}`);throw new Error(c)}const{topic:a}=o;yield i.isValidPairingTopic(a)});return function(o){return s.apply(this,arguments)}}()),G(this,"isValidPairingTopic",function(){var s=(0,f.Z)(function*(o){if(!ue(o,!1)){const{message:a}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${o}`);throw new Error(a)}if(!i.pairings.keys.includes(o)){const{message:a}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${o}`);throw new Error(a)}if(Ct(i.pairings.get(o).expiry)){yield i.deletePairing(o);const{message:a}=$("EXPIRED",`pairing topic: ${o}`);throw new Error(a)}});return function(o){return s.apply(this,arguments)}}()),this.core=e,this.logger=(0,K.Ep)(t,this.name),this.pairings=new Wt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,K.Fd)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){var e=this;this.core.relayer.on(ge_message,function(){var t=(0,f.Z)(function*(i){const{topic:s,message:o,transportType:a}=i;if(e.pairings.keys.includes(s)&&a!==oe.link_mode&&!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(o)))try{const c=yield e.core.crypto.decode(s,o);(0,z.isJsonRpcRequest)(c)?(e.core.history.set(s,c),yield e.onRelayEventRequest({topic:s,payload:c})):(0,z.isJsonRpcResponse)(c)&&(yield e.core.history.resolve(c),yield e.onRelayEventResponse({topic:s,payload:c}),e.core.history.delete(s,c.id)),yield e.core.relayer.messages.ack(s,o)}catch(c){e.logger.error(c)}});return function(i){return t.apply(this,arguments)}}())}registerExpirerEvents(){var e=this;this.core.expirer.on(We_expired,function(){var t=(0,f.Z)(function*(i){const{topic:s}=To(i.target);s&&e.pairings.keys.includes(s)&&(yield e.deletePairing(s,!0),e.events.emit(Ht_expire,{topic:s}))});return function(i){return t.apply(this,arguments)}}())}}var ov=Object.defineProperty,Pe=(r,e,t)=>((r,e,t)=>e in r?ov(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class cv extends Cg{constructor(e,t){var i;super(e,t),i=this,this.core=e,this.logger=t,Pe(this,"records",new Map),Pe(this,"events",new pt.EventEmitter),Pe(this,"name","history"),Pe(this,"version","0.3"),Pe(this,"cached",[]),Pe(this,"initialized",!1),Pe(this,"storagePrefix",ct),Pe(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),yield i.restore(),i.cached.forEach(s=>i.records.set(s.id,s)),i.cached=[],i.registerEventListeners(),i.initialized=!0)})),Pe(this,"set",(s,o,a)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:a}),this.records.has(o.id))return;const c={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:a,expiry:de(j.THIRTY_DAYS)};this.records.set(c.id,c),this.persist(),this.events.emit(tt_created,c)}),Pe(this,"resolve",function(){var s=(0,f.Z)(function*(o){if(i.isInitialized(),i.logger.debug("Updating JSON-RPC response history record"),i.logger.trace({type:"method",method:"update",response:o}),!i.records.has(o.id))return;const a=yield i.getRecord(o.id);typeof a.response>"u"&&(a.response=(0,z.isJsonRpcError)(o)?{error:o.error}:{result:o.result},i.records.set(a.id,a),i.persist(),i.events.emit(tt_updated,a))});return function(o){return s.apply(this,arguments)}}()),Pe(this,"get",function(){var s=(0,f.Z)(function*(o,a){return i.isInitialized(),i.logger.debug("Getting record"),i.logger.trace({type:"method",method:"get",topic:o,id:a}),yield i.getRecord(a)});return function(o,a){return s.apply(this,arguments)}}()),Pe(this,"delete",(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(a=>{if(a.topic===s){if(typeof o<"u"&&a.id!==o)return;this.records.delete(a.id),this.events.emit(tt_deleted,a)}}),this.persist()}),Pe(this,"exists",function(){var s=(0,f.Z)(function*(o,a){return i.isInitialized(),!!i.records.has(a)&&(yield i.getRecord(a)).topic===o});return function(o,a){return s.apply(this,arguments)}}()),Pe(this,"on",(s,o)=>{this.events.on(s,o)}),Pe(this,"once",(s,o)=>{this.events.once(s,o)}),Pe(this,"off",(s,o)=>{this.events.off(s,o)}),Pe(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:(0,z.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}setJsonRpcRecords(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getJsonRpcRecords(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}persist(){var e=this;return(0,f.Z)(function*(){yield e.setJsonRpcRecords(e.values),e.events.emit(tt_sync)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(e.records.size){const{message:i}=$("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored records for ${e.name}`),e.logger.trace({type:"method",method:"restore",records:e.values})}catch(t){e.logger.debug(`Failed to Restore records for ${e.name}`),e.logger.error(t)}})()}registerEventListeners(){this.events.on(tt_created,e=>{const t=tt_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(tt_updated,e=>{const t=tt_updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(tt_deleted,e=>{const t=tt_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Vt.Lx.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,j.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(tt_deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var uv=Object.defineProperty,Se=(r,e,t)=>((r,e,t)=>e in r?uv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class dv extends qg{constructor(e,t){var i;super(e,t),i=this,this.core=e,this.logger=t,Se(this,"expirations",new Map),Se(this,"events",new pt.EventEmitter),Se(this,"name","expirer"),Se(this,"version","0.3"),Se(this,"cached",[]),Se(this,"initialized",!1),Se(this,"storagePrefix",ct),Se(this,"init",(0,f.Z)(function*(){i.initialized||(i.logger.trace("Initialized"),yield i.restore(),i.cached.forEach(s=>i.expirations.set(s.target,s)),i.cached=[],i.registerEventListeners(),i.initialized=!0)})),Se(this,"has",s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}}),Se(this,"set",(s,o)=>{this.isInitialized();const a=this.formatTarget(s),c={target:a,expiry:o};this.expirations.set(a,c),this.checkExpiry(a,c),this.events.emit(We_created,{target:a,expiration:c})}),Se(this,"get",s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)}),Se(this,"del",s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),a=this.getExpiration(o);this.expirations.delete(o),this.events.emit(We_deleted,{target:o,expiration:a})}}),Se(this,"on",(s,o)=>{this.events.on(s,o)}),Se(this,"once",(s,o)=>{this.events.once(s,o)}),Se(this,"off",(s,o)=>{this.events.off(s,o)}),Se(this,"removeListener",(s,o)=>{this.events.removeListener(s,o)}),this.logger=(0,K.Ep)(t,this.name)}get context(){return(0,K.Fd)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function Qd(r){return No("topic",r)}(e);if("number"==typeof e)return function Yd(r){return No("id",r)}(e);const{message:t}=$("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}setExpirations(e){var t=this;return(0,f.Z)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getExpirations(){var e=this;return(0,f.Z)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}persist(){var e=this;return(0,f.Z)(function*(){yield e.setExpirations(e.values),e.events.emit(We_sync)})()}restore(){var e=this;return(0,f.Z)(function*(){try{const t=yield e.getExpirations();if(typeof t>"u"||!t.length)return;if(e.expirations.size){const{message:i}=$("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(i),new Error(i)}e.cached=t,e.logger.debug(`Successfully Restored expirations for ${e.name}`),e.logger.trace({type:"method",method:"restore",expirations:e.values})}catch(t){e.logger.debug(`Failed to Restore expirations for ${e.name}`),e.logger.error(t)}})()}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=$("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;(0,j.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(We_expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Vt.Lx.pulse,()=>this.checkExpirations()),this.events.on(We_created,e=>{const t=We_created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(We_expired,e=>{const t=We_expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(We_deleted,e=>{const t=We_deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hv=Object.defineProperty,le=(r,e,t)=>((r,e,t)=>e in r?hv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class fv extends Ug{constructor(e,t,i){var s;super(e,t,i),s=this,this.core=e,this.logger=t,this.store=i,le(this,"name","verify-api"),le(this,"abortController"),le(this,"isDevEnv"),le(this,"verifyUrlV3",my),le(this,"storagePrefix",ct),le(this,"version",2),le(this,"publicKey"),le(this,"fetchPromise"),le(this,"init",(0,f.Z)(function*(){var o;s.isDevEnv||(s.publicKey=yield s.store.getItem(s.storeKey),s.publicKey&&(0,j.toMiliseconds)(null==(o=s.publicKey)?void 0:o.expiresAt)<Date.now()&&(s.logger.debug("verify v2 public key expired"),yield s.removePublicKey()))})),le(this,"register",function(){var o=(0,f.Z)(function*(a){if(!tn()||s.isDevEnv)return;const c=window.location.origin,{id:u,decryptedId:d}=a,h=`${s.verifyUrlV3}/attestation?projectId=${s.core.projectId}&origin=${c}&id=${u}&decryptedId=${d}`;try{const p=(0,ft.getDocument)(),g=s.startAbortTimer(5*j.ONE_SECOND),m=yield new Promise((y,v)=>{const _=()=>{window.removeEventListener("message",w),p.body.removeChild(b),v("attestation aborted")};s.abortController.signal.addEventListener("abort",_);const b=p.createElement("iframe");b.src=h,b.style.display="none",b.addEventListener("error",_,{signal:s.abortController.signal});const w=E=>{if(E.data&&"string"==typeof E.data)try{const x=JSON.parse(E.data);if("verify_attestation"===x.type){if((0,jt.xp)(x.attestation).payload.id!==u)return;clearInterval(g),p.body.removeChild(b),s.abortController.signal.removeEventListener("abort",_),window.removeEventListener("message",w),y(null===x.attestation?"":x.attestation)}}catch(x){s.logger.warn(x)}};p.body.appendChild(b),window.addEventListener("message",w,{signal:s.abortController.signal})});return s.logger.debug("jwt attestation",m),m}catch(p){s.logger.warn(p)}return""});return function(a){return o.apply(this,arguments)}}()),le(this,"resolve",function(){var o=(0,f.Z)(function*(a){if(s.isDevEnv)return"";const{attestationId:c,hash:u,encryptedId:d}=a;if(""===c)return void s.logger.debug("resolve: attestationId is empty, skipping");if(c){if((0,jt.xp)(c).payload.id!==d)return;const p=yield s.isValidJwtAttestation(c);if(p)return p.isVerified?p:void s.logger.warn("resolve: jwt attestation: origin url not verified")}if(!u)return;const h=s.getVerifyUrl(a?.verifyUrl);return s.fetchAttestation(u,h)});return function(a){return o.apply(this,arguments)}}()),le(this,"fetchAttestation",function(){var o=(0,f.Z)(function*(a,c){s.logger.debug(`resolving attestation: ${a} from url: ${c}`);const u=s.startAbortTimer(5*j.ONE_SECOND),d=yield fetch(`${c}/attestation/${a}?v2Supported=true`,{signal:s.abortController.signal});return clearTimeout(u),200===d.status?yield d.json():void 0});return function(a,c){return o.apply(this,arguments)}}()),le(this,"getVerifyUrl",o=>{let a=o||nr;return _y.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${nr}`),a=nr),a}),le(this,"fetchPublicKey",(0,f.Z)(function*(){try{s.logger.debug(`fetching public key from: ${s.verifyUrlV3}`);const o=s.startAbortTimer(j.FIVE_SECONDS),a=yield fetch(`${s.verifyUrlV3}/public-key`,{signal:s.abortController.signal});return clearTimeout(o),yield a.json()}catch(o){s.logger.warn(o)}})),le(this,"persistPublicKey",function(){var o=(0,f.Z)(function*(a){s.logger.debug("persisting public key to local storage",a),yield s.store.setItem(s.storeKey,a),s.publicKey=a});return function(a){return o.apply(this,arguments)}}()),le(this,"removePublicKey",(0,f.Z)(function*(){s.logger.debug("removing verify v2 public key from storage"),yield s.store.removeItem(s.storeKey),s.publicKey=void 0})),le(this,"isValidJwtAttestation",function(){var o=(0,f.Z)(function*(a){const c=yield s.getPublicKey();try{if(c)return s.validateAttestation(a,c)}catch(d){s.logger.error(d),s.logger.warn("error validating attestation")}const u=yield s.fetchAndPersistPublicKey();try{if(u)return s.validateAttestation(a,u)}catch(d){s.logger.error(d),s.logger.warn("error validating attestation")}});return function(a){return o.apply(this,arguments)}}()),le(this,"getPublicKey",(0,f.Z)(function*(){return s.publicKey?s.publicKey:yield s.fetchAndPersistPublicKey()})),le(this,"fetchAndPersistPublicKey",(0,f.Z)(function*(){if(s.fetchPromise)return yield s.fetchPromise,s.publicKey;s.fetchPromise=new Promise(function(){var a=(0,f.Z)(function*(c){const u=yield s.fetchPublicKey();u&&(yield s.persistPublicKey(u),c(u))});return function(c){return a.apply(this,arguments)}}());const o=yield s.fetchPromise;return s.fetchPromise=void 0,o})),le(this,"validateAttestation",(o,a)=>{const c=Pf(o,a.publicKey),u={hasExpired:(0,j.toMiliseconds)(c.exp)<Date.now(),payload:c};if(u.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:u.payload.origin,isScam:u.payload.isScam,isVerified:u.payload.isVerified}}),this.logger=(0,K.Ep)(t,this.name),this.abortController=new AbortController,this.isDevEnv=Ci(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,K.Fd)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,j.toMiliseconds)(e))}}var gv=Object.defineProperty,Mc=(r,e,t)=>((r,e,t)=>e in r?gv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class mv extends kg{constructor(e,t){var i;super(e,t),i=this,this.projectId=e,this.logger=t,Mc(this,"context","echo"),Mc(this,"registerDeviceToken",function(){var s=(0,f.Z)(function*(o){const{clientId:a,token:c,notificationType:u,enableEncrypted:d=!1}=o,h=`https://echo.walletconnect.com/${i.projectId}/clients`;yield fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:u,token:c,always_raw:d})})});return function(o){return s.apply(this,arguments)}}()),this.logger=(0,K.Ep)(t,this.context)}}var _v=Object.defineProperty,Lc=Object.getOwnPropertySymbols,vv=Object.prototype.hasOwnProperty,bv=Object.prototype.propertyIsEnumerable,Is=(r,e,t)=>e in r?_v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cr=(r,e)=>{for(var t in e||(e={}))vv.call(e,t)&&Is(r,t,e[t]);if(Lc)for(var t of Lc(e))bv.call(e,t)&&Is(r,t,e[t]);return r},ye=(r,e,t)=>Is(r,"symbol"!=typeof e?e+"":e,t);class wv extends Bg{constructor(e,t,i=!0){var s;super(e,t,i),s=this,this.core=e,this.logger=t,ye(this,"context","event-client"),ye(this,"storagePrefix",ct),ye(this,"storageVersion",.1),ye(this,"events",new Map),ye(this,"shouldPersist",!1),ye(this,"init",(0,f.Z)(function*(){if(!Ci())try{const o={eventId:Fo(),timestamp:Date.now(),domain:s.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:yield s.core.crypto.getClientId(),user_agent:Ro(s.core.relayer.protocol,s.core.relayer.version,ps)}}};yield s.sendEvent([o])}catch(o){s.logger.warn(o)}})),ye(this,"createEvent",o=>{const{event:a="ERROR",type:c="",properties:{topic:u,trace:d}}=o,h=Fo(),p=this.core.projectId||"",g=Date.now(),m=cr({eventId:h,timestamp:g,props:{event:a,type:c,properties:{topic:u,trace:d}},bundleId:p,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,m),this.shouldPersist=!0),m}),ye(this,"getEvent",o=>{const{eventId:a,topic:c}=o;if(a)return this.events.get(a);const u=Array.from(this.events.values()).find(d=>d.props.properties.topic===c);return u?cr(cr({},u),this.setMethods(u.eventId)):void 0}),ye(this,"deleteEvent",o=>{const{eventId:a}=o;this.events.delete(a),this.shouldPersist=!0}),ye(this,"setEventListeners",()=>{this.core.heartbeat.on(Vt.Lx.pulse,(0,f.Z)(function*(){s.shouldPersist&&(yield s.persist()),s.events.forEach(o=>{(0,j.fromMiliseconds)(Date.now())-(0,j.fromMiliseconds)(o.timestamp)>86400&&(s.events.delete(o.eventId),s.shouldPersist=!0)})}))}),ye(this,"setMethods",o=>({addTrace:a=>this.addTrace(o,a),setError:a=>this.setError(o,a)})),ye(this,"addTrace",(o,a)=>{const c=this.events.get(o);c&&(c.props.properties.trace.push(a),this.events.set(o,c),this.shouldPersist=!0)}),ye(this,"setError",(o,a)=>{const c=this.events.get(o);c&&(c.props.type=a,c.timestamp=Date.now(),this.events.set(o,c),this.shouldPersist=!0)}),ye(this,"persist",(0,f.Z)(function*(){yield s.core.storage.setItem(s.storageKey,Array.from(s.events.values())),s.shouldPersist=!1})),ye(this,"restore",(0,f.Z)(function*(){try{const o=(yield s.core.storage.getItem(s.storageKey))||[];if(!o.length)return;o.forEach(a=>{s.events.set(a.eventId,cr(cr({},a),s.setMethods(a.eventId)))})}catch(o){s.logger.warn(o)}})),ye(this,"submit",(0,f.Z)(function*(){if(!s.telemetryEnabled||0===s.events.size)return;const o=[];for(const[a,c]of s.events)c.props.type&&o.push(c);if(0!==o.length)try{if((yield s.sendEvent(o)).ok)for(const a of o)s.events.delete(a.eventId),s.shouldPersist=!0}catch(a){s.logger.warn(a)}})),ye(this,"sendEvent",function(){var o=(0,f.Z)(function*(a){const c=s.getAppDomain()?"":"&sp=desktop";return yield fetch(`https://pulse.walletconnect.org/batch?projectId=${s.core.projectId}&st=events_sdk&sv=js-${ps}${c}`,{method:"POST",body:JSON.stringify(a)})});return function(a){return o.apply(this,arguments)}}()),ye(this,"getAppDomain",()=>Ao().url),this.logger=(0,K.Ep)(t,this.context),this.telemetryEnabled=i,i?this.restore().then((0,f.Z)(function*(){yield s.submit(),s.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var xv=Object.defineProperty,zc=Object.getOwnPropertySymbols,Ev=Object.prototype.hasOwnProperty,Dv=Object.prototype.propertyIsEnumerable,Ps=(r,e,t)=>e in r?xv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zc=(r,e)=>{for(var t in e||(e={}))Ev.call(e,t)&&Ps(r,t,e[t]);if(zc)for(var t of zc(e))Dv.call(e,t)&&Ps(r,t,e[t]);return r},se=(r,e,t)=>Ps(r,"symbol"!=typeof e?e+"":e,t);class Ss extends Dg{constructor(e){var t,i;super(e),t=this,se(this,"protocol","wc"),se(this,"version",2),se(this,"name",Ur),se(this,"relayUrl"),se(this,"projectId"),se(this,"customStoragePrefix"),se(this,"events",new pt.EventEmitter),se(this,"logger"),se(this,"heartbeat"),se(this,"relayer"),se(this,"crypto"),se(this,"storage"),se(this,"history"),se(this,"expirer"),se(this,"pairing"),se(this,"verify"),se(this,"echoClient"),se(this,"linkModeSupportedApps"),se(this,"eventClient"),se(this,"initialized",!1),se(this,"logChunkController"),se(this,"on",(u,d)=>this.events.on(u,d)),se(this,"once",(u,d)=>this.events.once(u,d)),se(this,"off",(u,d)=>this.events.off(u,d)),se(this,"removeListener",(u,d)=>this.events.removeListener(u,d)),se(this,"dispatchEnvelope",({topic:u,message:d,sessionExists:h})=>{if(!u||!d)return;const p={topic:u,message:d,publishedAt:Date.now(),transportType:oe.link_mode};this.relayer.onLinkMessageEvent(p,{sessionExists:h})});const s=this.getGlobalCore(e?.customStoragePrefix);if(s)try{return this.customStoragePrefix=s.customStoragePrefix,this.logger=s.logger,this.heartbeat=s.heartbeat,this.crypto=s.crypto,this.history=s.history,this.expirer=s.expirer,this.storage=s.storage,this.relayer=s.relayer,this.pairing=s.pairing,this.verify=s.verify,this.echoClient=s.echoClient,this.linkModeSupportedApps=s.linkModeSupportedApps,this.eventClient=s.eventClient,this.initialized=s.initialized,this.logChunkController=s.logChunkController,s}catch(u){console.warn("Failed to copy global core",u)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||dc,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const o=(0,K.jI)({level:"string"==typeof e?.logger&&e.logger?e.logger:Hg_logger,name:Ur}),{logger:a,chunkLoggerController:c}=(0,K.Rt)({opts:o,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=c,null!=(i=this.logChunkController)&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=(0,f.Z)(function*(){var u,d;null!=(u=t.logChunkController)&&u.downloadLogsBlobInBrowser&&(null==(d=t.logChunkController)||d.downloadLogsBlobInBrowser({clientId:yield t.crypto.getClientId()}))})),this.logger=(0,K.Ep)(a,this.name),this.heartbeat=new Vt.C$,this.crypto=new Ym(this,this.logger,e?.keychain),this.history=new cv(this,this.logger),this.expirer=new dv(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new wg.Z(Zc(Zc({},Kg),e?.storageOptions)),this.relayer=new I_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new sv(this,this.logger),this.verify=new fv(this,this.logger,this.storage),this.echoClient=new mv(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new wv(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static init(e){return(0,f.Z)(function*(){const t=new Ss(e);yield t.initialize();const i=yield t.crypto.getClientId();return yield t.storage.setItem("WALLETCONNECT_CLIENT_ID",i),t})()}get context(){return(0,K.Fd)(this.logger)}start(){var e=this;return(0,f.Z)(function*(){e.initialized||(yield e.initialize())})()}getLogsBlob(){var e=this;return(0,f.Z)(function*(){var t;return null==(t=e.logChunkController)?void 0:t.logsToBlob({clientId:yield e.crypto.getClientId()})})()}addLinkModeSupportedApp(e){var t=this;return(0,f.Z)(function*(){t.linkModeSupportedApps.includes(e)||(t.linkModeSupportedApps.push(e),yield t.storage.setItem(hc,t.linkModeSupportedApps))})()}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized");try{yield e.crypto.init(),yield e.history.init(),yield e.expirer.init(),yield e.relayer.init(),yield e.heartbeat.init(),yield e.pairing.init(),e.linkModeSupportedApps=(yield e.storage.getItem(hc))||[],e.initialized=!0,e.logger.info("Core Initialization Success")}catch(t){throw e.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),e.logger.error(t.message),t}})()}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){return void console.warn("Failed to get global WalletConnect core",t)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}const Iv=Ss,Cs="wc@2:client:",Os_name="client",Os_logger="error",Gc="WALLETCONNECT_DEEPLINK_CHOICE",Wc="Proposal expired",wn=j.SEVEN_DAYS,me={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1114},res:{ttl:j.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:j.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:j.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1119}}},As={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},dt_idle="IDLE",dt_active="ACTIVE",Jc={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},Av=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Lr="wc@1.5:auth:",zr=`${Lr}:PUB_KEY`;var Fv=Object.defineProperty,qv=Object.defineProperties,Uv=Object.getOwnPropertyDescriptors,Qc=Object.getOwnPropertySymbols,kv=Object.prototype.hasOwnProperty,Bv=Object.prototype.propertyIsEnumerable,Rs=(r,e,t)=>e in r?Fv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,re=(r,e)=>{for(var t in e||(e={}))kv.call(e,t)&&Rs(r,t,e[t]);if(Qc)for(var t of Qc(e))Bv.call(e,t)&&Rs(r,t,e[t]);return r},Ne=(r,e)=>qv(r,Uv(e)),S=(r,e,t)=>Rs(r,"symbol"!=typeof e?e+"":e,t);class Mv extends Zg{constructor(e){var t;super(e),t=this,S(this,"name","engine"),S(this,"events",new(pi())),S(this,"initialized",!1),S(this,"requestQueue",{state:dt_idle,queue:[]}),S(this,"sessionRequestQueue",{state:dt_idle,queue:[]}),S(this,"requestQueueDelay",j.ONE_SECOND),S(this,"expectedPairingMethodMap",new Map),S(this,"recentlyDeletedMap",new Map),S(this,"recentlyDeletedLimit",200),S(this,"relayMessageCache",[]),S(this,"pendingSessions",new Map),S(this,"init",(0,f.Z)(function*(){t.initialized||(yield t.cleanup(),t.registerRelayerEvents(),t.registerExpirerEvents(),t.registerPairingEvents(),yield t.registerLinkModeListeners(),t.client.core.pairing.register({methods:Object.keys(me)}),t.initialized=!0,setTimeout((0,f.Z)(function*(){yield t.processPendingMessageEvents(),t.sessionRequestQueue.queue=t.getPendingSessionRequests(),t.processSessionRequestQueue()}),(0,j.toMiliseconds)(t.requestQueueDelay)))})),S(this,"connect",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();const o=Ne(re({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});yield t.isValidConnect(o),o.optionalNamespaces=function Lf(r,e){var t,i,s,o,a,c;const u=jr(r),d=jr(e),h={},p=Object.keys(u).concat(Object.keys(d));for(const g of p)h[g]={chains:je(null==(t=u[g])?void 0:t.chains,null==(i=d[g])?void 0:i.chains),methods:je(null==(s=u[g])?void 0:s.methods,null==(o=d[g])?void 0:o.methods),events:je(null==(a=u[g])?void 0:a.events,null==(c=d[g])?void 0:c.events)};return h}(o.requiredNamespaces,o.optionalNamespaces),o.requiredNamespaces={};const{pairingTopic:a,requiredNamespaces:c,optionalNamespaces:u,sessionProperties:d,scopedProperties:h,relays:p}=o;let m,g=a,y=!1;try{if(g){const I=t.client.core.pairing.pairings.get(g);t.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),y=I.active}}catch(I){throw t.client.logger.error(`connect() -> pairing.get(${g}) failed`),I}if(!g||!y){const{topic:I,uri:A}=yield t.client.core.pairing.create();g=I,m=A}if(!g){const{message:I}=$("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(I)}const v=yield t.client.core.crypto.generateKeyPair(),_=me.wc_sessionPropose.req.ttl||j.FIVE_MINUTES,b=de(_),w=Ne(re(re({requiredNamespaces:c,optionalNamespaces:u,relays:p??[{protocol:"irn"}],proposer:{publicKey:v,metadata:t.client.metadata},expiryTimestamp:b,pairingTopic:g},d&&{sessionProperties:d}),h&&{scopedProperties:h}),{id:(0,z.payloadId)()}),E=ee("session_connect",w.id),{reject:x,resolve:C,done:P}=Ut(_,Wc),D=({id:I})=>{I===w.id&&(t.client.events.off("proposal_expire",D),t.pendingSessions.delete(w.id),t.events.emit(E,{error:{message:Wc,code:0}}))};return t.client.events.on("proposal_expire",D),t.events.once(E,({error:I,session:A})=>{t.client.events.off("proposal_expire",D),I?x(I):A&&C(A)}),yield t.sendRequest({topic:g,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),yield t.setProposal(w.id,w),{uri:m,approval:P}});return function(s){return i.apply(this,arguments)}}()),S(this,"pair",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{return yield t.client.core.pairing.pair(s)}catch(o){throw t.client.logger.error("pair() failed"),o}});return function(s){return i.apply(this,arguments)}}()),S(this,"approve",function(){var i=(0,f.Z)(function*(s){var o,a,c;const u=t.client.core.eventClient.createEvent({properties:{topic:null==(o=s?.id)?void 0:o.toString(),trace:[nt_session_approve_started]}});try{t.isInitialized(),yield t.confirmOnlineStateOrThrow()}catch(T){throw u.setError(Kt_no_internet_connection),T}try{yield t.isValidProposalId(s?.id)}catch(T){throw t.client.logger.error(`approve() -> proposal.get(${s?.id}) failed`),u.setError(Kt_proposal_not_found),T}try{yield t.isValidApprove(s)}catch(T){throw t.client.logger.error("approve() -> isValidApprove() failed"),u.setError(Kt_session_approve_namespace_validation_failure),T}const{id:d,relayProtocol:h,namespaces:p,sessionProperties:g,scopedProperties:m,sessionConfig:y}=s,v=t.client.proposal.get(d);t.client.core.eventClient.deleteEvent({eventId:u.eventId});const{pairingTopic:_,proposer:b,requiredNamespaces:w,optionalNamespaces:E}=v;let x=null==(a=t.client.core.eventClient)?void 0:a.getEvent({topic:_});x||(x=null==(c=t.client.core.eventClient)?void 0:c.createEvent({type:nt_session_approve_started,properties:{topic:_,trace:[nt_session_approve_started,nt_session_namespaces_validation_success]}}));const C=yield t.client.core.crypto.generateKeyPair(),P=b.publicKey,D=yield t.client.core.crypto.generateSharedKey(C,P),I=re(re(re({relay:{protocol:h??"irn"},namespaces:p,controller:{publicKey:C,metadata:t.client.metadata},expiry:de(wn)},g&&{sessionProperties:g}),m&&{scopedProperties:m}),y&&{sessionConfig:y}),A=oe.relay;x.addTrace(nt_subscribing_session_topic);try{yield t.client.core.relayer.subscribe(D,{transportType:A})}catch(T){throw x.setError(Kt_subscribe_session_topic_failure),T}x.addTrace(nt_subscribe_session_topic_success);const L=Ne(re({},I),{topic:D,requiredNamespaces:w,optionalNamespaces:E,pairingTopic:_,acknowledged:!1,self:I.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:C,transportType:oe.relay});yield t.client.session.set(D,L),x.addTrace(nt_store_session);try{x.addTrace(nt_publishing_session_settle),yield t.sendRequest({topic:D,method:"wc_sessionSettle",params:I,throwOnFailedPublish:!0}).catch(T=>{throw x?.setError(Kt_session_settle_publish_failure),T}),x.addTrace(nt_session_settle_publish_success),x.addTrace(nt_publishing_session_approve),yield t.sendResult({id:d,topic:_,result:{relay:{protocol:h??"irn"},responderPublicKey:C},throwOnFailedPublish:!0}).catch(T=>{throw x?.setError(Kt_session_approve_publish_failure),T}),x.addTrace(nt_session_approve_publish_success)}catch(T){throw t.client.logger.error(T),t.client.session.delete(D,te("USER_DISCONNECTED")),yield t.client.core.relayer.unsubscribe(D),T}return t.client.core.eventClient.deleteEvent({eventId:x.eventId}),yield t.client.core.pairing.updateMetadata({topic:_,metadata:b.metadata}),yield t.client.proposal.delete(d,te("USER_DISCONNECTED")),yield t.client.core.pairing.activate({topic:_}),yield t.setExpiry(D,de(wn)),{topic:D,acknowledged:()=>Promise.resolve(t.client.session.get(D))}});return function(s){return i.apply(this,arguments)}}()),S(this,"reject",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidReject(s)}catch(u){throw t.client.logger.error("reject() -> isValidReject() failed"),u}const{id:o,reason:a}=s;let c;try{c=t.client.proposal.get(o).pairingTopic}catch(u){throw t.client.logger.error(`reject() -> proposal.get(${o}) failed`),u}c&&(yield t.sendError({id:o,topic:c,error:a,rpcOpts:me.wc_sessionPropose.reject}),yield t.client.proposal.delete(o,te("USER_DISCONNECTED")))});return function(s){return i.apply(this,arguments)}}()),S(this,"update",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidUpdate(s)}catch(m){throw t.client.logger.error("update() -> isValidUpdate() failed"),m}const{topic:o,namespaces:a}=s,{done:c,resolve:u,reject:d}=Ut(),h=(0,z.payloadId)(),p=(0,z.getBigIntRpcId)().toString(),g=t.client.session.get(o).namespaces;return t.events.once(ee("session_update",h),({error:m})=>{m?d(m):u()}),yield t.client.session.update(o,{namespaces:a}),yield t.sendRequest({topic:o,method:"wc_sessionUpdate",params:{namespaces:a},throwOnFailedPublish:!0,clientRpcId:h,relayRpcId:p}).catch(m=>{t.client.logger.error(m),t.client.session.update(o,{namespaces:g}),d(m)}),{acknowledged:c}});return function(s){return i.apply(this,arguments)}}()),S(this,"extend",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidExtend(s)}catch(h){throw t.client.logger.error("extend() -> isValidExtend() failed"),h}const{topic:o}=s,a=(0,z.payloadId)(),{done:c,resolve:u,reject:d}=Ut();return t.events.once(ee("session_extend",a),({error:h})=>{h?d(h):u()}),yield t.setExpiry(o,de(wn)),t.sendRequest({topic:o,method:"wc_sessionExtend",params:{},clientRpcId:a,throwOnFailedPublish:!0}).catch(h=>{d(h)}),{acknowledged:c}});return function(s){return i.apply(this,arguments)}}()),S(this,"request",function(){var i=(0,f.Z)(function*(s){t.isInitialized();try{yield t.isValidRequest(s)}catch(E){throw t.client.logger.error("request() -> isValidRequest() failed"),E}const{chainId:o,request:a,topic:c,expiry:u=me.wc_sessionRequest.req.ttl}=s,d=t.client.session.get(c);d?.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const h=(0,z.payloadId)(),p=(0,z.getBigIntRpcId)().toString(),{done:g,resolve:m,reject:y}=Ut(u,"Request expired. Please try again.");t.events.once(ee("session_request",h),({error:E,result:x})=>{E?y(E):m(x)});const v="wc_sessionRequest",_=t.getAppLinkIfEnabled(d.peer.metadata,d.transportType);if(_)return yield t.sendRequest({clientRpcId:h,relayRpcId:p,topic:c,method:v,params:{request:Ne(re({},a),{expiryTimestamp:de(u)}),chainId:o},expiry:u,throwOnFailedPublish:!0,appLink:_}).catch(E=>y(E)),t.client.events.emit("session_request_sent",{topic:c,request:a,chainId:o,id:h}),yield g();const b={request:Ne(re({},a),{expiryTimestamp:de(u)}),chainId:o},w=t.shouldSetTVF(v,b);return yield Promise.all([new Promise(function(){var E=(0,f.Z)(function*(x){yield t.sendRequest(re({clientRpcId:h,relayRpcId:p,topic:c,method:v,params:b,expiry:u,throwOnFailedPublish:!0},w&&{tvf:t.getTVFParams(h,b)})).catch(C=>y(C)),t.client.events.emit("session_request_sent",{topic:c,request:a,chainId:o,id:h}),x()});return function(x){return E.apply(this,arguments)}}()),new Promise(function(){var E=(0,f.Z)(function*(x){var C;if(null==(C=d.sessionConfig)||!C.disableDeepLink){const P=yield function nh(r,e){return Si.apply(this,arguments)}(t.client.core.storage,Gc);yield function Xd(r){return Pi.apply(this,arguments)}({id:h,topic:c,wcDeepLink:P})}x()});return function(x){return E.apply(this,arguments)}}()),g()]).then(E=>E[2])});return function(s){return i.apply(this,arguments)}}()),S(this,"respond",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.isValidRespond(s);const{topic:o,response:a}=s,{id:c}=a,u=t.client.session.get(o);u.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const d=t.getAppLinkIfEnabled(u.peer.metadata,u.transportType);(0,z.isJsonRpcResult)(a)?yield t.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:d}):(0,z.isJsonRpcError)(a)&&(yield t.sendError({id:c,topic:o,error:a.error,appLink:d})),t.cleanupAfterResponse(s)});return function(s){return i.apply(this,arguments)}}()),S(this,"ping",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidPing(s)}catch(a){throw t.client.logger.error("ping() -> isValidPing() failed"),a}const{topic:o}=s;if(t.client.session.keys.includes(o)){const a=(0,z.payloadId)(),c=(0,z.getBigIntRpcId)().toString(),{done:u,resolve:d,reject:h}=Ut();t.events.once(ee("session_ping",a),({error:p})=>{p?h(p):d()}),yield Promise.all([t.sendRequest({topic:o,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),u()])}else t.client.core.pairing.pairings.keys.includes(o)&&(t.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),yield t.client.core.pairing.ping({topic:o}))});return function(s){return i.apply(this,arguments)}}()),S(this,"emit",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidEmit(s);const{topic:o,event:a,chainId:c}=s,u=(0,z.getBigIntRpcId)().toString(),d=(0,z.payloadId)();yield t.sendRequest({topic:o,method:"wc_sessionEvent",params:{event:a,chainId:c},throwOnFailedPublish:!0,relayRpcId:u,clientRpcId:d})});return function(s){return i.apply(this,arguments)}}()),S(this,"disconnect",function(){var i=(0,f.Z)(function*(s){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidDisconnect(s);const{topic:o}=s;if(t.client.session.keys.includes(o))yield t.sendRequest({topic:o,method:"wc_sessionDelete",params:te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),yield t.deleteSession({topic:o,emitEvent:!1});else{if(!t.client.core.pairing.pairings.keys.includes(o)){const{message:a}=$("MISMATCHED_TOPIC",`Session or pairing topic not found: ${o}`);throw new Error(a)}yield t.client.core.pairing.disconnect({topic:o})}});return function(s){return i.apply(this,arguments)}}()),S(this,"find",i=>(this.isInitialized(),this.client.session.getAll().filter(s=>function Vf(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let o=!0;return!!qt(s,i)&&(i.forEach(a=>{const{accounts:c,methods:u,events:d}=r.namespaces[a],h=mn(c),p=t[a];qt(xi(a,p),h)&&qt(p.methods,u)&&qt(p.events,d)||(o=!1)}),o)}(s,i)))),S(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),S(this,"authenticate",function(){var i=(0,f.Z)(function*(s,o){var a;t.isInitialized(),t.isValidAuthenticate(s);const c=o&&t.client.core.linkModeSupportedApps.includes(o)&&(null==(a=t.client.metadata.redirect)?void 0:a.linkMode),u=c?oe.link_mode:oe.relay;u===oe.relay&&(yield t.confirmOnlineStateOrThrow());const{chains:d,statement:h="",uri:p,domain:g,nonce:m,type:y,exp:v,nbf:_,methods:b=[],expiry:w}=s,E=[...s.resources||[]],{topic:x,uri:C}=yield t.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:u});t.client.logger.info({message:"Generated new pairing",pairing:{topic:x,uri:C}});const P=yield t.client.core.crypto.generateKeyPair(),D=Rr(P);if(yield Promise.all([t.client.auth.authKeys.set(zr,{responseTopic:D,publicKey:P}),t.client.auth.pairingTopics.set(D,{topic:D,pairingTopic:x})]),yield t.client.core.relayer.subscribe(D,{transportType:u}),t.client.logger.info(`sending request to new pairing topic: ${x}`),b.length>0){const{namespace:Z}=Ft(d[0]);let M=Gh(Z,"request",b);cn(E)&&(M=Wh(M,E.pop())),E.push(M)}const I=w&&w>me.wc_sessionAuthenticate.req.ttl?w:me.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:y??"caip122",chains:d,statement:h,aud:p,domain:g,version:"1",nonce:m,iat:(new Date).toISOString(),exp:v,nbf:_,resources:E},requester:{publicKey:P,metadata:t.client.metadata},expiryTimestamp:de(I)},T={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:d,methods:[...new Set(["personal_sign",...b])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:x,proposer:{publicKey:P,metadata:t.client.metadata},expiryTimestamp:de(me.wc_sessionPropose.req.ttl),id:(0,z.payloadId)()},{done:k,resolve:V,reject:O}=Ut(I,"Request expired"),R=(0,z.payloadId)(),N=ee("session_connect",T.id),q=ee("session_request",R),U=function(){var Z=(0,f.Z)(function*({error:M,session:X}){t.events.off(q,F),M?O(M):X&&V({session:X})});return function(X){return Z.apply(this,arguments)}}(),F=function(){var Z=(0,f.Z)(function*(M){var X,ae,he;if(yield t.deletePendingAuthRequest(R,{message:"fulfilled",code:0}),M.error){const Ve=te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return M.error.code===Ve.code?void 0:(t.events.off(N,U),O(M.error.message))}yield t.deleteProposal(T.id),t.events.off(N,U);const{cacaos:_e,responder:ve}=M.result,be=[],Oe=[];for(const Ve of _e){(yield Yo({cacao:Ve,projectId:t.client.core.projectId}))||(t.client.logger.error(Ve,"Signature verification failed"),O(te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:st}=Ve,Fn=cn(st.resources),lr=[Ui(st.iss)],K0=Er(st.iss);if(Fn){const Zs=ra(Fn),G0=ia(Fn);be.push(...Zs),lr.push(...G0)}for(const Zs of lr)Oe.push(`${Zs}:${K0}`)}const Dt=yield t.client.core.crypto.generateSharedKey(P,ve.publicKey);let ht;be.length>0&&(ht={topic:Dt,acknowledged:!0,self:{publicKey:P,metadata:t.client.metadata},peer:ve,controller:ve.publicKey,expiry:de(wn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:x,namespaces:Qa([...new Set(be)],[...new Set(Oe)]),transportType:u},yield t.client.core.relayer.subscribe(Dt,{transportType:u}),yield t.client.session.set(Dt,ht),x&&(yield t.client.core.pairing.updateMetadata({topic:x,metadata:ve.metadata})),ht=t.client.session.get(Dt)),null!=(X=t.client.metadata.redirect)&&X.linkMode&&null!=(ae=ve.metadata.redirect)&&ae.linkMode&&null!=(he=ve.metadata.redirect)&&he.universal&&o&&(t.client.core.addLinkModeSupportedApp(ve.metadata.redirect.universal),t.client.session.update(Dt,{transportType:oe.link_mode})),V({auths:_e,session:ht})});return function(X){return Z.apply(this,arguments)}}();let H;t.events.once(N,U),t.events.once(q,F);try{if(c){const Z=(0,z.formatJsonRpcRequest)("wc_sessionAuthenticate",A,R);t.client.core.history.set(x,Z);const M=yield t.client.core.crypto.encode("",Z,{type:Jn,encoding:Nt});H=Tr(o,x,M)}else yield Promise.all([t.sendRequest({topic:x,method:"wc_sessionAuthenticate",params:A,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:R}),t.sendRequest({topic:x,method:"wc_sessionPropose",params:T,expiry:me.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(Z){throw t.events.off(N,U),t.events.off(q,F),Z}return yield t.setProposal(T.id,T),yield t.setAuthRequest(R,{request:Ne(re({},A),{verifyContext:{}}),pairingTopic:x,transportType:u}),{uri:H??C,response:k}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"approveSessionAuthenticate",function(){var i=(0,f.Z)(function*(s){const{id:o,auths:a}=s,c=t.client.core.eventClient.createEvent({properties:{topic:o.toString(),trace:[Gt_authenticated_session_approve_started]}});try{t.isInitialized()}catch(w){throw c.setError(rr_no_internet_connection),w}const u=t.getPendingAuthRequest(o);if(!u)throw c.setError(rr_authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${o}`);const d=u.transportType||oe.relay;d===oe.relay&&(yield t.confirmOnlineStateOrThrow());const h=u.requester.publicKey,p=yield t.client.core.crypto.generateKeyPair(),g=Rr(h),m={type:xt,receiverPublicKey:h,senderPublicKey:p},y=[],v=[];for(const w of a){if(!(yield Yo({cacao:w,projectId:t.client.core.projectId}))){c.setError(rr_invalid_cacao);const D=te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw yield t.sendError({id:o,topic:g,error:D,encodeOpts:m}),new Error(D.message)}c.addTrace(Gt_cacaos_verified);const{p:E}=w,x=cn(E.resources),C=[Ui(E.iss)],P=Er(E.iss);if(x){const D=ra(x),I=ia(x);y.push(...D),C.push(...I)}for(const D of C)v.push(`${D}:${P}`)}const _=yield t.client.core.crypto.generateSharedKey(p,h);let b;if(c.addTrace(Gt_create_authenticated_session_topic),y?.length>0){b={topic:_,acknowledged:!0,self:{publicKey:p,metadata:t.client.metadata},peer:{publicKey:h,metadata:u.requester.metadata},controller:h,expiry:de(wn),authentication:a,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:u.pairingTopic,namespaces:Qa([...new Set(y)],[...new Set(v)]),transportType:d},c.addTrace(Gt_subscribing_authenticated_session_topic);try{yield t.client.core.relayer.subscribe(_,{transportType:d})}catch(w){throw c.setError(rr_subscribe_authenticated_session_topic_failure),w}c.addTrace(Gt_subscribe_authenticated_session_topic_success),yield t.client.session.set(_,b),c.addTrace(Gt_store_authenticated_session),yield t.client.core.pairing.updateMetadata({topic:u.pairingTopic,metadata:u.requester.metadata})}c.addTrace(Gt_publishing_authenticated_session_approve);try{yield t.sendResult({topic:g,id:o,result:{cacaos:a,responder:{publicKey:p,metadata:t.client.metadata}},encodeOpts:m,throwOnFailedPublish:!0,appLink:t.getAppLinkIfEnabled(u.requester.metadata,d)})}catch(w){throw c.setError(rr_authenticated_session_approve_publish_failure),w}return yield t.client.auth.requests.delete(o,{message:"fulfilled",code:0}),yield t.client.core.pairing.activate({topic:u.pairingTopic}),t.client.core.eventClient.deleteEvent({eventId:c.eventId}),{session:b}});return function(s){return i.apply(this,arguments)}}()),S(this,"rejectSessionAuthenticate",function(){var i=(0,f.Z)(function*(s){t.isInitialized();const{id:o,reason:a}=s,c=t.getPendingAuthRequest(o);if(!c)throw new Error(`Could not find pending auth request with id ${o}`);c.transportType===oe.relay&&(yield t.confirmOnlineStateOrThrow());const u=c.requester.publicKey,d=yield t.client.core.crypto.generateKeyPair(),h=Rr(u),p={type:xt,receiverPublicKey:u,senderPublicKey:d};yield t.sendError({id:o,topic:h,error:a,encodeOpts:p,rpcOpts:me.wc_sessionAuthenticate.reject,appLink:t.getAppLinkIfEnabled(c.requester.metadata,c.transportType)}),yield t.client.auth.requests.delete(o,{message:"rejected",code:0}),yield t.client.proposal.delete(o,te("USER_DISCONNECTED"))});return function(s){return i.apply(this,arguments)}}()),S(this,"formatAuthMessage",i=>{this.isInitialized();const{request:s,iss:o}=i;return Xo(s,o)}),S(this,"processRelayMessageCache",()=>{setTimeout((0,f.Z)(function*(){if(0!==t.relayMessageCache.length)for(;t.relayMessageCache.length>0;)try{const i=t.relayMessageCache.shift();i&&(yield t.onRelayMessage(i))}catch(i){t.client.logger.error(i)}}),50)}),S(this,"cleanupDuplicatePairings",function(){var i=(0,f.Z)(function*(s){if(s.pairingTopic)try{const o=t.client.core.pairing.pairings.get(s.pairingTopic),a=t.client.core.pairing.pairings.getAll().filter(c=>{var u,d;return(null==(u=c.peerMetadata)?void 0:u.url)&&(null==(d=c.peerMetadata)?void 0:d.url)===s.peer.metadata.url&&c.topic&&c.topic!==o.topic});if(0===a.length)return;t.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),yield Promise.all(a.map(c=>t.client.core.pairing.disconnect({topic:c.topic}))),t.client.logger.info("Duplicate pairings clean up finished")}catch(o){t.client.logger.error(o)}});return function(s){return i.apply(this,arguments)}}()),S(this,"deleteSession",function(){var i=(0,f.Z)(function*(s){var o;const{topic:a,expirerHasDeleted:c=!1,emitEvent:u=!0,id:d=0}=s,{self:h}=t.client.session.get(a);yield t.client.core.relayer.unsubscribe(a),yield t.client.session.delete(a,te("USER_DISCONNECTED")),t.addToRecentlyDeleted(a,"session"),t.client.core.crypto.keychain.has(h.publicKey)&&(yield t.client.core.crypto.deleteKeyPair(h.publicKey)),t.client.core.crypto.keychain.has(a)&&(yield t.client.core.crypto.deleteSymKey(a)),c||t.client.core.expirer.del(a),t.client.core.storage.removeItem(Gc).catch(p=>t.client.logger.warn(p)),t.getPendingSessionRequests().forEach(p=>{p.topic===a&&t.deletePendingSessionRequest(p.id,te("USER_DISCONNECTED"))}),a===(null==(o=t.sessionRequestQueue.queue[0])?void 0:o.topic)&&(t.sessionRequestQueue.state=dt_idle),u&&t.client.events.emit("session_delete",{id:d,topic:a})});return function(s){return i.apply(this,arguments)}}()),S(this,"deleteProposal",function(){var i=(0,f.Z)(function*(s,o){if(o)try{const a=t.client.proposal.get(s);t.client.core.eventClient.getEvent({topic:a.pairingTopic})?.setError(Kt_proposal_expired)}catch{}yield Promise.all([t.client.proposal.delete(s,te("USER_DISCONNECTED")),o?Promise.resolve():t.client.core.expirer.del(s)]),t.addToRecentlyDeleted(s,"proposal")});return function(s,o){return i.apply(this,arguments)}}()),S(this,"deletePendingSessionRequest",function(){var i=(0,f.Z)(function*(s,o,a=!1){yield Promise.all([t.client.pendingRequest.delete(s,o),a?Promise.resolve():t.client.core.expirer.del(s)]),t.addToRecentlyDeleted(s,"request"),t.sessionRequestQueue.queue=t.sessionRequestQueue.queue.filter(c=>c.id!==s),a&&(t.sessionRequestQueue.state=dt_idle,t.client.events.emit("session_request_expire",{id:s}))});return function(s,o){return i.apply(this,arguments)}}()),S(this,"deletePendingAuthRequest",function(){var i=(0,f.Z)(function*(s,o,a=!1){yield Promise.all([t.client.auth.requests.delete(s,o),a?Promise.resolve():t.client.core.expirer.del(s)])});return function(s,o){return i.apply(this,arguments)}}()),S(this,"setExpiry",function(){var i=(0,f.Z)(function*(s,o){t.client.session.keys.includes(s)&&(t.client.core.expirer.set(s,o),yield t.client.session.update(s,{expiry:o}))});return function(s,o){return i.apply(this,arguments)}}()),S(this,"setProposal",function(){var i=(0,f.Z)(function*(s,o){t.client.core.expirer.set(s,de(me.wc_sessionPropose.req.ttl)),yield t.client.proposal.set(s,o)});return function(s,o){return i.apply(this,arguments)}}()),S(this,"setAuthRequest",function(){var i=(0,f.Z)(function*(s,o){const{request:a,pairingTopic:c,transportType:u=oe.relay}=o;t.client.core.expirer.set(s,a.expiryTimestamp),yield t.client.auth.requests.set(s,{authPayload:a.authPayload,requester:a.requester,expiryTimestamp:a.expiryTimestamp,id:s,pairingTopic:c,verifyContext:a.verifyContext,transportType:u})});return function(s,o){return i.apply(this,arguments)}}()),S(this,"setPendingSessionRequest",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,params:c,verifyContext:u}=s,d=c.request.expiryTimestamp||de(me.wc_sessionRequest.req.ttl);t.client.core.expirer.set(o,d),yield t.client.pendingRequest.set(o,{id:o,topic:a,params:c,verifyContext:u})});return function(s){return i.apply(this,arguments)}}()),S(this,"sendRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,method:a,params:c,expiry:u,relayRpcId:d,clientRpcId:h,throwOnFailedPublish:p,appLink:g,tvf:m}=s,y=(0,z.formatJsonRpcRequest)(a,c,h);let v;const _=!!g;try{const E=_?Nt:Xe;v=yield t.client.core.crypto.encode(o,y,{encoding:E})}catch(E){throw yield t.cleanup(),t.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${o} failed`),E}let b;if(Av.includes(a)){const E=at(JSON.stringify(y)),x=at(v);b=yield t.client.core.verify.register({id:x,decryptedId:E})}const w=me[a].req;if(w.attestation=b,u&&(w.ttl=u),d&&(w.id=d),t.client.core.history.set(o,y),_){const E=Tr(g,o,v);yield global.Linking.openURL(E,t.client.name)}else{const E=me[a].req;u&&(E.ttl=u),d&&(E.id=d),E.tvf=Ne(re({},m),{correlationId:y.id}),p?(E.internal=Ne(re({},E.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(o,v,E)):t.client.core.relayer.publish(o,v,E).catch(x=>t.client.logger.error(x))}return y.id});return function(s){return i.apply(this,arguments)}}()),S(this,"sendResult",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,result:c,throwOnFailedPublish:u,encodeOpts:d,appLink:h}=s,p=(0,z.formatJsonRpcResult)(o,c);let g;const m=h&&typeof(null==global?void 0:global.Linking)<"u";try{const _=m?Nt:Xe;g=yield t.client.core.crypto.encode(a,p,Ne(re({},d||{}),{encoding:_}))}catch(_){throw yield t.cleanup(),t.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),_}let y,v;try{y=yield t.client.core.history.get(a,o);const _=y.request;try{t.shouldSetTVF(_.method,_.params)&&(v=t.getTVFParams(o,_.params,c))}catch(b){t.client.logger.warn("sendResult() -> getTVFParams() failed",b)}}catch(_){throw t.client.logger.error(`sendResult() -> history.get(${a}, ${o}) failed`),_}if(m){const _=Tr(h,a,g);yield global.Linking.openURL(_,t.client.name)}else{const _=y.request.method,b=me[_].res;b.tvf=Ne(re({},v),{correlationId:o}),u?(b.internal=Ne(re({},b.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(a,g,b)):t.client.core.relayer.publish(a,g,b).catch(w=>t.client.logger.error(w))}yield t.client.core.history.resolve(p)});return function(s){return i.apply(this,arguments)}}()),S(this,"sendError",function(){var i=(0,f.Z)(function*(s){const{id:o,topic:a,error:c,encodeOpts:u,rpcOpts:d,appLink:h}=s,p=(0,z.formatJsonRpcError)(o,c);let g;const m=h&&typeof(null==global?void 0:global.Linking)<"u";try{const v=m?Nt:Xe;g=yield t.client.core.crypto.encode(a,p,Ne(re({},u||{}),{encoding:v}))}catch(v){throw yield t.cleanup(),t.client.logger.error(`sendError() -> core.crypto.encode() for topic ${a} failed`),v}let y;try{y=yield t.client.core.history.get(a,o)}catch(v){throw t.client.logger.error(`sendError() -> history.get(${a}, ${o}) failed`),v}if(m){const v=Tr(h,a,g);yield global.Linking.openURL(v,t.client.name)}else{const v=y.request.method,_=d||me[v].res;t.client.core.relayer.publish(a,g,_)}yield t.client.core.history.resolve(p)});return function(s){return i.apply(this,arguments)}}()),S(this,"cleanup",(0,f.Z)(function*(){const i=[],s=[];t.client.session.getAll().forEach(o=>{let a=!1;Ct(o.expiry)&&(a=!0),t.client.core.crypto.keychain.has(o.topic)||(a=!0),a&&i.push(o.topic)}),t.client.proposal.getAll().forEach(o=>{Ct(o.expiryTimestamp)&&s.push(o.id)}),yield Promise.all([...i.map(o=>t.deleteSession({topic:o})),...s.map(o=>t.deleteProposal(o))])})),S(this,"onProviderMessageEvent",function(){var i=(0,f.Z)(function*(s){!t.initialized||t.relayMessageCache.length>0?t.relayMessageCache.push(s):yield t.onRelayMessage(s)});return function(s){return i.apply(this,arguments)}}()),S(this,"onRelayEventRequest",function(){var i=(0,f.Z)(function*(s){t.requestQueue.queue.push(s),yield t.processRequestsQueue()});return function(s){return i.apply(this,arguments)}}()),S(this,"processRequestsQueue",(0,f.Z)(function*(){if(t.requestQueue.state!==dt_active){for(t.client.logger.info(`Request queue starting with ${t.requestQueue.queue.length} requests`);t.requestQueue.queue.length>0;){t.requestQueue.state=dt_active;const i=t.requestQueue.queue.shift();if(i)try{yield t.processRequest(i)}catch(s){t.client.logger.warn(s)}}t.requestQueue.state=dt_idle}else t.client.logger.info("Request queue already active, skipping...")})),S(this,"processRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,attestation:c,transportType:u,encryptedId:d}=s,h=a.method;if(!t.shouldIgnorePairingRequest({topic:o,requestMethod:h}))switch(h){case"wc_sessionPropose":return yield t.onSessionProposeRequest({topic:o,payload:a,attestation:c,encryptedId:d});case"wc_sessionSettle":return yield t.onSessionSettleRequest(o,a);case"wc_sessionUpdate":return yield t.onSessionUpdateRequest(o,a);case"wc_sessionExtend":return yield t.onSessionExtendRequest(o,a);case"wc_sessionPing":return yield t.onSessionPingRequest(o,a);case"wc_sessionDelete":return yield t.onSessionDeleteRequest(o,a);case"wc_sessionRequest":return yield t.onSessionRequest({topic:o,payload:a,attestation:c,encryptedId:d,transportType:u});case"wc_sessionEvent":return yield t.onSessionEventRequest(o,a);case"wc_sessionAuthenticate":return yield t.onSessionAuthenticateRequest({topic:o,payload:a,attestation:c,encryptedId:d,transportType:u});default:return t.client.logger.info(`Unsupported request method ${h}`)}});return function(s){return i.apply(this,arguments)}}()),S(this,"onRelayEventResponse",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,transportType:c}=s,u=(yield t.client.core.history.get(o,a.id)).request.method;switch(u){case"wc_sessionPropose":return t.onSessionProposeResponse(o,a,c);case"wc_sessionSettle":return t.onSessionSettleResponse(o,a);case"wc_sessionUpdate":return t.onSessionUpdateResponse(o,a);case"wc_sessionExtend":return t.onSessionExtendResponse(o,a);case"wc_sessionPing":return t.onSessionPingResponse(o,a);case"wc_sessionRequest":return t.onSessionRequestResponse(o,a);case"wc_sessionAuthenticate":return t.onSessionAuthenticateResponse(o,a);default:return t.client.logger.info(`Unsupported response method ${u}`)}});return function(s){return i.apply(this,arguments)}}()),S(this,"onRelayEventUnknownPayload",i=>{const{topic:s}=i,{message:o}=$("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)}),S(this,"shouldIgnorePairingRequest",i=>{const{topic:s,requestMethod:o}=i,a=this.expectedPairingMethodMap.get(s);return!(!a||a.includes(o))&&!!(a.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),S(this,"onSessionProposeRequest",function(){var i=(0,f.Z)(function*(s){const{topic:o,payload:a,attestation:c,encryptedId:u}=s,{params:d,id:h}=a;try{const p=t.client.core.eventClient.getEvent({topic:o});0===t.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),p?.setError(Et_proposal_listener_not_found)),t.isValidConnect(re({},a.params));const g=d.expiryTimestamp||de(me.wc_sessionPropose.req.ttl),m=re({id:h,pairingTopic:o,expiryTimestamp:g},d);yield t.setProposal(h,m);const y=yield t.getVerifyContext({attestationId:c,hash:at(JSON.stringify(a)),encryptedId:u,metadata:m.proposer.metadata});p?.addTrace(ut_emit_session_proposal),t.client.events.emit("session_proposal",{id:h,params:m,verifyContext:y})}catch(p){yield t.sendError({id:h,topic:o,error:p,rpcOpts:me.wc_sessionPropose.autoReject}),t.client.logger.error(p)}});return function(s){return i.apply(this,arguments)}}()),S(this,"onSessionProposeResponse",function(){var i=(0,f.Z)(function*(s,o,a){const{id:c}=o;if((0,z.isJsonRpcResult)(o)){const{result:u}=o;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const d=t.client.proposal.get(c);t.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const h=d.proposer.publicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const p=u.responderPublicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:p});const g=yield t.client.core.crypto.generateSharedKey(h,p);t.pendingSessions.set(c,{sessionTopic:g,pairingTopic:s,proposalId:c,publicKey:h});const m=yield t.client.core.relayer.subscribe(g,{transportType:a});t.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),yield t.client.core.pairing.activate({topic:s})}else if((0,z.isJsonRpcError)(o)){yield t.client.proposal.delete(c,te("USER_DISCONNECTED"));const u=ee("session_connect",c);if(0===t.events.listenerCount(u))throw new Error(`emitting ${u} without any listeners, 954`);t.events.emit(u,{error:o.error})}});return function(s,o,a){return i.apply(this,arguments)}}()),S(this,"onSessionSettleRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a,params:c}=o;try{t.isValidSessionSettleRequest(c);const{relay:u,controller:d,expiry:h,namespaces:p,sessionProperties:g,scopedProperties:m,sessionConfig:y}=o.params,v=[...t.pendingSessions.values()].find(w=>w.sessionTopic===s);if(!v)return t.client.logger.error(`Pending session not found for topic ${s}`);const _=t.client.proposal.get(v.proposalId),b=Ne(re(re(re({topic:s,relay:u,expiry:h,namespaces:p,acknowledged:!0,pairingTopic:v.pairingTopic,requiredNamespaces:_.requiredNamespaces,optionalNamespaces:_.optionalNamespaces,controller:d.publicKey,self:{publicKey:v.publicKey,metadata:t.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},g&&{sessionProperties:g}),m&&{scopedProperties:m}),y&&{sessionConfig:y}),{transportType:oe.relay});yield t.client.session.set(b.topic,b),yield t.setExpiry(b.topic,b.expiry),yield t.client.core.pairing.updateMetadata({topic:v.pairingTopic,metadata:b.peer.metadata}),t.client.events.emit("session_connect",{session:b}),t.events.emit(ee("session_connect",v.proposalId),{session:b}),t.pendingSessions.delete(v.proposalId),t.deleteProposal(v.proposalId,!1),t.cleanupDuplicatePairings(b),yield t.sendResult({id:o.id,topic:s,result:!0,throwOnFailedPublish:!0})}catch(u){yield t.sendError({id:a,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionSettleResponse",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;(0,z.isJsonRpcResult)(o)?(yield t.client.session.update(s,{acknowledged:!0}),t.events.emit(ee("session_approve",a),{})):(0,z.isJsonRpcError)(o)&&(yield t.client.session.delete(s,te("USER_DISCONNECTED")),t.events.emit(ee("session_approve",a),{error:o.error}))});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionUpdateRequest",function(){var i=(0,f.Z)(function*(s,o){const{params:a,id:c}=o;try{const u=`${s}_session_update`,d=er.get(u);if(d&&t.isRequestOutOfSync(d,c))return t.client.logger.warn(`Discarding out of sync request - ${c}`),void t.sendError({id:c,topic:s,error:te("INVALID_UPDATE_REQUEST")});t.isValidUpdate(re({topic:s},a));try{er.set(u,c),yield t.client.session.update(s,{namespaces:a.namespaces}),yield t.sendResult({id:c,topic:s,result:!0,throwOnFailedPublish:!0})}catch(h){throw er.delete(u),h}t.client.events.emit("session_update",{id:c,topic:s,params:a})}catch(u){yield t.sendError({id:c,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"isRequestOutOfSync",(i,s)=>s.toString().slice(0,-3)<i.toString().slice(0,-3)),S(this,"onSessionUpdateResponse",(i,s)=>{const{id:o}=s,a=ee("session_update",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_update",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_update",o),{error:s.error})}),S(this,"onSessionExtendRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidExtend({topic:s}),yield t.setExpiry(s,de(wn)),yield t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.client.events.emit("session_extend",{id:a,topic:s})}catch(c){yield t.sendError({id:a,topic:s,error:c}),t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionExtendResponse",(i,s)=>{const{id:o}=s,a=ee("session_extend",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_extend",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_extend",o),{error:s.error})}),S(this,"onSessionPingRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidPing({topic:s}),yield t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.client.events.emit("session_ping",{id:a,topic:s})}catch(c){yield t.sendError({id:a,topic:s,error:c}),t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionPingResponse",(i,s)=>{const{id:o}=s,a=ee("session_ping",o);setTimeout(()=>{if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners 2176`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_ping",o),{}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_ping",o),{error:s.error})},500)}),S(this,"onSessionDeleteRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a}=o;try{t.isValidDisconnect({topic:s,reason:o.params}),Promise.all([new Promise(c=>{t.client.core.relayer.once(ge_publish,(0,f.Z)(function*(){c(yield t.deleteSession({topic:s,id:a}))}))}),t.sendResult({id:a,topic:s,result:!0,throwOnFailedPublish:!0}),t.cleanupPendingSentRequestsForTopic({topic:s,error:te("USER_DISCONNECTED")})]).catch(c=>t.client.logger.error(c))}catch(c){t.client.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionRequest",function(){var i=(0,f.Z)(function*(s){var o,a,c;const{topic:u,payload:d,attestation:h,encryptedId:p,transportType:g}=s,{id:m,params:y}=d;try{yield t.isValidRequest(re({topic:u},y));const v=t.client.session.get(u),b={id:m,topic:u,params:y,verifyContext:yield t.getVerifyContext({attestationId:h,hash:at(JSON.stringify((0,z.formatJsonRpcRequest)("wc_sessionRequest",y,m))),encryptedId:p,metadata:v.peer.metadata,transportType:g})};yield t.setPendingSessionRequest(b),g===oe.link_mode&&null!=(o=v.peer.metadata.redirect)&&o.universal&&t.client.core.addLinkModeSupportedApp(null==(a=v.peer.metadata.redirect)?void 0:a.universal),null!=(c=t.client.signConfig)&&c.disableRequestQueue?t.emitSessionRequest(b):(t.addSessionRequestToSessionRequestQueue(b),t.processSessionRequestQueue())}catch(v){yield t.sendError({id:m,topic:u,error:v}),t.client.logger.error(v)}});return function(s){return i.apply(this,arguments)}}()),S(this,"onSessionRequestResponse",(i,s)=>{const{id:o}=s,a=ee("session_request",o);if(0===this.events.listenerCount(a))throw new Error(`emitting ${a} without any listeners`);(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_request",o),{result:s.result}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_request",o),{error:s.error})}),S(this,"onSessionEventRequest",function(){var i=(0,f.Z)(function*(s,o){const{id:a,params:c}=o;try{const u=`${s}_session_event_${c.event.name}`,d=er.get(u);if(d&&t.isRequestOutOfSync(d,a))return void t.client.logger.info(`Discarding out of sync request - ${a}`);t.isValidEmit(re({topic:s},c)),t.client.events.emit("session_event",{id:a,topic:s,params:c}),er.set(u,a)}catch(u){yield t.sendError({id:a,topic:s,error:u}),t.client.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),S(this,"onSessionAuthenticateResponse",(i,s)=>{const{id:o}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:s}),(0,z.isJsonRpcResult)(s)?this.events.emit(ee("session_request",o),{result:s.result}):(0,z.isJsonRpcError)(s)&&this.events.emit(ee("session_request",o),{error:s.error})}),S(this,"onSessionAuthenticateRequest",function(){var i=(0,f.Z)(function*(s){var o;const{topic:a,payload:c,attestation:u,encryptedId:d,transportType:h}=s;try{const{requester:p,authPayload:g,expiryTimestamp:m}=c.params,y=yield t.getVerifyContext({attestationId:u,hash:at(JSON.stringify(c)),encryptedId:d,metadata:p.metadata,transportType:h}),v={requester:p,pairingTopic:a,id:c.id,authPayload:g,verifyContext:y,expiryTimestamp:m};yield t.setAuthRequest(c.id,{request:v,pairingTopic:a,transportType:h}),h===oe.link_mode&&null!=(o=p.metadata.redirect)&&o.universal&&t.client.core.addLinkModeSupportedApp(p.metadata.redirect.universal),t.client.events.emit("session_authenticate",{topic:a,params:c.params,id:c.id,verifyContext:y})}catch(p){t.client.logger.error(p);const g=c.params.requester.publicKey,m=yield t.client.core.crypto.generateKeyPair(),y=t.getAppLinkIfEnabled(c.params.requester.metadata,h),v={type:xt,receiverPublicKey:g,senderPublicKey:m};yield t.sendError({id:c.id,topic:a,error:p,encodeOpts:v,rpcOpts:me.wc_sessionAuthenticate.autoReject,appLink:y})}});return function(s){return i.apply(this,arguments)}}()),S(this,"addSessionRequestToSessionRequestQueue",i=>{this.sessionRequestQueue.queue.push(i)}),S(this,"cleanupAfterResponse",i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=dt_idle,this.processSessionRequestQueue()},(0,j.toMiliseconds)(this.requestQueueDelay))}),S(this,"cleanupPendingSentRequestsForTopic",({topic:i,error:s})=>{const o=this.client.core.history.pending;o.length>0&&o.filter(a=>a.topic===i&&"wc_sessionRequest"===a.request.method).forEach(a=>{const u=ee("session_request",a.request.id);if(0===this.events.listenerCount(u))throw new Error(`emitting ${u} without any listeners`);this.events.emit(ee("session_request",a.request.id),{error:s})})}),S(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===dt_active)return void this.client.logger.info("session request queue is already active.");const i=this.sessionRequestQueue.queue[0];if(i)try{this.sessionRequestQueue.state=dt_active,this.emitSessionRequest(i)}catch(s){this.client.logger.error(s)}else this.client.logger.info("session request queue is empty.")}),S(this,"emitSessionRequest",i=>{this.client.events.emit("session_request",i)}),S(this,"onPairingCreated",i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);s&&this.onSessionProposeRequest({topic:i.topic,payload:(0,z.formatJsonRpcRequest)("wc_sessionPropose",Ne(re({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id)})}),S(this,"isValidConnect",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:p}=$("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(p)}const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:u,scopedProperties:d,relays:h}=s;if(Ee(o)||(yield t.isValidPairingTopic(o)),!function rg(r,e){let t=!1;return e&&!r?t=!0:r&&et(r)&&r.length&&r.forEach(i=>{t=ec(i)}),t}(h,!0)){const{message:p}=$("MISSING_OR_INVALID",`connect() relays: ${h}`);throw new Error(p)}if(!Ee(a)&&0!==Tt(a)){const p="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(t.client.logger.level)?console.warn(p):t.client.logger.warn(p),t.validateNamespaces(a,"requiredNamespaces")}if(!Ee(c)&&0!==Tt(c)&&t.validateNamespaces(c,"optionalNamespaces"),Ee(u)||t.validateSessionProps(u,"sessionProperties"),!Ee(d)){t.validateSessionProps(d,"scopedProperties");const p=Object.keys(a||{}).concat(Object.keys(c||{}));if(!Object.keys(d).every(g=>p.includes(g)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(d)}, required/optional namespaces: ${JSON.stringify(p)}`)}});return function(s){return i.apply(this,arguments)}}()),S(this,"validateNamespaces",(i,s)=>{const o=function ng(r,e,t){let i=null;if(r&&Tt(r)){const s=Xa(r,e);s&&(i=s);const o=Yf(r,e,t);o&&(i=o)}else i=$("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}(i,"connect()",s);if(o)throw new Error(o.message)}),S(this,"isValidApprove",function(){var i=(0,f.Z)(function*(s){if(!qe(s))throw new Error($("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:o,namespaces:a,relayProtocol:c,sessionProperties:u,scopedProperties:d}=s;t.checkRecentlyDeleted(o),yield t.isValidProposalId(o);const h=t.client.proposal.get(o),p=qr(a,"approve()");if(p)throw new Error(p.message);const g=us(h.requiredNamespaces,a,"approve()");if(g)throw new Error(g.message);if(!ue(c,!0)){const{message:m}=$("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(m)}if(Ee(u)||t.validateSessionProps(u,"sessionProperties"),!Ee(d)){t.validateSessionProps(d,"scopedProperties");const m=new Set(Object.keys(a));if(!Object.keys(d).every(y=>m.has(y)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(d)}, approved namespaces: ${Array.from(m).join(", ")}`)}});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidReject",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:c}=$("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(c)}const{id:o,reason:a}=s;if(t.checkRecentlyDeleted(o),yield t.isValidProposalId(o),!function sg(r){return!!(r&&"object"==typeof r&&r.code&&cs(r.code,!1)&&r.message&&ue(r.message,!1))}(a)){const{message:c}=$("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(c)}});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidSessionSettleRequest",i=>{if(!qe(i)){const{message:h}=$("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(h)}const{relay:s,controller:o,namespaces:a,expiry:c}=i;if(!ec(s)){const{message:h}=$("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const u=function Jf(r,e){let t=null;return ue(r?.publicKey,!1)||(t=$("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}(o,"onSessionSettleRequest()");if(u)throw new Error(u.message);const d=qr(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);if(Ct(c)){const{message:h}=$("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),S(this,"isValidUpdate",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:h}=$("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(h)}const{topic:o,namespaces:a}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o);const c=t.client.session.get(o),u=qr(a,"update()");if(u)throw new Error(u.message);const d=us(c.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidExtend",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:a}=$("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(a)}const{topic:o}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o)});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidRequest",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:h}=$("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(h)}const{topic:o,request:a,chainId:c,expiry:u}=s;t.checkRecentlyDeleted(o),yield t.isValidSessionTopic(o);const{namespaces:d}=t.client.session.get(o);if(!tc(d,c)){const{message:h}=$("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(h)}if(!function og(r){return!(Ee(r)||!ue(r.method,!1))}(a)){const{message:h}=$("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(h)}if(!ug(d,c,a.method)){const{message:h}=$("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(h)}if(u&&!function pg(r,e){return cs(r,!1)&&r<=e.max&&r>=e.min}(u,As)){const{message:h}=$("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${As.min} and ${As.max}`);throw new Error(h)}});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidRespond",function(){var i=(0,f.Z)(function*(s){var o;if(!qe(s)){const{message:u}=$("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(u)}const{topic:a,response:c}=s;try{yield t.isValidSessionTopic(a)}catch(u){throw null!=(o=s?.response)&&o.id&&t.cleanupAfterResponse(s),u}if(!function ag(r){return!(Ee(r)||Ee(r.result)&&Ee(r.error)||!cs(r.id,!1)||!ue(r.jsonrpc,!1))}(c)){const{message:u}=$("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(c)}`);throw new Error(u)}});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidPing",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:a}=$("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield t.isValidSessionOrPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidEmit",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:d}=$("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(d)}const{topic:o,event:a,chainId:c}=s;yield t.isValidSessionTopic(o);const{namespaces:u}=t.client.session.get(o);if(!tc(u,c)){const{message:d}=$("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(d)}if(!function cg(r){return!(Ee(r)||!ue(r.name,!1))}(a)){const{message:d}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!lg(u,c,a.name)){const{message:d}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidDisconnect",function(){var i=(0,f.Z)(function*(s){if(!qe(s)){const{message:a}=$("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield t.isValidSessionOrPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),S(this,"isValidAuthenticate",i=>{const{chains:s,uri:o,domain:a,nonce:c}=i;if(!Array.isArray(s)||0===s.length)throw new Error("chains is required and must be a non-empty array");if(!ue(o,!1))throw new Error("uri is required parameter");if(!ue(a,!1))throw new Error("domain is required parameter");if(!ue(c,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(d=>Ft(d).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:u}=Ft(s[0]);if("eip155"!==u)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),S(this,"getVerifyContext",function(){var i=(0,f.Z)(function*(s){const{attestationId:o,hash:a,encryptedId:c,metadata:u,transportType:d}=s,h={verified:{verifyUrl:u.verifyUrl||nr,validation:"UNKNOWN",origin:u.url||""}};try{if(d===oe.link_mode){const g=t.getAppLinkIfEnabled(u,d);return h.verified.validation=g&&new URL(g).origin===new URL(u.url).origin?"VALID":"INVALID",h}const p=yield t.client.core.verify.resolve({attestationId:o,hash:a,encryptedId:c,verifyUrl:u.verifyUrl});p&&(h.verified.origin=p.origin,h.verified.isScam=p.isScam,h.verified.validation=p.origin===new URL(u.url).origin?"VALID":"INVALID")}catch(p){t.client.logger.warn(p)}return t.client.logger.debug(`Verify context: ${JSON.stringify(h)}`),h});return function(s){return i.apply(this,arguments)}}()),S(this,"validateSessionProps",(i,s)=>{Object.values(i).forEach((o,a)=>{if(null==o){const{message:c}=$("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${o} for key ${Object.keys(i)[a]}`);throw new Error(c)}})}),S(this,"getPendingAuthRequest",i=>{const s=this.client.auth.requests.get(i);return"object"==typeof s?s:void 0}),S(this,"addToRecentlyDeleted",(i,s)=>{if(this.recentlyDeletedMap.set(i,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let o=0;const a=this.recentlyDeletedLimit/2;for(const c of this.recentlyDeletedMap.keys()){if(o++>=a)break;this.recentlyDeletedMap.delete(c)}}}),S(this,"checkRecentlyDeleted",i=>{const s=this.recentlyDeletedMap.get(i);if(s){const{message:o}=$("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${i}`);throw new Error(o)}}),S(this,"isLinkModeEnabled",(i,s)=>{var o,a,c,u,d,h,p,g,m;return!(!i||s!==oe.link_mode)&&(!0===(null==(a=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:a.linkMode)&&void 0!==(null==(u=null==(c=this.client.metadata)?void 0:c.redirect)?void 0:u.universal)&&""!==(null==(h=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:h.universal)&&void 0!==(null==(p=i?.redirect)?void 0:p.universal)&&""!==(null==(g=i?.redirect)?void 0:g.universal)&&!0===(null==(m=i?.redirect)?void 0:m.linkMode)&&this.client.core.linkModeSupportedApps.includes(i.redirect.universal)&&typeof(null==global?void 0:global.Linking)<"u")}),S(this,"getAppLinkIfEnabled",(i,s)=>{var o;return this.isLinkModeEnabled(i,s)?null==(o=i?.redirect)?void 0:o.universal:void 0}),S(this,"handleLinkModeMessage",({url:i})=>{if(!i||!i.includes("wc_ev")||!i.includes("topic"))return;const s=jo(i,"topic")||"",o=decodeURIComponent(jo(i,"wc_ev")||""),a=this.client.session.keys.includes(s);a&&this.client.session.update(s,{transportType:oe.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:o,sessionExists:a})}),S(this,"registerLinkModeListeners",(0,f.Z)(function*(){var i;if(Ci()||Pt()&&null!=(i=t.client.metadata.redirect)&&i.linkMode){const s=null==global?void 0:global.Linking;if(typeof s<"u"){s.addEventListener("url",t.handleLinkModeMessage,t.client.name);const o=yield s.getInitialURL();o&&setTimeout(()=>{t.handleLinkModeMessage({url:o})},50)}}})),S(this,"shouldSetTVF",(i,s)=>{if(!s||"wc_sessionRequest"!==i)return!1;const{request:o}=s;return Object.keys(Jc).includes(o.method)}),S(this,"getTVFParams",(i,s,o)=>{var a,c;try{const u=s.request.method,d=this.extractTxHashesFromResult(u,o);return Ne(re({correlationId:i,rpcMethods:[u],chainId:s.chainId},this.isValidContractData(s.request.params)&&{contractAddresses:[null==(c=null==(a=s.request.params)?void 0:a[0])?void 0:c.to]}),{txHashes:d})}catch(u){this.client.logger.warn("Error getting TVF params",u)}return{}}),S(this,"isValidContractData",i=>{var s;if(!i)return!1;try{const o=i?.data||(null==(s=i?.[0])?void 0:s.data);if(!o.startsWith("0x"))return!1;const a=o.slice(2);return!!/^[0-9a-fA-F]*$/.test(a)&&a.length%2==0}catch{}return!1}),S(this,"extractTxHashesFromResult",(i,s)=>{try{const o=Jc[i];if("string"==typeof s)return[s];const a=s[o.key];if(et(a))return"solana_signAllTransactions"===i?a.map(c=>function Th(r){const e=atob(r),t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);const i=t[0];if(0===i)throw new Error("No signatures found");const s=1+64*i;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const o=Buffer.from(r,"base64").slice(1,65);return Qu.encode(o)}(c)):a;if("string"==typeof a)return[a]}catch(o){this.client.logger.warn("Error extracting tx hashes from result",o)}return[]})}processPendingMessageEvents(){var e=this;return(0,f.Z)(function*(){try{const t=e.client.session.keys,i=e.client.core.relayer.messages.getWithoutAck(t);for(const[s,o]of Object.entries(i))for(const a of o)try{yield e.onProviderMessageEvent({topic:s,message:a,publishedAt:Date.now()})}catch{e.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${a}`)}}catch(t){e.client.logger.warn("processPendingMessageEvents failed",t)}})()}isInitialized(){if(!this.initialized){const{message:e}=$("NOT_INITIALIZED",this.name);throw new Error(e)}}confirmOnlineStateOrThrow(){var e=this;return(0,f.Z)(function*(){yield e.client.core.relayer.confirmOnlineStateOrThrow()})()}registerRelayerEvents(){this.client.core.relayer.on(ge_message,e=>{this.onProviderMessageEvent(e)})}onRelayMessage(e){var t=this;return(0,f.Z)(function*(){const{topic:i,message:s,attestation:o,transportType:a}=e,{publicKey:c}=t.client.auth.authKeys.keys.includes(zr)?t.client.auth.authKeys.get(zr):{responseTopic:void 0,publicKey:void 0};try{const u=yield t.client.core.crypto.decode(i,s,{receiverPublicKey:c,encoding:a===oe.link_mode?Nt:Xe});(0,z.isJsonRpcRequest)(u)?(t.client.core.history.set(i,u),yield t.onRelayEventRequest({topic:i,payload:u,attestation:o,transportType:a,encryptedId:at(s)})):(0,z.isJsonRpcResponse)(u)?(yield t.client.core.history.resolve(u),yield t.onRelayEventResponse({topic:i,payload:u,transportType:a}),t.client.core.history.delete(i,u.id)):yield t.onRelayEventUnknownPayload({topic:i,payload:u,transportType:a}),yield t.client.core.relayer.messages.ack(i,s)}catch(u){t.client.logger.error(u)}})()}registerExpirerEvents(){var e=this;this.client.core.expirer.on(We_expired,function(){var t=(0,f.Z)(function*(i){const{topic:s,id:o}=To(i.target);return o&&e.client.pendingRequest.keys.includes(o)?yield e.deletePendingSessionRequest(o,$("EXPIRED"),!0):o&&e.client.auth.requests.keys.includes(o)?yield e.deletePendingAuthRequest(o,$("EXPIRED"),!0):void(s?e.client.session.keys.includes(s)&&(yield e.deleteSession({topic:s,expirerHasDeleted:!0}),e.client.events.emit("session_expire",{topic:s})):o&&(yield e.deleteProposal(o,!0),e.client.events.emit("proposal_expire",{id:o})))});return function(i){return t.apply(this,arguments)}}())}registerPairingEvents(){this.client.core.pairing.events.on(Ht_create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Ht_delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ue(e,!1)){const{message:t}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ct(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=$("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}isValidSessionTopic(e){var t=this;return(0,f.Z)(function*(){if(!ue(e,!1)){const{message:i}=$("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(t.checkRecentlyDeleted(e),!t.client.session.keys.includes(e)){const{message:i}=$("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Ct(t.client.session.get(e).expiry)){yield t.deleteSession({topic:e});const{message:i}=$("EXPIRED",`session topic: ${e}`);throw new Error(i)}if(!t.client.core.crypto.keychain.has(e)){const{message:i}=$("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw yield t.deleteSession({topic:e}),new Error(i)}})()}isValidSessionOrPairingTopic(e){var t=this;return(0,f.Z)(function*(){if(t.checkRecentlyDeleted(e),t.client.session.keys.includes(e))yield t.isValidSessionTopic(e);else{if(!t.client.core.pairing.pairings.keys.includes(e)){if(ue(e,!1)){const{message:i}=$("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}{const{message:i}=$("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}t.isValidPairingTopic(e)}})()}isValidProposalId(e){var t=this;return(0,f.Z)(function*(){if(!function ig(r){return"number"==typeof r}(e)){const{message:i}=$("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!t.client.proposal.keys.includes(e)){const{message:i}=$("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Ct(t.client.proposal.get(e).expiryTimestamp)){yield t.deleteProposal(e);const{message:i}=$("EXPIRED",`proposal id: ${e}`);throw new Error(i)}})()}}class Lv extends Wt{constructor(e,t){super(e,t,"proposal",Cs),this.core=e,this.logger=t}}class zv extends Wt{constructor(e,t){super(e,t,"session",Cs),this.core=e,this.logger=t}}class Zv extends Wt{constructor(e,t){super(e,t,"request",Cs,i=>i.id),this.core=e,this.logger=t}}class Vv extends Wt{constructor(e,t){super(e,t,"authKeys",Lr,()=>zr),this.core=e,this.logger=t}}class Hv extends Wt{constructor(e,t){super(e,t,"pairingTopics",Lr),this.core=e,this.logger=t}}class Kv extends Wt{constructor(e,t){super(e,t,"requests",Lr,i=>i.id),this.core=e,this.logger=t}}var Gv=Object.defineProperty,Ns=(r,e,t)=>((r,e,t)=>e in r?Gv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Jv{constructor(e,t){this.core=e,this.logger=t,Ns(this,"authKeys"),Ns(this,"pairingTopics"),Ns(this,"requests"),this.authKeys=new Vv(this.core,this.logger),this.pairingTopics=new Hv(this.core,this.logger),this.requests=new Kv(this.core,this.logger)}init(){var e=this;return(0,f.Z)(function*(){yield e.authKeys.init(),yield e.pairingTopics.init(),yield e.requests.init()})()}}var Qv=Object.defineProperty,W=(r,e,t)=>((r,e,t)=>e in r?Qv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Ts extends zg{constructor(e){var t;super(e),t=this,W(this,"protocol","wc"),W(this,"version",2),W(this,"name",Os_name),W(this,"metadata"),W(this,"core"),W(this,"logger"),W(this,"events",new pt.EventEmitter),W(this,"engine"),W(this,"session"),W(this,"proposal"),W(this,"pendingRequest"),W(this,"auth"),W(this,"signConfig"),W(this,"on",(s,o)=>this.events.on(s,o)),W(this,"once",(s,o)=>this.events.once(s,o)),W(this,"off",(s,o)=>this.events.off(s,o)),W(this,"removeListener",(s,o)=>this.events.removeListener(s,o)),W(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),W(this,"connect",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.connect(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"pair",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.pair(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"approve",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.approve(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"reject",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.reject(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"update",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.update(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"extend",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.extend(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"request",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.request(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"respond",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.respond(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"ping",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.ping(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"emit",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.emit(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"disconnect",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.disconnect(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"find",s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}}),W(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),W(this,"authenticate",function(){var s=(0,f.Z)(function*(o,a){try{return yield t.engine.authenticate(o,a)}catch(c){throw t.logger.error(c.message),c}});return function(o,a){return s.apply(this,arguments)}}()),W(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(o){throw this.logger.error(o.message),o}}),W(this,"approveSessionAuthenticate",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.approveSessionAuthenticate(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),W(this,"rejectSessionAuthenticate",function(){var s=(0,f.Z)(function*(o){try{return yield t.engine.rejectSessionAuthenticate(o)}catch(a){throw t.logger.error(a.message),a}});return function(o){return s.apply(this,arguments)}}()),this.name=e?.name||Os_name,this.metadata=Zd(e?.metadata),this.signConfig=e?.signConfig;const i=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,K.gw)((0,K.jI)({level:e?.logger||Os_logger}));this.core=e?.core||new Iv(e),this.logger=(0,K.Ep)(i,this.name),this.session=new zv(this.core,this.logger),this.proposal=new Lv(this.core,this.logger),this.pendingRequest=new Zv(this.core,this.logger),this.engine=new Mv(this),this.auth=new Jv(this.core,this.logger)}static init(e){return(0,f.Z)(function*(){const t=new Ts(e);return yield t.initialize(),t})()}get context(){return(0,K.Fd)(this.logger)}get pairing(){return this.core.pairing.pairings}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized");try{yield e.core.start(),yield e.session.init(),yield e.proposal.init(),yield e.pendingRequest.init(),yield e.auth.init(),yield e.engine.init(),e.logger.info("SignClient Initialization Success"),setTimeout(()=>{e.engine.processRelayMessageCache()},(0,j.toMiliseconds)(j.ONE_SECOND))}catch(t){throw e.logger.info("SignClient Initialization Failure"),e.logger.error(t.message),t}})()}}var it=B(20901);const Zr="wc@2:universal_provider:",Xc="https://rpc.walletconnect.org/v1/",xn="generic",nb=`${Xc}bundler`,Je_DEFAULT_CHAIN_CHANGED="default_chain_changed";function rb(){}function $s(r){return null==r||"object"!=typeof r&&"function"!=typeof r}function js(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function eu(r){return"object"==typeof r&&null!==r}function tu(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function nu(r){return null==r?void 0===r?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const sb="[object RegExp]",ru="[object String]",iu="[object Number]",su="[object Boolean]",ou="[object Arguments]",ob="[object Symbol]",ab="[object Date]",cb="[object Map]",ub="[object Set]",lb="[object Array]",db="[object ArrayBuffer]",hb="[object Object]",pb="[object DataView]",fb="[object Uint8Array]",gb="[object Uint8ClampedArray]",yb="[object Uint16Array]",mb="[object Uint32Array]",_b="[object Int8Array]",vb="[object Int16Array]",bb="[object Int32Array]",wb="[object Float32Array]",xb="[object Float64Array]";function En(r,e,t,i=new Map,s=void 0){const o=s?.(r,e,t,i);if(null!=o)return o;if($s(r))return r;if(i.has(r))return i.get(r);if(Array.isArray(r)){const a=new Array(r.length);i.set(r,a);for(let c=0;c<r.length;c++)a[c]=En(r[c],c,t,i,s);return Object.hasOwn(r,"index")&&(a.index=r.index),Object.hasOwn(r,"input")&&(a.input=r.input),a}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const a=new RegExp(r.source,r.flags);return a.lastIndex=r.lastIndex,a}if(r instanceof Map){const a=new Map;i.set(r,a);for(const[c,u]of r)a.set(c,En(u,c,t,i,s));return a}if(r instanceof Set){const a=new Set;i.set(r,a);for(const c of r)a.add(En(c,void 0,t,i,s));return a}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(js(r)){const a=new(Object.getPrototypeOf(r).constructor)(r.length);i.set(r,a);for(let c=0;c<r.length;c++)a[c]=En(r[c],c,t,i,s);return a}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const a=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return i.set(r,a),Jt(a,r,t,i,s),a}if(typeof File<"u"&&r instanceof File){const a=new File([r],r.name,{type:r.type});return i.set(r,a),Jt(a,r,t,i,s),a}if(r instanceof Blob){const a=new Blob([r],{type:r.type});return i.set(r,a),Jt(a,r,t,i,s),a}if(r instanceof Error){const a=new r.constructor;return i.set(r,a),a.message=r.message,a.name=r.name,a.stack=r.stack,a.cause=r.cause,Jt(a,r,t,i,s),a}if("object"==typeof r&&function Db(r){switch(nu(r)){case ou:case lb:case db:case pb:case su:case ab:case wb:case xb:case _b:case vb:case bb:case cb:case iu:case hb:case sb:case ub:case ru:case ob:case fb:case gb:case yb:case mb:return!0;default:return!1}}(r)){const a=Object.create(Object.getPrototypeOf(r));return i.set(r,a),Jt(a,r,t,i,s),a}return r}function Jt(r,e,t=r,i,s){const o=[...Object.keys(e),...tu(e)];for(let a=0;a<o.length;a++){const c=o[a],u=Object.getOwnPropertyDescriptor(r,c);(null==u||u.writable)&&(r[c]=En(e[c],c,t,i,s))}}function Ib(r,e){return function Eb(r,e){return En(r,void 0,r,new Map,e)}(r,(t,i,s,o)=>{const a=e?.(t,i,s,o);if(null!=a)return a;if("object"==typeof r)switch(Object.prototype.toString.call(r)){case iu:case ru:case su:{const c=new r.constructor(r?.valueOf());return Jt(c,r),c}case ou:{const c={};return Jt(c,r),c.length=r.length,c[Symbol.iterator]=r[Symbol.iterator],c}default:return}})}function au(r){return Ib(r)}function cu(r){return null!==r&&"object"==typeof r&&"[object Arguments]"===nu(r)}function Pb(r){return js(r)}function Sb(r){if("object"!=typeof r||null==r)return!1;if(null===Object.getPrototypeOf(r))return!0;if("[object Object]"!==Object.prototype.toString.call(r)){const t=r[Symbol.toStringTag];return!(null==t||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable)&&r.toString()===`[object ${t}]`}let e=r;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function Fs(r,e,t,i){if($s(r)&&(r=Object(r)),null==e||"object"!=typeof e)return r;if(i.has(e))return function ib(r){if($s(r))return r;if(Array.isArray(r)||js(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const i=new t(r);return i.lastIndex=r.lastIndex,i}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const i=new t(r.message);return i.stack=r.stack,i.name=r.name,i.cause=r.cause,i}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if("object"==typeof r){const i=Object.create(e);return Object.assign(i,r)}return r}(i.get(e));if(i.set(e,r),Array.isArray(e)){e=e.slice();for(let o=0;o<e.length;o++)e[o]=e[o]??void 0}const s=[...Object.keys(e),...tu(e)];for(let o=0;o<s.length;o++){const a=s[o];let c=e[a],u=r[a];if(cu(c)&&(c={...c}),cu(u)&&(u={...u}),typeof Buffer<"u"&&Buffer.isBuffer(c)&&(c=au(c)),Array.isArray(c))if("object"==typeof u&&null!=u){const h=[],p=Reflect.ownKeys(u);for(let g=0;g<p.length;g++){const m=p[g];h[m]=u[m]}u=h}else u=[];const d=t(u,c,a,r,e,i);null!=d?r[a]=d:Array.isArray(c)||eu(u)&&eu(c)?r[a]=Fs(u,c,t,i):null==u&&Sb(c)?r[a]=Fs({},c,t,i):null==u&&Pb(c)?r[a]=au(c):(void 0===u||void 0!==c)&&(r[a]=c)}return r}function Ob(r,...e){return function Cb(r,...e){const t=e.slice(0,-1),i=e[e.length-1];let s=r;for(let o=0;o<t.length;o++)s=Fs(s,t[o],i,new Map);return s}(r,...e,rb)}var Ab=Object.defineProperty,Rb=Object.defineProperties,Nb=Object.getOwnPropertyDescriptors,uu=Object.getOwnPropertySymbols,Tb=Object.prototype.hasOwnProperty,$b=Object.prototype.propertyIsEnumerable,lu=(r,e,t)=>e in r?Ab(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vr=(r,e)=>{for(var t in e||(e={}))Tb.call(e,t)&&lu(r,t,e[t]);if(uu)for(var t of uu(e))$b.call(e,t)&&lu(r,t,e[t]);return r},jb=(r,e)=>Rb(r,Nb(e));function ze(r,e,t){var i;const s=Ft(r);return(null==(i=e.rpcMap)?void 0:i[s.reference])||`${Xc}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function Qt(r){return r.includes(":")?r.split(":")[1]:r}function du(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Hr(r={},e={}){return Ob(hu(r),hu(e))}function hu(r){var e,t,i,s,o;const a={};if(!Tt(r))return a;for(const[c,u]of Object.entries(r)){const d=$r(c)?[c]:u.chains,h=u.methods||[],p=u.events||[],g=u.rpcMap||{},m=_n(c);a[m]=jb(Vr(Vr({},a[m]),u),{chains:je(d,null==(e=a[m])?void 0:e.chains),methods:je(h,null==(t=a[m])?void 0:t.methods),events:je(p,null==(i=a[m])?void 0:i.events)}),(Tt(g)||Tt((null==(s=a[m])?void 0:s.rpcMap)||{}))&&(a[m].rpcMap=Vr(Vr({},g),null==(o=a[m])?void 0:o.rpcMap))}return a}function pu(r){return r.includes(":")?r.split(":")[2]:r}function fu(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],o=i.events||[],a=i.accounts||[],c=$r(t)?[t]:i.chains?i.chains:du(i.accounts);e[t]={chains:c,methods:s,events:o,accounts:a}}return e}function qs(r){return"number"==typeof r?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const gu={},Y=r=>gu[r],Us=(r,e)=>{gu[r]=e};var qb=Object.defineProperty,Dn=(r,e,t)=>((r,e,t)=>e in r?qb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class kb{constructor(e){Dn(this,"name","polkadot"),Dn(this,"client"),Dn(this,"httpProviders"),Dn(this,"events"),Dn(this,"namespace"),Dn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Qt(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var Bb=Object.defineProperty,Mb=Object.defineProperties,Lb=Object.getOwnPropertyDescriptors,yu=Object.getOwnPropertySymbols,zb=Object.prototype.hasOwnProperty,Zb=Object.prototype.propertyIsEnumerable,ks=(r,e,t)=>e in r?Bb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mu=(r,e)=>{for(var t in e||(e={}))zb.call(e,t)&&ks(r,t,e[t]);if(yu)for(var t of yu(e))Zb.call(e,t)&&ks(r,t,e[t]);return r},_u=(r,e)=>Mb(r,Lb(e)),In=(r,e,t)=>ks(r,"symbol"!=typeof e?e+"":e,t);class Vb{constructor(e){In(this,"name","eip155"),In(this,"client"),In(this,"chainId"),In(this,"namespace"),In(this,"httpProviders"),In(this,"events"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}request(e){var t=this;return(0,f.Z)(function*(){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return t.getAccounts();case"wallet_switchEthereumChain":return yield t.handleSwitchChain(e);case"eth_chainId":return parseInt(t.getDefaultChain());case"wallet_getCapabilities":return yield t.getCapabilities(e);case"wallet_getCallsStatus":return yield t.getCallStatus(e)}return t.namespace.methods.includes(e.request.method)?yield t.client.request(e):t.getHttpProvider().request(e.request)})()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||ze(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.k(i,Y("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(Qt(t));e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}handleSwitchChain(e){var t=this;return(0,f.Z)(function*(){var i,s;let o=e.request.params?null==(i=e.request.params[0])?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const a=parseInt(o,16);if(t.isChainApproved(a))t.setDefaultChain(`${a}`);else{if(!t.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);yield t.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:o}]},chainId:null==(s=t.namespace.chains)?void 0:s[0]}),t.setDefaultChain(`${a}`)}return null})()}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}getCapabilities(e){var t=this;return(0,f.Z)(function*(){var i,s,o,a,c;const u=null==(s=null==(i=e.request)?void 0:i.params)?void 0:s[0],h=`${u}${((null==(a=null==(o=e.request)?void 0:o.params)?void 0:a[1])||[]).join(",")}`;if(!u)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const p=t.client.session.get(e.topic),g=(null==(c=p?.sessionProperties)?void 0:c.capabilities)||{};if(null!=g&&g[h])return g?.[h];const m=yield t.client.request(e);try{yield t.client.session.update(e.topic,{sessionProperties:_u(mu({},p.sessionProperties||{}),{capabilities:_u(mu({},g||{}),{[h]:m})})})}catch(y){console.warn("Failed to update session with capabilities",y)}return m})()}getCallStatus(e){var t=this;return(0,f.Z)(function*(){var i,s;const o=t.client.session.get(e.topic),a=null==(i=o.sessionProperties)?void 0:i.bundler_name;if(a){const u=t.getBundlerUrl(e.chainId,a);try{return yield t.getUserOperationReceipt(u,e)}catch(d){console.warn("Failed to fetch call status from bundler",d,u)}}const c=null==(s=o.sessionProperties)?void 0:s.bundler_url;if(c)try{return yield t.getUserOperationReceipt(c,e)}catch(u){console.warn("Failed to fetch call status from custom bundler",u,c)}if(t.namespace.methods.includes(e.request.method))return yield t.client.request(e);throw new Error("Fetching call status not approved by the wallet.")})()}getUserOperationReceipt(e,t){return(0,f.Z)(function*(){var i;const s=new URL(e),o=yield fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,z.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!o.ok)throw new Error(`Failed to fetch user operation receipt - ${o.status}`);return yield o.json()})()}getBundlerUrl(e,t){return`${nb}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var Hb=Object.defineProperty,Pn=(r,e,t)=>((r,e,t)=>e in r?Hb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Gb{constructor(e){Pn(this,"name","solana"),Pn(this,"client"),Pn(this,"httpProviders"),Pn(this,"events"),Pn(this,"namespace"),Pn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Qt(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var Wb=Object.defineProperty,Sn=(r,e,t)=>((r,e,t)=>e in r?Wb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class Qb{constructor(e){Sn(this,"name","cosmos"),Sn(this,"client"),Sn(this,"httpProviders"),Sn(this,"events"),Sn(this,"namespace"),Sn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Qt(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var Yb=Object.defineProperty,Cn=(r,e,t)=>((r,e,t)=>e in r?Yb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class e0{constructor(e){Cn(this,"name","algorand"),Cn(this,"client"),Cn(this,"httpProviders"),Cn(this,"events"),Cn(this,"namespace"),Cn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||ze(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var t0=Object.defineProperty,An=(r,e,t)=>((r,e,t)=>e in r?t0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class r0{constructor(e){An(this,"name","cip34"),An(this,"client"),An(this,"httpProviders"),An(this,"events"),An(this,"namespace"),An(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=Qt(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var i0=Object.defineProperty,Rn=(r,e,t)=>((r,e,t)=>e in r?i0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class o0{constructor(e){Rn(this,"name","elrond"),Rn(this,"client"),Rn(this,"httpProviders"),Rn(this,"events"),Rn(this,"namespace"),Rn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Qt(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var a0=Object.defineProperty,Nn=(r,e,t)=>((r,e,t)=>e in r?a0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class u0{constructor(e){Nn(this,"name","multiversx"),Nn(this,"client"),Nn(this,"httpProviders"),Nn(this,"events"),Nn(this,"namespace"),Nn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Qt(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var l0=Object.defineProperty,Tn=(r,e,t)=>((r,e,t)=>e in r?l0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class h0{constructor(e){Tn(this,"name","near"),Tn(this,"client"),Tn(this,"httpProviders"),Tn(this,"events"),Tn(this,"namespace"),Tn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||ze(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace);return typeof i>"u"?void 0:new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var p0=Object.defineProperty,$n=(r,e,t)=>((r,e,t)=>e in r?p0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class g0{constructor(e){$n(this,"name","tezos"),$n(this,"client"),$n(this,"httpProviders"),$n(this,"events"),$n(this,"namespace"),$n(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||ze(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace);return typeof i>"u"?void 0:new Ke.r(new it.Z(i))}}var y0=Object.defineProperty,jn=(r,e,t)=>((r,e,t)=>e in r?y0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t)(r,"symbol"!=typeof e?e+"":e,t);class _0{constructor(e){jn(this,"name",xn),jn(this,"client"),jn(this,"httpProviders"),jn(this,"events"),jn(this,"namespace"),jn(this,"chainId"),this.namespace=e.namespace,this.events=Y("events"),this.client=Y("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(Je_DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(s=>{const o=Ft(s);i[`${o.namespace}:${o.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||ze(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ke.r(new it.Z(i,Y("disableProviderPing")))}}var v0=Object.defineProperty,b0=Object.defineProperties,w0=Object.getOwnPropertyDescriptors,vu=Object.getOwnPropertySymbols,x0=Object.prototype.hasOwnProperty,E0=Object.prototype.propertyIsEnumerable,Bs=(r,e,t)=>e in r?v0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kr=(r,e)=>{for(var t in e||(e={}))x0.call(e,t)&&Bs(r,t,e[t]);if(vu)for(var t of vu(e))E0.call(e,t)&&Bs(r,t,e[t]);return r},Ms=(r,e)=>b0(r,w0(e)),Qe=(r,e,t)=>Bs(r,"symbol"!=typeof e?e+"":e,t);class Ls{constructor(e){Qe(this,"client"),Qe(this,"namespaces"),Qe(this,"optionalNamespaces"),Qe(this,"sessionProperties"),Qe(this,"scopedProperties"),Qe(this,"events",new(pi())),Qe(this,"rpcProviders",{}),Qe(this,"session"),Qe(this,"providerOpts"),Qe(this,"logger"),Qe(this,"uri"),Qe(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:(0,K.gw)((0,K.jI)({level:e?.logger||"error"})),this.disableProviderPing=e?.disableProviderPing||!1}static init(e){return(0,f.Z)(function*(){const t=new Ls(e);return yield t.initialize(),t})()}request(e,t,i){var s=this;return(0,f.Z)(function*(){const[o,a]=s.validateChain(t);if(!s.session)throw new Error("Please call connect() before request()");return yield s.getProvider(o).request({request:Kr({},e),chainId:`${o}:${a}`,topic:s.session.topic,expiry:i})})()}sendAsync(e,t,i,s){const o=(new Date).getTime();this.request(e,i,s).then(a=>t(null,(0,z.formatJsonRpcResult)(o,a))).catch(a=>t(a,void 0))}enable(){var e=this;return(0,f.Z)(function*(){if(!e.client)throw new Error("Sign Client not initialized");return e.session||(yield e.connect({namespaces:e.namespaces,optionalNamespaces:e.optionalNamespaces,sessionProperties:e.sessionProperties,scopedProperties:e.scopedProperties})),yield e.requestAccounts()})()}disconnect(){var e=this;return(0,f.Z)(function*(){var t;if(!e.session)throw new Error("Please call connect() before enable()");yield e.client.disconnect({topic:null==(t=e.session)?void 0:t.topic,reason:te("USER_DISCONNECTED")}),yield e.cleanup()})()}connect(e){var t=this;return(0,f.Z)(function*(){if(!t.client)throw new Error("Sign Client not initialized");if(t.setNamespaces(e),yield t.cleanupPendingPairings(),!e.skipPairing)return yield t.pair(e.pairingTopic)})()}authenticate(e,t){var i=this;return(0,f.Z)(function*(){if(!i.client)throw new Error("Sign Client not initialized");i.setNamespaces(e),yield i.cleanupPendingPairings();const{uri:s,response:o}=yield i.client.authenticate(e,t);s&&(i.uri=s,i.events.emit("display_uri",s));const a=yield o();if(i.session=a.session,i.session){const c=fu(i.session.namespaces);i.namespaces=Hr(i.namespaces,c),yield i.persist("namespaces",i.namespaces),i.onConnect()}return a})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}pair(e){var t=this;return(0,f.Z)(function*(){const{uri:i,approval:s}=yield t.client.connect({pairingTopic:e,requiredNamespaces:t.namespaces,optionalNamespaces:t.optionalNamespaces,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties});i&&(t.uri=i,t.events.emit("display_uri",i));const o=yield s();t.session=o;const a=fu(o.namespaces);return t.namespaces=Hr(t.namespaces,a),yield t.persist("namespaces",t.namespaces),yield t.persist("optionalNamespaces",t.optionalNamespaces),t.onConnect(),t.session})()}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),o=this.getProvider(i);o.name===xn?o.setDefaultChain(`${i}:${s}`,t):o.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}cleanupPendingPairings(e={}){var t=this;return(0,f.Z)(function*(){t.logger.info("Cleaning up inactive pairings...");const i=t.client.pairing.getAll();if(et(i)){for(const s of i)e.deletePairings?t.client.core.expirer.set(s.topic,0):yield t.client.core.relayer.subscriber.unsubscribe(s.topic);t.logger.info(`Inactive pairings cleared: ${i.length}`)}})()}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}checkStorage(){var e=this;return(0,f.Z)(function*(){e.namespaces=(yield e.getFromStore("namespaces"))||{},e.optionalNamespaces=(yield e.getFromStore("optionalNamespaces"))||{},e.session&&e.createProviders()})()}initialize(){var e=this;return(0,f.Z)(function*(){e.logger.trace("Initialized"),yield e.createClient(),yield e.checkStorage(),e.registerEventListeners()})()}createClient(){var e=this;return(0,f.Z)(function*(){var t,i;if(e.client=e.providerOpts.client||(yield Ts.init({core:e.providerOpts.core,logger:e.providerOpts.logger||"error",relayUrl:e.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:e.providerOpts.projectId,metadata:e.providerOpts.metadata,storageOptions:e.providerOpts.storageOptions,storage:e.providerOpts.storage,name:e.providerOpts.name,customStoragePrefix:e.providerOpts.customStoragePrefix,telemetryEnabled:e.providerOpts.telemetryEnabled})),e.providerOpts.session)try{e.session=e.client.session.get(e.providerOpts.session.topic)}catch(s){throw e.logger.error("Failed to get session",s),new Error(`The provided session: ${null==(i=null==(t=e.providerOpts)?void 0:t.session)?void 0:i.topic} doesn't exist in the Sign client`)}else{const s=e.client.session.getAll();e.session=s[0]}e.logger.trace("SignClient Initialized")})()}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>_n(t)))];Us("client",this.client),Us("events",this.events),Us("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=function Fb(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const o=e.namespaces[s].accounts;i.push(...o)}),i}(t,this.session),s=du(i),o=Hr(this.namespaces,this.optionalNamespaces),a=Ms(Kr({},o[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new Vb({namespace:a});break;case"algorand":this.rpcProviders[t]=new e0({namespace:a});break;case"solana":this.rpcProviders[t]=new Gb({namespace:a});break;case"cosmos":this.rpcProviders[t]=new Qb({namespace:a});break;case"polkadot":this.rpcProviders[t]=new kb({namespace:a});break;case"cip34":this.rpcProviders[t]=new r0({namespace:a});break;case"elrond":this.rpcProviders[t]=new o0({namespace:a});break;case"multiversx":this.rpcProviders[t]=new u0({namespace:a});break;case"near":this.rpcProviders[t]=new h0({namespace:a});break;case"tezos":this.rpcProviders[t]=new g0({namespace:a});break;default:this.rpcProviders[xn]?this.rpcProviders[xn].updateNamespace(a):this.rpcProviders[xn]=new _0({namespace:a})}})}registerEventListeners(){var e=this;if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{var i;const{topic:s}=t;s===(null==(i=this.session)?void 0:i.topic)&&this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{var i;const{params:s,topic:o}=t;if(o!==(null==(i=this.session)?void 0:i.topic))return;const{event:a}=s;if("accountsChanged"===a.name){const c=a.data;c&&et(c)&&this.events.emit("accountsChanged",c.map(pu))}else if("chainChanged"===a.name){const c=s.chainId,u=s.event.data,d=_n(c),h=qs(c)!==qs(u)?`${d}:${qs(u)}`:c;this.onChainChanged(h)}else this.events.emit(a.name,a.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:i})=>{var s,o;if(t!==(null==(s=this.session)?void 0:s.topic))return;const{namespaces:a}=i,c=null==(o=this.client)?void 0:o.session.get(t);this.session=Ms(Kr({},c),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:i})}),this.client.on("session_delete",function(){var t=(0,f.Z)(function*(i){var s;i.topic===(null==(s=e.session)?void 0:s.topic)&&(yield e.cleanup(),e.events.emit("session_delete",i),e.events.emit("disconnect",Ms(Kr({},te("USER_DISCONNECTED")),{data:i.topic})))});return function(i){return t.apply(this,arguments)}}()),this.on(Je_DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[xn]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:o}=e;this.optionalNamespaces=Hr(t,i),this.sessionProperties=s,this.scopedProperties=o}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(a=>_n(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=_n(Object.keys(this.namespaces)[0]);return[s,this.rpcProviders[s].getDefaultChain()]}requestAccounts(){var e=this;return(0,f.Z)(function*(){const[t]=e.validateChain();return yield e.getProvider(t).requestAccounts()})()}onChainChanged(e,t=!1){var i=this;return(0,f.Z)(function*(){if(!i.namespaces)return;const[s,o]=i.validateChain(e);if(!o)return;i.updateNamespaceChain(s,o),i.events.emit("chainChanged",o);const a=i.getProvider(s).getDefaultChain();t||i.getProvider(s).setDefaultChain(o),i.emitAccountsChangedOnChainChange({namespace:s,previousChainId:a,newChainId:e}),yield i.persist("namespaces",i.namespaces)})()}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var s,o;try{if(t===i)return;const a=null==(o=null==(s=this.session)?void 0:s.namespaces[e])?void 0:o.accounts;if(!a)return;const c=a.filter(u=>u.includes(`${i}:`)).map(pu);if(!et(c))return;this.events.emit("accountsChanged",c)}catch(a){this.logger.warn("Failed to emit accountsChanged on chain change",a)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}cleanup(){var e=this;return(0,f.Z)(function*(){e.namespaces=void 0,e.optionalNamespaces=void 0,e.sessionProperties=void 0,yield e.deleteFromStore("namespaces"),yield e.deleteFromStore("optionalNamespaces"),yield e.deleteFromStore("sessionProperties"),e.session=void 0,yield e.cleanupPendingPairings({deletePairings:!0}),yield e.cleanupStorage()})()}persist(e,t){var i=this;return(0,f.Z)(function*(){var s;const o=(null==(s=i.session)?void 0:s.topic)||"";yield i.client.core.storage.setItem(`${Zr}/${e}${o}`,t)})()}getFromStore(e){var t=this;return(0,f.Z)(function*(){var i;const s=(null==(i=t.session)?void 0:i.topic)||"";return yield t.client.core.storage.getItem(`${Zr}/${e}${s}`)})()}deleteFromStore(e){var t=this;return(0,f.Z)(function*(){var i;const s=(null==(i=t.session)?void 0:i.topic)||"";yield t.client.core.storage.removeItem(`${Zr}/${e}${s}`)})()}cleanupStorage(){var e=this;return(0,f.Z)(function*(){var t;try{if((null==(t=e.client)?void 0:t.session.length)>0)return;const i=yield e.client.core.storage.getKeys();for(const s of i)s.startsWith(Zr)&&(yield e.client.core.storage.removeItem(s))}catch(i){e.logger.warn("Failed to cleanup storage",i)}})()}}const D0=Ls,Gr=["eth_sendTransaction","personal_sign"],bu=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Wr=["chainChanged","accountsChanged"],wu=["chainChanged","accountsChanged","message","disconnect","connect"],O0=function(){var r=(0,f.Z)(function*(){const{createAppKit:e}=yield B.e(1171).then(B.bind(B,91171));return e});return function(){return r.apply(this,arguments)}}();var A0=Object.defineProperty,R0=Object.defineProperties,N0=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,T0=Object.prototype.hasOwnProperty,$0=Object.prototype.propertyIsEnumerable,zs=(r,e,t)=>e in r?A0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yt=(r,e)=>{for(var t in e||(e={}))T0.call(e,t)&&zs(r,t,e[t]);if(xu)for(var t of xu(e))$0.call(e,t)&&zs(r,t,e[t]);return r},ur=(r,e)=>R0(r,N0(e)),Ze=(r,e,t)=>zs(r,"symbol"!=typeof e?e+"":e,t);function Jr(r){return Number(r[0].split(":")[1])}function Qr(r){return`0x${r.toString(16)}`}class Yr{constructor(){Ze(this,"events",new pt.EventEmitter),Ze(this,"namespace","eip155"),Ze(this,"accounts",[]),Ze(this,"signer"),Ze(this,"chainId",1),Ze(this,"modal"),Ze(this,"rpc"),Ze(this,"STORAGE_KEY","wc@2:ethereum_provider:"),Ze(this,"on",(e,t)=>(this.events.on(e,t),this)),Ze(this,"once",(e,t)=>(this.events.once(e,t),this)),Ze(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Ze(this,"off",(e,t)=>(this.events.off(e,t),this)),Ze(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static init(e){return(0,f.Z)(function*(){const t=new Yr;return yield t.initialize(e),t})()}request(e,t){var i=this;return(0,f.Z)(function*(){return yield i.signer.request(e,i.formatChainId(i.chainId),t)})()}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}enable(){var e=this;return(0,f.Z)(function*(){return e.session||(yield e.connect()),yield e.request({method:"eth_requestAccounts"})})()}connect(e){var t=this;return(0,f.Z)(function*(){var i;if(!t.signer.client)throw new Error("Provider not initialized. Call init() first");t.loadConnectOpts(e);const{required:s,optional:o}=function j0(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:o,optionalEvents:a,rpcMap:c}=r;if(!et(e))throw new Error("Invalid chains");const u={chains:e,methods:i||Gr,events:o||Wr,rpcMap:Yt({},e.length?{[Jr(e)]:c[Jr(e)]}:{})},d=o?.filter(m=>!Wr.includes(m)),h=i?.filter(m=>!Gr.includes(m));if(!(t||a||s||null!=d&&d.length||null!=h&&h.length))return{required:e.length?u:void 0};const g={chains:[...new Set(d?.length&&h?.length||!t?u.chains.concat(t||[]):t)],methods:[...new Set(u.methods.concat(null!=s&&s.length?s:bu))],events:[...new Set(u.events.concat(null!=a&&a.length?a:wu))],rpcMap:c};return{required:e.length?u:void 0,optional:t.length?g:void 0}}(t.rpc);try{const a=yield new Promise(function(){var u=(0,f.Z)(function*(d,h){var p,g;t.rpc.showQrModal&&(null==(p=t.modal)||p.open(),null==(g=t.modal)||g.subscribeState(y=>{!y.open&&!t.signer.session&&(t.signer.abortPairingAttempt(),h(new Error("Connection request reset. Please try again.")))}));const m=null!=e&&e.scopedProperties?{[t.namespace]:e.scopedProperties}:void 0;yield t.signer.connect(ur(Yt({namespaces:Yt({},s&&{[t.namespace]:s})},o&&{optionalNamespaces:{[t.namespace]:o}}),{pairingTopic:e?.pairingTopic,scopedProperties:m})).then(y=>{d(y)}).catch(y=>{var v;null==(v=t.modal)||v.showErrorMessage("Unable to connect"),h(new Error(y.message))})});return function(d,h){return u.apply(this,arguments)}}());if(!a)return;const c=Do(a.namespaces,[t.namespace]);t.setChainIds(t.rpc.chains.length?t.rpc.chains:c),t.setAccounts(c),t.events.emit("connect",{chainId:Qr(t.chainId)})}catch(a){throw t.signer.logger.error(a),a}finally{null==(i=t.modal)||i.close()}})()}authenticate(e,t){var i=this;return(0,f.Z)(function*(){var s;if(!i.signer.client)throw new Error("Provider not initialized. Call init() first");i.loadConnectOpts({chains:e?.chains});try{const o=yield new Promise(function(){var c=(0,f.Z)(function*(u,d){var h,p;i.rpc.showQrModal&&(null==(h=i.modal)||h.open(),null==(p=i.modal)||p.subscribeState(g=>{!g.open&&!i.signer.session&&(i.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),yield i.signer.authenticate(ur(Yt({},e),{chains:i.rpc.chains}),t).then(g=>{u(g)}).catch(g=>{var m;null==(m=i.modal)||m.showErrorMessage("Unable to connect"),d(new Error(g.message))})});return function(u,d){return c.apply(this,arguments)}}()),a=o.session;if(a){const c=Do(a.namespaces,[i.namespace]);i.setChainIds(i.rpc.chains.length?i.rpc.chains:c),i.setAccounts(c),i.events.emit("connect",{chainId:Qr(i.chainId)})}return o}catch(o){throw i.signer.logger.error(o),o}finally{null==(s=i.modal)||s.close()}})()}disconnect(){var e=this;return(0,f.Z)(function*(){e.session&&(yield e.signer.disconnect()),e.reset()})()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;"accountsChanged"===i.name?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===i.name?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Qr(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ur(Yt({},te("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Qr(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=null!=(t=e?.chains)?t:[],o=null!=(i=e?.optionalChains)?i:[],a=s.concat(o);if(!a.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const c=s.length?e?.methods||Gr:[],u=s.length?e?.events||Wr:[],d=e?.optionalMethods||[],h=e?.optionalEvents||[],p=e?.rpcMap||this.buildRpcMap(a,e.projectId),g=e?.qrModalOptions||void 0;return{chains:s?.map(m=>this.formatChainId(m)),optionalChains:o.map(m=>this.formatChainId(m)),methods:c,events:u,optionalMethods:d,optionalEvents:h,rpcMap:p,showQrModal:!(null==e||!e.showQrModal),qrModalOptions:g,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}initialize(e){var t=this;return(0,f.Z)(function*(){if(t.rpc=t.getRpcConfig(e),t.chainId=t.rpc.chains.length?Jr(t.rpc.chains):Jr(t.rpc.optionalChains),t.signer=yield D0.init({projectId:t.rpc.projectId,metadata:t.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),t.registerEventListeners(),yield t.loadPersistedSession(),t.rpc.showQrModal){let i;try{const s=yield O0(),{convertWCMToAppKitOptions:o}=yield Promise.resolve().then(function(){return H0}),a=o(ur(Yt({},t.rpc.qrModalOptions),{chains:[...new Set([...t.rpc.chains,...t.rpc.optionalChains])],metadata:t.rpc.metadata,projectId:t.rpc.projectId}));if(!a.networks.length)throw new Error("No networks found for WalletConnect\xb7");i=s(ur(Yt({},a),{universalProvider:t.signer,manualWCControl:!0}))}catch(s){throw console.warn(s),new Error("To use QR modal, please install @reown/appkit package")}if(i)try{t.modal=i}catch(s){throw t.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}})()}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&et(t)&&(this.rpc.chains=t.map(o=>this.formatChainId(o)),t.forEach(o=>{this.rpc.rpcMap[o]=s?.[o]||this.getRpcUrl(o)})),i&&et(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(o=>this.formatChainId(o)),i.forEach(o=>{this.rpc.rpcMap[o]=s?.[o]||this.getRpcUrl(o)}))}getRpcUrl(e,t){var i;return(null==(i=this.rpc.rpcMap)?void 0:i[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}loadPersistedSession(){var e=this;return(0,f.Z)(function*(){if(e.session)try{const t=yield e.signer.client.core.storage.getItem(`${e.STORAGE_KEY}/chainId`),i=e.session.namespaces[`${e.namespace}:${t}`]?e.session.namespaces[`${e.namespace}:${t}`]:e.session.namespaces[e.namespace];e.setChainIds(t?[e.formatChainId(t)]:i?.accounts),e.setAccounts(i?.accounts)}catch(t){e.signer.logger.error("Failed to load persisted session, clearing state..."),e.signer.logger.error(t),yield e.disconnect().catch(i=>e.signer.logger.warn(i))}})()}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const F0=Yr;var q0=Object.defineProperty,U0=Object.defineProperties,k0=Object.getOwnPropertyDescriptors,Eu=Object.getOwnPropertySymbols,B0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,Du=(r,e,t)=>e in r?q0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Iu=(r,e)=>{for(var t in e||(e={}))B0.call(e,t)&&Du(r,t,e[t]);if(Eu)for(var t of Eu(e))M0.call(e,t)&&Du(r,t,e[t]);return r},L0=(r,e)=>U0(r,k0(e));function z0(r){if(r)return{"--w3m-font-family":r["--wcm-font-family"],"--w3m-accent":r["--wcm-accent-color"],"--w3m-color-mix":r["--wcm-background-color"],"--w3m-z-index":r["--wcm-z-index"]?Number(r["--wcm-z-index"]):void 0,"--w3m-qr-color":r["--wcm-accent-color"],"--w3m-font-size-master":r["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":r["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const Z0=r=>{const[e,t]=r.split(":");return Pu({id:t,caipNetworkId:r,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function Pu(r){return Iu({formatters:void 0,fees:void 0,serializers:void 0},r)}var H0=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function V0(r){var e,t,i,s,o,a,c;const u=null==(e=r.chains)?void 0:e.map(Z0).filter(Boolean);if(0===u.length)throw new Error("At least one chain must be specified");const d=u.find(p=>{var g;return p.id===(null==(g=r.defaultChain)?void 0:g.id)}),h={projectId:r.projectId,networks:u,themeMode:r.themeMode,themeVariables:z0(r.themeVariables),chainImages:r.chainImages,connectorImages:r.walletImages,defaultNetwork:d,metadata:L0(Iu({},r.metadata),{name:(null==(t=r.metadata)?void 0:t.name)||"WalletConnect",description:(null==(i=r.metadata)?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:(null==(s=r.metadata)?void 0:s.url)||"https://walletconnect.org",icons:(null==(o=r.metadata)?void 0:o.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:"NONE"===r.explorerRecommendedWalletIds?[]:Array.isArray(r.explorerRecommendedWalletIds)?r.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===r.explorerExcludedWalletIds?[]:Array.isArray(r.explorerExcludedWalletIds)?r.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(a=r.mobileWallets)&&a.length||null!=(c=r.desktopWallets)&&c.length){const p=[...(r.mobileWallets||[]).map(y=>({id:y.id,name:y.name,links:y.links})),...(r.desktopWallets||[]).map(y=>({id:y.id,name:y.name,links:{native:y.links.native,universal:y.links.universal}}))],g=[...h.featuredWalletIds||[],...h.excludeWalletIds||[]],m=p.filter(y=>!g.includes(y.id));m.length&&(h.customWallets=m)}return h},defineChain:Pu})}}]);